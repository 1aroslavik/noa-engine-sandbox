{"version":3,"file":"bundle.js","mappings":"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","sources":["webpack:///webpack/runtime/chunk loaded","webpack:///../../noa-examples/node_modules/noa-engine/src/lib/shims.js","webpack:///../../noa-examples/node_modules/gl-vec3/add.js","webpack:///../../noa-examples/node_modules/gl-vec3/lerp.js","webpack:///../../noa-examples/node_modules/gl-vec3/copy.js","webpack:///../../noa-examples/node_modules/gl-vec3/angle.js","webpack:///../../noa-examples/node_modules/gl-vec3/sqrDist.js","webpack:///../../noa-examples/node_modules/gl-vec3/squaredDistance.js","webpack:///../../noa-examples/node_modules/gl-vec3/rotateY.js","webpack:///../../noa-examples/node_modules/aabb-3d/index.js","webpack:///../../noa-examples/node_modules/gl-vec3/squaredLength.js","webpack:///../../noa-examples/node_modules/gl-vec3/divide.js","webpack:///../../noa-examples/node_modules/gl-vec3/rotateZ.js","webpack:///../../noa-examples/node_modules/gl-vec3/sub.js","webpack:///../../noa-examples/node_modules/box-intersect/lib/sweep.js","webpack:///../../noa-examples/node_modules/gl-vec3/min.js","webpack:///../../noa-examples/node_modules/gl-vec3/transformQuat.js","webpack:///../../noa-examples/node_modules/ndarray/node_modules/is-buffer/index.js","webpack:///../../noa-examples/node_modules/@jpweeks/typedarray-pool/pool.js","webpack:///../../noa-examples/node_modules/gl-vec3/transformMat4.js","webpack:///../../noa-examples/node_modules/gl-vec3/equals.js","webpack:///../../noa-examples/node_modules/gl-vec3/scale.js","webpack:///../../noa-examples/node_modules/gl-vec3/clone.js","webpack:///../../noa-examples/node_modules/gl-vec3/transformMat3.js","webpack:///../../noa-examples/node_modules/gl-vec3/normalize.js","webpack:///../../noa-examples/node_modules/ent-comp/src/ECS.js","webpack:///../../noa-examples/node_modules/gl-vec3/distance.js","webpack:///../../noa-examples/node_modules/gl-vec3/create.js","webpack:///../../noa-examples/node_modules/gl-vec3/multiply.js","webpack:///../../noa-examples/node_modules/gl-vec3/dot.js","webpack:///../../noa-examples/node_modules/gl-vec3/inverse.js","webpack:///../../noa-examples/node_modules/box-intersect/lib/intersect.js","webpack:///../../noa-examples/node_modules/gl-vec3/dist.js","webpack:///../../noa-examples/node_modules/gl-vec3/fromValues.js","webpack:///../../noa-examples/node_modules/gl-vec3/cross.js","webpack:///../../noa-examples/node_modules/game-inputs/src/inputs.js","webpack:///../../noa-examples/node_modules/noa-engine/src/lib/inputs.js","webpack:///../../noa-examples/node_modules/micro-game-shell/src/micro-game-shell.js","webpack:///../../noa-examples/node_modules/noa-engine/src/lib/container.js","webpack:///../../noa-examples/node_modules/noa-engine/src/lib/camera.js","webpack:///../../noa-examples/node_modules/noa-engine/src/components/position.js","webpack:///../../noa-examples/node_modules/noa-engine/src/components/physics.js","webpack:///../../noa-examples/node_modules/noa-engine/src/components/collideEntities.js","webpack:///../../noa-examples/node_modules/noa-engine/src/components/collideTerrain.js","webpack:///../../noa-examples/node_modules/noa-engine/src/components/fadeOnZoom.js","webpack:///../../noa-examples/node_modules/noa-engine/src/components/followsEntity.js","webpack:///../../noa-examples/node_modules/noa-engine/src/components/mesh.js","webpack:///../../noa-examples/node_modules/noa-engine/src/components/movement.js","webpack:///../../noa-examples/node_modules/noa-engine/src/components/receivesInputs.js","webpack:///../../noa-examples/node_modules/noa-engine/src/components/shadow.js","webpack:///../../noa-examples/node_modules/noa-engine/src/components/smoothCamera.js","webpack:///../../noa-examples/node_modules/noa-engine/src/lib/entities.js","webpack:///../../noa-examples/node_modules/noa-engine/src/lib/util.js","webpack:///../../noa-examples/node_modules/noa-engine/src/lib/objectMesher.js","webpack:///../../noa-examples/node_modules/noa-engine/src/lib/terrainMaterials.js","webpack:///../../noa-examples/node_modules/noa-engine/src/lib/terrainMesher.js","webpack:///../../noa-examples/node_modules/noa-engine/src/lib/registry.js","webpack:///../../noa-examples/node_modules/noa-engine/src/lib/sceneOctreeManager.js","webpack:///../../noa-examples/node_modules/noa-engine/src/lib/rendering.js","webpack:///../../noa-examples/node_modules/voxel-physics-engine/src/rigidBody.js","webpack:///../../noa-examples/node_modules/voxel-physics-engine/src/index.js","webpack:///../../noa-examples/node_modules/noa-engine/src/lib/physics.js","webpack:///../../noa-examples/node_modules/noa-engine/src/lib/chunk.js","webpack:///../../noa-examples/node_modules/noa-engine/src/lib/world.js","webpack:///../../noa-examples/node_modules/noa-engine/src/index.js","webpack:///../../noa-examples/src/hello-world/index.js","webpack:///../../noa-examples/node_modules/gl-vec3/scaleAndAdd.js","webpack:///../../noa-examples/node_modules/gl-vec3/forEach.js","webpack:///../../noa-examples/node_modules/box-intersect/lib/median.js","webpack:///../../noa-examples/node_modules/voxel-aabb-sweep/index.js","webpack:///../../noa-examples/node_modules/gl-vec3/negate.js","webpack:///../../noa-examples/node_modules/is-buffer/index.js","webpack:///../../noa-examples/node_modules/gl-vec3/index.js","webpack:///../../noa-examples/src/textures/grass/ sync nonrecursive \\.png$","webpack:///../../noa-examples/node_modules/box-intersect/lib/partition.js","webpack:///../../noa-examples/node_modules/gl-vec3/subtract.js","webpack:///../../noa-examples/node_modules/gl-vec3/set.js","webpack:///../../noa-examples/node_modules/iota-array/iota.js","webpack:///../../noa-examples/node_modules/ndarray/ndarray.js","webpack:///../../noa-examples/node_modules/gl-vec3/div.js","webpack:///../../noa-examples/node_modules/fast-voxel-raycast/index.js","webpack:///../../noa-examples/node_modules/gl-vec3/exactEquals.js","webpack:///../../noa-examples/node_modules/gl-vec3/epsilon.js","webpack:///../../noa-examples/node_modules/box-intersect/lib/brute.js","webpack:///../../noa-examples/node_modules/ent-comp/src/dataStore.js","webpack:///../../noa-examples/node_modules/gl-vec3/round.js","webpack:///../../noa-examples/node_modules/gl-vec3/floor.js","webpack:///../../noa-examples/node_modules/gl-vec3/random.js","webpack:///../../noa-examples/node_modules/bit-twiddle/twiddle.js","webpack:///../../noa-examples/node_modules/gl-vec3/mul.js","webpack:///../../noa-examples/node_modules/gl-vec3/length.js","webpack:///../../noa-examples/node_modules/gl-vec3/max.js","webpack:///../../noa-examples/node_modules/events/events.js","webpack:///../../noa-examples/node_modules/box-intersect/lib/sort.js","webpack:///../../noa-examples/node_modules/gl-vec3/rotateX.js","webpack:///../../noa-examples/node_modules/box-intersect/index.js","webpack:///../../noa-examples/node_modules/gl-vec3/len.js","webpack:///../../noa-examples/node_modules/gl-vec3/ceil.js","webpack:///../../noa-examples/node_modules/dup/dup.js","webpack:///../../noa-examples/node_modules/gl-vec3/sqrLen.js","webpack:///webpack/bootstrap","webpack:///webpack/runtime/compat get default export","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/global","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///webpack/runtime/publicPath","webpack:///webpack/runtime/jsonp chunk loading","webpack:///webpack/startup"],"sourcesContent":["var deferred = [];\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar [chunkIds, fn, priority] = deferred[i];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","\n/**\n * This works around some old node-style code in a\n * dependency of box-intersect.\n*/\nif (window && !window['global']) {\n    window['global'] = window.globalThis || {}\n}\n\n","module.exports = add;\n\n/**\n * Adds two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @returns {vec3} out\n */\nfunction add(out, a, b) {\n    out[0] = a[0] + b[0]\n    out[1] = a[1] + b[1]\n    out[2] = a[2] + b[2]\n    return out\n}","module.exports = lerp;\n\n/**\n * Performs a linear interpolation between two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @param {Number} t interpolation amount between the two inputs\n * @returns {vec3} out\n */\nfunction lerp(out, a, b, t) {\n    var ax = a[0],\n        ay = a[1],\n        az = a[2]\n    out[0] = ax + t * (b[0] - ax)\n    out[1] = ay + t * (b[1] - ay)\n    out[2] = az + t * (b[2] - az)\n    return out\n}","module.exports = copy;\n\n/**\n * Copy the values from one vec3 to another\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the source vector\n * @returns {vec3} out\n */\nfunction copy(out, a) {\n    out[0] = a[0]\n    out[1] = a[1]\n    out[2] = a[2]\n    return out\n}","module.exports = angle\n\nvar fromValues = require('./fromValues')\nvar normalize = require('./normalize')\nvar dot = require('./dot')\n\n/**\n * Get the angle between two 3D vectors\n * @param {vec3} a The first operand\n * @param {vec3} b The second operand\n * @returns {Number} The angle in radians\n */\nfunction angle(a, b) {\n    var tempA = fromValues(a[0], a[1], a[2])\n    var tempB = fromValues(b[0], b[1], b[2])\n \n    normalize(tempA, tempA)\n    normalize(tempB, tempB)\n \n    var cosine = dot(tempA, tempB)\n\n    if(cosine > 1.0){\n        return 0\n    } else {\n        return Math.acos(cosine)\n    }     \n}\n","module.exports = require('./squaredDistance')\n","module.exports = squaredDistance;\n\n/**\n * Calculates the squared euclidian distance between two vec3's\n *\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @returns {Number} squared distance between a and b\n */\nfunction squaredDistance(a, b) {\n    var x = b[0] - a[0],\n        y = b[1] - a[1],\n        z = b[2] - a[2]\n    return x*x + y*y + z*z\n}","module.exports = rotateY;\n\n/**\n * Rotate a 3D vector around the y-axis\n * @param {vec3} out The receiving vec3\n * @param {vec3} a The vec3 point to rotate\n * @param {vec3} b The origin of the rotation\n * @param {Number} c The angle of rotation\n * @returns {vec3} out\n */\nfunction rotateY(out, a, b, c){\n    var bx = b[0]\n    var bz = b[2]\n\n    // translate point to the origin\n    var px = a[0] - bx\n    var pz = a[2] - bz\n    \n    var sc = Math.sin(c)\n    var cc = Math.cos(c)\n  \n    // perform rotation and translate to correct position\n    out[0] = bx + pz * sc + px * cc\n    out[1] = a[1]\n    out[2] = bz + pz * cc - px * sc\n  \n    return out\n}\n","module.exports = AABB\n\nvar vec3 = require('gl-vec3')\n\nfunction AABB(pos, vec) {\n\n  if(!(this instanceof AABB)) {\n    return new AABB(pos, vec)\n  }\n\n  var pos2 = vec3.create()\n  vec3.add(pos2, pos, vec)\n \n  this.base = vec3.min(vec3.create(), pos, pos2)\n  this.vec = vec3.clone(vec)\n  this.max = vec3.max(vec3.create(), pos, pos2)\n\n  this.mag = vec3.length(this.vec)\n\n}\n\nvar cons = AABB\n  , proto = cons.prototype\n\nproto.width = function() {\n  return this.vec[0]\n}\n\nproto.height = function() {\n  return this.vec[1]\n}\n\nproto.depth = function() {\n  return this.vec[2]\n}\n\nproto.x0 = function() {\n  return this.base[0]\n}\n\nproto.y0 = function() {\n  return this.base[1]\n}\n\nproto.z0 = function() {\n  return this.base[2]\n}\n\nproto.x1 = function() {\n  return this.max[0]\n}\n\nproto.y1 = function() {\n  return this.max[1]\n}\n\nproto.z1 = function() {\n  return this.max[2]\n}\n\nproto.translate = function(by) {\n  vec3.add(this.max, this.max, by)\n  vec3.add(this.base, this.base, by)\n  return this\n}\n\nproto.setPosition = function(pos) {\n  vec3.add(this.max, pos, this.vec)\n  vec3.copy(this.base, pos)\n  return this\n}\n\nproto.expand = function(aabb) {\n  var max = vec3.create()\n    , min = vec3.create()\n\n  vec3.max(max, aabb.max, this.max)\n  vec3.min(min, aabb.base, this.base)\n  vec3.subtract(max, max, min)\n\n  return new AABB(min, max)\n}\n\nproto.intersects = function(aabb) {\n  if(aabb.base[0] > this.max[0]) return false\n  if(aabb.base[1] > this.max[1]) return false\n  if(aabb.base[2] > this.max[2]) return false\n  if(aabb.max[0] < this.base[0]) return false\n  if(aabb.max[1] < this.base[1]) return false\n  if(aabb.max[2] < this.base[2]) return false\n\n  return true\n}\n\nproto.touches = function(aabb) {\n\n  var intersection = this.union(aabb);\n\n  return (intersection !== null) &&\n         ((intersection.width() == 0) ||\n         (intersection.height() == 0) || \n         (intersection.depth() == 0))\n\n}\n\nproto.union = function(aabb) {\n  if(!this.intersects(aabb)) return null\n\n  var base_x = Math.max(aabb.base[0], this.base[0])\n    , base_y = Math.max(aabb.base[1], this.base[1])\n    , base_z = Math.max(aabb.base[2], this.base[2])\n    , max_x = Math.min(aabb.max[0], this.max[0])\n    , max_y = Math.min(aabb.max[1], this.max[1])\n    , max_z = Math.min(aabb.max[2], this.max[2])\n\n  return new AABB([base_x, base_y, base_z], [max_x - base_x, max_y - base_y, max_z - base_z])\n}\n\n\n\n\n","module.exports = squaredLength;\n\n/**\n * Calculates the squared length of a vec3\n *\n * @param {vec3} a vector to calculate squared length of\n * @returns {Number} squared length of a\n */\nfunction squaredLength(a) {\n    var x = a[0],\n        y = a[1],\n        z = a[2]\n    return x*x + y*y + z*z\n}","module.exports = divide;\n\n/**\n * Divides two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @returns {vec3} out\n */\nfunction divide(out, a, b) {\n    out[0] = a[0] / b[0]\n    out[1] = a[1] / b[1]\n    out[2] = a[2] / b[2]\n    return out\n}","module.exports = rotateZ;\n\n/**\n * Rotate a 3D vector around the z-axis\n * @param {vec3} out The receiving vec3\n * @param {vec3} a The vec3 point to rotate\n * @param {vec3} b The origin of the rotation\n * @param {Number} c The angle of rotation\n * @returns {vec3} out\n */\nfunction rotateZ(out, a, b, c){\n    var bx = b[0]\n    var by = b[1]\n\n    //Translate point to the origin\n    var px = a[0] - bx\n    var py = a[1] - by\n  \n    var sc = Math.sin(c)\n    var cc = Math.cos(c)\n\n    // perform rotation and translate to correct position\n    out[0] = bx + px * cc - py * sc\n    out[1] = by + px * sc + py * cc\n    out[2] = a[2]\n  \n    return out\n}\n","module.exports = require('./subtract')\n","'use strict'\n\nmodule.exports = {\n  init:           sqInit,\n  sweepBipartite: sweepBipartite,\n  sweepComplete:  sweepComplete,\n  scanBipartite:  scanBipartite,\n  scanComplete:   scanComplete\n}\n\nvar pool  = require('@jpweeks/typedarray-pool')\nvar bits  = require('bit-twiddle')\nvar isort = require('./sort')\n\n//Flag for blue\nvar BLUE_FLAG = (1<<28)\n\n//1D sweep event queue stuff (use pool to save space)\nvar INIT_CAPACITY      = 1024\nvar RED_SWEEP_QUEUE    = pool.mallocInt32(INIT_CAPACITY)\nvar RED_SWEEP_INDEX    = pool.mallocInt32(INIT_CAPACITY)\nvar BLUE_SWEEP_QUEUE   = pool.mallocInt32(INIT_CAPACITY)\nvar BLUE_SWEEP_INDEX   = pool.mallocInt32(INIT_CAPACITY)\nvar COMMON_SWEEP_QUEUE = pool.mallocInt32(INIT_CAPACITY)\nvar COMMON_SWEEP_INDEX = pool.mallocInt32(INIT_CAPACITY)\nvar SWEEP_EVENTS       = pool.mallocDouble(INIT_CAPACITY * 8)\n\n//Reserves memory for the 1D sweep data structures\nfunction sqInit(count) {\n  var rcount = bits.nextPow2(count)\n  if(RED_SWEEP_QUEUE.length < rcount) {\n    pool.free(RED_SWEEP_QUEUE)\n    RED_SWEEP_QUEUE = pool.mallocInt32(rcount)\n  }\n  if(RED_SWEEP_INDEX.length < rcount) {\n    pool.free(RED_SWEEP_INDEX)\n    RED_SWEEP_INDEX = pool.mallocInt32(rcount)\n  }\n  if(BLUE_SWEEP_QUEUE.length < rcount) {\n    pool.free(BLUE_SWEEP_QUEUE)\n    BLUE_SWEEP_QUEUE = pool.mallocInt32(rcount)\n  }\n  if(BLUE_SWEEP_INDEX.length < rcount) {\n    pool.free(BLUE_SWEEP_INDEX)\n    BLUE_SWEEP_INDEX = pool.mallocInt32(rcount)\n  }\n  if(COMMON_SWEEP_QUEUE.length < rcount) {\n    pool.free(COMMON_SWEEP_QUEUE)\n    COMMON_SWEEP_QUEUE = pool.mallocInt32(rcount)\n  }\n  if(COMMON_SWEEP_INDEX.length < rcount) {\n    pool.free(COMMON_SWEEP_INDEX)\n    COMMON_SWEEP_INDEX = pool.mallocInt32(rcount)\n  }\n  var eventLength = 8 * rcount\n  if(SWEEP_EVENTS.length < eventLength) {\n    pool.free(SWEEP_EVENTS)\n    SWEEP_EVENTS = pool.mallocDouble(eventLength)\n  }\n}\n\n//Remove an item from the active queue in O(1)\nfunction sqPop(queue, index, count, item) {\n  var idx = index[item]\n  var top = queue[count-1]\n  queue[idx] = top\n  index[top] = idx\n}\n\n//Insert an item into the active queue in O(1)\nfunction sqPush(queue, index, count, item) {\n  queue[count] = item\n  index[item]  = count\n}\n\n//Recursion base case: use 1D sweep algorithm\nfunction sweepBipartite(\n    d, visit,\n    redStart,  redEnd, red, redIndex,\n    blueStart, blueEnd, blue, blueIndex) {\n\n  //store events as pairs [coordinate, idx]\n  //\n  //  red create:  -(idx+1)\n  //  red destroy: idx\n  //  blue create: -(idx+BLUE_FLAG)\n  //  blue destroy: idx+BLUE_FLAG\n  //\n  var ptr      = 0\n  var elemSize = 2*d\n  var istart   = d-1\n  var iend     = elemSize-1\n\n  for(var i=redStart; i<redEnd; ++i) {\n    var idx = redIndex[i]\n    var redOffset = elemSize*i\n    SWEEP_EVENTS[ptr++] = red[redOffset+istart]\n    SWEEP_EVENTS[ptr++] = -(idx+1)\n    SWEEP_EVENTS[ptr++] = red[redOffset+iend]\n    SWEEP_EVENTS[ptr++] = idx\n  }\n\n  for(var i=blueStart; i<blueEnd; ++i) {\n    var idx = blueIndex[i]+BLUE_FLAG\n    var blueOffset = elemSize*i\n    SWEEP_EVENTS[ptr++] = blue[blueOffset+istart]\n    SWEEP_EVENTS[ptr++] = -idx\n    SWEEP_EVENTS[ptr++] = blue[blueOffset+iend]\n    SWEEP_EVENTS[ptr++] = idx\n  }\n\n  //process events from left->right\n  var n = ptr >>> 1\n  isort(SWEEP_EVENTS, n)\n  \n  var redActive  = 0\n  var blueActive = 0\n  for(var i=0; i<n; ++i) {\n    var e = SWEEP_EVENTS[2*i+1]|0\n    if(e >= BLUE_FLAG) {\n      //blue destroy event\n      e = (e-BLUE_FLAG)|0\n      sqPop(BLUE_SWEEP_QUEUE, BLUE_SWEEP_INDEX, blueActive--, e)\n    } else if(e >= 0) {\n      //red destroy event\n      sqPop(RED_SWEEP_QUEUE, RED_SWEEP_INDEX, redActive--, e)\n    } else if(e <= -BLUE_FLAG) {\n      //blue create event\n      e = (-e-BLUE_FLAG)|0\n      for(var j=0; j<redActive; ++j) {\n        var retval = visit(RED_SWEEP_QUEUE[j], e)\n        if(retval !== void 0) {\n          return retval\n        }\n      }\n      sqPush(BLUE_SWEEP_QUEUE, BLUE_SWEEP_INDEX, blueActive++, e)\n    } else {\n      //red create event\n      e = (-e-1)|0\n      for(var j=0; j<blueActive; ++j) {\n        var retval = visit(e, BLUE_SWEEP_QUEUE[j])\n        if(retval !== void 0) {\n          return retval\n        }\n      }\n      sqPush(RED_SWEEP_QUEUE, RED_SWEEP_INDEX, redActive++, e)\n    }\n  }\n}\n\n//Complete sweep\nfunction sweepComplete(d, visit, \n  redStart, redEnd, red, redIndex,\n  blueStart, blueEnd, blue, blueIndex) {\n\n  var ptr      = 0\n  var elemSize = 2*d\n  var istart   = d-1\n  var iend     = elemSize-1\n\n  for(var i=redStart; i<redEnd; ++i) {\n    var idx = (redIndex[i]+1)<<1\n    var redOffset = elemSize*i\n    SWEEP_EVENTS[ptr++] = red[redOffset+istart]\n    SWEEP_EVENTS[ptr++] = -idx\n    SWEEP_EVENTS[ptr++] = red[redOffset+iend]\n    SWEEP_EVENTS[ptr++] = idx\n  }\n\n  for(var i=blueStart; i<blueEnd; ++i) {\n    var idx = (blueIndex[i]+1)<<1\n    var blueOffset = elemSize*i\n    SWEEP_EVENTS[ptr++] = blue[blueOffset+istart]\n    SWEEP_EVENTS[ptr++] = (-idx)|1\n    SWEEP_EVENTS[ptr++] = blue[blueOffset+iend]\n    SWEEP_EVENTS[ptr++] = idx|1\n  }\n\n  //process events from left->right\n  var n = ptr >>> 1\n  isort(SWEEP_EVENTS, n)\n  \n  var redActive    = 0\n  var blueActive   = 0\n  var commonActive = 0\n  for(var i=0; i<n; ++i) {\n    var e     = SWEEP_EVENTS[2*i+1]|0\n    var color = e&1\n    if(i < n-1 && (e>>1) === (SWEEP_EVENTS[2*i+3]>>1)) {\n      color = 2\n      i += 1\n    }\n    \n    if(e < 0) {\n      //Create event\n      var id = -(e>>1) - 1\n\n      //Intersect with common\n      for(var j=0; j<commonActive; ++j) {\n        var retval = visit(COMMON_SWEEP_QUEUE[j], id)\n        if(retval !== void 0) {\n          return retval\n        }\n      }\n\n      if(color !== 0) {\n        //Intersect with red\n        for(var j=0; j<redActive; ++j) {\n          var retval = visit(RED_SWEEP_QUEUE[j], id)\n          if(retval !== void 0) {\n            return retval\n          }\n        }\n      }\n\n      if(color !== 1) {\n        //Intersect with blue\n        for(var j=0; j<blueActive; ++j) {\n          var retval = visit(BLUE_SWEEP_QUEUE[j], id)\n          if(retval !== void 0) {\n            return retval\n          }\n        }\n      }\n\n      if(color === 0) {\n        //Red\n        sqPush(RED_SWEEP_QUEUE, RED_SWEEP_INDEX, redActive++, id)\n      } else if(color === 1) {\n        //Blue\n        sqPush(BLUE_SWEEP_QUEUE, BLUE_SWEEP_INDEX, blueActive++, id)\n      } else if(color === 2) {\n        //Both\n        sqPush(COMMON_SWEEP_QUEUE, COMMON_SWEEP_INDEX, commonActive++, id)\n      }\n    } else {\n      //Destroy event\n      var id = (e>>1) - 1\n      if(color === 0) {\n        //Red\n        sqPop(RED_SWEEP_QUEUE, RED_SWEEP_INDEX, redActive--, id)\n      } else if(color === 1) {\n        //Blue\n        sqPop(BLUE_SWEEP_QUEUE, BLUE_SWEEP_INDEX, blueActive--, id)\n      } else if(color === 2) {\n        //Both\n        sqPop(COMMON_SWEEP_QUEUE, COMMON_SWEEP_INDEX, commonActive--, id)\n      }\n    }\n  }\n}\n\n//Sweep and prune/scanline algorithm:\n//  Scan along axis, detect intersections\n//  Brute force all boxes along axis\nfunction scanBipartite(\n  d, axis, visit, flip,\n  redStart,  redEnd, red, redIndex,\n  blueStart, blueEnd, blue, blueIndex) {\n  \n  var ptr      = 0\n  var elemSize = 2*d\n  var istart   = axis\n  var iend     = axis+d\n\n  var redShift  = 1\n  var blueShift = 1\n  if(flip) {\n    blueShift = BLUE_FLAG\n  } else {\n    redShift  = BLUE_FLAG\n  }\n\n  for(var i=redStart; i<redEnd; ++i) {\n    var idx = i + redShift\n    var redOffset = elemSize*i\n    SWEEP_EVENTS[ptr++] = red[redOffset+istart]\n    SWEEP_EVENTS[ptr++] = -idx\n    SWEEP_EVENTS[ptr++] = red[redOffset+iend]\n    SWEEP_EVENTS[ptr++] = idx\n  }\n  for(var i=blueStart; i<blueEnd; ++i) {\n    var idx = i + blueShift\n    var blueOffset = elemSize*i\n    SWEEP_EVENTS[ptr++] = blue[blueOffset+istart]\n    SWEEP_EVENTS[ptr++] = -idx\n  }\n\n  //process events from left->right\n  var n = ptr >>> 1\n  isort(SWEEP_EVENTS, n)\n  \n  var redActive    = 0\n  for(var i=0; i<n; ++i) {\n    var e = SWEEP_EVENTS[2*i+1]|0\n    if(e < 0) {\n      var idx   = -e\n      var isRed = false\n      if(idx >= BLUE_FLAG) {\n        isRed = !flip\n        idx -= BLUE_FLAG \n      } else {\n        isRed = !!flip\n        idx -= 1\n      }\n      if(isRed) {\n        sqPush(RED_SWEEP_QUEUE, RED_SWEEP_INDEX, redActive++, idx)\n      } else {\n        var blueId  = blueIndex[idx]\n        var bluePtr = elemSize * idx\n        \n        var b0 = blue[bluePtr+axis+1]\n        var b1 = blue[bluePtr+axis+1+d]\n\nred_loop:\n        for(var j=0; j<redActive; ++j) {\n          var oidx   = RED_SWEEP_QUEUE[j]\n          var redPtr = elemSize * oidx\n\n          if(b1 < red[redPtr+axis+1] || \n             red[redPtr+axis+1+d] < b0) {\n            continue\n          }\n\n          for(var k=axis+2; k<d; ++k) {\n            if(blue[bluePtr + k + d] < red[redPtr + k] || \n               red[redPtr + k + d] < blue[bluePtr + k]) {\n              continue red_loop\n            }\n          }\n\n          var redId  = redIndex[oidx]\n          var retval\n          if(flip) {\n            retval = visit(blueId, redId)\n          } else {\n            retval = visit(redId, blueId)\n          }\n          if(retval !== void 0) {\n            return retval \n          }\n        }\n      }\n    } else {\n      sqPop(RED_SWEEP_QUEUE, RED_SWEEP_INDEX, redActive--, e - redShift)\n    }\n  }\n}\n\nfunction scanComplete(\n  d, axis, visit,\n  redStart,  redEnd, red, redIndex,\n  blueStart, blueEnd, blue, blueIndex) {\n\n  var ptr      = 0\n  var elemSize = 2*d\n  var istart   = axis\n  var iend     = axis+d\n\n  for(var i=redStart; i<redEnd; ++i) {\n    var idx = i + BLUE_FLAG\n    var redOffset = elemSize*i\n    SWEEP_EVENTS[ptr++] = red[redOffset+istart]\n    SWEEP_EVENTS[ptr++] = -idx\n    SWEEP_EVENTS[ptr++] = red[redOffset+iend]\n    SWEEP_EVENTS[ptr++] = idx\n  }\n  for(var i=blueStart; i<blueEnd; ++i) {\n    var idx = i + 1\n    var blueOffset = elemSize*i\n    SWEEP_EVENTS[ptr++] = blue[blueOffset+istart]\n    SWEEP_EVENTS[ptr++] = -idx\n  }\n\n  //process events from left->right\n  var n = ptr >>> 1\n  isort(SWEEP_EVENTS, n)\n  \n  var redActive    = 0\n  for(var i=0; i<n; ++i) {\n    var e = SWEEP_EVENTS[2*i+1]|0\n    if(e < 0) {\n      var idx   = -e\n      if(idx >= BLUE_FLAG) {\n        RED_SWEEP_QUEUE[redActive++] = idx - BLUE_FLAG\n      } else {\n        idx -= 1\n        var blueId  = blueIndex[idx]\n        var bluePtr = elemSize * idx\n\n        var b0 = blue[bluePtr+axis+1]\n        var b1 = blue[bluePtr+axis+1+d]\n\nred_loop:\n        for(var j=0; j<redActive; ++j) {\n          var oidx   = RED_SWEEP_QUEUE[j]\n          var redId  = redIndex[oidx]\n\n          if(redId === blueId) {\n            break\n          }\n\n          var redPtr = elemSize * oidx\n          if(b1 < red[redPtr+axis+1] || \n            red[redPtr+axis+1+d] < b0) {\n            continue\n          }\n          for(var k=axis+2; k<d; ++k) {\n            if(blue[bluePtr + k + d] < red[redPtr + k] || \n               red[redPtr + k + d]   < blue[bluePtr + k]) {\n              continue red_loop\n            }\n          }\n\n          var retval = visit(redId, blueId)\n          if(retval !== void 0) {\n            return retval \n          }\n        }\n      }\n    } else {\n      var idx = e - BLUE_FLAG\n      for(var j=redActive-1; j>=0; --j) {\n        if(RED_SWEEP_QUEUE[j] === idx) {\n          for(var k=j+1; k<redActive; ++k) {\n            RED_SWEEP_QUEUE[k-1] = RED_SWEEP_QUEUE[k]\n          }\n          break\n        }\n      }\n      --redActive\n    }\n  }\n}","module.exports = min;\n\n/**\n * Returns the minimum of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @returns {vec3} out\n */\nfunction min(out, a, b) {\n    out[0] = Math.min(a[0], b[0])\n    out[1] = Math.min(a[1], b[1])\n    out[2] = Math.min(a[2], b[2])\n    return out\n}","module.exports = transformQuat;\n\n/**\n * Transforms the vec3 with a quat\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the vector to transform\n * @param {quat} q quaternion to transform with\n * @returns {vec3} out\n */\nfunction transformQuat(out, a, q) {\n    // benchmarks: http://jsperf.com/quaternion-transform-vec3-implementations\n\n    var x = a[0], y = a[1], z = a[2],\n        qx = q[0], qy = q[1], qz = q[2], qw = q[3],\n\n        // calculate quat * vec\n        ix = qw * x + qy * z - qz * y,\n        iy = qw * y + qz * x - qx * z,\n        iz = qw * z + qx * y - qy * x,\n        iw = -qx * x - qy * y - qz * z\n\n    // calculate result * inverse quat\n    out[0] = ix * qw + iw * -qx + iy * -qz - iz * -qy\n    out[1] = iy * qw + iw * -qy + iz * -qx - ix * -qz\n    out[2] = iz * qw + iw * -qz + ix * -qy - iy * -qx\n    return out\n}","/*!\n * Determine if an object is a Buffer\n *\n * @author   Feross Aboukhadijeh <https://feross.org>\n * @license  MIT\n */\n\n// The _isBuffer check is for Safari 5-7 support, because it's missing\n// Object.prototype.constructor. Remove this eventually\nmodule.exports = function (obj) {\n  return obj != null && (isBuffer(obj) || isSlowBuffer(obj) || !!obj._isBuffer)\n}\n\nfunction isBuffer (obj) {\n  return !!obj.constructor && typeof obj.constructor.isBuffer === 'function' && obj.constructor.isBuffer(obj)\n}\n\n// For Node v0.10 support. Remove this eventually.\nfunction isSlowBuffer (obj) {\n  return typeof obj.readFloatLE === 'function' && typeof obj.slice === 'function' && isBuffer(obj.slice(0, 0))\n}\n","'use strict'\n\nvar bits = require('bit-twiddle')\nvar dup = require('dup')\nvar isBuffer = require('is-buffer')\n\n//Legacy pool support\nif(!global.__TYPEDARRAY_POOL) {\n  global.__TYPEDARRAY_POOL = {\n      UINT8   : dup([32, 0])\n    , UINT16  : dup([32, 0])\n    , UINT32  : dup([32, 0])\n    , INT8    : dup([32, 0])\n    , INT16   : dup([32, 0])\n    , INT32   : dup([32, 0])\n    , FLOAT   : dup([32, 0])\n    , DOUBLE  : dup([32, 0])\n    , DATA    : dup([32, 0])\n    , UINT8C  : dup([32, 0])\n    , BUFFER  : dup([32, 0])\n  }\n}\n\nvar hasUint8C = (typeof Uint8ClampedArray) !== 'undefined'\nvar POOL = global.__TYPEDARRAY_POOL\n\n//Upgrade pool\nif(!POOL.UINT8C) {\n  POOL.UINT8C = dup([32, 0])\n}\nif(!POOL.BUFFER) {\n  POOL.BUFFER = dup([32, 0])\n}\n\n//New technique: Only allocate from ArrayBufferView and Buffer\nvar DATA    = POOL.DATA\n  , BUFFER  = POOL.BUFFER\n\nexports.free = function free(array) {\n  if(isBuffer(array)) {\n    BUFFER[bits.log2(array.length)].push(array)\n  } else {\n    if(Object.prototype.toString.call(array) !== '[object ArrayBuffer]') {\n      array = array.buffer\n    }\n    if(!array) {\n      return\n    }\n    var n = array.length || array.byteLength\n    var log_n = bits.log2(n)|0\n    DATA[log_n].push(array)\n  }\n}\n\nfunction freeArrayBuffer(buffer) {\n  if(!buffer) {\n    return\n  }\n  var n = buffer.length || buffer.byteLength\n  var log_n = bits.log2(n)\n  DATA[log_n].push(buffer)\n}\n\nfunction freeTypedArray(array) {\n  freeArrayBuffer(array.buffer)\n}\n\nexports.freeUint8 =\nexports.freeUint16 =\nexports.freeUint32 =\nexports.freeInt8 =\nexports.freeInt16 =\nexports.freeInt32 =\nexports.freeFloat32 = \nexports.freeFloat =\nexports.freeFloat64 = \nexports.freeDouble = \nexports.freeUint8Clamped = \nexports.freeDataView = freeTypedArray\n\nexports.freeArrayBuffer = freeArrayBuffer\n\nexports.freeBuffer = function freeBuffer(array) {\n  BUFFER[bits.log2(array.length)].push(array)\n}\n\nexports.malloc = function malloc(n, dtype) {\n  if(dtype === undefined || dtype === 'arraybuffer') {\n    return mallocArrayBuffer(n)\n  } else {\n    switch(dtype) {\n      case 'uint8':\n        return mallocUint8(n)\n      case 'uint16':\n        return mallocUint16(n)\n      case 'uint32':\n        return mallocUint32(n)\n      case 'int8':\n        return mallocInt8(n)\n      case 'int16':\n        return mallocInt16(n)\n      case 'int32':\n        return mallocInt32(n)\n      case 'float':\n      case 'float32':\n        return mallocFloat(n)\n      case 'double':\n      case 'float64':\n        return mallocDouble(n)\n      case 'uint8_clamped':\n        return mallocUint8Clamped(n)\n      case 'buffer':\n        throw 'Buffer not supported'\n      case 'data':\n      case 'dataview':\n        return mallocDataView(n)\n\n      default:\n        return null\n    }\n  }\n  return null\n}\n\nfunction mallocArrayBuffer(n) {\n  var n = bits.nextPow2(n)\n  var log_n = bits.log2(n)\n  var d = DATA[log_n]\n  if(d.length > 0) {\n    return d.pop()\n  }\n  return new ArrayBuffer(n)\n}\nexports.mallocArrayBuffer = mallocArrayBuffer\n\nfunction mallocUint8(n) {\n  return new Uint8Array(mallocArrayBuffer(n), 0, n)\n}\nexports.mallocUint8 = mallocUint8\n\nfunction mallocUint16(n) {\n  return new Uint16Array(mallocArrayBuffer(2*n), 0, n)\n}\nexports.mallocUint16 = mallocUint16\n\nfunction mallocUint32(n) {\n  return new Uint32Array(mallocArrayBuffer(4*n), 0, n)\n}\nexports.mallocUint32 = mallocUint32\n\nfunction mallocInt8(n) {\n  return new Int8Array(mallocArrayBuffer(n), 0, n)\n}\nexports.mallocInt8 = mallocInt8\n\nfunction mallocInt16(n) {\n  return new Int16Array(mallocArrayBuffer(2*n), 0, n)\n}\nexports.mallocInt16 = mallocInt16\n\nfunction mallocInt32(n) {\n  return new Int32Array(mallocArrayBuffer(4*n), 0, n)\n}\nexports.mallocInt32 = mallocInt32\n\nfunction mallocFloat(n) {\n  return new Float32Array(mallocArrayBuffer(4*n), 0, n)\n}\nexports.mallocFloat32 = exports.mallocFloat = mallocFloat\n\nfunction mallocDouble(n) {\n  return new Float64Array(mallocArrayBuffer(8*n), 0, n)\n}\nexports.mallocFloat64 = exports.mallocDouble = mallocDouble\n\nfunction mallocUint8Clamped(n) {\n  if(hasUint8C) {\n    return new Uint8ClampedArray(mallocArrayBuffer(n), 0, n)\n  } else {\n    return mallocUint8(n)\n  }\n}\nexports.mallocUint8Clamped = mallocUint8Clamped\n\nfunction mallocDataView(n) {\n  return new DataView(mallocArrayBuffer(n), 0, n)\n}\nexports.mallocDataView = mallocDataView\n\nexports.clearCache = function clearCache() {\n  for(var i=0; i<32; ++i) {\n    POOL.UINT8[i].length = 0\n    POOL.UINT16[i].length = 0\n    POOL.UINT32[i].length = 0\n    POOL.INT8[i].length = 0\n    POOL.INT16[i].length = 0\n    POOL.INT32[i].length = 0\n    POOL.FLOAT[i].length = 0\n    POOL.DOUBLE[i].length = 0\n    POOL.UINT8C[i].length = 0\n    DATA[i].length = 0\n    BUFFER[i].length = 0\n  }\n}","module.exports = transformMat4;\n\n/**\n * Transforms the vec3 with a mat4.\n * 4th vector component is implicitly '1'\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the vector to transform\n * @param {mat4} m matrix to transform with\n * @returns {vec3} out\n */\nfunction transformMat4(out, a, m) {\n    var x = a[0], y = a[1], z = a[2],\n        w = m[3] * x + m[7] * y + m[11] * z + m[15]\n    w = w || 1.0\n    out[0] = (m[0] * x + m[4] * y + m[8] * z + m[12]) / w\n    out[1] = (m[1] * x + m[5] * y + m[9] * z + m[13]) / w\n    out[2] = (m[2] * x + m[6] * y + m[10] * z + m[14]) / w\n    return out\n}","module.exports = equals\n\nvar EPSILON = require('./epsilon')\n\n/**\n * Returns whether or not the vectors have approximately the same elements in the same position.\n *\n * @param {vec3} a The first vector.\n * @param {vec3} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\nfunction equals(a, b) {\n  var a0 = a[0]\n  var a1 = a[1]\n  var a2 = a[2]\n  var b0 = b[0]\n  var b1 = b[1]\n  var b2 = b[2]\n  return (Math.abs(a0 - b0) <= EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) &&\n          Math.abs(a1 - b1) <= EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) &&\n          Math.abs(a2 - b2) <= EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)))\n}\n","module.exports = scale;\n\n/**\n * Scales a vec3 by a scalar number\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the vector to scale\n * @param {Number} b amount to scale the vector by\n * @returns {vec3} out\n */\nfunction scale(out, a, b) {\n    out[0] = a[0] * b\n    out[1] = a[1] * b\n    out[2] = a[2] * b\n    return out\n}","module.exports = clone;\n\n/**\n * Creates a new vec3 initialized with values from an existing vector\n *\n * @param {vec3} a vector to clone\n * @returns {vec3} a new 3D vector\n */\nfunction clone(a) {\n    var out = new Float32Array(3)\n    out[0] = a[0]\n    out[1] = a[1]\n    out[2] = a[2]\n    return out\n}","module.exports = transformMat3;\n\n/**\n * Transforms the vec3 with a mat3.\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the vector to transform\n * @param {mat4} m the 3x3 matrix to transform with\n * @returns {vec3} out\n */\nfunction transformMat3(out, a, m) {\n    var x = a[0], y = a[1], z = a[2]\n    out[0] = x * m[0] + y * m[3] + z * m[6]\n    out[1] = x * m[1] + y * m[4] + z * m[7]\n    out[2] = x * m[2] + y * m[5] + z * m[8]\n    return out\n}","module.exports = normalize;\n\n/**\n * Normalize a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a vector to normalize\n * @returns {vec3} out\n */\nfunction normalize(out, a) {\n    var x = a[0],\n        y = a[1],\n        z = a[2]\n    var len = x*x + y*y + z*z\n    if (len > 0) {\n        //TODO: evaluate use of glm_invsqrt here?\n        len = 1 / Math.sqrt(len)\n        out[0] = a[0] * len\n        out[1] = a[1] * len\n        out[2] = a[2] * len\n    }\n    return out\n}","\nmodule.exports = ECS\nvar DataStore = require('./dataStore')\n\n\n\n/*!\n * ent-comp: a light, *fast* Entity Component System in JS\n * @url      github.com/fenomas/ent-comp\n * @author   Andy Hall <andy@fenomas.com>\n * @license  MIT\n*/\n\n\n\n/**\n * Constructor for a new entity-component-system manager.\n * \n * ```js\n * var ECS = require('ent-comp')\n * var ecs = new ECS()\n * ```\n * @class\n * @constructor\n * @exports ECS\n * @typicalname ecs\n*/\n\nfunction ECS() {\n\tvar self = this\n\n\t/** \n\t * Hash of component definitions. Also aliased to `comps`.\n\t * \n\t * ```js\n\t * var comp = { name: 'foo' }\n\t * ecs.createComponent(comp)\n\t * ecs.components['foo'] === comp  // true\n\t * ecs.comps['foo']                // same\n\t * ```\n\t*/\n\tthis.components = {}\n\tthis.comps = this.components\n\n\n\n\t/*\n\t * \n\t * \t\tinternal properties:\n\t * \n\t*/\n\n\tvar components = this.components\n\n\t// counter for entity IDs\n\tvar UID = 1\n\n\t// Storage for all component state data:\n\t// storage['component-name'] = DataStore instance\n\tvar storage = {}\n\n\t// flat arrays of names of components with systems\n\tvar systems = []\n\tvar renderSystems = []\n\n\t// flags and arrays for deferred cleanup of removed stuff\n\tvar deferrals = {\n\t\ttimeout: false,\n\t\tremovals: [],\n\t\tmultiComps: [],\n\t}\n\n\t// expose references to internals for debugging or hacking\n\tthis._storage = storage\n\tthis._systems = systems\n\tthis._renderSystems = renderSystems\n\n\n\n\n\n\t/*\n\t * \n\t * \n\t * \t\t\t\tPublic API\n\t * \n\t * \n\t*/\n\n\n\n\n\t/**\n\t * Creates a new entity id (currently just an incrementing integer).\n\t * \n\t * Optionally takes a list of component names to add to the entity (with default state data).\n\t * \n\t * ```js\n\t * var id1 = ecs.createEntity()\n\t * var id2 = ecs.createEntity([ 'some-component', 'other-component' ])\n\t * ```\n\t*/\n\tthis.createEntity = function (compList) {\n\t\tvar id = UID++\n\t\tif (Array.isArray(compList)) {\n\t\t\tcompList.forEach(compName => self.addComponent(id, compName))\n\t\t}\n\t\treturn id\n\t}\n\n\n\n\t/**\n\t * Deletes an entity, which in practice means removing all its components.\n\t * \n\t * ```js\n\t * ecs.deleteEntity(id)\n\t * ```\n\t*/\n\tthis.deleteEntity = function (entID) {\n\t\t// loop over all components and maybe remove them\n\t\t// this avoids needing to keep a list of components-per-entity\n\t\tObject.keys(storage).forEach(compName => {\n\t\t\tvar data = storage[compName]\n\t\t\tif (data.hash[entID]) {\n\t\t\t\tremoveComponent(entID, compName)\n\t\t\t}\n\t\t})\n\t\treturn self\n\t}\n\n\n\n\n\n\n\n\t/**\n\t * Creates a new component from a definition object. \n\t * The definition must have a `name`; all other properties are optional.\n\t * \n\t * Returns the component name, to make it easy to grab when the component\n\t * is being `require`d from a module.\n\t * \n\t * ```js\n\t * var comp = {\n\t * \t name: 'some-unique-string',\n\t * \t state: {},\n\t * \t order: 99,\n\t * \t multi: false,\n\t * \t onAdd:        (id, state) => { },\n\t * \t onRemove:     (id, state) => { },\n\t * \t system:       (dt, states) => { },\n\t * \t renderSystem: (dt, states) => { },\n\t * }\n\t * \n\t * var name = ecs.createComponent( comp )\n\t * // name == 'some-unique-string'\n\t * ```\n\t * \n\t * Note the `multi` flag - for components where this is true, a given \n\t * entity can have multiple state objects for that component.\n\t * For multi-components, APIs that would normally return a state object \n\t * (like `getState`) will instead return an array of them.\n\t*/\n\tthis.createComponent = function (compDefn) {\n\t\tif (!compDefn) throw new Error('Missing component definition')\n\t\tvar name = compDefn.name\n\t\tif (!name) throw new Error('Component definition must have a name property.')\n\t\tif (typeof name !== 'string') throw new Error('Component name must be a string.')\n\t\tif (name === '') throw new Error('Component name must be a non-empty string.')\n\t\tif (storage[name]) throw new Error(`Component ${name} already exists.`)\n\n\t\t// rebuild definition object for monomorphism\n\t\tvar internalDef = {}\n\t\tinternalDef.name = name\n\t\tinternalDef.multi = !!compDefn.multi\n\t\tinternalDef.order = isNaN(compDefn.order) ? 99 : compDefn.order\n\t\tinternalDef.state = compDefn.state || {}\n\t\tinternalDef.onAdd = compDefn.onAdd || null\n\t\tinternalDef.onRemove = compDefn.onRemove || null\n\t\tinternalDef.system = compDefn.system || null\n\t\tinternalDef.renderSystem = compDefn.renderSystem || null\n\n\t\tcomponents[name] = internalDef\n\t\tstorage[name] = new DataStore()\n\t\tstorage[name]._pendingMultiCleanup = false\n\t\tstorage[name]._multiCleanupIDs = (internalDef.multi) ? [] : null\n\n\t\tif (internalDef.system) {\n\t\t\tsystems.push(name)\n\t\t\tsystems.sort((a, b) => components[a].order - components[b].order)\n\t\t}\n\t\tif (internalDef.renderSystem) {\n\t\t\trenderSystems.push(name)\n\t\t\trenderSystems.sort((a, b) => components[a].order - components[b].order)\n\t\t}\n\n\t\treturn name\n\t}\n\n\n\n\n\n\n\t/**\n\t * Overwrites an existing component with a new definition object, which\n\t * must have the same `name` property as the component it overwrites.\n\t * Otherwise identical to `createComponent`\n\t * \n\t * ```js\n\t *   ecs.createComponent({\n\t *     name: 'foo',\n\t *     state: { aaa: 0 },\n\t *   })\n\t *   ecs.addComponent(myEntity, 'foo')\n\t *   ecs.getState(myEntity, 'foo').aaa = 123\n\t *   \n\t *   ecs.overwriteComponent('foo', {\n\t *\t   name: 'foo',\n\t *\t   state: { bbb: 456 },\n\t *\t })\n\t *   ecs.getState(myEntity, 'foo')  // { aaa:123, bbb:456 }\n\t * ```\n\t * \n\t*/\n\tthis.overwriteComponent = function (compName, compDefn) {\n\t\tvar def = components[compName]\n\t\tif (!def) throw new Error(`Unknown component: ${compName}`)\n\t\tif (!compDefn) throw new Error('Missing component definition')\n\t\tif (def.name !== compDefn.name) throw new Error('Overwriting component must use the same name property.')\n\n\t\t// rebuild definition object for monomorphism\n\t\tvar internalDef = {}\n\t\tinternalDef.name = compName\n\t\tinternalDef.multi = !!compDefn.multi\n\t\tinternalDef.order = isNaN(compDefn.order) ? 99 : compDefn.order\n\t\tinternalDef.state = compDefn.state || {}\n\t\tinternalDef.onAdd = compDefn.onAdd || null\n\t\tinternalDef.onRemove = compDefn.onRemove || null\n\t\tinternalDef.system = compDefn.system || null\n\t\tinternalDef.renderSystem = compDefn.renderSystem || null\n\n\t\t// overwrite internal references to old component def\n\t\tcomponents[compName] = internalDef\n\t\tstorage[compName]._pendingMultiCleanup = false\n\t\tstorage[compName]._multiCleanupIDs = (internalDef.multi) ? [] : null\n\n\t\tvar si = systems.indexOf(compName)\n\t\tif (internalDef.system && si < 0) systems.push(compName)\n\t\tif (!internalDef.system && si >= 0) systems.splice(si, 1)\n\t\tsystems.sort((a, b) => components[a].order - components[b].order)\n\n\t\tvar ri = renderSystems.indexOf(compName)\n\t\tif (internalDef.renderSystem && ri < 0) renderSystems.push(compName)\n\t\tif (!internalDef.renderSystem && ri >= 0) renderSystems.splice(ri, 1)\n\t\trenderSystems.sort((a, b) => components[a].order - components[b].order)\n\n\t\t// for any existing entities with the component,\n\t\t// add any default state properties they're missing\n\t\tvar baseState = internalDef.state\n\t\tthis.getStatesList(compName).forEach(state => {\n\t\t\tfor (var key in baseState) {\n\t\t\t\tif (!(key in state)) state[key] = baseState[key]\n\t\t\t}\n\t\t\t// also call the new comp's add handler, if any\n\t\t\tif (internalDef.onAdd) internalDef.onAdd(state.__id, state)\n\t\t})\n\n\n\t\treturn compName\n\t}\n\n\n\n\n\n\n\n\t/**\n\t * Deletes the component definition with the given name. \n\t * First removes the component from all entities that have it.\n\t * \n\t * **Note:** This API shouldn't be necessary in most real-world usage - \n\t * you should set up all your components during init and then leave them be.\n\t * But it's useful if, say, you receive an ECS from another library and \n\t * you need to replace its components.\n\t * \n\t * ```js\n\t * ecs.deleteComponent( 'some-component' )\n\t * ```\n\t*/\n\tthis.deleteComponent = function (compName) {\n\t\tvar data = storage[compName]\n\t\tif (!data) throw new Error(`Unknown component: ${compName}`)\n\n\t\tdata.flush()\n\t\tdata.list.forEach(obj => {\n\t\t\tif (!obj) return\n\t\t\tvar id = obj.__id || obj[0].__id\n\t\t\tremoveComponent(id, compName)\n\t\t})\n\n\t\tvar i = systems.indexOf(compName)\n\t\tvar j = renderSystems.indexOf(compName)\n\t\tif (i > -1) systems.splice(i, 1)\n\t\tif (j > -1) renderSystems.splice(j, 1)\n\n\t\tstorage[compName].dispose()\n\t\tdelete storage[compName]\n\t\tdelete components[compName]\n\n\t\treturn self\n\t}\n\n\n\n\n\t/**\n\t * Adds a component to an entity, optionally initializing the state object.\n\t * \n\t * ```js\n\t * ecs.createComponent({\n\t * \tname: 'foo',\n\t * \tstate: { val: 1 }\n\t * })\n\t * ecs.addComponent(id1, 'foo')             // use default state\n\t * ecs.addComponent(id2, 'foo', { val:2 })  // pass in state data\n\t * ```\n\t*/\n\tthis.addComponent = function (entID, compName, state) {\n\t\tvar def = components[compName]\n\t\tvar data = storage[compName]\n\t\tif (!data) throw new Error(`Unknown component: ${compName}.`)\n\n\t\t// treat adding an existing (non-multi-) component as an error\n\t\tif (data.hash[entID] && !def.multi) {\n\t\t\tthrow new Error(`Entity ${entID} already has component: ${compName}.`)\n\t\t}\n\n\t\t// create new component state object for this entity\n\t\tvar newState = Object.assign({}, { __id: entID }, def.state, state)\n\n\t\t// just in case passed-in state object had an __id property\n\t\tnewState.__id = entID\n\n\t\t// add to data store - for multi components, may already be present\n\t\tif (def.multi) {\n\t\t\tvar statesArr = data.hash[entID]\n\t\t\tif (!statesArr) {\n\t\t\t\tstatesArr = []\n\t\t\t\tdata.add(entID, statesArr)\n\t\t\t}\n\t\t\tstatesArr.push(newState)\n\t\t} else {\n\t\t\tdata.add(entID, newState)\n\t\t}\n\n\t\t// call handler and return\n\t\tif (def.onAdd) def.onAdd(entID, newState)\n\n\t\treturn this\n\t}\n\n\n\n\t/**\n\t * Checks if an entity has a component.\n\t * \n\t * ```js\n\t * ecs.addComponent(id, 'foo')\n\t * ecs.hasComponent(id, 'foo')       // true\n\t * ```\n\t*/\n\n\tthis.hasComponent = function (entID, compName) {\n\t\tvar data = storage[compName]\n\t\tif (!data) throw new Error(`Unknown component: ${compName}.`)\n\t\treturn !!data.hash[entID]\n\t}\n\n\n\n\n\n\t/**\n\t * Removes a component from an entity, triggering the component's \n\t * `onRemove` handler, and then deleting any state data.\n\t * \n\t * ```js\n\t * ecs.removeComponent(id, 'foo')\n\t * ecs.hasComponent(id, 'foo')     \t // false\n\t * ```\n\t*/\n\tthis.removeComponent = function (entID, compName) {\n\t\tvar data = storage[compName]\n\t\tif (!data) throw new Error(`Unknown component: ${compName}.`)\n\n\t\t// removal implementations at end\n\t\tremoveComponent(entID, compName)\n\n\t\treturn self\n\t}\n\n\n\n\n\n\t/**\n\t * Get the component state for a given entity.\n\t * It will automatically have an `__id` property for the entity id.\n\t * \n\t * ```js\n\t * ecs.createComponent({\n\t * \tname: 'foo',\n\t * \tstate: { val: 0 }\n\t * })\n\t * ecs.addComponent(id, 'foo')\n\t * ecs.getState(id, 'foo').val       // 0\n\t * ecs.getState(id, 'foo').__id      // equals id\n\t * ```\n\t*/\n\n\tthis.getState = function (entID, compName) {\n\t\tvar data = storage[compName]\n\t\tif (!data) throw new Error(`Unknown component: ${compName}.`)\n\t\treturn data.hash[entID]\n\t}\n\n\n\n\n\t/**\n\t * Get an array of state objects for every entity with the given component. \n\t * Each one will have an `__id` property for the entity id it refers to.\n\t * Don't add or remove elements from the returned list!\n\t * \n\t * ```js\n\t * var arr = ecs.getStatesList('foo')\n\t * // returns something shaped like:\n\t * //   [\n\t * //     {__id:0, x:1},\n\t * //     {__id:7, x:2},\n\t * //   ]\n\t * ```  \n\t*/\n\n\tthis.getStatesList = function (compName) {\n\t\tvar data = storage[compName]\n\t\tif (!data) throw new Error(`Unknown component: ${compName}.`)\n\t\tdoDeferredCleanup(data)\n\t\treturn data.list\n\t}\n\n\n\n\n\t/**\n\t * Makes a `getState`-like accessor bound to a given component. \n\t * The accessor is faster than `getState`, so you may want to create \n\t * an accessor for any component you'll be accessing a lot.\n\t * \n\t * ```js\n\t * ecs.createComponent({\n\t * \tname: 'size',\n\t * \tstate: { val: 0 }\n\t * })\n\t * var getEntitySize = ecs.getStateAccessor('size')\n\t * // ...\n\t * ecs.addComponent(id, 'size', { val:123 })\n\t * getEntitySize(id).val      // 123\n\t * ```  \n\t*/\n\n\tthis.getStateAccessor = function (compName) {\n\t\tif (!storage[compName]) throw new Error(`Unknown component: ${compName}.`)\n\t\tvar hash = storage[compName].hash\n\t\treturn (id) => hash[id]\n\t}\n\n\n\n\n\t/**\n\t * Makes a `hasComponent`-like accessor function bound to a given component. \n\t * The accessor is much faster than `hasComponent`.\n\t * \n\t * ```js\n\t * ecs.createComponent({\n\t * \tname: 'foo',\n\t * })\n\t * var hasFoo = ecs.getComponentAccessor('foo')\n\t * // ...\n\t * ecs.addComponent(id, 'foo')\n\t * hasFoo(id) // true\n\t * ```  \n\t*/\n\n\tthis.getComponentAccessor = function (compName) {\n\t\tif (!storage[compName]) throw new Error(`Unknown component: ${compName}.`)\n\t\tvar hash = storage[compName].hash\n\t\treturn (id) => !!hash[id]\n\t}\n\n\n\n\n\n\t/**\n\t * Tells the ECS that a game tick has occurred, causing component \n\t * `system` functions to get called.\n\t * \n\t * The optional parameter simply gets passed to the system functions. \n\t * It's meant to be a timestep, but can be used (or not used) as you like.    \n\t * \n\t * If components have an `order` property, they'll get called in that order\n\t * (lowest to highest). Component order defaults to `99`.\n\t * ```js\n\t * ecs.createComponent({\n\t * \tname: foo,\n\t * \torder: 1,\n\t * \tsystem: function(dt, states) {\n\t * \t\t// states is the same array you'd get from #getStatesList()\n\t * \t\tstates.forEach(state => {\n\t * \t\t\tconsole.log('Entity ID: ', state.__id)\n\t * \t\t})\n\t * \t}\n\t * })\n\t * ecs.tick(30) // triggers log statements\n\t * ```\n\t*/\n\n\tthis.tick = function (dt) {\n\t\tdoDeferredCleanup()\n\t\tfor (var i = 0; i < systems.length; i++) {\n\t\t\tvar compName = systems[i]\n\t\t\tvar comp = components[compName]\n\t\t\tvar data = storage[compName]\n\t\t\tcomp.system(dt, data.list)\n\t\t\tdoDeferredCleanup()\n\t\t}\n\t\treturn self\n\t}\n\n\n\n\t/**\n\t * Functions exactly like `tick`, but calls `renderSystem` functions.\n\t * this effectively gives you a second set of systems that are \n\t * called with separate timing, in case you want to \n\t * [tick and render in separate loops](http://gafferongames.com/game-physics/fix-your-timestep/)\n\t * (which you should!).\n\t * \n\t * ```js\n\t * ecs.createComponent({\n\t * \tname: foo,\n\t * \torder: 5,\n\t * \trenderSystem: function(dt, states) {\n\t * \t\t// states is the same array you'd get from #getStatesList()\n\t * \t}\n\t * })\n\t * ecs.render(1000/60)\n\t * ```\n\t*/\n\n\tthis.render = function (dt) {\n\t\tdoDeferredCleanup()\n\t\tfor (var i = 0; i < renderSystems.length; i++) {\n\t\t\tvar compName = renderSystems[i]\n\t\t\tvar comp = components[compName]\n\t\t\tvar data = storage[compName]\n\t\t\tcomp.renderSystem(dt, data.list)\n\t\t\tdoDeferredCleanup()\n\t\t}\n\t\treturn self\n\t}\n\n\n\n\n\t/**\n\t * Removes one particular instance of a multi-component.\n\t * To avoid breaking loops, the relevant state object will get nulled\n\t * immediately, and spliced from the states array later when safe \n\t * (after the current tick/render/animationFrame).\n\t * \n\t * ```js\n\t * // where component 'foo' is a multi-component\n\t * ecs.getState(id, 'foo')   // [ state1, state2, state3 ]\n\t * ecs.removeMultiComponent(id, 'foo', 1)\n\t * ecs.getState(id, 'foo')   // [ state1, null, state3 ]\n\t * // one JS event loop later...\n\t * ecs.getState(id, 'foo')   // [ state1, state3 ]\n\t * ```\n\t */\n\tthis.removeMultiComponent = function (entID, compName, index) {\n\t\tvar def = components[compName]\n\t\tvar data = storage[compName]\n\t\tif (!data) throw new Error(`Unknown component: ${compName}.`)\n\t\tif (!def.multi) throw new Error('removeMultiComponent called on non-multi component')\n\n\t\t// removal implementations at end\n\t\tremoveMultiCompElement(entID, def, data, index)\n\n\t\treturn self\n\t}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\t/*\n\t * \n\t * \n\t *\t\tinternal implementations of remove/delete operations\n\t * \t\ta bit hairy due to deferred cleanup, etc.\n\t * \n\t * \n\t*/\n\n\n\t// remove given component from an entity\n\tfunction removeComponent(entID, compName) {\n\t\tvar def = components[compName]\n\t\tvar data = storage[compName]\n\n\t\t// fail silently on all cases where removal target isn't present,\n\t\t// since multiple pieces of logic often remove/delete simultaneously\n\t\tvar state = data.hash[entID]\n\t\tif (!state) return\n\n\t\t// null out data now, so overlapped remove events won't fire\n\t\tdata.remove(entID)\n\n\t\t// call onRemove handler - on each instance for multi components\n\t\tif (def.onRemove) {\n\t\t\tif (def.multi) {\n\t\t\t\tstate.forEach(state => {\n\t\t\t\t\tif (state) def.onRemove(entID, state)\n\t\t\t\t})\n\t\t\t\tstate.length = 0\n\t\t\t} else {\n\t\t\t\tdef.onRemove(entID, state)\n\t\t\t}\n\t\t}\n\n\t\tdeferrals.removals.push(data)\n\t\tpingDeferrals()\n\t}\n\n\n\t// remove one state from a multi component\n\tfunction removeMultiCompElement(entID, def, data, index) {\n\t\t// if statesArr isn't present there's no work or cleanup to do\n\t\tvar statesArr = data.hash[entID]\n\t\tif (!statesArr) return\n\n\t\t// as above, ignore cases where removal target doesn't exist\n\t\tvar state = statesArr[index]\n\t\tif (!state) return\n\n\t\t// null out element and fire event\n\t\tstatesArr[index] = null\n\t\tif (def.onRemove) def.onRemove(entID, state)\n\n\t\tdeferrals.multiComps.push({ entID, data })\n\t\tpingDeferrals()\n\t}\n\n\n\n\n\n\n\n\t// rigging\n\tfunction pingDeferrals() {\n\t\tif (deferrals.timeout) return\n\t\tdeferrals.timeout = true\n\t\tsetTimeout(deferralHandler, 1)\n\t}\n\n\tfunction deferralHandler() {\n\t\tdeferrals.timeout = false\n\t\tdoDeferredCleanup()\n\t}\n\n\n\t/*\n\t * \n\t *\t\tgeneral handling for deferred data cleanup\n\t * \t\t\t- removes null states if component is multi\n\t * \t\t\t- removes null entries from component dataStore\n\t * \t\tshould be called at safe times - not during state loops\n\t * \n\t*/\n\n\tfunction doDeferredCleanup() {\n\t\tif (deferrals.multiComps.length) {\n\t\t\tdeferredMultiCompCleanup(deferrals.multiComps)\n\t\t}\n\t\tif (deferrals.removals.length) {\n\t\t\tdeferredComponentCleanup(deferrals.removals)\n\t\t}\n\t}\n\n\t// removes null elements from multi-comp state arrays\n\tfunction deferredMultiCompCleanup(list) {\n\t\tfor (var i = 0; i < list.length; i++) {\n\t\t\tvar { entID, data } = list[i]\n\t\t\tvar statesArr = data.hash[entID]\n\t\t\tif (!statesArr) continue\n\t\t\tfor (var j = 0; j < statesArr.length; j++) {\n\t\t\t\tif (statesArr[j]) continue\n\t\t\t\tstatesArr.splice(j, 1)\n\t\t\t\tj--\n\t\t\t}\n\t\t\t// if this leaves the states list empty, remove the whole component\n\t\t\tif (statesArr.length === 0) {\n\t\t\t\tdata.remove(entID)\n\t\t\t\tdeferrals.removals.push(data)\n\t\t\t}\n\t\t}\n\t\tlist.length = 0\n\t}\n\n\t// flushes dataStore after components have been removed\n\tfunction deferredComponentCleanup(list) {\n\t\tfor (var i = 0; i < list.length; i++) {\n\t\t\tvar data = list[i]\n\t\t\tdata.flush()\n\t\t}\n\t\tlist.length = 0\n\t}\n\n\n\n}\n\n","module.exports = distance;\n\n/**\n * Calculates the euclidian distance between two vec3's\n *\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @returns {Number} distance between a and b\n */\nfunction distance(a, b) {\n    var x = b[0] - a[0],\n        y = b[1] - a[1],\n        z = b[2] - a[2]\n    return Math.sqrt(x*x + y*y + z*z)\n}","module.exports = create;\n\n/**\n * Creates a new, empty vec3\n *\n * @returns {vec3} a new 3D vector\n */\nfunction create() {\n    var out = new Float32Array(3)\n    out[0] = 0\n    out[1] = 0\n    out[2] = 0\n    return out\n}","module.exports = multiply;\n\n/**\n * Multiplies two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @returns {vec3} out\n */\nfunction multiply(out, a, b) {\n    out[0] = a[0] * b[0]\n    out[1] = a[1] * b[1]\n    out[2] = a[2] * b[2]\n    return out\n}","module.exports = dot;\n\n/**\n * Calculates the dot product of two vec3's\n *\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @returns {Number} dot product of a and b\n */\nfunction dot(a, b) {\n    return a[0] * b[0] + a[1] * b[1] + a[2] * b[2]\n}","module.exports = inverse;\n\n/**\n * Returns the inverse of the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a vector to invert\n * @returns {vec3} out\n */\nfunction inverse(out, a) {\n  out[0] = 1.0 / a[0]\n  out[1] = 1.0 / a[1]\n  out[2] = 1.0 / a[2]\n  return out\n}","'use strict'\n\nmodule.exports = boxIntersectIter\n\nvar pool = require('@jpweeks/typedarray-pool')\nvar bits = require('bit-twiddle')\nvar bruteForce = require('./brute')\nvar bruteForcePartial = bruteForce.partial\nvar bruteForceFull = bruteForce.full\nvar sweep = require('./sweep')\nvar findMedian = require('./median')\nvar genPartition = require('./partition')\n\n//Twiddle parameters\nvar BRUTE_FORCE_CUTOFF    = 128       //Cut off for brute force search\nvar SCAN_CUTOFF           = (1<<22)   //Cut off for two way scan\nvar SCAN_COMPLETE_CUTOFF  = (1<<22)  \n\n//Partition functions\nvar partitionInteriorContainsInterval = genPartition(\n  '!(lo>=p0)&&!(p1>=hi)', \n  ['p0', 'p1'])\n\nvar partitionStartEqual = genPartition(\n  'lo===p0',\n  ['p0'])\n\nvar partitionStartLessThan = genPartition(\n  'lo<p0',\n  ['p0'])\n\nvar partitionEndLessThanEqual = genPartition(\n  'hi<=p0',\n  ['p0'])\n\nvar partitionContainsPoint = genPartition(\n  'lo<=p0&&p0<=hi',\n  ['p0'])\n\nvar partitionContainsPointProper = genPartition(\n  'lo<p0&&p0<=hi',\n  ['p0'])\n\n//Frame size for iterative loop\nvar IFRAME_SIZE = 6\nvar DFRAME_SIZE = 2\n\n//Data for box statck\nvar INIT_CAPACITY = 1024\nvar BOX_ISTACK  = pool.mallocInt32(INIT_CAPACITY)\nvar BOX_DSTACK  = pool.mallocDouble(INIT_CAPACITY)\n\n//Initialize iterative loop queue\nfunction iterInit(d, count) {\n  var levels = (8 * bits.log2(count+1) * (d+1))|0\n  var maxInts = bits.nextPow2(IFRAME_SIZE*levels)\n  if(BOX_ISTACK.length < maxInts) {\n    pool.free(BOX_ISTACK)\n    BOX_ISTACK = pool.mallocInt32(maxInts)\n  }\n  var maxDoubles = bits.nextPow2(DFRAME_SIZE*levels)\n  if(BOX_DSTACK.length < maxDoubles) {\n    pool.free(BOX_DSTACK)\n    BOX_DSTACK = pool.mallocDouble(maxDoubles)\n  }\n}\n\n//Append item to queue\nfunction iterPush(ptr,\n  axis, \n  redStart, redEnd, \n  blueStart, blueEnd, \n  state, \n  lo, hi) {\n\n  var iptr = IFRAME_SIZE * ptr\n  BOX_ISTACK[iptr]   = axis\n  BOX_ISTACK[iptr+1] = redStart\n  BOX_ISTACK[iptr+2] = redEnd\n  BOX_ISTACK[iptr+3] = blueStart\n  BOX_ISTACK[iptr+4] = blueEnd\n  BOX_ISTACK[iptr+5] = state\n\n  var dptr = DFRAME_SIZE * ptr\n  BOX_DSTACK[dptr]   = lo\n  BOX_DSTACK[dptr+1] = hi\n}\n\n//Special case:  Intersect single point with list of intervals\nfunction onePointPartial(\n  d, axis, visit, flip,\n  redStart, redEnd, red, redIndex,\n  blueOffset, blue, blueId) {\n\n  var elemSize = 2 * d\n  var bluePtr  = blueOffset * elemSize\n  var blueX    = blue[bluePtr + axis]\n\nred_loop:\n  for(var i=redStart, redPtr=redStart*elemSize; i<redEnd; ++i, redPtr+=elemSize) {\n    var r0 = red[redPtr+axis]\n    var r1 = red[redPtr+axis+d]\n    if(blueX < r0 || r1 < blueX) {\n      continue\n    }\n    if(flip && blueX === r0) {\n      continue\n    }\n    var redId = redIndex[i]\n    for(var j=axis+1; j<d; ++j) {\n      var r0 = red[redPtr+j]\n      var r1 = red[redPtr+j+d]\n      var b0 = blue[bluePtr+j]\n      var b1 = blue[bluePtr+j+d]\n      if(r1 < b0 || b1 < r0) {\n        continue red_loop\n      }\n    }\n    var retval\n    if(flip) {\n      retval = visit(blueId, redId)\n    } else {\n      retval = visit(redId, blueId)\n    }\n    if(retval !== void 0) {\n      return retval\n    }\n  }\n}\n\n//Special case:  Intersect one point with list of intervals\nfunction onePointFull(\n  d, axis, visit,\n  redStart, redEnd, red, redIndex,\n  blueOffset, blue, blueId) {\n\n  var elemSize = 2 * d\n  var bluePtr  = blueOffset * elemSize\n  var blueX    = blue[bluePtr + axis]\n\nred_loop:\n  for(var i=redStart, redPtr=redStart*elemSize; i<redEnd; ++i, redPtr+=elemSize) {\n    var redId = redIndex[i]\n    if(redId === blueId) {\n      continue\n    }\n    var r0 = red[redPtr+axis]\n    var r1 = red[redPtr+axis+d]\n    if(blueX < r0 || r1 < blueX) {\n      continue\n    }\n    for(var j=axis+1; j<d; ++j) {\n      var r0 = red[redPtr+j]\n      var r1 = red[redPtr+j+d]\n      var b0 = blue[bluePtr+j]\n      var b1 = blue[bluePtr+j+d]\n      if(r1 < b0 || b1 < r0) {\n        continue red_loop\n      }\n    }\n    var retval = visit(redId, blueId)\n    if(retval !== void 0) {\n      return retval\n    }\n  }\n}\n\n//The main box intersection routine\nfunction boxIntersectIter(\n  d, visit, initFull,\n  xSize, xBoxes, xIndex,\n  ySize, yBoxes, yIndex) {\n\n  //Reserve memory for stack\n  iterInit(d, xSize + ySize)\n\n  var top  = 0\n  var elemSize = 2 * d\n  var retval\n\n  iterPush(top++,\n      0,\n      0, xSize,\n      0, ySize,\n      initFull ? 16 : 0, \n      -Infinity, Infinity)\n  if(!initFull) {\n    iterPush(top++,\n      0,\n      0, ySize,\n      0, xSize,\n      1, \n      -Infinity, Infinity)\n  }\n\n  while(top > 0) {\n    top  -= 1\n\n    var iptr = top * IFRAME_SIZE\n    var axis      = BOX_ISTACK[iptr]\n    var redStart  = BOX_ISTACK[iptr+1]\n    var redEnd    = BOX_ISTACK[iptr+2]\n    var blueStart = BOX_ISTACK[iptr+3]\n    var blueEnd   = BOX_ISTACK[iptr+4]\n    var state     = BOX_ISTACK[iptr+5]\n\n    var dptr = top * DFRAME_SIZE\n    var lo        = BOX_DSTACK[dptr]\n    var hi        = BOX_DSTACK[dptr+1]\n\n    //Unpack state info\n    var flip      = (state & 1)\n    var full      = !!(state & 16)\n\n    //Unpack indices\n    var red       = xBoxes\n    var redIndex  = xIndex\n    var blue      = yBoxes\n    var blueIndex = yIndex\n    if(flip) {\n      red         = yBoxes\n      redIndex    = yIndex\n      blue        = xBoxes\n      blueIndex   = xIndex\n    }\n\n    if(state & 2) {\n      redEnd = partitionStartLessThan(\n        d, axis,\n        redStart, redEnd, red, redIndex,\n        hi)\n      if(redStart >= redEnd) {\n        continue\n      }\n    }\n    if(state & 4) {\n      redStart = partitionEndLessThanEqual(\n        d, axis,\n        redStart, redEnd, red, redIndex,\n        lo)\n      if(redStart >= redEnd) {\n        continue\n      }\n    }\n    \n    var redCount  = redEnd  - redStart\n    var blueCount = blueEnd - blueStart\n\n    if(full) {\n      if(d * redCount * (redCount + blueCount) < SCAN_COMPLETE_CUTOFF) {\n        retval = sweep.scanComplete(\n          d, axis, visit, \n          redStart, redEnd, red, redIndex,\n          blueStart, blueEnd, blue, blueIndex)\n        if(retval !== void 0) {\n          return retval\n        }\n        continue\n      }\n    } else {\n      if(d * Math.min(redCount, blueCount) < BRUTE_FORCE_CUTOFF) {\n        //If input small, then use brute force\n        retval = bruteForcePartial(\n            d, axis, visit, flip,\n            redStart,  redEnd,  red,  redIndex,\n            blueStart, blueEnd, blue, blueIndex)\n        if(retval !== void 0) {\n          return retval\n        }\n        continue\n      } else if(d * redCount * blueCount < SCAN_CUTOFF) {\n        //If input medium sized, then use sweep and prune\n        retval = sweep.scanBipartite(\n          d, axis, visit, flip, \n          redStart, redEnd, red, redIndex,\n          blueStart, blueEnd, blue, blueIndex)\n        if(retval !== void 0) {\n          return retval\n        }\n        continue\n      }\n    }\n    \n    //First, find all red intervals whose interior contains (lo,hi)\n    var red0 = partitionInteriorContainsInterval(\n      d, axis, \n      redStart, redEnd, red, redIndex,\n      lo, hi)\n\n    //Lower dimensional case\n    if(redStart < red0) {\n\n      if(d * (red0 - redStart) < BRUTE_FORCE_CUTOFF) {\n        //Special case for small inputs: use brute force\n        retval = bruteForceFull(\n          d, axis+1, visit,\n          redStart, red0, red, redIndex,\n          blueStart, blueEnd, blue, blueIndex)\n        if(retval !== void 0) {\n          return retval\n        }\n      } else if(axis === d-2) {\n        if(flip) {\n          retval = sweep.sweepBipartite(\n            d, visit,\n            blueStart, blueEnd, blue, blueIndex,\n            redStart, red0, red, redIndex)\n        } else {\n          retval = sweep.sweepBipartite(\n            d, visit,\n            redStart, red0, red, redIndex,\n            blueStart, blueEnd, blue, blueIndex)\n        }\n        if(retval !== void 0) {\n          return retval\n        }\n      } else {\n        iterPush(top++,\n          axis+1,\n          redStart, red0,\n          blueStart, blueEnd,\n          flip,\n          -Infinity, Infinity)\n        iterPush(top++,\n          axis+1,\n          blueStart, blueEnd,\n          redStart, red0,\n          flip^1,\n          -Infinity, Infinity)\n      }\n    }\n\n    //Divide and conquer phase\n    if(red0 < redEnd) {\n\n      //Cut blue into 3 parts:\n      //\n      //  Points < mid point\n      //  Points = mid point\n      //  Points > mid point\n      //\n      var blue0 = findMedian(\n        d, axis, \n        blueStart, blueEnd, blue, blueIndex)\n      var mid = blue[elemSize * blue0 + axis]\n      var blue1 = partitionStartEqual(\n        d, axis,\n        blue0, blueEnd, blue, blueIndex,\n        mid)\n\n      //Right case\n      if(blue1 < blueEnd) {\n        iterPush(top++,\n          axis,\n          red0, redEnd,\n          blue1, blueEnd,\n          (flip|4) + (full ? 16 : 0),\n          mid, hi)\n      }\n\n      //Left case\n      if(blueStart < blue0) {\n        iterPush(top++,\n          axis,\n          red0, redEnd,\n          blueStart, blue0,\n          (flip|2) + (full ? 16 : 0),\n          lo, mid)\n      }\n\n      //Center case (the hard part)\n      if(blue0 + 1 === blue1) {\n        //Optimization: Range with exactly 1 point, use a brute force scan\n        if(full) {\n          retval = onePointFull(\n            d, axis, visit,\n            red0, redEnd, red, redIndex,\n            blue0, blue, blueIndex[blue0])\n        } else {\n          retval = onePointPartial(\n            d, axis, visit, flip,\n            red0, redEnd, red, redIndex,\n            blue0, blue, blueIndex[blue0])\n        }\n        if(retval !== void 0) {\n          return retval\n        }\n      } else if(blue0 < blue1) {\n        var red1\n        if(full) {\n          //If full intersection, need to handle special case\n          red1 = partitionContainsPoint(\n            d, axis,\n            red0, redEnd, red, redIndex,\n            mid)\n          if(red0 < red1) {\n            var redX = partitionStartEqual(\n              d, axis,\n              red0, red1, red, redIndex,\n              mid)\n            if(axis === d-2) {\n              //Degenerate sweep intersection:\n              //  [red0, redX] with [blue0, blue1]\n              if(red0 < redX) {\n                retval = sweep.sweepComplete(\n                  d, visit,\n                  red0, redX, red, redIndex,\n                  blue0, blue1, blue, blueIndex)\n                if(retval !== void 0) {\n                  return retval\n                }\n              }\n\n              //Normal sweep intersection:\n              //  [redX, red1] with [blue0, blue1]\n              if(redX < red1) {\n                retval = sweep.sweepBipartite(\n                  d, visit,\n                  redX, red1, red, redIndex,\n                  blue0, blue1, blue, blueIndex)\n                if(retval !== void 0) {\n                  return retval\n                }\n              }\n            } else {\n              if(red0 < redX) {\n                iterPush(top++,\n                  axis+1,\n                  red0, redX,\n                  blue0, blue1,\n                  16,\n                  -Infinity, Infinity)\n              }\n              if(redX < red1) {\n                iterPush(top++,\n                  axis+1,\n                  redX, red1,\n                  blue0, blue1,\n                  0,\n                  -Infinity, Infinity)\n                iterPush(top++,\n                  axis+1,\n                  blue0, blue1,\n                  redX, red1,\n                  1,\n                  -Infinity, Infinity)\n              }\n            }\n          }\n        } else {\n          if(flip) {\n            red1 = partitionContainsPointProper(\n              d, axis,\n              red0, redEnd, red, redIndex,\n              mid)\n          } else {\n            red1 = partitionContainsPoint(\n              d, axis,\n              red0, redEnd, red, redIndex,\n              mid)\n          }\n          if(red0 < red1) {\n            if(axis === d-2) {\n              if(flip) {\n                retval = sweep.sweepBipartite(\n                  d, visit,\n                  blue0, blue1, blue, blueIndex,\n                  red0, red1, red, redIndex)\n              } else {\n                retval = sweep.sweepBipartite(\n                  d, visit,\n                  red0, red1, red, redIndex,\n                  blue0, blue1, blue, blueIndex)\n              }\n            } else {\n              iterPush(top++,\n                axis+1,\n                red0, red1,\n                blue0, blue1,\n                flip,\n                -Infinity, Infinity)\n              iterPush(top++,\n                axis+1,\n                blue0, blue1,\n                red0, red1,\n                flip^1,\n                -Infinity, Infinity)\n            }\n          }\n        }\n      }\n    }\n  }\n}","module.exports = require('./distance')\n","module.exports = fromValues;\n\n/**\n * Creates a new vec3 initialized with the given values\n *\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @returns {vec3} a new 3D vector\n */\nfunction fromValues(x, y, z) {\n    var out = new Float32Array(3)\n    out[0] = x\n    out[1] = y\n    out[2] = z\n    return out\n}","module.exports = cross;\n\n/**\n * Computes the cross product of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @returns {vec3} out\n */\nfunction cross(out, a, b) {\n    var ax = a[0], ay = a[1], az = a[2],\n        bx = b[0], by = b[1], bz = b[2]\n\n    out[0] = ay * bz - az * by\n    out[1] = az * bx - ax * bz\n    out[2] = ax * by - ay * bx\n    return out\n}","\nimport { EventEmitter } from 'events'\n\nimport packageJSON from '../package.json'\nvar version = packageJSON.version\n\n\nfunction DefaultOptions() {\n    this.preventDefaults = false\n    this.stopPropagation = false\n    this.allowContextMenu = false\n    this.disabled = false\n}\n\n\nexport class GameInputs {\n\n    /**\n     *   Simple inputs manager to abstract key/mouse inputs.\n     * \n     * @param {HTMLElement} domElement\n     * @param {DefaultOptions} options\n    */\n\n    constructor(domElement, options) {\n        this.version = version\n        var opts = Object.assign({}, new DefaultOptions(), options || {})\n\n        // settings\n        /** The HTMLElement that `inputs` is bound to. */\n        this.element = domElement || document\n        /** When true, all key events with bindings will call `preventDefaults`. */\n        this.preventDefaults = !!opts.preventDefaults\n        /** When true, all key events with bindings will call `stopPropagation`. */\n        this.stopPropagation = !!opts.stopPropagation\n        /** When this is false, the context menu will be prevented from opening if there is a binding to the right mouse button. */\n        this.allowContextMenu = !!opts.allowContextMenu\n        /** When disabled, no binding events will fire. */\n        this.disabled = !!opts.disabled\n\n        /** \n         * Optional filter function. Useful if you want to, e.g., \n         * ignore a key binding if ctrl/alt are pressed, but allow that\n         * same binding if it originated from a mouse event.\n         * @param {KeyboardEvent & MouseEvent} ev\n         * @param {string} bindingName\n        */\n        this.filterEvents = (ev, bindingName) => true\n\n        // emitters\n        /** \n         * Event emitter for binding **press** events.  \n         * The original mouse or key event will be passed as an argument.\n        */\n        this.down = new EventEmitter()\n        /** \n         * Event emitter for binding **release** events.  \n         * The original mouse or key event will be passed as an argument.\n         */\n        this.up = new EventEmitter()\n\n        /** \n         * The boolean state of whether each binding is currently pressed.\n         * \n         * `inputs.state['move-left'] // true if a bound key is pressed`\n         * @type {{ [key:string]: boolean }} \n        */\n        this.state = {}\n\n        /** \n         * Numeric counters representing accumulated pointer/scroll inputs \n         * since the last time `tick` was called.\n        */\n        this.pointerState = {\n            dx: 0,\n            dy: 0,\n            scrollx: 0,\n            scrolly: 0,\n            scrollz: 0,\n        }\n\n        /** \n         * How many times each binding has been **pressed** \n         * since the last time `tick` was called.\n         * @type {{ [key:string]: number }} \n        */\n        this.pressCount = {}\n\n        /** \n         * How many times each binding has been **released** \n         * since the last time `tick` was called.\n         * @type {{ [key:string]: number }} \n        */\n        this.releaseCount = {}\n\n\n\n        // internal state\n        /** @private @type {{ [key:string]: string[] }}   code -> [...binding names] */\n        this._keyBindmap = {}\n        /** @private @type {{ [key:string]: boolean }} code -> isDown */\n        this._keyStates = {}\n        /** @private @type {{ [key:string]: number }}  bindingName -> currCt */\n        this._bindPressCount = {}\n        /** @private */\n        this._touches = { lastX: 0, lastY: 0, currID: null }\n\n        /** @private For a macOs bug workaround */\n        this._pressedDuringMeta = {}\n\n        // register for ALL THE dom events\n        if (document.readyState !== 'loading') {\n            initEvents(this)\n        } else {\n            document.addEventListener('DOMContentLoaded', ev => {\n                initEvents(this)\n            }, { once: true })\n        }\n    }\n\n\n    /**\n     * Binds one or more physical keys to an arbitrary binding name.\n     * Key strings should align to `KeyboardEvent.code` strings - \n     * e.g. `KeyA`, `ArrowDown`, etc.\n     * \n     * `inputs.bind('move-player-left', 'KeyW', 'ArrowLeft')\n     * \n     * @param {string} bindingName \n     * @param {...string} keys \n     */\n    bind(bindingName, ...keys) {\n        keys.forEach(code => {\n            var bindings = this._keyBindmap[code] || []\n            if (bindings.includes(bindingName)) return\n            bindings.push(bindingName)\n            this._keyBindmap[code] = bindings\n        })\n        this.state[bindingName] = !!this.state[bindingName]\n        this.pressCount[bindingName] = this.pressCount[bindingName] || 0\n        this.releaseCount[bindingName] = this.releaseCount[bindingName] || 0\n    }\n\n\n    /**\n     * Removes all key bindings for a given binding name.\n     * \n     * `inputs.unbind('move-player-left')\n     */\n    unbind(bindingName) {\n        for (var code in this._keyBindmap) {\n            var bindings = this._keyBindmap[code]\n            var i = bindings.indexOf(bindingName)\n            if (i > -1) { bindings.splice(i, 1) }\n        }\n    }\n\n    /**\n     * Returns a copy of all existing bindings, in the format:\n     * ```js\n     *   {\n     *      bindingName: [ keyCode1, keyCode2, ... ]\n     *      ...\n     *   }\n     * ```\n     */\n    getBindings() {\n        var res = {}\n        for (var code in this._keyBindmap) {\n            var bindings = this._keyBindmap[code]\n            bindings.forEach(bindingName => {\n                res[bindingName] = res[bindingName] || []\n                res[bindingName].push(code)\n            })\n        }\n        return res\n    }\n\n\n    /**\n     * Tick function - clears out all cumulative counters\n    */\n    tick() {\n        zeroAllProperties(this.pointerState)\n        zeroAllProperties(this.pressCount)\n        zeroAllProperties(this.releaseCount)\n    }\n}\n\nfunction zeroAllProperties(obj) {\n    for (var key in obj) obj[key] = 0\n}\n\n\n\n\n\n\n/*\n *\n *   PRIVATE FUNCTIONS\n *\n*/\n\n/** @param {GameInputs} inputs */\nfunction initEvents(inputs) {\n    // keys\n    window.addEventListener('keydown', onKeyEvent.bind(null, inputs, true), false)\n    window.addEventListener('keyup', onKeyEvent.bind(null, inputs, false), false)\n\n    // pointer/mouse events\n    var pointerOpts = { passive: true }\n    if (window.PointerEvent) {\n        inputs.element.addEventListener(\"pointerdown\", onPointerEvent.bind(null, inputs, true), pointerOpts)\n        window.document.addEventListener(\"pointerup\", onPointerEvent.bind(null, inputs, false), pointerOpts)\n        inputs.element.addEventListener(\"pointermove\", onPointerMove.bind(null, inputs), pointerOpts)\n    } else {\n        inputs.element.addEventListener(\"mousedown\", onPointerEvent.bind(null, inputs, true), pointerOpts)\n        window.document.addEventListener(\"mouseup\", onPointerEvent.bind(null, inputs, false), pointerOpts)\n        inputs.element.addEventListener(\"mousemove\", onPointerMove.bind(null, inputs), pointerOpts)\n    }\n    inputs.element.addEventListener(\"wheel\", onWheelEvent.bind(null, inputs), pointerOpts)\n    inputs.element.addEventListener(\"contextmenu\", onContextMenu.bind(null, inputs), false)\n\n    // doc-level blur event for edge cases\n    window.addEventListener(\"blur\", onWindowBlur.bind(null, inputs), false)\n}\n\n\n\n\n\n/*\n *\n *\n *      INTERNALS - DOM EVENT HANDLERS\n *\n *\n*/\n\nfunction onKeyEvent(inputs, nowDown, ev) {\n    handleKeyEvent(ev.code, nowDown, inputs, ev)\n    workaroundMacBug(nowDown, inputs, ev)\n}\n\nfunction onPointerEvent(inputs, nowDown, ev) {\n    // if pointer events supported, only track the first\n    if ('pointerId' in ev) {\n        if (nowDown) {\n            if (inputs._touches.currID !== null) return\n            inputs._touches.currID = ev.pointerId\n        } else {\n            if (inputs._touches.currID !== ev.pointerId) return\n            inputs._touches.currID = null\n        }\n    }\n    var button = ('button' in ev) ? (ev.button + 1) : 1\n    handleKeyEvent('Mouse' + button, nowDown, inputs, ev)\n    return false\n}\n\nfunction onPointerMove(inputs, ev) {\n    // if a touch exists, ignore movement of other touches\n    if ('pointerId' in ev && inputs._touches.currID !== null) {\n        if (inputs._touches.currID !== ev.pointerId) return\n    }\n    // fire no events, just expose the state data\n    var dx = ev.movementX || ev.mozMovementX || 0,\n        dy = ev.movementY || ev.mozMovementY || 0\n    inputs.pointerState.dx += dx\n    inputs.pointerState.dy += dy\n}\n\n\n\n\n/*\n * \n *      mousewheel / scroll handling...\n * \n */\n\nfunction onWheelEvent(inputs, ev) {\n    var scale = 1\n    switch (ev.deltaMode) {\n        case 0: scale = 1; break  // Pixel\n        case 1: scale = 12; break  // Line\n        case 2:  // page\n            // TODO: investigate when this happens, what correct handling is\n            scale = inputs.element.clientHeight || window.innerHeight\n            break\n    }\n    // accumulate state\n    inputs.pointerState.scrollx += (ev.deltaX || 0) * scale\n    inputs.pointerState.scrolly += (ev.deltaY || 0) * scale\n    inputs.pointerState.scrollz += (ev.deltaZ || 0) * scale\n}\n\n\n/*\n *\n *          Edge cases...\n *\n*/\n\nfunction onContextMenu(inputs, ev) {\n    if (!inputs.allowContextMenu) {\n        ev.preventDefault()\n        return false\n    }\n}\n\nfunction onWindowBlur(inputs) {\n    // at least some browsers handle mouse events correctly here\n    // but not keys, so on window blur simulate a keyUp for all pressed keys\n    // there may be a better way to handle this someday..\n    for (var code in inputs._keyStates) {\n        if (!inputs._keyStates[code]) continue\n        if (/^Mouse\\d/.test(code)) continue\n        handleKeyEvent(code, false, inputs, {\n            code: code,\n            note: `This is a mocked KeyboardEvent made by the 'game-inputs' module`,\n            preventDefault: () => { },\n            stopPropagation: () => { },\n        })\n    }\n}\n\n\n\n\n/*\n *\n *\n *          FINAL KEY BIND HANDLING\n *\n *\n*/\n\n// tracks the state/counts of individual physical keys\nfunction handleKeyEvent(code, nowDown, inputs, ev) {\n    var bindings = inputs._keyBindmap[code]\n    if (!bindings) return\n\n    // if the key state has changed, handle the event for all bindings\n    var prevState = inputs._keyStates[code]\n    if (XOR(prevState, nowDown)) {\n        inputs._keyStates[code] = nowDown\n        bindings.forEach(bindingName => {\n            // allow client to filter events if applicable\n            var allow = (inputs.filterEvents) ?\n                inputs.filterEvents(ev, bindingName) : true\n            if (!allow) return\n            // finally emit the event\n            handleBindingEvent(bindingName, nowDown, inputs, ev)\n        })\n    }\n\n    // prevent/stop only for non-mouse events\n    if (!('button' in ev)) {\n        if (inputs.preventDefaults && !ev.defaultPrevented) {\n            ev.preventDefault()\n        }\n        if (inputs.stopPropagation) ev.stopPropagation()\n    }\n\n}\n\n\n// tracks the state/counts of virtual bindings\nfunction handleBindingEvent(bindingName, pressed, inputs, ev) {\n    // externally, track *cumulative* press/release counts\n    var counter = (pressed) ? inputs.pressCount : inputs.releaseCount\n    counter[bindingName] = (counter[bindingName] || 0) + 1\n    // internally, track *current* press count (to handle overlapping keybinds)\n    var ct = inputs._bindPressCount[bindingName] || 0\n    ct += pressed ? 1 : -1\n    if (ct < 0) { ct = 0 } // shouldn't happen\n    inputs._bindPressCount[bindingName] = ct\n\n    // emit event if binding's state has changed\n    var currstate = inputs.state[bindingName]\n    if (XOR(currstate, ct)) {\n        inputs.state[bindingName] = (ct > 0)\n        var emitter = pressed ? inputs.down : inputs.up\n        if (!inputs.disabled) emitter.emit(bindingName, ev)\n    }\n}\n\n\n\n\n/*\n *\n *\n *    HELPERS\n *\n *\n*/\n\n\n// how is this not part of Javascript?\nfunction XOR(a, b) {\n    return a ? !b : b\n}\n\n\n/*\n *\n *\n *    MEHHHH\n *\n *\n*/\n\n\nfunction workaroundMacBug(down, inputs, ev) {\n    var isMeta = /^Meta/.test(ev.code)\n    if (ev.metaKey && !isMeta && down) {\n        // remember any key codes that were pressed while meta is down \n        inputs._pressedDuringMeta[ev.code] = true\n    } else if (isMeta && !down) {\n        // when meta released, maybe issue keyUps for them\n        for (var code in inputs._pressedDuringMeta) {\n            if (!inputs._keyStates[code]) continue\n            if (/^Mouse\\d/.test(code)) continue\n            handleKeyEvent(code, false, inputs, {\n                code: code,\n                note: `This is a mocked KeyboardEvent made by the 'game-inputs' module`,\n                preventDefault: () => { },\n                stopPropagation: () => { },\n            })\n        }\n        inputs._pressedDuringMeta = {}\n    }\n}\n\n\n","\nimport { GameInputs } from 'game-inputs'\n\nvar defaultOptions = {\n    preventDefaults: false,\n    stopPropagation: false,\n    allowContextMenu: false,\n}\n\nvar defaultBindings = {\n    \"forward\": [\"KeyW\", \"ArrowUp\"],\n    \"backward\": [\"KeyS\", \"ArrowDown\"],\n    \"left\": [\"KeyA\", \"ArrowLeft\"],\n    \"right\": [\"KeyD\", \"ArrowRight\"],\n    \"fire\": \"Mouse1\",\n    \"mid-fire\": [\"Mouse2\", \"KeyQ\"],\n    \"alt-fire\": [\"Mouse3\", \"KeyE\"],\n    \"jump\": \"Space\",\n}\n\n/**\n * `noa.inputs` - Handles key and mouse input bindings.\n * \n * This module extends \n * [game-inputs](https://github.com/fenomas/game-inputs),\n * so turn on \"Inherited\" to see its APIs here, or view the base module \n * for full docs.\n * \n * This module uses the following default options (from the options\n * object passed to the {@link Engine}):\n * \n * ```js\n *   defaultBindings: {\n *     \"forward\":  [\"KeyW\", \"ArrowUp\"],\n *     \"backward\": [\"KeyS\", \"ArrowDown\"],\n *     \"left\":     [\"KeyA\", \"ArrowLeft\"],\n *     \"right\":    [\"KeyD\", \"ArrowRight\"],\n *     \"fire\":     \"Mouse1\",\n *     \"mid-fire\": [\"Mouse2\", \"KeyQ\"],\n *     \"alt-fire\": [\"Mouse3\", \"KeyE\"],\n *     \"jump\":     \"Space\",\n *   }\n * ```\n */\n\nexport class Inputs extends GameInputs {\n\n    /** @internal */\n    constructor(noa, opts, element) {\n        opts = Object.assign({}, defaultOptions, opts)\n        super(element, opts)\n\n        var b = opts.bindings || defaultBindings\n        for (var name in b) {\n            var keys = Array.isArray(b[name]) ? b[name] : [b[name]]\n            this.bind(name, ...keys)\n        }\n    }\n}\n\n","\n\n\n/*\n * \n * \n *      base class and API\n * \n * \n*/\n\nexport class MicroGameShell {\n\n    constructor(domElement = null, pollTime = 10) {\n\n        /** When true, the shell will try to acquire pointerlock on click events */\n        this.stickyPointerLock = false\n        /** When true, the shell will try to acquire fullscreen on click events */\n        this.stickyFullscreen = false\n\n        /** Desired tick events per second */\n        this.tickRate = 30\n        /** Upper limit for render events per second - `0` means uncapped */\n        this.maxRenderRate = 0\n        /** Max time spent issuing tick events when behind schedule. If the shell spends this long on tick events, it will discard all pending ticks to catch up. */\n        this.maxTickTime = 100\n\n\n        /** Check or set whether the DOM element has pointerlock */\n        this.pointerLock = false\n        /** Check or set whether the DOM element has fullscreen */\n        this.fullscreen = false\n\n        /**\n         * Tick event handler.\n         * @param {number} dt: tick duration (ms) - this is a fixed value based on the tick rate, not the observed time elapsed\n         */\n        this.onTick = function (dt) { }\n\n        /**\n         * Render event handler.\n         * @param {number} dt: elapsed time (ms) since previous render event\n         * @param {number} framePart: fraction (0..1) corresponding to how much of the current tick has elapsed\n         * @param {number} tickDur: tick duration (ms)\n         */\n        this.onRender = function (dt, framePart, tickDur) { }\n\n\n        /** This event fires once after shell initializes. */\n        this.onInit = function () { }\n        /** This event fires when the domElement's window resizes */\n        this.onResize = function () { }\n        /** This event fires when pointerlock is gained or lost */\n        this.onPointerLockChanged = function (hasPL = false) { }\n        /** This event fires when fullscreen is gained or lost */\n        this.onFullscreenChanged = function (hasFS = false) { }\n        /** This event fires when a pointerLock error occurs */\n        this.onPointerLockError = function (err) { }\n\n\n\n        // hide internals in a data object\n        this._data = new Data(pollTime)\n\n        // init\n        domReady(() => {\n            setupTimers(this)\n            setupDomElement(this, domElement)\n            this.onInit()\n        })\n    }\n}\n\n\n// internal data structure\nfunction Data(pollTime = 10) {\n    this.nowObject = performance || Date\n    this.pollTime = pollTime\n    this.renderAccum = 0\n    this.lastTickStarted = 0\n    this.lastFrameStarted = 0\n    this.lastRenderStarted = 0\n    this.avgTickTime = 2\n    this.frameCB = null\n    this.intervalCB = null\n    this.intervalID = -1\n}\n\n\n\n\n\n\n\n/*\n * \n *      tick- and render events\n * \n*/\n\n/** @param {MicroGameShell} shell */\nfunction setupTimers(shell) {\n    var dat = shell._data\n    var now = dat.nowObject.now()\n    dat.lastTickStarted = now\n    dat.lastFrameStarted = now\n    dat.lastRenderStarted = now\n\n    dat.frameCB = () => frameHandler(shell)\n    dat.intervalCB = () => intervalHandler(shell)\n    requestAnimationFrame(dat.frameCB)\n\n    if (dat.pollTime > 0) {\n        dat.intervalID = setInterval(dat.intervalCB, dat.pollTime)\n    }\n}\n\n\n\n\n/** \n * RAF handler - triggers render events\n * @param {MicroGameShell} shell\n*/\nfunction frameHandler(shell) {\n    var dat = shell._data\n    requestAnimationFrame(dat.frameCB)\n    // first catch up on ticks if we're behind schedule\n    intervalHandler(shell)\n    // now decide whether to do a render, if rate is capped\n    var now = dat.nowObject.now()\n    var dt = now - dat.lastFrameStarted\n    dat.lastFrameStarted = now\n    if (shell.maxRenderRate > 0) {\n        dat.renderAccum += dt\n        var frameDur = 1000 / shell.maxRenderRate\n        if (dat.renderAccum < frameDur) return\n        dat.renderAccum -= frameDur\n        // don't save up more than one pending frame\n        if (dat.renderAccum > frameDur) dat.renderAccum = frameDur\n    }\n    // issue the render event\n    var renderDt = now - dat.lastRenderStarted\n    dat.lastRenderStarted = now\n    var tickDur = 1000 / shell.tickRate\n    var framePart = (now - dat.lastTickStarted) / tickDur\n    if (framePart < 0) framePart = 0\n\n    // issue render, and optimistically schedule lookahead interval handler\n    shell.onRender(renderDt, framePart, tickDur)\n    setTimeout(intervalHandler, 0, shell, true)\n}\n\n\n\n\n/** \n * setInterval handler - triggers tick events\n * @param {MicroGameShell} shell\n*/\nfunction intervalHandler(shell, lookAhead = false) {\n    var dat = shell._data\n    var now = dat.nowObject.now()\n    // decide base and cutoff times until which we issue ticks\n    var tickUntil = now\n    if (lookAhead) tickUntil += dat.avgTickTime\n    var cutoffTime = now + shell.maxTickTime\n    if (!(cutoffTime > now)) cutoffTime = now + 1\n    var tickDur = 1000 / shell.tickRate\n\n    // issue ticks until we're up to date or out of time\n    while (dat.lastTickStarted + tickDur < tickUntil) {\n        shell.onTick(tickDur)\n        dat.lastTickStarted += tickDur\n        var after = dat.nowObject.now()\n        dat.avgTickTime = runningAverage(dat.avgTickTime, after - now)\n\n        // and track the approx processing time, and close loop\n        now = after\n        if (now > cutoffTime) {\n            dat.lastTickStarted = now\n            return\n        }\n    }\n}\n\n\n\n\n\n\n\n/*\n * \n *      DOM element and sticky fullscreen/pointerlock\n * \n*/\n\nfunction setupDomElement(shell, el) {\n    if (!el) return\n    var hasPL = false\n    var hasFS = false\n\n    var setPL = (want) => {\n        hasPL = (el === document.pointerLockElement)\n        if (!!want === hasPL) return\n        if (want) {\n            // chrome returns a promise here, others don't\n            var res = el.requestPointerLock()\n            if (res && res.catch) res.catch(err => {\n                // error already handled in `pointerlockerror`\n            })\n        } else {\n            document.exitPointerLock()\n        }\n    }\n    var setFS = (want) => {\n        hasFS = (el === document.fullscreenElement)\n        if (!!want === hasFS) return\n        if (want) {\n            if (el.requestFullscreen) {\n                el.requestFullscreen()\n            } else if (el.webkitRequestFullscreen) {\n                el.webkitRequestFullscreen()\n            }\n        } else {\n            if (document.exitFullscreen) {\n                document.exitFullscreen()\n            } else if (document['webkitExitFullscreen']) {\n                document['webkitExitFullscreen']()\n            }\n        }\n    }\n\n    // track whether we actually have PL/FS, and send events\n    document.addEventListener('pointerlockchange', ev => {\n        hasPL = (el === document.pointerLockElement)\n        shell.onPointerLockChanged(hasPL)\n    })\n    document.addEventListener('fullscreenchange', ev => {\n        hasFS = (el === document.fullscreenElement)\n        shell.onFullscreenChanged(hasFS)\n    })\n    document.addEventListener('pointerlockerror', err => {\n        hasPL = (el === document.pointerLockElement)\n        shell.onPointerLockError(err)\n    })\n\n\n    // decorate shell with getter/setters that request FS/PL\n    Object.defineProperty(shell, 'pointerLock', {\n        get: () => hasPL,\n        set: setPL,\n    })\n    Object.defineProperty(shell, 'fullscreen', {\n        get: () => hasFS,\n        set: setFS,\n    })\n\n\n    // stickiness via click handler\n    el.addEventListener('click', ev => {\n        if (shell.stickyPointerLock) setPL(true)\n        if (shell.stickyFullscreen) setFS(true)\n    })\n\n\n    // resize events via ResizeObserver\n    var resizeHandler = () => shell.onResize()\n    if (window.ResizeObserver) {\n        var observer = new ResizeObserver(resizeHandler)\n        observer.observe(el)\n    } else {\n        window.addEventListener('resize', resizeHandler)\n    }\n}\n\n\n\n\n\n/*\n * \n *      util \n * \n*/\n\nfunction runningAverage(avg, newVal) {\n    // squash effects of large one-off spikes\n    if (newVal > avg * 4) newVal = avg * 4\n    if (newVal < avg * 0.25) newVal = avg * 0.25\n    return 0.9 * avg + 0.1 * newVal\n}\n\nfunction domReady(fn) {\n    if (document.readyState === 'loading') {\n        var handler = () => {\n            document.removeEventListener('readystatechange', handler)\n            fn()\n        }\n        document.addEventListener('readystatechange', handler)\n    } else {\n        setTimeout(fn, 0)\n    }\n}\n","\nimport { EventEmitter } from 'events'\nimport { MicroGameShell } from 'micro-game-shell'\n\n\n\n\n\n/**\n * `noa.container` - manages the game's HTML container element, canvas, \n * fullscreen, pointerLock, and so on.\n * \n * This module wraps `micro-game-shell`, which does most of the implementation.\n * \n * **Events**\n *  + `DOMready => ()`  \n *    Relays the browser DOMready event, after noa does some initialization\n *  + `gainedPointerLock => ()`  \n *    Fires when the game container gains pointerlock.\n *  + `lostPointerLock => ()`  \n *    Fires when the game container loses pointerlock.\n */\n\nexport class Container extends EventEmitter {\n\n    /** @internal */\n    constructor(noa, opts) {\n        super()\n        opts = opts || {}\n\n        /** \n         * @internal\n         * @type {import('../index').Engine}\n        */\n        this.noa = noa\n\n        /** The game's DOM element container */\n        var domEl = opts.domElement || null\n        if (typeof domEl === 'string') {\n            domEl = document.querySelector(domEl)\n        }\n        this.element = domEl || createContainerDiv()\n\n        /** The `canvas` element that the game will draw into */\n        this.canvas = getOrCreateCanvas(this.element)\n        doCanvasBugfix(noa, this.canvas) // grumble...\n\n\n        /** Whether the browser supports pointerLock. @readonly */\n        this.supportsPointerLock = false\n\n        /** Whether the user's pointer is within the game area. @readonly */\n        this.pointerInGame = false\n\n        /** Whether the game is focused. @readonly */\n        this.isFocused = !!document.hasFocus()\n\n        /** Gets the current state of pointerLock. @readonly */\n        this.hasPointerLock = false\n\n\n\n        // shell manages tick/render rates, and pointerlock/fullscreen\n        var pollTime = 10\n        /** @internal */\n        this._shell = new MicroGameShell(this.element, pollTime)\n        this._shell.tickRate = opts.tickRate\n        this._shell.maxRenderRate = opts.maxRenderRate\n        this._shell.stickyPointerLock = opts.stickyPointerLock\n        this._shell.stickyFullscreen = opts.stickyFullscreen\n        this._shell.maxTickTime = 50\n\n\n\n        // core timing events\n        this._shell.onTick = noa.tick.bind(noa)\n        this._shell.onRender = noa.render.bind(noa)\n\n        // shell listeners\n        this._shell.onPointerLockChanged = (hasPL) => {\n            this.hasPointerLock = hasPL\n            this.emit((hasPL) ? 'gainedPointerLock' : 'lostPointerLock')\n            // this works around a Firefox bug where no mouse-in event \n            // gets issued after starting pointerlock\n            if (hasPL) this.pointerInGame = true\n        }\n\n        // catch and relay domReady event\n        this._shell.onInit = () => {\n            this._shell.onResize = noa.rendering.resize.bind(noa.rendering)\n            // listeners to track when game has focus / pointer\n            detectPointerLock(this)\n            this.element.addEventListener('mouseenter', () => { this.pointerInGame = true })\n            this.element.addEventListener('mouseleave', () => { this.pointerInGame = false })\n            window.addEventListener('focus', () => { this.isFocused = true })\n            window.addEventListener('blur', () => { this.isFocused = false })\n            // catch edge cases for initial states\n            var onFirstMousedown = () => {\n                this.pointerInGame = true\n                this.isFocused = true\n                this.element.removeEventListener('mousedown', onFirstMousedown)\n            }\n            this.element.addEventListener('mousedown', onFirstMousedown)\n            // emit for engine core\n            this.emit('DOMready')\n            // done and remove listener\n            this._shell.onInit = null\n        }\n    }\n\n\n    /*\n     *\n     *\n     *              PUBLIC API \n     *\n     *\n    */\n\n    /** @internal */\n    appendTo(htmlElement) {\n        this.element.appendChild(htmlElement)\n    }\n\n    /** \n     * Sets whether `noa` should try to acquire or release pointerLock\n    */\n    setPointerLock(lock = false) {\n        // not sure if this will work robustly\n        this._shell.pointerLock = !!lock\n    }\n}\n\n\n\n/*\n *\n *\n *              INTERNALS\n *\n *\n*/\n\n\nfunction createContainerDiv() {\n    // based on github.com/mikolalysenko/game-shell - makeDefaultContainer()\n    var container = document.createElement(\"div\")\n    container.tabIndex = 1\n    container.style.position = \"fixed\"\n    container.style.left = \"0px\"\n    container.style.right = \"0px\"\n    container.style.top = \"0px\"\n    container.style.bottom = \"0px\"\n    container.style.height = \"100%\"\n    container.style.overflow = \"hidden\"\n    document.body.appendChild(container)\n    document.body.style.overflow = \"hidden\" //Prevent bounce\n    document.body.style.height = \"100%\"\n    container.id = 'noa-container'\n    return container\n}\n\n\nfunction getOrCreateCanvas(el) {\n    // based on github.com/stackgl/gl-now - default canvas\n    var canvas = el.querySelector('canvas')\n    if (!canvas) {\n        canvas = document.createElement('canvas')\n        canvas.style.position = \"absolute\"\n        canvas.style.left = \"0px\"\n        canvas.style.top = \"0px\"\n        canvas.style.height = \"100%\"\n        canvas.style.width = \"100%\"\n        canvas.id = 'noa-canvas'\n        el.insertBefore(canvas, el.firstChild)\n    }\n    return canvas\n}\n\n\n// set up stuff to detect pointer lock support.\n// Needlessly complex because Chrome/Android claims to support but doesn't.\n// For now, just feature detect, but assume no support if a touch event occurs\n// TODO: see if this makes sense on hybrid touch/mouse devices\nfunction detectPointerLock(self) {\n    var lockElementExists =\n        ('pointerLockElement' in document) ||\n        ('mozPointerLockElement' in document) ||\n        ('webkitPointerLockElement' in document)\n    if (lockElementExists) {\n        self.supportsPointerLock = true\n        var listener = function (e) {\n            self.supportsPointerLock = false\n            document.removeEventListener(e.type, listener)\n        }\n        document.addEventListener('touchmove', listener)\n    }\n}\n\n\n/**\n * This works around a weird bug that seems to be chrome/mac only?\n * Without this, the page sometimes initializes with the canva\n * zoomed into its lower left quadrant. \n * Resizing the canvas fixes the issue (also: resizing page, changing zoom...)\n */\nfunction doCanvasBugfix(noa, canvas) {\n    var ct = 0\n    var fixCanvas = () => {\n        var w = canvas.width\n        canvas.width = w + 1\n        canvas.width = w\n        if (ct++ > 10) noa.off('beforeRender', fixCanvas)\n    }\n    noa.on('beforeRender', fixCanvas)\n}\n","\nimport vec3 from 'gl-vec3'\nimport aabb from 'aabb-3d'\nimport sweep from 'voxel-aabb-sweep'\n\n\n\n// default options\nfunction CameraDefaults() {\n    this.inverseX = false\n    this.inverseY = false\n    this.sensitivityMult = 1\n    this.sensitivityMultOutsidePointerlock = 0\n    this.sensitivityX = 10\n    this.sensitivityY = 10\n    this.initialZoom = 0\n    this.zoomSpeed = 0.2\n}\n\n\n// locals\nvar tempVectors = [\n    vec3.create(),\n    vec3.create(),\n    vec3.create(),\n]\nvar originVector = vec3.create()\n\n\n/**\n * `noa.camera` - manages the camera, its position and direction, \n * mouse sensitivity, and so on.\n * \n * This module uses the following default options (from the options\n * object passed to the {@link Engine}):\n * ```js\n * var defaults = {\n *     inverseX: false,\n *     inverseY: false,\n *     sensitivityX: 10,\n *     sensitivityY: 10,\n *     initialZoom: 0,\n *     zoomSpeed: 0.2,\n * }\n * ```\n*/\n\nexport class Camera {\n\n    /** \n     * @internal \n     * @param {import('../index').Engine} noa\n     * @param {Partial.<CameraDefaults>} opts\n    */\n    constructor(noa, opts) {\n        opts = Object.assign({}, new CameraDefaults, opts)\n        this.noa = noa\n\n        /** Horizontal mouse sensitivity. Same scale as Overwatch (typical values around `5..10`) */\n        this.sensitivityX = +opts.sensitivityX\n\n        /** Vertical mouse sensitivity. Same scale as Overwatch (typical values around `5..10`) */\n        this.sensitivityY = +opts.sensitivityY\n\n        /** Mouse look inverse (horizontal) */\n        this.inverseX = !!opts.inverseX\n\n        /** Mouse look inverse (vertical) */\n        this.inverseY = !!opts.inverseY\n\n        /** \n         * Multiplier for temporarily altering mouse sensitivity.\n         * Set this to `0` to temporarily disable camera controls.\n        */\n        this.sensitivityMult = opts.sensitivityMult\n\n        /** \n         * Multiplier for altering mouse sensitivity when pointerlock\n         * is not active - default of `0` means no camera movement.\n         * Note this setting is ignored if pointerLock isn't supported.\n         */\n        this.sensitivityMultOutsidePointerlock = opts.sensitivityMultOutsidePointerlock\n\n        /** \n         * Camera yaw angle. \n         * Returns the camera's rotation angle around the vertical axis. \n         * Range: `0..2`  \n         * This value is writeable, but it's managed by the engine and \n         * will be overwritten each frame.\n        */\n        this.heading = 0\n\n        /** Camera pitch angle. \n         * Returns the camera's up/down rotation angle. The pitch angle is \n         * clamped by a small epsilon, such that the camera never quite \n         * points perfectly up or down.  \n         * Range: `-/2../2`.  \n         * This value is writeable, but it's managed by the engine and \n         * will be overwritten each frame.\n        */\n        this.pitch = 0\n\n        /** \n         * Entity ID of a special entity that exists for the camera to point at.\n         * \n         * By default this entity follows the player entity, so you can \n         * change the player's eye height by changing the `follow` component's offset:\n         * ```js\n         * var followState = noa.ents.getState(noa.camera.cameraTarget, 'followsEntity')\n         * followState.offset[1] = 0.9 * myPlayerHeight\n         * ```\n         * \n         * For customized camera controls you can change the follow \n         * target to some other entity, or override the behavior entirely:\n         * ```js\n         * // make cameraTarget stop following the player\n         * noa.ents.removeComponent(noa.camera.cameraTarget, 'followsEntity')\n         * // control cameraTarget position directly (or whatever..)\n         * noa.ents.setPosition(noa.camera.cameraTarget, [x,y,z])\n         * ```\n        */\n        this.cameraTarget = this.noa.ents.createEntity(['position'])\n\n        // make the camera follow the cameraTarget entity\n        var eyeOffset = 0.9 * noa.ents.getPositionData(noa.playerEntity).height\n        noa.ents.addComponent(this.cameraTarget, 'followsEntity', {\n            entity: noa.playerEntity,\n            offset: [0, eyeOffset, 0],\n        })\n\n        /** How far back the camera should be from the player's eye position */\n        this.zoomDistance = opts.initialZoom\n\n        /** How quickly the camera moves to its `zoomDistance` (0..1) */\n        this.zoomSpeed = opts.zoomSpeed\n\n        /** Current actual zoom distance. This differs from `zoomDistance` when\n         * the camera is in the process of moving towards the desired distance, \n         * or when it's obstructed by solid terrain behind the player.\n         * This value will get overwritten each tick, but you may want to write to it\n         * when overriding the camera zoom speed.\n        */\n        this.currentZoom = opts.initialZoom\n\n        /** @internal */\n        this._dirVector = vec3.fromValues(0, 0, 1)\n    }\n\n\n\n\n    /*\n     * \n     * \n     *          API\n     * \n     * \n    */\n\n\n    /*\n     *      Local position functions for high precision\n    */\n    /** @internal */\n    _localGetTargetPosition() {\n        var pdat = this.noa.ents.getPositionData(this.cameraTarget)\n        var pos = tempVectors[0]\n        return vec3.copy(pos, pdat._renderPosition)\n    }\n    /** @internal */\n    _localGetPosition() {\n        var loc = this._localGetTargetPosition()\n        if (this.currentZoom === 0) return loc\n        return vec3.scaleAndAdd(loc, loc, this._dirVector, -this.currentZoom)\n    }\n\n\n\n    /**\n     * Returns the camera's current target position - i.e. the player's \n     * eye position. When the camera is zoomed all the way in, \n     * this returns the same location as `camera.getPosition()`.\n    */\n    getTargetPosition() {\n        var loc = this._localGetTargetPosition()\n        var globalCamPos = tempVectors[1]\n        return this.noa.localToGlobal(loc, globalCamPos)\n    }\n\n\n    /**\n     * Returns the current camera position (read only)\n    */\n    getPosition() {\n        var loc = this._localGetPosition()\n        var globalCamPos = tempVectors[2]\n        return this.noa.localToGlobal(loc, globalCamPos)\n    }\n\n\n    /**\n     * Returns the camera direction vector (read only)\n    */\n    getDirection() {\n        return this._dirVector\n    }\n\n\n\n\n    /*\n     * \n     * \n     * \n     *          internals below\n     * \n     * \n     * \n    */\n\n\n\n    /**\n     * Called before render, if mouseLock etc. is applicable.\n     * Applies current mouse x/y inputs to the camera angle and zoom\n     * @internal\n    */\n\n    applyInputsToCamera() {\n\n        // conditional changes to mouse sensitivity\n        var senseMult = this.sensitivityMult\n        if (this.noa.container.supportsPointerLock) {\n            if (!this.noa.container.hasPointerLock) {\n                senseMult *= this.sensitivityMultOutsidePointerlock\n            }\n        }\n        if (senseMult === 0) return\n\n        // dx/dy from input state\n        var pointerState = this.noa.inputs.pointerState\n        bugFix(pointerState) // TODO: REMOVE EVENTUALLY    \n\n        // convert to rads, using (sens * 0.0066 deg/pixel), like Overwatch\n        var conv = 0.0066 * Math.PI / 180\n        var dx = pointerState.dx * this.sensitivityX * senseMult * conv\n        var dy = pointerState.dy * this.sensitivityY * senseMult * conv\n        if (this.inverseX) dx = -dx\n        if (this.inverseY) dy = -dy\n\n        // normalize/clamp angles, update direction vector\n        var twopi = 2 * Math.PI\n        this.heading += (dx < 0) ? dx + twopi : dx\n        if (this.heading > twopi) this.heading -= twopi\n        var maxPitch = Math.PI / 2 - 0.001\n        this.pitch = Math.max(-maxPitch, Math.min(maxPitch, this.pitch + dy))\n\n        vec3.set(this._dirVector, 0, 0, 1)\n        var dir = this._dirVector\n        var origin = originVector\n        vec3.rotateX(dir, dir, origin, this.pitch)\n        vec3.rotateY(dir, dir, origin, this.heading)\n    }\n\n\n\n    /**\n     *  Called before all renders, pre- and post- entity render systems\n     * @internal\n    */\n    updateBeforeEntityRenderSystems() {\n        // zoom update\n        this.currentZoom += (this.zoomDistance - this.currentZoom) * this.zoomSpeed\n    }\n\n    /** @internal */\n    updateAfterEntityRenderSystems() {\n        // clamp camera zoom not to clip into solid terrain\n        var maxZoom = cameraObstructionDistance(this)\n        if (this.currentZoom > maxZoom) this.currentZoom = maxZoom\n    }\n\n}\n\n\n\n\n/*\n *  check for obstructions behind camera by sweeping back an AABB\n*/\n\nfunction cameraObstructionDistance(self) {\n    if (!self._sweepBox) {\n        self._sweepBox = new aabb([0, 0, 0], [0.2, 0.2, 0.2])\n        self._sweepGetVoxel = self.noa.world.getBlockSolidity.bind(self.noa.world)\n        self._sweepVec = vec3.create()\n        self._sweepHit = () => true\n    }\n    var pos = vec3.copy(self._sweepVec, self._localGetTargetPosition())\n    vec3.add(pos, pos, self.noa.worldOriginOffset)\n    for (var i = 0; i < 3; i++) pos[i] -= 0.1\n    self._sweepBox.setPosition(pos)\n    var dist = Math.max(self.zoomDistance, self.currentZoom) + 0.1\n    vec3.scale(self._sweepVec, self.getDirection(), -dist)\n    return sweep(self._sweepGetVoxel, self._sweepBox, self._sweepVec, self._sweepHit, true)\n}\n\n\n\n\n\n\n// workaround for this Chrome 63 + Win10 bug\n// https://bugs.chromium.org/p/chromium/issues/detail?id=781182\n// later updated to also address: https://github.com/fenomas/noa/issues/153\nfunction bugFix(pointerState) {\n    var dx = pointerState.dx\n    var dy = pointerState.dy\n    var badx = (Math.abs(dx) > 400 && Math.abs(dx / lastx) > 4)\n    var bady = (Math.abs(dy) > 400 && Math.abs(dy / lasty) > 4)\n    if (badx || bady) {\n        pointerState.dx = lastx\n        pointerState.dy = lasty\n        lastx = (lastx + dx) / 2\n        lasty = (lasty + dy) / 2\n    } else {\n        lastx = dx || 1\n        lasty = dy || 1\n    }\n}\n\nvar lastx = 0\nvar lasty = 0\n","/** \n * @module \n * @internal \n */\n\nimport vec3 from 'gl-vec3'\n\n\n\n// definition for this component's state object\nexport class PositionState {\n    constructor() {\n        /** Position in global coords (may be low precision) \n         * @type {null | number[]} */\n        this.position = null\n        this.width = 0.8\n        this.height = 0.8\n\n        /** Precise position in local coords\n         * @type {null | number[]} */\n        this._localPosition = null\n\n        /** [x,y,z] in LOCAL COORDS\n         * @type {null | number[]} */\n        this._renderPosition = null\n\n        /** [lo,lo,lo, hi,hi,hi] in LOCAL COORDS\n         * @type {null | number[]} */\n        this._extents = null\n    }\n}\n\n\n\n\n/**\n * \tComponent holding entity's position, width, and height.\n *  By convention, entity's \"position\" is the bottom center of its AABB\n * \n *  Of the various properties, _localPosition is the \"real\", \n *  single-source-of-truth position. Others are derived.\n *  Local coords are relative to `noa.worldOriginOffset`.\n * @param {import('..').Engine} noa\n*/\n\nexport default function (noa) {\n\n    return {\n\n        name: 'position',\n\n        order: 60,\n\n        state: new PositionState,\n\n        onAdd: function (eid, state) {\n            // copy position into a plain array\n            var pos = [0, 0, 0]\n            if (state.position) vec3.copy(pos, state.position)\n            state.position = pos\n\n            state._localPosition = vec3.create()\n            state._renderPosition = vec3.create()\n            state._extents = new Float32Array(6)\n\n            // on init only, set local from global\n            noa.globalToLocal(state.position, null, state._localPosition)\n            vec3.copy(state._renderPosition, state._localPosition)\n            updatePositionExtents(state)\n        },\n\n        onRemove: null,\n\n\n\n        system: function (dt, states) {\n            var off = noa.worldOriginOffset\n            for (var i = 0; i < states.length; i++) {\n                var state = states[i]\n                vec3.add(state.position, state._localPosition, off)\n                updatePositionExtents(state)\n            }\n        },\n\n\n    }\n}\n\n\n\n// update an entity's position state `_extents` \nexport function updatePositionExtents(state) {\n    var hw = state.width / 2\n    var lpos = state._localPosition\n    var ext = state._extents\n    ext[0] = lpos[0] - hw\n    ext[1] = lpos[1]\n    ext[2] = lpos[2] - hw\n    ext[3] = lpos[0] + hw\n    ext[4] = lpos[1] + state.height\n    ext[5] = lpos[2] + hw\n}\n","/** \n * @module\n * @internal\n */\n\nimport vec3 from 'gl-vec3'\n\n\nexport class PhysicsState {\n    constructor() {\n        /** @type {import('voxel-physics-engine').RigidBody} */\n        this.body = null\n    }\n}\n\n\n/**\n * Physics component, stores an entity's physics engbody.\n * @param {import('..').Engine} noa\n*/\n\nexport default function (noa) {\n\n    return {\n\n        name: 'physics',\n\n        order: 40,\n\n        state: new PhysicsState,\n\n        onAdd: function (entID, state) {\n            state.body = noa.physics.addBody()\n            // implicitly assume body has a position component, to get size\n            var posDat = noa.ents.getPositionData(state.__id)\n            setPhysicsFromPosition(state, posDat)\n        },\n\n\n        onRemove: function (entID, state) {\n            // update position before removing\n            // this lets entity wind up at e.g. the result of a collision\n            // even if physics component is removed in collision handler\n            if (noa.ents.hasPosition(state.__id)) {\n                var pdat = noa.ents.getPositionData(state.__id)\n                setPositionFromPhysics(state, pdat)\n                backtrackRenderPos(state, pdat, 0, false)\n            }\n            noa.physics.removeBody(state.body)\n        },\n\n\n        system: function (dt, states) {\n            for (var i = 0; i < states.length; i++) {\n                var state = states[i]\n                var pdat = noa.ents.getPositionData(state.__id)\n                setPositionFromPhysics(state, pdat)\n            }\n        },\n\n\n        renderSystem: function (dt, states) {\n\n            var tickPos = noa.positionInCurrentTick\n            var tickTime = 1000 / noa.container._shell.tickRate\n            tickTime *= noa.timeScale\n            var tickMS = tickPos * tickTime\n\n            // tickMS is time since last physics engine tick\n            // to avoid temporal aliasing, render the state as if lerping between\n            // the last position and the next one \n            // since the entity data is the \"next\" position this amounts to \n            // offsetting each entity into the past by tickRate - dt\n            // http://gafferongames.com/game-physics/fix-your-timestep/\n\n            var backtrackAmt = (tickMS - tickTime) / 1000\n            for (var i = 0; i < states.length; i++) {\n                var state = states[i]\n                var id = state.__id\n                var pdat = noa.ents.getPositionData(id)\n                var smoothed = noa.ents.cameraSmoothed(id)\n                backtrackRenderPos(state, pdat, backtrackAmt, smoothed)\n            }\n        }\n\n    }\n\n}\n\n\n\n// var offset = vec3.create()\nvar local = vec3.create()\n\nexport function setPhysicsFromPosition(physState, posState) {\n    var box = physState.body.aabb\n    var ext = posState._extents\n    vec3.copy(box.base, ext)\n    vec3.set(box.vec, posState.width, posState.height, posState.width)\n    vec3.add(box.max, box.base, box.vec)\n}\n\n\nfunction setPositionFromPhysics(physState, posState) {\n    var base = physState.body.aabb.base\n    var hw = posState.width / 2\n    vec3.set(posState._localPosition, base[0] + hw, base[1], base[2] + hw)\n}\n\n\nfunction backtrackRenderPos(physState, posState, backtrackAmt, smoothed) {\n    // pos = pos + backtrack * body.velocity\n    var vel = physState.body.velocity\n    vec3.scaleAndAdd(local, posState._localPosition, vel, backtrackAmt)\n\n    // smooth out update if component is present\n    // (this is set after sudden movements like auto-stepping)\n    if (smoothed) vec3.lerp(local, posState._renderPosition, local, 0.3)\n\n    // copy values over to renderPosition, \n    vec3.copy(posState._renderPosition, local)\n}\n","\nimport boxIntersect from 'box-intersect'\n\n\n\n/*\n * \tEvery frame, entities with this component will get mutually checked for colliions\n * \n *   * cylinder: flag for checking collisions as a vertical cylindar (rather than AABB)\n *   * collideBits: category for this entity\n *   * collideMask: categories this entity collides with\n *   * callback: function(other_id) - called when `own.collideBits & other.collideMask` is true\n * \n * \n * \t\tNotes:\n * \tSet collideBits=0 for entities like bullets, which can collide with things \n * \t\tbut are never the target of a collision.\n * \tSet collideMask=0 for things with no callback - things that get collided with,\n * \t\tbut don't themselves instigate collisions.\n * \n */\n\n\n\nexport default function (noa) {\n\n    var intervals = []\n\n    return {\n\n        name: 'collideEntities',\n\n        order: 70,\n\n        state: {\n            cylinder: false,\n            collideBits: 1 | 0,\n            collideMask: 1 | 0,\n            callback: null,\n        },\n\n        onAdd: null,\n\n        onRemove: null,\n\n\n        system: function entityCollider(dt, states) {\n            var ents = noa.ents\n\n            // data struct that boxIntersect looks for\n            // - array of [lo, lo, lo, hi, hi, hi] extents\n            for (var i = 0; i < states.length; i++) {\n                var id = states[i].__id\n                var dat = ents.getPositionData(id)\n                intervals[i] = dat._extents\n            }\n            intervals.length = states.length\n\n            // run the intersect library\n            boxIntersect(intervals, function (a, b) {\n                var stateA = states[a]\n                var stateB = states[b]\n                if (!stateA || !stateB) return\n                var intervalA = intervals[a]\n                var intervalB = intervals[b]\n                if (cylindricalHitTest(stateA, stateB, intervalA, intervalB)) {\n                    handleCollision(noa, stateA, stateB)\n                }\n            })\n\n        }\n    }\n\n\n\n    /*\n     * \n     * \t\tIMPLEMENTATION\n     * \n     */\n\n\n    function handleCollision(noa, stateA, stateB) {\n        var idA = stateA.__id\n        var idB = stateB.__id\n\n        // entities really do overlap, so check masks and call event handlers\n        if (stateA.collideMask & stateB.collideBits) {\n            if (stateA.callback) stateA.callback(idB)\n        }\n        if (stateB.collideMask & stateA.collideBits) {\n            if (stateB.callback) stateB.callback(idA)\n        }\n\n        // general pairwise handler\n        noa.ents.onPairwiseEntityCollision(idA, idB)\n    }\n\n\n\n    // For entities whose extents overlap, \n    // test if collision still happens when taking cylinder flags into account\n\n    function cylindricalHitTest(stateA, stateB, intervalA, intervalB) {\n        if (stateA.cylinder) {\n            if (stateB.cylinder) {\n                return cylinderCylinderTest(intervalA, intervalB)\n            } else {\n                return cylinderBoxTest(intervalA, intervalB)\n            }\n        } else if (stateB.cylinder) {\n            return cylinderBoxTest(intervalB, intervalA)\n        }\n        return true\n    }\n\n\n\n\n    // Cylinder-cylinder hit test (AABBs are known to overlap)\n    // given their extent arrays [lo, lo, lo, hi, hi, hi]\n\n    function cylinderCylinderTest(a, b) {\n        // distance between cylinder centers\n        var rada = (a[3] - a[0]) / 2\n        var radb = (b[3] - b[0]) / 2\n        var dx = a[0] + rada - (b[0] + radb)\n        var dz = a[2] + rada - (b[2] + radb)\n        // collide if dist <= sum of radii\n        var distsq = dx * dx + dz * dz\n        var radsum = rada + radb\n        return (distsq <= radsum * radsum)\n    }\n\n\n\n\n    // Cylinder-Box hit test (AABBs are known to overlap)\n    // given their extent arrays [lo, lo, lo, hi, hi, hi]\n\n    function cylinderBoxTest(cyl, cube) {\n        // X-z center of cylinder\n        var rad = (cyl[3] - cyl[0]) / 2\n        var cx = cyl[0] + rad\n        var cz = cyl[2] + rad\n        // point in X-Z square closest to cylinder\n        var px = clamp(cx, cube[0], cube[3])\n        var pz = clamp(cz, cube[2], cube[5])\n        // collision if distance from that point to circle <= cylinder radius\n        var dx = px - cx\n        var dz = pz - cz\n        var distsq = dx * dx + dz * dz\n        return (distsq <= rad * rad)\n    }\n\n    function clamp(val, lo, hi) {\n        return (val < lo) ? lo : (val > hi) ? hi : val\n    }\n\n\n\n\n}\n","\n\nexport default function (noa) {\n    return {\n\n        name: 'collideTerrain',\n\n        order: 0,\n\n        state: {\n            callback: null\n        },\n\n        onAdd: function (eid, state) {\n            // add collide handler for physics engine to call\n            var ents = noa.entities\n            if (ents.hasPhysics(eid)) {\n                var body = ents.getPhysics(eid).body\n                body.onCollide = function bodyOnCollide(impulse) {\n                    var cb = noa.ents.getCollideTerrain(eid).callback\n                    if (cb) cb(impulse, eid)\n                }\n            }\n        },\n\n        onRemove: function (eid, state) {\n            var ents = noa.entities\n            if (ents.hasPhysics(eid)) {\n                ents.getPhysics(eid).body.onCollide = null\n            }\n        },\n\n\n\n    }\n}\n","\n/**\n * Component for the player entity, when active hides the player's mesh \n * when camera zoom is less than a certain amount\n */\n\nexport default function (noa) {\n    return {\n\n        name: 'fadeOnZoom',\n\n        order: 99,\n\n        state: {\n            cutoff: 1.5,\n        },\n\n        onAdd: null,\n\n        onRemove: null,\n\n        system: function fadeOnZoomProc(dt, states) {\n            var zoom = noa.camera.currentZoom\n            for (var i = 0; i < states.length; i++) {\n                checkZoom(states[i], zoom, noa)\n            }\n        }\n    }\n}\n\n\nfunction checkZoom(state, zoom, noa) {\n    if (!noa.ents.hasMesh(state.__id)) return\n    var mesh = noa.ents.getMeshData(state.__id).mesh\n    if (!mesh.metadata) return\n    var shouldHide = (zoom < state.cutoff)\n    noa.rendering.setMeshVisibility(mesh, !shouldHide)\n}\n","\nimport vec3 from 'gl-vec3'\n\n\n/*\n * Indicates that an entity should be moved to another entity's position each tick,\n * possibly by a fixed offset, and the same for renderPositions each render\n */\n\nexport default function (noa) {\n\n    return {\n\n        name: 'followsEntity',\n\n        order: 50,\n\n        state: {\n            entity: 0 | 0,\n            offset: null,\n            onTargetMissing: null,\n        },\n\n        onAdd: function (eid, state) {\n            var off = vec3.create()\n            state.offset = (state.offset) ? vec3.copy(off, state.offset) : off\n            updatePosition(state)\n            updateRenderPosition(state)\n        },\n\n        onRemove: null,\n\n\n        // on tick, copy over regular positions\n        system: function followEntity(dt, states) {\n            for (var i = 0; i < states.length; i++) {\n                updatePosition(states[i])\n            }\n        },\n\n\n        // on render, copy over render positions\n        renderSystem: function followEntityMesh(dt, states) {\n            for (var i = 0; i < states.length; i++) {\n                updateRenderPosition(states[i])\n            }\n        }\n    }\n\n\n\n    function updatePosition(state) {\n        var id = state.__id\n        var self = noa.ents.getPositionData(id)\n        var other = noa.ents.getPositionData(state.entity)\n        if (!other) {\n            if (state.onTargetMissing) state.onTargetMissing(id)\n            noa.ents.removeComponent(id, noa.ents.names.followsEntity)\n        } else {\n            vec3.add(self._localPosition, other._localPosition, state.offset)\n        }\n    }\n\n    function updateRenderPosition(state) {\n        var id = state.__id\n        var self = noa.ents.getPositionData(id)\n        var other = noa.ents.getPositionData(state.entity)\n        if (other) {\n            vec3.add(self._renderPosition, other._renderPosition, state.offset)\n        }\n    }\n\n}\n","\nimport vec3 from 'gl-vec3'\n\n\nexport default function (noa) {\n    return {\n\n        name: 'mesh',\n\n        order: 100,\n\n        state: {\n            mesh: null,\n            offset: null\n        },\n\n\n        onAdd: function (eid, state) {\n            // implicitly assume there's already a position component\n            var posDat = noa.ents.getPositionData(eid)\n            if (state.mesh) {\n                noa.rendering.addMeshToScene(state.mesh, false, posDat.position)\n            } else {\n                throw new Error('Mesh component added without a mesh - probably a bug!')\n            }\n            if (!state.offset) state.offset = vec3.create()\n\n            // set mesh to correct position\n            var rpos = posDat._renderPosition\n            state.mesh.position.copyFromFloats(\n                rpos[0] + state.offset[0],\n                rpos[1] + state.offset[1],\n                rpos[2] + state.offset[2])\n        },\n\n\n        onRemove: function (eid, state) {\n            state.mesh.dispose()\n        },\n\n\n\n        renderSystem: function (dt, states) {\n            // before render move each mesh to its render position, \n            // set by the physics engine or driving logic\n            for (var i = 0; i < states.length; i++) {\n                var state = states[i]\n                var id = state.__id\n\n                var rpos = noa.ents.getPositionData(id)._renderPosition\n                state.mesh.position.copyFromFloats(\n                    rpos[0] + state.offset[0],\n                    rpos[1] + state.offset[1],\n                    rpos[2] + state.offset[2])\n            }\n        }\n\n\n    }\n}\n","\nimport vec3 from 'gl-vec3'\n\n\n\n\n\n/** \n * \n * State object of the `movement` component\n * \n*/\nexport function MovementState() {\n    this.heading = 0 // radians\n    this.running = false\n    this.jumping = false\n\n    // options\n    this.maxSpeed = 10\n    this.moveForce = 30\n    this.responsiveness = 15\n    this.runningFriction = 0\n    this.standingFriction = 2\n\n    // jumps\n    this.airMoveMult = 0.5\n    this.jumpImpulse = 10\n    this.jumpForce = 12\n    this.jumpTime = 500 // ms\n    this.airJumps = 1\n\n    // internal state\n    this._jumpCount = 0\n    this._currjumptime = 0\n    this._isJumping = false\n}\n\n\n\n\n\n/**\n * Movement component. State stores settings like jump height, etc.,\n * as well as current state (running, jumping, heading angle).\n * Processor checks state and applies movement/friction/jump forces\n * to the entity's physics body. \n * @param {import('..').Engine} noa\n*/\n\nexport default function (noa) {\n    return {\n\n        name: 'movement',\n\n        order: 30,\n\n        state: new MovementState(),\n\n        onAdd: null,\n\n        onRemove: null,\n\n\n        system: function movementProcessor(dt, states) {\n            var ents = noa.entities\n            for (var i = 0; i < states.length; i++) {\n                var state = states[i]\n                var phys = ents.getPhysics(state.__id)\n                if (phys) applyMovementPhysics(dt, state, phys.body)\n            }\n        }\n\n\n    }\n}\n\n\nvar tempvec = vec3.create()\nvar tempvec2 = vec3.create()\nvar zeroVec = vec3.create()\n\n\n/**\n * @param {number} dt \n * @param {MovementState} state \n * @param {*} body \n*/\n\nfunction applyMovementPhysics(dt, state, body) {\n    // move implementation originally written as external module\n    //   see https://github.com/fenomas/voxel-fps-controller\n    //   for original code\n\n    // jumping\n    var onGround = (body.atRestY() < 0)\n    var canjump = (onGround || state._jumpCount < state.airJumps)\n    if (onGround) {\n        state._isJumping = false\n        state._jumpCount = 0\n    }\n\n    // process jump input\n    if (state.jumping) {\n        if (state._isJumping) { // continue previous jump\n            if (state._currjumptime > 0) {\n                var jf = state.jumpForce\n                if (state._currjumptime < dt) jf *= state._currjumptime / dt\n                body.applyForce([0, jf, 0])\n                state._currjumptime -= dt\n            }\n        } else if (canjump) { // start new jump\n            state._isJumping = true\n            if (!onGround) state._jumpCount++\n            state._currjumptime = state.jumpTime\n            body.applyImpulse([0, state.jumpImpulse, 0])\n            // clear downward velocity on airjump\n            if (!onGround && body.velocity[1] < 0) body.velocity[1] = 0\n        }\n    } else {\n        state._isJumping = false\n    }\n\n    // apply movement forces if entity is moving, otherwise just friction\n    var m = tempvec\n    var push = tempvec2\n    if (state.running) {\n\n        var speed = state.maxSpeed\n        // todo: add crouch/sprint modifiers if needed\n        // if (state.sprint) speed *= state.sprintMoveMult\n        // if (state.crouch) speed *= state.crouchMoveMult\n        vec3.set(m, 0, 0, speed)\n\n        // rotate move vector to entity's heading\n        vec3.rotateY(m, m, zeroVec, state.heading)\n\n        // push vector to achieve desired speed & dir\n        // following code to adjust 2D velocity to desired amount is patterned on Quake: \n        // https://github.com/id-Software/Quake-III-Arena/blob/master/code/game/bg_pmove.c#L275\n        vec3.subtract(push, m, body.velocity)\n        push[1] = 0\n        var pushLen = vec3.length(push)\n        vec3.normalize(push, push)\n\n        if (pushLen > 0) {\n            // pushing force vector\n            var canPush = state.moveForce\n            if (!onGround) canPush *= state.airMoveMult\n\n            // apply final force\n            var pushAmt = state.responsiveness * pushLen\n            if (canPush > pushAmt) canPush = pushAmt\n\n            vec3.scale(push, push, canPush)\n            body.applyForce(push)\n        }\n\n        // different friction when not moving\n        // idea from Sonic: http://info.sonicretro.org/SPG:Running\n        body.friction = state.runningFriction\n    } else {\n        body.friction = state.standingFriction\n    }\n}\n","\n/**\n * \n * Input processing component - gets (key) input state and  \n * applies it to receiving entities by updating their movement \n * component state (heading, movespeed, jumping, etc.)\n * \n */\n\nexport default function (noa) {\n    return {\n\n        name: 'receivesInputs',\n\n        order: 20,\n\n        state: {},\n\n        onAdd: null,\n\n        onRemove: null,\n\n        system: function inputProcessor(dt, states) {\n            var ents = noa.entities\n            var inputState = noa.inputs.state\n            var camHeading = noa.camera.heading\n\n            for (var i = 0; i < states.length; i++) {\n                var state = states[i]\n                var moveState = ents.getMovement(state.__id)\n                setMovementState(moveState, inputState, camHeading)\n            }\n        }\n\n    }\n}\n\n\n\n/**\n * @param {import('../components/movement').MovementState} state \n * @param {Object<string, boolean>} inputs \n * @param {number} camHeading \n*/\n\nfunction setMovementState(state, inputs, camHeading) {\n    state.jumping = !!inputs.jump\n\n    var fb = inputs.forward ? (inputs.backward ? 0 : 1) : (inputs.backward ? -1 : 0)\n    var rl = inputs.right ? (inputs.left ? 0 : 1) : (inputs.left ? -1 : 0)\n\n    if ((fb | rl) === 0) {\n        state.running = false\n    } else {\n        state.running = true\n        if (fb) {\n            if (fb == -1) camHeading += Math.PI\n            if (rl) {\n                camHeading += Math.PI / 4 * fb * rl // didn't plan this but it works!\n            }\n        } else {\n            camHeading += rl * Math.PI / 2\n        }\n        state.heading = camHeading\n    }\n\n}\n","\nimport vec3 from 'gl-vec3'\n\nimport { Color3 } from '@babylonjs/core/Maths/math.color'\nimport { CreateDisc } from '@babylonjs/core/Meshes/Builders/discBuilder'\nimport '@babylonjs/core/Meshes/instancedMesh'\n\n\n/** @param {import('../index').Engine} noa  */\nexport default function (noa, distance = 10) {\n\n    var shadowDist = distance\n\n    // create a mesh to re-use for shadows\n    var scene = noa.rendering.getScene()\n    var disc = CreateDisc('shadow', { radius: 0.75, tessellation: 30 }, scene)\n    disc.rotation.x = Math.PI / 2\n    var mat = noa.rendering.makeStandardMaterial('shadow_component_mat')\n    mat.diffuseColor.set(0, 0, 0)\n    mat.ambientColor.set(0, 0, 0)\n    mat.alpha = 0.5\n    disc.material = mat\n    mat.freeze()\n\n    // source mesh needn't be in the scene graph\n    noa.rendering.setMeshVisibility(disc, false)\n\n\n    return {\n\n        name: 'shadow',\n\n        order: 80,\n\n        state: {\n            size: 0.5,\n            _mesh: null,\n        },\n\n\n        onAdd: function (eid, state) {\n            var mesh = disc.createInstance('shadow_instance')\n            noa.rendering.addMeshToScene(mesh)\n            mesh.setEnabled(false)\n            state._mesh = mesh\n        },\n\n\n        onRemove: function (eid, state) {\n            state._mesh.dispose()\n            state._mesh = null\n        },\n\n\n        system: function shadowSystem(dt, states) {\n            var cpos = noa.camera._localGetPosition()\n            var dist = shadowDist\n            for (var i = 0; i < states.length; i++) {\n                var state = states[i]\n                var posState = noa.ents.getPositionData(state.__id)\n                var physState = noa.ents.getPhysics(state.__id)\n                updateShadowHeight(noa, posState, physState, state._mesh, state.size, dist, cpos)\n            }\n        },\n\n\n        renderSystem: function (dt, states) {\n            // before render adjust shadow x/z to render positions\n            for (var i = 0; i < states.length; i++) {\n                var state = states[i]\n                var rpos = noa.ents.getPositionData(state.__id)._renderPosition\n                var spos = state._mesh.position\n                spos.x = rpos[0]\n                spos.z = rpos[2]\n            }\n        }\n\n\n\n\n    }\n}\n\nvar shadowPos = vec3.fromValues(0, 0, 0)\nvar down = vec3.fromValues(0, -1, 0)\n\nfunction updateShadowHeight(noa, posDat, physDat, mesh, size, shadowDist, camPos) {\n\n    // local Y ground position - from physics or raycast\n    var localY\n    if (physDat && physDat.body.resting[1] < 0) {\n        localY = posDat._localPosition[1]\n    } else {\n        var res = noa._localPick(posDat._localPosition, down, shadowDist)\n        if (!res) {\n            mesh.setEnabled(false)\n            return\n        }\n        localY = res.position[1] - noa.worldOriginOffset[1]\n    }\n\n    // round Y pos and offset upwards slightly to avoid z-fighting\n    localY = Math.round(localY)\n    vec3.copy(shadowPos, posDat._localPosition)\n    shadowPos[1] = localY\n    var sqdist = vec3.squaredDistance(camPos, shadowPos)\n    // offset ~ 0.01 for nearby shadows, up to 0.1 at distance of ~40\n    var offset = 0.01 + 0.1 * (sqdist / 1600)\n    if (offset > 0.1) offset = 0.1\n    mesh.position.y = localY + offset\n    // set shadow scale\n    var dist = posDat._localPosition[1] - localY\n    var scale = size * 0.7 * (1 - dist / shadowDist)\n    mesh.scaling.copyFromFloats(scale, scale, scale)\n    mesh.setEnabled(true)\n}\n","\n\nexport default function (noa) {\n\n    var compName = 'smoothCamera'\n\n    return {\n\n        name: compName,\n\n        order: 99,\n\n        state: {\n            time: 100.1\n        },\n\n        onAdd: null,\n\n        onRemove: null,\n\n        system: function (dt, states) {\n            // remove self after time elapses\n            for (var i = 0; i < states.length; i++) {\n                var state = states[i]\n                state.time -= dt\n                if (state.time < 0) noa.ents.removeComponent(state.__id, compName)\n            }\n        },\n\n    }\n}\n","\nimport ECS from 'ent-comp'\nimport vec3 from 'gl-vec3'\nimport { updatePositionExtents } from '../components/position'\nimport { setPhysicsFromPosition } from '../components/physics'\n\n\n// Component definitions\nimport collideEntitiesComp from \"../components/collideEntities.js\"\nimport collideTerrainComp from \"../components/collideTerrain.js\"\nimport fadeOnZoomComp from \"../components/fadeOnZoom.js\"\nimport followsEntityComp from \"../components/followsEntity.js\"\nimport meshComp from \"../components/mesh.js\"\nimport movementComp from \"../components/movement.js\"\nimport physicsComp from \"../components/physics.js\"\nimport positionComp from \"../components/position.js\"\nimport receivesInputsComp from \"../components/receivesInputs.js\"\nimport shadowComp from \"../components/shadow.js\"\nimport smoothCameraComp from \"../components/smoothCamera.js\"\n\n\n\nvar defaultOptions = {\n    shadowDistance: 10,\n}\n\n\n/**\n * `noa.entities` - manages entities and components.\n * \n * This class extends [ent-comp](https://github.com/fenomas/ent-comp), \n * a general-purpose ECS. It's also decorated with noa-specific helpers and \n * accessor functions for querying entity positions, etc.\n * \n * Expects entity definitions in a specific format - see source `components` \n * folder for examples.\n * \n * This module uses the following default options (from the options\n * object passed to the {@link Engine}):\n * \n * ```js\n * var defaults = {\n *     shadowDistance: 10,\n * }\n * ```\n*/\n\nexport class Entities extends ECS {\n\n\n    /** @internal */\n    constructor(noa, opts) {\n        super()\n        opts = Object.assign({}, defaultOptions, opts)\n        // optional arguments to supply to component creation functions\n        var componentArgs = {\n            'shadow': opts.shadowDistance,\n        }\n\n        /** \n         * @internal\n         * @type {import('../index').Engine}\n        */\n        this.noa = noa\n\n        /** Hash containing the component names of built-in components.\n         * @type {{ [key:string]: string }} \n        */\n        this.names = {}\n\n\n        // call `createComponent` on all component definitions, and\n        // store their names in ents.names\n        var compDefs = {\n            collideEntities: collideEntitiesComp,\n            collideTerrain: collideTerrainComp,\n            fadeOnZoom: fadeOnZoomComp,\n            followsEntity: followsEntityComp,\n            mesh: meshComp,\n            movement: movementComp,\n            physics: physicsComp,\n            position: positionComp,\n            receivesInputs: receivesInputsComp,\n            shadow: shadowComp,\n            smoothCamera: smoothCameraComp,\n        }\n\n        Object.keys(compDefs).forEach(bareName => {\n            var arg = componentArgs[bareName] || undefined\n            var compFn = compDefs[bareName]\n            var compDef = compFn(noa, arg)\n            this.names[bareName] = this.createComponent(compDef)\n        })\n\n\n\n        /*\n         *\n         *\n         * \n         *          ENTITY ACCESSORS\n         *\n         * A whole bunch of getters and such for accessing component state.\n         * These are moderately faster than `ents.getState(whatever)`.\n         * \n         * \n         * \n        */\n\n        /** @internal */\n        this.cameraSmoothed = this.getComponentAccessor(this.names.smoothCamera)\n\n\n        /**\n         * Returns whether the entity has a physics body\n         * @type {(id:number) => boolean}\n        */\n        this.hasPhysics = this.getComponentAccessor(this.names.physics)\n\n        /**\n         * Returns whether the entity has a position\n         * @type {(id:number) => boolean}\n        */\n        this.hasPosition = this.getComponentAccessor(this.names.position)\n\n        /**\n         * Returns the entity's position component state\n         * @type {(id:number) => null | import(\"../components/position\").PositionState} \n        */\n        this.getPositionData = this.getStateAccessor(this.names.position)\n\n        /**\n         * Returns the entity's position vector.\n         * @type {(id:number) => number[]}\n        */\n        this.getPosition = (id) => {\n            var state = this.getPositionData(id)\n            return (state) ? state.position : null\n        }\n\n        /**\n         * Get the entity's `physics` component state.\n         * @type {(id:number) => null | import(\"../components/physics\").PhysicsState} \n        */\n        this.getPhysics = this.getStateAccessor(this.names.physics)\n\n        /**\n         * Returns the entity's physics body\n         * Note, will throw if the entity doesn't have the position component!\n         * @type {(id:number) => null | import(\"voxel-physics-engine\").RigidBody} \n        */\n        this.getPhysicsBody = (id) => {\n            var state = this.getPhysics(id)\n            return (state) ? state.body : null\n        }\n\n        /**\n         * Returns whether the entity has a mesh\n         * @type {(id:number) => boolean}\n        */\n        this.hasMesh = this.getComponentAccessor(this.names.mesh)\n\n        /**\n         * Returns the entity's `mesh` component state\n         * @type {(id:number) => {mesh:any, offset:number[]}}\n        */\n        this.getMeshData = this.getStateAccessor(this.names.mesh)\n\n        /**\n         * Returns the entity's `movement` component state\n         * @type {(id:number) => import('../components/movement').MovementState}\n        */\n        this.getMovement = this.getStateAccessor(this.names.movement)\n\n        /**\n         * Returns the entity's `collideTerrain` component state\n         * @type {(id:number) => {callback: function}}\n        */\n        this.getCollideTerrain = this.getStateAccessor(this.names.collideTerrain)\n\n        /**\n         * Returns the entity's `collideEntities` component state\n         * @type {(id:number) => {\n         *      cylinder:boolean, collideBits:number, \n         *      collideMask:number, callback: function}}\n        */\n        this.getCollideEntities = this.getStateAccessor(this.names.collideEntities)\n\n\n        /**\n         * Pairwise collideEntities event - assign your own function to this \n         * property if you want to handle entity-entity overlap events.\n         * @type {(id1:number, id2:number) => void}\n         */\n        this.onPairwiseEntityCollision = function (id1, id2) { }\n    }\n\n\n\n\n    /*\n     * \n     * \n     *      PUBLIC ENTITY STATE ACCESSORS\n     * \n     * \n    */\n\n\n    /** Set an entity's position, and update all derived state.\n     * \n     * In general, always use this to set an entity's position unless\n     * you're familiar with engine internals.\n     * \n     * ```js\n     * noa.ents.setPosition(playerEntity, [5, 6, 7])\n     * noa.ents.setPosition(playerEntity, 5, 6, 7)  // also works\n     * ```\n     * \n     * @param {number} id\n     */\n    setPosition(id, pos, y = 0, z = 0) {\n        if (typeof pos === 'number') pos = [pos, y, z]\n        // convert to local and defer impl\n        var loc = this.noa.globalToLocal(pos, null, [])\n        this._localSetPosition(id, loc)\n    }\n\n    /** Set an entity's size \n     * @param {number} xs\n     * @param {number} ys\n     * @param {number} zs\n    */\n    setEntitySize(id, xs, ys, zs) {\n        var posDat = this.getPositionData(id)\n        posDat.width = (xs + zs) / 2\n        posDat.height = ys\n        this._updateDerivedPositionData(id, posDat)\n    }\n\n\n\n\n    /**\n     * called when engine rebases its local coords\n     * @internal\n     */\n    _rebaseOrigin(delta) {\n        for (var state of this.getStatesList(this.names.position)) {\n            var locPos = state._localPosition\n            var hw = state.width / 2\n            nudgePosition(locPos, 0, -hw, hw, state.__id)\n            nudgePosition(locPos, 1, 0, state.height, state.__id)\n            nudgePosition(locPos, 2, -hw, hw, state.__id)\n            vec3.subtract(locPos, locPos, delta)\n            this._updateDerivedPositionData(state.__id, state)\n        }\n    }\n\n    /** @internal */\n    _localGetPosition(id) {\n        return this.getPositionData(id)._localPosition\n    }\n\n    /** @internal */\n    _localSetPosition(id, pos) {\n        var posDat = this.getPositionData(id)\n        vec3.copy(posDat._localPosition, pos)\n        this._updateDerivedPositionData(id, posDat)\n    }\n\n\n    /** \n     * helper to update everything derived from `_localPosition`\n     * @internal \n    */\n    _updateDerivedPositionData(id, posDat) {\n        vec3.copy(posDat._renderPosition, posDat._localPosition)\n        var offset = this.noa.worldOriginOffset\n        vec3.add(posDat.position, posDat._localPosition, offset)\n        updatePositionExtents(posDat)\n        var physDat = this.getPhysics(id)\n        if (physDat) setPhysicsFromPosition(physDat, posDat)\n    }\n\n\n\n\n\n    /*\n     *\n     *\n     *      OTHER ENTITY MANAGEMENT APIs\n     * \n     *      note most APIs are on the original ECS module (ent-comp)\n     *      these are some overlaid extras for noa\n     *\n     *\n    */\n\n\n    /** \n     * Safely add a component - if the entity already had the \n     * component, this will remove and re-add it.\n    */\n    addComponentAgain(id, name, state) {\n        // removes component first if necessary\n        if (this.hasComponent(id, name)) this.removeComponent(id, name)\n        this.addComponent(id, name, state)\n    }\n\n\n    /** \n     * Checks whether a voxel is obstructed by any entity (with the \n     * `collidesTerrain` component)\n    */\n    isTerrainBlocked(x, y, z) {\n        // checks if terrain location is blocked by entities\n        var off = this.noa.worldOriginOffset\n        var xlocal = Math.floor(x - off[0])\n        var ylocal = Math.floor(y - off[1])\n        var zlocal = Math.floor(z - off[2])\n        var blockExt = [\n            xlocal + 0.001, ylocal + 0.001, zlocal + 0.001,\n            xlocal + 0.999, ylocal + 0.999, zlocal + 0.999,\n        ]\n        var list = this.getStatesList(this.names.collideTerrain)\n        for (var i = 0; i < list.length; i++) {\n            var id = list[i].__id\n            var ext = this.getPositionData(id)._extents\n            if (extentsOverlap(blockExt, ext)) return true\n        }\n        return false\n    }\n\n\n\n    /** \n     * Gets an array of all entities overlapping the given AABB\n    */\n    getEntitiesInAABB(box, withComponent) {\n        // extents to test against\n        var off = this.noa.worldOriginOffset\n        var testExtents = [\n            box.base[0] - off[0], box.base[1] - off[1], box.base[2] - off[2],\n            box.max[0] - off[0], box.max[1] - off[1], box.max[2] - off[2],\n        ]\n        // entity position state list\n        var entStates\n        if (withComponent) {\n            entStates = []\n            for (var compState of this.getStatesList(withComponent)) {\n                var pdat = this.getPositionData(compState.__id)\n                if (pdat) entStates.push(pdat)\n            }\n        } else {\n            entStates = this.getStatesList(this.names.position)\n        }\n\n        // run each test\n        var hits = []\n        for (var i = 0; i < entStates.length; i++) {\n            var state = entStates[i]\n            if (extentsOverlap(testExtents, state._extents)) {\n                hits.push(state.__id)\n            }\n        }\n        return hits\n    }\n\n\n\n    /** \n     * Helper to set up a general entity, and populate with some common components depending on arguments.\n    */\n    add(position = null, width = 1, height = 1,\n        mesh = null, meshOffset = null, doPhysics = false, shadow = false) {\n\n        var self = this\n\n        // new entity\n        var eid = this.createEntity()\n\n        // position component\n        this.addComponent(eid, this.names.position, {\n            position: position || vec3.create(),\n            width: width,\n            height: height,\n        })\n\n        // rigid body in physics simulator\n        if (doPhysics) {\n            // body = this.noa.physics.addBody(box)\n            this.addComponent(eid, this.names.physics)\n            var body = this.getPhysics(eid).body\n\n            // handler for physics engine to call on auto-step\n            var smoothName = this.names.smoothCamera\n            body.onStep = function () {\n                self.addComponentAgain(eid, smoothName)\n            }\n        }\n\n        // mesh for the entity\n        if (mesh) {\n            if (!meshOffset) meshOffset = vec3.create()\n            this.addComponent(eid, this.names.mesh, {\n                mesh: mesh,\n                offset: meshOffset\n            })\n        }\n\n        // add shadow-drawing component\n        if (shadow) {\n            this.addComponent(eid, this.names.shadow, { size: width })\n        }\n\n        return eid\n    }\n}\n\n\n/*\n * \n * \n * \n *          HELPERS\n * \n * \n * \n*/\n\n// safety helper - when rebasing, nudge extent away from \n// voxel boudaries, so floating point error doesn't carry us accross\nfunction nudgePosition(pos, index, dmin, dmax, id) {\n    var min = pos[index] + dmin\n    var max = pos[index] + dmax\n    if (Math.abs(min - Math.round(min)) < 0.002) pos[index] += 0.002\n    if (Math.abs(max - Math.round(max)) < 0.001) pos[index] -= 0.001\n}\n\n// compare extent arrays\nfunction extentsOverlap(extA, extB) {\n    if (extA[0] > extB[3]) return false\n    if (extA[1] > extB[4]) return false\n    if (extA[2] > extB[5]) return false\n    if (extA[3] < extB[0]) return false\n    if (extA[4] < extB[1]) return false\n    if (extA[5] < extB[2]) return false\n    return true\n}\n\n","\n\n\n\n// helper to swap item to end and pop(), instead of splice()ing\nexport function removeUnorderedListItem(list, item) {\n    var i = list.indexOf(item)\n    if (i < 0) return\n    if (i === list.length - 1) {\n        list.pop()\n    } else {\n        list[i] = list.pop()\n    }\n}\n\n\n\n\n\n\n\n// ....\nexport function numberOfVoxelsInSphere(rad) {\n    if (rad === prevRad) return prevAnswer\n    var ext = Math.ceil(rad), ct = 0, rsq = rad * rad\n    for (var i = -ext; i <= ext; ++i) {\n        for (var j = -ext; j <= ext; ++j) {\n            for (var k = -ext; k <= ext; ++k) {\n                var dsq = i * i + j * j + k * k\n                if (dsq < rsq) ct++\n            }\n        }\n    }\n    prevRad = rad\n    prevAnswer = ct\n    return ct\n}\nvar prevRad = 0, prevAnswer = 0\n\n\n\n\n\n// partly \"unrolled\" loops to copy contents of ndarrays\n// when there's no source, zeroes out the array instead\nexport function copyNdarrayContents(src, tgt, pos, size, tgtPos) {\n    if (typeof src === 'number') {\n        doNdarrayFill(src, tgt, tgtPos[0], tgtPos[1], tgtPos[2],\n            size[0], size[1], size[2])\n    } else {\n        doNdarrayCopy(src, tgt, pos[0], pos[1], pos[2],\n            size[0], size[1], size[2], tgtPos[0], tgtPos[1], tgtPos[2])\n    }\n}\nfunction doNdarrayCopy(src, tgt, i0, j0, k0, si, sj, sk, ti, tj, tk) {\n    var sdx = src.stride[2]\n    var tdx = tgt.stride[2]\n    for (var i = 0; i < si; i++) {\n        for (var j = 0; j < sj; j++) {\n            var six = src.index(i0 + i, j0 + j, k0)\n            var tix = tgt.index(ti + i, tj + j, tk)\n            for (var k = 0; k < sk; k++) {\n                tgt.data[tix] = src.data[six]\n                six += sdx\n                tix += tdx\n            }\n        }\n    }\n}\n\nfunction doNdarrayFill(value, tgt, i0, j0, k0, si, sj, sk) {\n    var dx = tgt.stride[2]\n    for (var i = 0; i < si; i++) {\n        for (var j = 0; j < sj; j++) {\n            var ix = tgt.index(i0 + i, j0 + j, k0)\n            for (var k = 0; k < sk; k++) {\n                tgt.data[ix] = value\n                ix += dx\n            }\n        }\n    }\n}\n\n\n\n\n// iterates over 3D positions a given manhattan distance from (0,0,0)\n// and exit early if the callback returns true\n// skips locations beyond a horiz or vertical max distance\nexport function iterateOverShellAtDistance(d, xmax, ymax, cb) {\n    if (d === 0) return cb(0, 0, 0)\n    // larger top/bottom planes of current shell\n    var dx = Math.min(d, xmax)\n    var dy = Math.min(d, ymax)\n    if (d <= ymax) {\n        for (var x = -dx; x <= dx; x++) {\n            for (var z = -dx; z <= dx; z++) {\n                if (cb(x, d, z)) return true\n                if (cb(x, -d, z)) return true\n            }\n        }\n    }\n    // smaller side planes of shell\n    if (d <= xmax) {\n        for (var i = -d; i < d; i++) {\n            for (var y = -dy + 1; y < dy; y++) {\n                if (cb(i, y, d)) return true\n                if (cb(-i, y, -d)) return true\n                if (cb(d, y, -i)) return true\n                if (cb(-d, y, i)) return true\n            }\n        }\n    }\n    return false\n}\n\n\n\n\n\n\n// function to hash three indexes (i,j,k) into one integer\n// note that hash wraps around every 1024 indexes.\n//      i.e.:   hash(1, 1, 1) === hash(1025, 1, -1023)\nexport function locationHasher(i, j, k) {\n    return (i & 1023)\n        | ((j & 1023) << 10)\n        | ((k & 1023) << 20)\n}\n\n\n\n/*\n * \n *      chunkStorage - a Map-backed abstraction for storing/\n *      retrieving chunk objects by their location indexes\n * \n*/\n\n/** @internal */\nexport class ChunkStorage {\n    constructor() {\n        this.hash = {}\n    }\n\n    /** @returns {import('./chunk').Chunk} */\n    getChunkByIndexes(i = 0, j = 0, k = 0) {\n        return this.hash[locationHasher(i, j, k)] || null\n    }\n    /** @param {import('./chunk').Chunk} chunk */\n    storeChunkByIndexes(i = 0, j = 0, k = 0, chunk) {\n        this.hash[locationHasher(i, j, k)] = chunk\n    }\n    removeChunkByIndexes(i = 0, j = 0, k = 0) {\n        delete this.hash[locationHasher(i, j, k)]\n    }\n}\n\n\n\n\n\n\n/*\n * \n *      LocationQueue - simple array of [i,j,k] locations, \n *      backed by a hash for O(1) existence checks.\n *      removals by value are O(n).\n * \n*/\n\n/** @internal */\nexport class LocationQueue {\n    constructor() {\n        this.arr = []\n        this.hash = {}\n    }\n    forEach(cb, thisArg) {\n        this.arr.forEach(cb, thisArg)\n    }\n    includes(i, j, k) {\n        var id = locationHasher(i, j, k)\n        return !!this.hash[id]\n    }\n    add(i, j, k, toFront = false) {\n        var id = locationHasher(i, j, k)\n        if (this.hash[id]) return\n        if (toFront) {\n            this.arr.unshift([i, j, k, id])\n        } else {\n            this.arr.push([i, j, k, id])\n        }\n        this.hash[id] = true\n    }\n    removeByIndex(ix) {\n        var el = this.arr[ix]\n        delete this.hash[el[3]]\n        this.arr.splice(ix, 1)\n    }\n    remove(i, j, k) {\n        var id = locationHasher(i, j, k)\n        if (!this.hash[id]) return\n        delete this.hash[id]\n        for (var ix = 0; ix < this.arr.length; ix++) {\n            if (id === this.arr[ix][3]) {\n                this.arr.splice(ix, 1)\n                return\n            }\n        }\n        throw 'internal bug with location queue - hash value overlapped'\n    }\n    count() { return this.arr.length }\n    isEmpty() { return (this.arr.length === 0) }\n    empty() {\n        this.arr = []\n        this.hash = {}\n    }\n    pop() {\n        var el = this.arr.pop()\n        delete this.hash[el[3]]\n        return el\n    }\n    copyFrom(queue) {\n        this.arr = queue.arr.slice()\n        this.hash = {}\n        for (var key in queue.hash) this.hash[key] = true\n    }\n    sortByDistance(locToDist, reverse = false) {\n        sortLocationArrByDistance(this.arr, locToDist, reverse)\n    }\n}\n\n// internal helper for preceding class\nfunction sortLocationArrByDistance(arr, distFn, reverse) {\n    var hash = {}\n    for (var loc of arr) {\n        hash[loc[3]] = distFn(loc[0], loc[1], loc[2])\n    }\n    if (reverse) {\n        arr.sort((a, b) => hash[a[3]] - hash[b[3]]) // ascending\n    } else {\n        arr.sort((a, b) => hash[b[3]] - hash[a[3]]) // descending\n    }\n    hash = null\n}\n\n\n\n\n\n\n\n\n\n\n\n// simple thing for reporting time split up between several activities\nexport function makeProfileHook(every, title = '', filter) {\n    if (!(every > 0)) return () => { }\n    var times = {}\n    var started = 0, last = 0, iter = 0, total = 0\n\n    var start = () => {\n        started = last = performance.now()\n        iter++\n    }\n    var add = (name) => {\n        var t = performance.now()\n        times[name] = (times[name] || 0) + (t - last)\n        last = t\n    }\n    var report = () => {\n        total += performance.now() - started\n        if (iter < every) return\n        var out = `${title}: ${(total / every).toFixed(2)}ms  --  `\n        out += Object.keys(times).map(name => {\n            if (filter && (times[name] / total) < 0.05) return ''\n            return `${name}: ${(times[name] / iter).toFixed(2)}ms`\n        }).join('  ')\n        console.log(out + `    (avg over ${every} runs)`)\n        times = {}\n        iter = total = 0\n    }\n    return (state) => {\n        if (state === 'start') start()\n        else if (state === 'end') report()\n        else add(state)\n    }\n}\n\n\n\n\n// simple thing for reporting time actions/sec\nexport function makeThroughputHook(_every, _title, filter) {\n    var title = _title || ''\n    var every = _every || 1\n    var counts = {}\n    var started = performance.now()\n    var iter = 0\n    return function profile_hook(state) {\n        if (state === 'start') return\n        if (state === 'end') {\n            if (++iter < every) return\n            var t = performance.now()\n            console.log(title + '   ' + Object.keys(counts).map(k => {\n                var through = counts[k] / (t - started) * 1000\n                counts[k] = 0\n                return k + ':' + through.toFixed(2) + '   '\n            }).join(''))\n            started = t\n            iter = 0\n        } else {\n            if (!counts[state]) counts[state] = 0\n            counts[state]++\n        }\n    }\n}\n","\nimport { TransformNode } from '@babylonjs/core/Meshes/transformNode'\nimport { makeProfileHook } from './util'\nimport '@babylonjs/core/Meshes/thinInstanceMesh'\n\n\nvar PROFILE = 0\n\n\n\n\n\n/*\n *\n *          Object meshing\n * \n *      Per-chunk handling of the creation/disposal of static meshes\n *      associated with particular voxel IDs\n * \n * \n*/\n\n\n/** \n * @internal\n * @param {import('../index').Engine} noa\n*/\nexport function ObjectMesher(noa) {\n\n    // transform node for all instance meshes to be parented to\n    this.rootNode = new TransformNode('objectMeshRoot', noa.rendering.scene)\n\n    // tracking rebase amount inside matrix data\n    var rebaseOffset = [0, 0, 0]\n\n    // flag to trigger a rebuild after a chunk is disposed\n    var rebuildNextTick = false\n\n    // mock object to pass to customMesh handler, to get transforms\n    var transformObj = new TransformNode('')\n\n    // list of known base meshes\n    this.allBaseMeshes = []\n\n    // internal storage of instance managers, keyed by ID\n    // has check to dedupe by mesh, since babylon chokes on\n    // separate sets of instances for the same mesh/clone/geometry\n    var managers = {}\n    var getManager = (id) => {\n        if (managers[id]) return managers[id]\n        var mesh = noa.registry._blockMeshLookup[id]\n        for (var id2 in managers) {\n            var prev = managers[id2].mesh\n            if (prev === mesh || (prev.geometry === mesh.geometry)) {\n                return managers[id] = managers[id2]\n            }\n        }\n        this.allBaseMeshes.push(mesh)\n        if (!mesh.metadata) mesh.metadata = {}\n        mesh.metadata[objectMeshFlag] = true\n        return managers[id] = new InstanceManager(noa, mesh)\n    }\n    var objectMeshFlag = 'noa_object_base_mesh'\n\n\n\n    /*\n     * \n     *      public API\n     * \n    */\n\n\n    // add any properties that will get used for meshing\n    this.initChunk = function (chunk) {\n        chunk._objectBlocks = {}\n    }\n\n\n    // called by world when an object block is set or cleared\n    this.setObjectBlock = function (chunk, blockID, i, j, k) {\n        var x = chunk.x + i\n        var y = chunk.y + j\n        var z = chunk.z + k\n        var key = `${x}:${y}:${z}`\n\n        var oldID = chunk._objectBlocks[key] || 0\n        if (oldID === blockID) return // should be impossible\n        if (oldID > 0) {\n            var oldMgr = getManager(oldID)\n            oldMgr.removeInstance(chunk, key)\n        }\n\n        if (blockID > 0) {\n            // if there's a block event handler, call it with\n            // a mock object so client can add transforms\n            var handlers = noa.registry._blockHandlerLookup[blockID]\n            var onCreate = handlers && handlers.onCustomMeshCreate\n            if (onCreate) {\n                transformObj.position.copyFromFloats(0.5, 0, 0.5)\n                transformObj.scaling.setAll(1)\n                transformObj.rotation.setAll(0)\n                onCreate(transformObj, x, y, z)\n            }\n            var mgr = getManager(blockID)\n            var xform = (onCreate) ? transformObj : null\n            mgr.addInstance(chunk, key, i, j, k, xform, rebaseOffset)\n        }\n\n        if (oldID > 0 && !blockID) delete chunk._objectBlocks[key]\n        if (blockID > 0) chunk._objectBlocks[key] = blockID\n    }\n\n\n\n    // called by world when it knows that objects have been updated\n    this.buildObjectMeshes = function () {\n        profile_hook('start')\n\n        for (var id in managers) {\n            var mgr = managers[id]\n            mgr.updateMatrix()\n            if (mgr.count === 0) mgr.dispose()\n            if (mgr.disposed) delete managers[id]\n        }\n\n        profile_hook('rebuilt')\n        profile_hook('end')\n    }\n\n\n\n    // called by world at end of chunk lifecycle\n    this.disposeChunk = function (chunk) {\n        for (var key in chunk._objectBlocks) {\n            var id = chunk._objectBlocks[key]\n            if (id > 0) {\n                var mgr = getManager(id)\n                mgr.removeInstance(chunk, key)\n            }\n        }\n        chunk._objectBlocks = null\n\n        // since some instance managers will have been updated\n        rebuildNextTick = true\n    }\n\n\n\n    // tick handler catches case where objects are dirty due to disposal\n    this.tick = function () {\n        if (rebuildNextTick) {\n            this.buildObjectMeshes()\n            rebuildNextTick = false\n        }\n    }\n\n\n\n    // world rebase handler\n    this._rebaseOrigin = function (delta) {\n        rebaseOffset[0] += delta[0]\n        rebaseOffset[1] += delta[1]\n        rebaseOffset[2] += delta[2]\n\n        for (var id1 in managers) managers[id1].rebased = false\n        for (var id2 in managers) {\n            var mgr = managers[id2]\n            if (mgr.rebased) continue\n            for (var i = 0; i < mgr.count; i++) {\n                var ix = i << 4\n                mgr.buffer[ix + 12] -= delta[0]\n                mgr.buffer[ix + 13] -= delta[1]\n                mgr.buffer[ix + 14] -= delta[2]\n            }\n            mgr.rebased = true\n            mgr.dirty = true\n        }\n        rebuildNextTick = true\n    }\n\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/*\n * \n * \n *      manager class for thin instances of a given object block ID \n * \n * \n*/\n\n/** @param {import('../index').Engine} noa*/\nfunction InstanceManager(noa, mesh) {\n    this.noa = noa\n    this.mesh = mesh\n    this.buffer = null\n    this.capacity = 0\n    this.count = 0\n    this.dirty = false\n    this.rebased = true\n    this.disposed = false\n    // dual struct to map keys (locations) to buffer locations, and back\n    this.keyToIndex = {}\n    this.locToKey = []\n    // prepare mesh for rendering\n    this.mesh.position.setAll(0)\n    this.mesh.parent = noa._objectMesher.rootNode\n    this.noa.rendering.addMeshToScene(this.mesh, false)\n    this.noa.emit('addingTerrainMesh', this.mesh)\n    this.mesh.isPickable = false\n    this.mesh.doNotSyncBoundingInfo = true\n    this.mesh.alwaysSelectAsActiveMesh = true\n}\n\n\n\nInstanceManager.prototype.dispose = function () {\n    if (this.disposed) return\n    this.mesh.thinInstanceCount = 0\n    this.setCapacity(0)\n    this.noa.emit('removingTerrainMesh', this.mesh)\n    this.noa.rendering.setMeshVisibility(this.mesh, false)\n    this.mesh = null\n    this.keyToIndex = null\n    this.locToKey = null\n    this.disposed = true\n}\n\n\nInstanceManager.prototype.addInstance = function (chunk, key, i, j, k, transform, rebaseVec) {\n    maybeExpandBuffer(this)\n    var ix = this.count << 4\n    this.locToKey[this.count] = key\n    this.keyToIndex[key] = ix\n    if (transform) {\n        transform.position.x += (chunk.x - rebaseVec[0]) + i\n        transform.position.y += (chunk.y - rebaseVec[1]) + j\n        transform.position.z += (chunk.z - rebaseVec[2]) + k\n        transform.computeWorldMatrix(true)\n        var xformArr = transform._localMatrix._m\n        copyMatrixData(xformArr, 0, this.buffer, ix)\n    } else {\n        var matArray = tempMatrixArray\n        matArray[12] = (chunk.x - rebaseVec[0]) + i + 0.5\n        matArray[13] = (chunk.y - rebaseVec[1]) + j\n        matArray[14] = (chunk.z - rebaseVec[2]) + k + 0.5\n        copyMatrixData(matArray, 0, this.buffer, ix)\n    }\n    this.count++\n    this.dirty = true\n}\n\n\nInstanceManager.prototype.removeInstance = function (chunk, key) {\n    var remIndex = this.keyToIndex[key]\n    if (!(remIndex >= 0)) throw 'tried to remove object instance not in storage'\n    delete this.keyToIndex[key]\n    var remLoc = remIndex >> 4\n    // copy tail instance's data to location of one we're removing\n    var tailLoc = this.count - 1\n    if (remLoc !== tailLoc) {\n        var tailIndex = tailLoc << 4\n        copyMatrixData(this.buffer, tailIndex, this.buffer, remIndex)\n        // update key/location structs\n        var tailKey = this.locToKey[tailLoc]\n        this.keyToIndex[tailKey] = remIndex\n        this.locToKey[remLoc] = tailKey\n    }\n    this.count--\n    this.dirty = true\n    maybeContractBuffer(this)\n}\n\n\nInstanceManager.prototype.updateMatrix = function () {\n    if (!this.dirty) return\n    this.mesh.thinInstanceCount = this.count\n    this.mesh.thinInstanceBufferUpdated('matrix')\n    this.mesh.isVisible = (this.count > 0)\n    this.dirty = false\n}\n\n\n\nInstanceManager.prototype.setCapacity = function (size = 4) {\n    this.capacity = size\n    if (size === 0) {\n        this.buffer = null\n    } else {\n        var newBuff = new Float32Array(this.capacity * 16)\n        if (this.buffer) {\n            var len = Math.min(this.buffer.length, newBuff.length)\n            for (var i = 0; i < len; i++) newBuff[i] = this.buffer[i]\n        }\n        this.buffer = newBuff\n    }\n    this.mesh.thinInstanceSetBuffer('matrix', this.buffer)\n    this.updateMatrix()\n}\n\n\nfunction maybeExpandBuffer(mgr) {\n    if (mgr.count < mgr.capacity) return\n    var size = Math.max(8, mgr.capacity * 2)\n    mgr.setCapacity(size)\n}\n\nfunction maybeContractBuffer(mgr) {\n    if (mgr.count > mgr.capacity * 0.4) return\n    if (mgr.capacity < 100) return\n    mgr.setCapacity(Math.round(mgr.capacity / 2))\n    mgr.locToKey.length = Math.min(mgr.locToKey.length, mgr.capacity)\n}\n\n\n\n// helpers\n\nvar tempMatrixArray = [\n    1.0, 0.0, 0.0, 0.0,\n    0.0, 1.0, 0.0, 0.0,\n    0.0, 0.0, 1.0, 0.0,\n    0.0, 0.0, 0.0, 1.0,\n]\n\nfunction copyMatrixData(src, srcOff, dest, destOff) {\n    for (var i = 0; i < 16; i++) dest[destOff + i] = src[srcOff + i]\n}\n\n\n\n\n\n\n\n\n\n\n\n\nvar profile_hook = (PROFILE) ?\n    makeProfileHook(PROFILE, 'Object meshing') : () => { }\n","\nimport { Engine } from '@babylonjs/core/Engines/engine'\nimport { Texture } from '@babylonjs/core/Materials/Textures/texture'\nimport { MaterialPluginBase } from '@babylonjs/core/Materials/materialPluginBase'\nimport { RawTexture2DArray } from '@babylonjs/core/Materials/Textures/rawTexture2DArray'\n\n/**\n * \n * \n *      This module creates and manages Materials for terrain meshes. \n *      It tells the terrain mesher which block face materials can share\n *      the same material (and should thus be joined into a single mesh),\n *      and also creates the materials when needed.\n * \n * @internal\n*/\n\nexport class TerrainMatManager {\n\n    /** @param {import('../index').Engine} noa  */\n    constructor(noa) {\n        // make a baseline default material for untextured terrain with no alpha\n        this._defaultMat = noa.rendering.makeStandardMaterial('base-terrain')\n        this._defaultMat.freeze()\n\n        this.allMaterials = [this._defaultMat]\n\n        // internals\n        this.noa = noa\n        this._idCounter = 1000\n        this._blockMatIDtoTerrainID = {}\n        this._terrainIDtoMatObject = {}\n        this._texURLtoTerrainID = {}\n        this._renderMatToTerrainID = new Map()\n    }\n\n\n\n    /** \n     * Maps a given `matID` (from noa.registry) to a unique ID of which \n     * terrain material can be used for that block material.\n     * This lets the terrain mesher map which blocks can be merged into\n     * the same meshes.\n     * Internally, this accessor also creates the material for each \n     * terrainMatID as they are first encountered.\n     */\n\n    getTerrainMatId(blockMatID) {\n        // fast case where matID has been seen before\n        if (blockMatID in this._blockMatIDtoTerrainID) {\n            return this._blockMatIDtoTerrainID[blockMatID]\n        }\n        // decide a unique terrainID for this block material\n        var terrID = decideTerrainMatID(this, blockMatID)\n        // create a mat object for it, if needed\n        if (!(terrID in this._terrainIDtoMatObject)) {\n            var mat = createTerrainMat(this, blockMatID)\n            this.allMaterials.push(mat)\n            this._terrainIDtoMatObject[terrID] = mat\n        }\n        // cache results and done\n        this._blockMatIDtoTerrainID[blockMatID] = terrID\n        return terrID\n    }\n\n\n    /**\n     * Get a Babylon Material object, given a terrainMatID (gotten from this module)\n     */\n    getMaterial(terrainMatID = 1) {\n        return this._terrainIDtoMatObject[terrainMatID]\n    }\n\n\n\n\n\n}\n\n\n\n\n/**\n * \n * \n *      Implementations of creating/disambiguating terrain Materials\n * \n * \n*/\n\n/** \n * Decide a unique terrainID, based on block material ID properties\n * @param {TerrainMatManager} self \n*/\nfunction decideTerrainMatID(self, blockMatID = 0) {\n    var matInfo = self.noa.registry.getMaterialData(blockMatID)\n\n    // custom render materials get one unique terrainID per material\n    if (matInfo.renderMat) {\n        var mat = matInfo.renderMat\n        if (!self._renderMatToTerrainID.has(mat)) {\n            self._renderMatToTerrainID.set(mat, self._idCounter++)\n        }\n        return self._renderMatToTerrainID.get(mat)\n    }\n\n    // ditto for textures, unique URL\n    if (matInfo.texture) {\n        var url = matInfo.texture\n        if (!(url in self._texURLtoTerrainID)) {\n            self._texURLtoTerrainID[url] = self._idCounter++\n        }\n        return self._texURLtoTerrainID[url]\n    }\n\n    // plain color materials with an alpha value are unique by alpha\n    var alpha = matInfo.alpha\n    if (alpha > 0 && alpha < 1) return 10 + Math.round(alpha * 100)\n\n    // the only remaining case is the baseline, which always reuses one fixed ID\n    return 1\n}\n\n\n/** \n * Create (choose) a material for a given set of block material properties\n * @param {TerrainMatManager} self \n*/\nfunction createTerrainMat(self, blockMatID = 0) {\n    var matInfo = self.noa.registry.getMaterialData(blockMatID)\n\n    // custom render mats are just reused\n    if (matInfo.renderMat) return matInfo.renderMat\n\n    // if no texture: use a basic flat material, possibly with alpha\n    if (!matInfo.texture) {\n        var needsAlpha = (matInfo.alpha > 0 && matInfo.alpha < 1)\n        if (!needsAlpha) return self._defaultMat\n        var matName = 'terrain-alpha-' + blockMatID\n        var plainMat = self.noa.rendering.makeStandardMaterial(matName)\n        plainMat.alpha = matInfo.alpha\n        plainMat.freeze()\n        return plainMat\n    }\n\n    // remaining case is a new material with a diffuse texture\n    var scene = self.noa.rendering.getScene()\n    var mat = self.noa.rendering.makeStandardMaterial('terrain-textured-' + blockMatID)\n    var texURL = matInfo.texture\n    var sampling = Texture.NEAREST_SAMPLINGMODE\n    var tex = new Texture(texURL, scene, true, false, sampling)\n    if (matInfo.texHasAlpha) tex.hasAlpha = true\n    mat.diffuseTexture = tex\n\n    // it texture is an atlas, apply material plugin\n    // and check whether any material for the atlas needs alpha\n    if (matInfo.atlasIndex >= 0) {\n        new TerrainMaterialPlugin(mat, tex)\n        if (self.noa.registry._textureNeedsAlpha(matInfo.texture)) {\n            tex.hasAlpha = true\n        }\n    }\n\n    mat.freeze()\n    return mat\n}\n\n\n\n\n\n\n\n\n\n\n\n/**\n * \n *      Babylon material plugin - twiddles the defines/shaders/etc so that\n *      a standard material can use textures from a 2D texture atlas.\n * \n*/\n\nclass TerrainMaterialPlugin extends MaterialPluginBase {\n    constructor(material, texture) {\n        var priority = 200\n        var defines = { 'NOA_TWOD_ARRAY_TEXTURE': false }\n        super(material, 'TestPlugin', priority, defines)\n        this._enable(true)\n        this._atlasTextureArray = null\n\n        texture.onLoadObservable.add((tex) => {\n            this.setTextureArrayData(tex)\n        })\n    }\n\n    setTextureArrayData(texture) {\n        var { width, height } = texture.getSize()\n        var numLayers = Math.round(height / width)\n        height = width\n        var data = texture._readPixelsSync()\n\n        var format = Engine.TEXTUREFORMAT_RGBA\n        var genMipMaps = true\n        var invertY = false\n        var mode = Texture.NEAREST_SAMPLINGMODE\n        var scene = texture.getScene()\n\n        this._atlasTextureArray = new RawTexture2DArray(\n            data, width, height, numLayers,\n            format, scene, genMipMaps, invertY, mode,\n        )\n    }\n\n    prepareDefines(defines, scene, mesh) {\n        defines['NOA_TWOD_ARRAY_TEXTURE'] = true\n    }\n\n    getClassName() {\n        return 'TerrainMaterialPluginName'\n    }\n\n    getSamplers(samplers) {\n        samplers.push('atlasTexture')\n    }\n\n    getAttributes(attributes) {\n        attributes.push('texAtlasIndices')\n    }\n\n    getUniforms() {\n        return { ubo: [] }\n    }\n\n    bindForSubMesh(uniformBuffer, scene, engine, subMesh) {\n        if (this._atlasTextureArray) {\n            uniformBuffer.setTexture('atlasTexture', this._atlasTextureArray)\n        }\n    }\n\n    getCustomCode(shaderType) {\n        if (shaderType === 'vertex') return {\n            'CUSTOM_VERTEX_MAIN_BEGIN': `\n                texAtlasIndex = texAtlasIndices;\n            `,\n            'CUSTOM_VERTEX_DEFINITIONS': `\n                uniform highp sampler2DArray atlasTexture;\n                attribute float texAtlasIndices;\n                varying float texAtlasIndex;\n            `,\n        }\n        if (shaderType === 'fragment') return {\n            '!baseColor\\\\=texture2D\\\\(diffuseSampler,vDiffuseUV\\\\+uvOffset\\\\);':\n                `baseColor = texture(atlasTexture, vec3(vDiffuseUV, texAtlasIndex));`,\n            'CUSTOM_FRAGMENT_DEFINITIONS': `\n                uniform highp sampler2DArray atlasTexture;\n                varying float texAtlasIndex;\n            `,\n        }\n        return null\n    }\n}\n","\nimport ndarray from 'ndarray'\nimport { Mesh } from '@babylonjs/core/Meshes/mesh'\nimport { VertexData } from '@babylonjs/core/Meshes/mesh.vertexData'\nimport { TerrainMatManager } from './terrainMaterials'\nimport { makeProfileHook } from './util'\n\n\n\n// enable for profiling..\nvar PROFILE_EVERY = 0\n\n\n\n\n/*\n * \n *          TERRAIN MESHER!!\n * \n * \n *  top-level entry point:\n *      takes a chunk, passes it to the greedy mesher,\n *      gets back an intermediate struct of face data,\n *      passes that to the mesh builder,\n *      gets back an array of Mesh objects,\n *      and finally puts those into the 3D engine\n *      \n*/\n\n\n/** \n * @internal\n * @param {import('../index').Engine} noa \n*/\nexport function TerrainMesher(noa) {\n\n    // wrangles which block materials can be merged into the same mesh\n    var terrainMatManager = new TerrainMatManager(noa)\n    this.allTerrainMaterials = terrainMatManager.allMaterials\n\n    // internally expose the default flat material used for untextured terrain\n    this._defaultMaterial = terrainMatManager._defaultMat\n\n    // two-pass implementations for this module\n    var greedyMesher = new GreedyMesher(noa, terrainMatManager)\n    var meshBuilder = new MeshBuilder(noa, terrainMatManager)\n\n\n    /*\n     * \n     *      API\n     * \n    */\n\n    // set or clean up any per-chunk properties needed for terrain meshing\n    this.initChunk = function (chunk) {\n        chunk._terrainMeshes.length = 0\n    }\n\n    this.disposeChunk = function (chunk) {\n        chunk._terrainMeshes.forEach(mesh => {\n            noa.emit('removingTerrainMesh', mesh)\n            mesh.dispose()\n        })\n        chunk._terrainMeshes.length = 0\n    }\n\n\n    /**\n     * meshing entry point and high-level flow\n     * @param {import('./chunk').Chunk} chunk \n     */\n    this.meshChunk = function (chunk, ignoreMaterials = false) {\n        profile_hook('start')\n\n        // remove any previous terrain meshes\n        this.disposeChunk(chunk)\n        profile_hook('cleanup')\n\n        // greedy mesher generates struct of face data\n        var faceDataSet = greedyMesher.mesh(chunk, ignoreMaterials)\n        profile_hook('geom')\n\n        // builder generates mesh data (positions, normals, etc)\n        var meshes = meshBuilder.buildMesh(chunk, faceDataSet, ignoreMaterials)\n        profile_hook('build')\n\n        profile_hook('end')\n\n        // add meshes to scene and finish\n        meshes.forEach((mesh) => {\n            mesh.cullingStrategy = Mesh.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY\n            noa.rendering.addMeshToScene(mesh, true, chunk.pos, this)\n            noa.emit('addingTerrainMesh', mesh)\n            mesh.freezeNormals()\n            mesh.freezeWorldMatrix()\n            chunk._terrainMeshes.push(mesh)\n            if (!mesh.metadata) mesh.metadata = {}\n            mesh.metadata[terrainMeshFlag] = true\n        })\n    }\n    var terrainMeshFlag = 'noa_chunk_terrain_mesh'\n\n}\n\n\n\n\n\n\n\n/*\n * \n * \n * \n * \n *      Intermediate struct to hold data for a bunch of merged block faces\n * \n *      The greedy mesher produces these (one per terrainID), \n *      and the mesh builder turns each one into a Mesh instance.\n *\n * \n * \n * \n * \n*/\n\nfunction MeshedFaceData() {\n    this.terrainID = 0\n    this.numFaces = 0\n    // following arrays are all one element per quad\n    this.matIDs = []\n    this.dirs = []\n    this.is = []\n    this.js = []\n    this.ks = []\n    this.wids = []\n    this.hts = []\n    this.packedAO = []\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/**\n * \n * \n * \n *      Greedy meshing algorithm\n *      \n *      Originally based on algo by Mikola Lysenko:\n *          http://0fps.net/2012/07/07/meshing-minecraft-part-2/\n *      but probably no code remaining from there anymore.\n *      Ad-hoc AO handling by me, made of cobwebs and dreams\n * \n *    \n *      Takes in a Chunk instance, and returns an object containing \n *      GeometryData structs, keyed by terrain material ID, \n *      which the terrain builder can then make into meshes.\n * \n * \n * @param {import('../index').Engine} noa\n * @param {import('./terrainMaterials').TerrainMatManager} terrainMatManager\n*/\n\nfunction GreedyMesher(noa, terrainMatManager) {\n\n    // class-wide cached structs and getters\n    var maskCache = new Int16Array(16)\n    var aoMaskCache = new Int16Array(16)\n\n    // terrain ID accessor can be overridded for hacky reasons\n    var realGetTerrainID = terrainMatManager.getTerrainMatId.bind(terrainMatManager)\n    var fakeGetTerrainID = (matID) => 1\n    var terrainIDgetter = realGetTerrainID\n\n\n\n\n\n    /** \n     * Entry point\n     * \n     * @param {import('./chunk').Chunk} chunk\n     * @returns {Object.<string, MeshedFaceData>} keyed by terrain material ID \n     */\n    this.mesh = function (chunk, ignoreMaterials) {\n        var cs = chunk.size\n        terrainIDgetter = (ignoreMaterials) ? fakeGetTerrainID : realGetTerrainID\n\n        // no internal faces for empty or entirely solid chunks\n        var edgesOnly = (chunk._isEmpty || chunk._isFull)\n\n        /** @type {Object.<string, MeshedFaceData>} */\n        var faceDataSet = {}\n        faceDataPool.reset()\n\n        // Sweep over each axis, mapping axes to [d,u,v]\n        for (var d = 0; d < 3; ++d) {\n            var u = (d === 2) ? 0 : 2\n            var v = (d === 1) ? 0 : 1\n\n            // transposed ndarrays of nearby chunk voxels (self and neighbors)\n            var nabVoxelsArr = chunk._neighbors.data.map(c => {\n                if (c && c.voxels) return c.voxels.transpose(d, u, v)\n                return null\n            })\n\n            // ndarray of the previous, similarly transposed\n            var nabVoxelsT = ndarray(nabVoxelsArr, [3, 3, 3])\n                .lo(1, 1, 1)\n                .transpose(d, u, v)\n\n            // embiggen the cached mask arrays if needed\n            if (maskCache.length < cs * cs) {\n                maskCache = new Int16Array(cs * cs)\n                aoMaskCache = new Int16Array(cs * cs)\n            }\n\n            // sets up transposed accessor for querying solidity of (i,j,k):\n            prepareSolidityLookup(nabVoxelsT, cs)\n\n\n            // ACTUAL MASK AND GEOMETRY CREATION\n\n\n            // mesh plane between this chunk and previous neighbor on i axis?\n            var prev = nabVoxelsT.get(-1, 0, 0)\n            var here = nabVoxelsT.get(0, 0, 0)\n            if (prev) {\n                // offset version of neighbor to make queries work at i=-1\n                var prevOff = prev.lo(cs, 0, 0)\n                var nFaces = constructMeshMask(d, prevOff, -1, here, 0)\n\n                if (nFaces > 0) {\n                    constructGeometryFromMasks(0, d, u, v, cs, cs, nFaces, faceDataSet)\n                }\n            }\n\n            // if only doing edges, we're done with this axis\n            if (edgesOnly) continue\n\n\n            // mesh the rest of the planes internal to this chunk\n            // note only looping up to (size-1), skipping final coord so as \n            // not to duplicate faces at chunk borders\n            for (var i = 0; i < cs - 1; i++) {\n\n                // maybe skip y axis, if both layers are all the same voxel\n                if (d === 1) {\n                    var v1 = chunk._wholeLayerVoxel[i]\n                    if (v1 >= 0 && v1 === chunk._wholeLayerVoxel[i + 1]) {\n                        continue\n                    }\n                }\n\n                // pass in layer array for skip checks, only if not already checked\n                var layerVoxRef = (d === 1) ? null : chunk._wholeLayerVoxel\n\n                var nf = constructMeshMask(d, here, i, here, i + 1, layerVoxRef)\n                if (nf > 0) {\n                    constructGeometryFromMasks(i + 1, d, u, v, cs, cs, nf, faceDataSet)\n                }\n            }\n\n            // we skip the i-positive neighbor so as not to duplicate edge faces\n        }\n\n        // done!\n        return faceDataSet\n    }\n\n\n\n\n\n\n    /**\n     * Rigging for a transposed (i,j,k) => boolean solidity lookup, \n     * that knows how to query into neigboring chunks at edges.\n     * This sets up the indirection used by `voxelIsSolid` below.\n    */\n    function prepareSolidityLookup(nabVoxelsT, size) {\n        if (solidityLookupInittedSize !== size) {\n            solidityLookupInittedSize = size\n            voxelIDtoSolidity = noa.registry._solidityLookup\n\n            for (var x = -1; x < size + 1; x++) {\n                var loc = (x < 0) ? 0 : (x < size) ? 1 : 2\n                coordToLoc[x + 1] = [0, 1, 2][loc]\n                edgeCoordLookup[x + 1] = [size - 1, x, 0][loc]\n                missingCoordLookup[x + 1] = [0, x, size - 1][loc]\n            }\n        }\n\n        var centerChunk = nabVoxelsT.get(0, 0, 0)\n        for (var i = 0; i < 3; i++) {\n            for (var j = 0; j < 3; j++) {\n                for (var k = 0; k < 3; k++) {\n                    var ix = i * 9 + j * 3 + k\n                    var nab = nabVoxelsT.get(i - 1, j - 1, k - 1)\n                    var type = 0\n                    if (!nab) type = 1\n                    if (nab === centerChunk) type = 2\n                    voxTypeLookup[ix] = type\n                    voxLookup[ix] = nab || centerChunk\n                }\n            }\n        }\n    }\n\n    var solidityLookupInittedSize = -1\n    var voxelIDtoSolidity = [false, true]\n    var voxLookup = Array(27).fill(null)\n    var voxTypeLookup = Array(27).fill(0)\n    var coordToLoc = [0, 1, 1, 1, 1, 1, 2]\n    var edgeCoordLookup = [3, 0, 1, 2, 3, 0]\n    var missingCoordLookup = [0, 0, 1, 2, 3, 3]\n\n\n    function voxelIsSolid(i, j, k) {\n        var li = coordToLoc[i + 1]\n        var lj = coordToLoc[j + 1]\n        var lk = coordToLoc[k + 1]\n        var ix = li * 9 + lj * 3 + lk\n        var voxArray = voxLookup[ix]\n        var type = voxTypeLookup[ix]\n        if (type === 2) {\n            return voxelIDtoSolidity[voxArray.get(i, j, k)]\n        }\n        var lookup = [edgeCoordLookup, missingCoordLookup][type]\n        var ci = lookup[i + 1]\n        var cj = lookup[j + 1]\n        var ck = lookup[k + 1]\n        return voxelIDtoSolidity[voxArray.get(ci, cj, ck)]\n    }\n\n\n\n\n\n\n\n\n    /**\n     * \n     *      Build a 2D array of mask values representing whether a \n     *      mesh face is needed at each position\n     * \n     *      Each mask value is a terrain material ID, negative if\n     *      the face needs to point in the -i direction (towards voxel arr A)\n     * \n     * @returns {number} number of mesh faces found\n     */\n\n    function constructMeshMask(d, arrA, iA, arrB, iB, wholeLayerVoxel = null) {\n        var len = arrA.shape[1]\n        var mask = maskCache\n        var aoMask = aoMaskCache\n        var doAO = noa.rendering.useAO\n        var skipRevAo = (noa.rendering.revAoVal === noa.rendering.aoVals[0])\n\n        var opacityLookup = noa.registry._opacityLookup\n        var getMaterial = noa.registry.getBlockFaceMaterial\n        var materialDir = d * 2\n\n        // mask is iterated by a simple integer, both here and later when\n        // merging meshes, so the j/k order must be the same in both places\n        var n = 0\n\n        // set up for quick ndarray traversals\n        var indexA = arrA.index(iA, 0, 0)\n        var jstrideA = arrA.stride[1]\n        var kstrideA = arrA.stride[2]\n        var indexB = arrB.index(iB, 0, 0)\n        var jstrideB = arrB.stride[1]\n        var kstrideB = arrB.stride[2]\n\n        var facesFound = 0\n\n        for (var k = 0; k < len; ++k) {\n            var dA = indexA\n            var dB = indexB\n            indexA += kstrideA\n            indexB += kstrideB\n\n            // skip this second axis, if whole layer is same voxel?\n            if (wholeLayerVoxel && wholeLayerVoxel[k] >= 0) {\n                n += len\n                continue\n            }\n\n            for (var j = 0; j < len; j++, n++, dA += jstrideA, dB += jstrideB) {\n\n                // mask[n] represents the face needed between the two voxel layers\n                // for now, assume we never have two faces in both directions\n\n                // note that mesher zeroes out the mask as it goes, so there's \n                // no need to zero it here when no face is needed\n\n                // IDs at i-1,j,k  and  i,j,k\n                var id0 = arrA.data[dA]\n                var id1 = arrB.data[dB]\n\n                // most common case: never a face between same voxel IDs, \n                // so skip out early\n                if (id0 === id1) continue\n\n                // no face if both blocks are opaque\n                var op0 = opacityLookup[id0]\n                var op1 = opacityLookup[id1]\n                if (op0 && op1) continue\n\n                // also no face if both block faces have the same block material\n                var m0 = getMaterial(id0, materialDir)\n                var m1 = getMaterial(id1, materialDir + 1)\n                if (m0 === m1) continue\n\n                // choose which block face to draw:\n                //   * if either block is opaque draw that one\n                //   * if either material is missing draw the other one\n                if (op0 || m1 === 0) {\n                    mask[n] = m0\n                    if (doAO) aoMask[n] = packAOMask(voxelIsSolid, iB, iA, j, k, skipRevAo)\n                    facesFound++\n                } else if (op1 || m0 === 0) {\n                    mask[n] = -m1\n                    if (doAO) aoMask[n] = packAOMask(voxelIsSolid, iA, iB, j, k, skipRevAo)\n                    facesFound++\n                } else {\n                    // leftover case is two different non-opaque blocks facing each other.\n                    // Someday we could try to draw both, but for now we draw neither.\n                }\n            }\n        }\n        return facesFound\n    }\n\n\n\n\n\n\n    // \n    //      Greedy meshing inner loop two\n    //\n    // construct geometry data from the masks\n\n    function constructGeometryFromMasks(i, d, u, v, len1, len2, numFaces, faceDataSet) {\n        var doAO = noa.rendering.useAO\n        var mask = maskCache\n        var aomask = aoMaskCache\n\n        var n = 0\n        var materialDir = d * 2\n        var x = [0, 0, 0]\n        x[d] = i\n\n        var maskCompareFcn = (doAO) ? maskCompare : maskCompare_noAO\n\n        for (var k = 0; k < len2; ++k) {\n            var w = 1\n            var h = 1\n            for (var j = 0; j < len1; j += w, n += w) {\n\n                var maskVal = mask[n] | 0\n                if (!maskVal) {\n                    w = 1\n                    continue\n                }\n\n                var ao = aomask[n] | 0\n\n                // Compute width and height of area with same mask/aomask values\n                for (w = 1; w < len1 - j; ++w) {\n                    if (!maskCompareFcn(n + w, mask, maskVal, aomask, ao)) break\n                }\n\n                OUTER:\n                for (h = 1; h < len2 - k; ++h) {\n                    for (var m = 0; m < w; ++m) {\n                        var ix = n + m + h * len1\n                        if (!maskCompareFcn(ix, mask, maskVal, aomask, ao)) break OUTER\n                    }\n                }\n\n                // for testing: doing the following will disable greediness\n                //w=h=1\n\n                //  materialID and terrain ID type for the face\n                var matID = Math.abs(maskVal)\n                var terrainID = terrainIDgetter(matID)\n\n                // if terrainID not seen before, start a new MeshedFaceData\n                // from the extremely naive object pool\n                if (!(terrainID in faceDataSet)) {\n                    var fdFromPool = faceDataPool.get()\n                    fdFromPool.numFaces = 0\n                    fdFromPool.terrainID = terrainID\n                    faceDataSet[terrainID] = fdFromPool\n                }\n\n                // pack one face worth of data into the return struct\n\n                var faceData = faceDataSet[terrainID]\n                var nf = faceData.numFaces\n                faceData.numFaces++\n\n                faceData.matIDs[nf] = matID\n                x[u] = j\n                x[v] = k\n                faceData.is[nf] = x[0]\n                faceData.js[nf] = x[1]\n                faceData.ks[nf] = x[2]\n                faceData.wids[nf] = w\n                faceData.hts[nf] = h\n                faceData.packedAO[nf] = ao\n                faceData.dirs[nf] = (maskVal > 0) ? materialDir : materialDir + 1\n\n\n                // Face now finished, zero out the used part of the mask\n                for (var hx = 0; hx < h; ++hx) {\n                    for (var wx = 0; wx < w; ++wx) {\n                        mask[n + wx + hx * len1] = 0\n                    }\n                }\n\n                // exit condition where no more faces are left to mesh\n                numFaces -= w * h\n                if (numFaces === 0) return\n            }\n        }\n    }\n\n    function maskCompare(index, mask, maskVal, aomask, aoVal) {\n        if (maskVal !== mask[index]) return false\n        if (aoVal !== aomask[index]) return false\n        return true\n    }\n\n    function maskCompare_noAO(index, mask, maskVal, aomask, aoVal) {\n        if (maskVal !== mask[index]) return false\n        return true\n    }\n\n}\n\n\n/**\n * Extremely naive object pool for MeshedFaceData objects\n*/\nvar faceDataPool = (() => {\n    var arr = [], ix = 0\n    var get = () => {\n        if (ix >= arr.length) arr.push(new MeshedFaceData)\n        ix++\n        return arr[ix - 1]\n    }\n    var reset = () => { ix = 0 }\n    return { get, reset }\n})()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/**\n * \n * \n * \n * \n *       Mesh Builder - consumes all the raw data in geomData to build\n *          Babylon.js mesh/submeshes, ready to be added to the scene\n * \n * \n * \n * \n * \n */\n\n/** @param {import('../index').Engine} noa  */\nfunction MeshBuilder(noa, terrainMatManager) {\n\n    /** \n     * Consume the intermediate FaceData struct and produce\n     * actual mesehes the 3D engine can render\n     * @param {Object.<string, MeshedFaceData>} faceDataSet  \n    */\n    this.buildMesh = function (chunk, faceDataSet, ignoreMaterials) {\n        var scene = noa.rendering.getScene()\n\n        var doAO = noa.rendering.useAO\n        var aoVals = noa.rendering.aoVals\n        var revAoVal = noa.rendering.revAoVal\n\n        var atlasIndexLookup = noa.registry._matAtlasIndexLookup\n        var matColorLookup = noa.registry._materialColorLookup\n        var white = [1, 1, 1]\n\n\n\n\n        // geometry data is already keyed by terrain type, so build\n        // one mesh per geomData object in the hash\n        var meshes = []\n        for (var key in faceDataSet) {\n            var faceData = faceDataSet[key]\n            var terrainID = faceData.terrainID\n\n            // will this mesh need texture atlas indexes?\n            var usesAtlas = false\n            if (!ignoreMaterials) {\n                var firstIx = atlasIndexLookup[faceData.matIDs[0]]\n                usesAtlas = (firstIx >= 0)\n            }\n\n            // build the necessary arrays\n            var nf = faceData.numFaces\n            var indices = new Uint16Array(nf * 6)\n            var positions = new Float32Array(nf * 12)\n            var normals = new Float32Array(nf * 12)\n            var colors = new Float32Array(nf * 16)\n            var uvs = new Float32Array(nf * 8)\n            var atlasIndexes\n            if (usesAtlas) atlasIndexes = new Float32Array(nf * 4)\n\n            // scan all faces in the struct, creating data for each\n            for (var f = 0; f < faceData.numFaces; f++) {\n\n                // basic data from struct\n                var matID = faceData.matIDs[f]\n                var materialDir = faceData.dirs[f]  // 0..5: x,-x, y,-y, z,-z\n\n                var i = faceData.is[f]\n                var j = faceData.js[f]\n                var k = faceData.ks[f]\n                var w = faceData.wids[f]\n                var h = faceData.hts[f]\n                var axis = (materialDir / 2) | 0\n                var dir = (materialDir % 2) ? -1 : 1\n\n\n                addPositionValues(positions, f, i, j, k, axis, w, h)\n                addUVs(uvs, f, axis, w, h, dir)\n\n                var norms = [0, 0, 0]\n                norms[axis] = dir\n                addNormalValues(normals, f, norms)\n\n                var ao = faceData.packedAO[f]\n                var [A, B, C, D] = unpackAOMask(ao)\n                var triDir = decideTriDir(A, B, C, D)\n\n                addIndexValues(indices, f, axis, dir, triDir)\n\n                if (usesAtlas) {\n                    var atlasIndex = atlasIndexLookup[matID]\n                    addAtlasIndices(atlasIndexes, f, atlasIndex)\n                }\n\n                var matColor = matColorLookup[matID] || white\n                if (doAO) {\n                    pushMeshColors(colors, f, matColor, aoVals, revAoVal, A, B, C, D)\n                } else {\n                    pushMeshColors_noAO(colors, f, matColor)\n                }\n            }\n\n\n\n            // the mesh and vertexData object\n            var name = `chunk_${chunk.requestID}_${terrainID}`\n            var mesh = new Mesh(name, scene)\n            var vdat = new VertexData()\n\n            // finish the mesh\n            vdat.positions = positions\n            vdat.indices = indices\n            vdat.normals = normals\n            vdat.colors = colors\n            vdat.uvs = uvs\n            vdat.applyToMesh(mesh)\n\n            // meshes using a texture atlas need atlasIndices\n            if (usesAtlas) {\n                mesh.setVerticesData('texAtlasIndices', atlasIndexes, false, 1)\n            }\n\n            // disable some unnecessary bounding checks\n            mesh.isPickable = false\n            mesh.doNotSyncBoundingInfo = true\n            mesh._refreshBoundingInfo = () => mesh\n\n            // materials wrangled by external module\n            if (!ignoreMaterials) {\n                mesh.material = terrainMatManager.getMaterial(terrainID)\n            }\n\n            // done\n            meshes.push(mesh)\n        }\n\n        return meshes\n    }\n\n\n\n\n    // HELPERS ---- these could probably be simplified and less magical\n\n    function addPositionValues(posArr, faceNum, i, j, k, axis, w, h) {\n        var offset = faceNum * 12\n\n        var loc = [i, j, k]\n        var du = [0, 0, 0]\n        var dv = [0, 0, 0]\n        du[(axis === 2) ? 0 : 2] = w\n        dv[(axis === 1) ? 0 : 1] = h\n\n        for (var ix = 0; ix < 3; ix++) {\n            posArr[offset + ix] = loc[ix]\n            posArr[offset + 3 + ix] = loc[ix] + du[ix]\n            posArr[offset + 6 + ix] = loc[ix] + du[ix] + dv[ix]\n            posArr[offset + 9 + ix] = loc[ix] + dv[ix]\n        }\n    }\n\n\n\n    function addUVs(uvArr, faceNum, d, w, h, dir) {\n        var offset = faceNum * 8\n        var epsilon = 0\n        for (var i = 0; i < 8; i++) uvArr[offset + i] = epsilon\n        if (d === 0) {\n            uvArr[offset + 1] = uvArr[offset + 3] = h - epsilon\n            uvArr[offset + 2] = uvArr[offset + 4] = dir * w\n        } else if (d === 1) {\n            uvArr[offset + 1] = uvArr[offset + 7] = w - epsilon\n            uvArr[offset + 4] = uvArr[offset + 6] = dir * h\n        } else {\n            uvArr[offset + 1] = uvArr[offset + 3] = h - epsilon\n            uvArr[offset + 2] = uvArr[offset + 4] = -dir * w\n        }\n    }\n\n    function addNormalValues(normArr, faceNum, norms) {\n        var offset = faceNum * 12\n        for (var i = 0; i < 12; i++) {\n            normArr[offset + i] = norms[i % 3]\n        }\n    }\n\n    function addIndexValues(indArr, faceNum, axis, dir, triDir) {\n        var offset = faceNum * 6\n        var baseIndex = faceNum * 4\n        if (axis === 0) dir = -dir\n        var ix = (dir < 0) ? 0 : 1\n        if (!triDir) ix += 2\n        var indexVals = indexLists[ix]\n        for (var i = 0; i < 6; i++) {\n            indArr[offset + i] = baseIndex + indexVals[i]\n        }\n    }\n    var indexLists = [\n        [0, 1, 2, 0, 2, 3], // base\n        [0, 2, 1, 0, 3, 2], // flipped\n        [1, 2, 3, 1, 3, 0], // opposite triDir\n        [1, 3, 2, 1, 0, 3], // opposite triDir\n    ]\n\n\n\n\n    function addAtlasIndices(indArr, faceNum, atlasIndex) {\n        var offset = faceNum * 4\n        for (var i = 0; i < 4; i++) {\n            indArr[offset + i] = atlasIndex\n        }\n    }\n\n    function decideTriDir(A, B, C, D) {\n        // this bit is pretty magical..\n        // (true means split along the a00-a11 axis)\n        if (A === C) {\n            return (D === B) ? (D === 2) : true\n        } else {\n            return (D === B) ? false : (A + C > D + B)\n        }\n    }\n\n    function pushMeshColors_noAO(colors, faceNum, col) {\n        var offset = faceNum * 16\n        for (var i = 0; i < 16; i += 4) {\n            colors[offset + i] = col[0]\n            colors[offset + i + 1] = col[1]\n            colors[offset + i + 2] = col[2]\n            colors[offset + i + 3] = 1\n        }\n    }\n\n    function pushMeshColors(colors, faceNum, col, aoVals, revAo, A, B, C, D) {\n        var offset = faceNum * 16\n        pushAOColor(colors, offset, col, A, aoVals, revAo)\n        pushAOColor(colors, offset + 4, col, D, aoVals, revAo)\n        pushAOColor(colors, offset + 8, col, C, aoVals, revAo)\n        pushAOColor(colors, offset + 12, col, B, aoVals, revAo)\n    }\n\n    // premultiply vertex colors by value depending on AO level\n    // then push them into color array\n    function pushAOColor(colors, ix, baseCol, ao, aoVals, revAoVal) {\n        var mult = (ao === 0) ? revAoVal : aoVals[ao - 1]\n        colors[ix] = baseCol[0] * mult\n        colors[ix + 1] = baseCol[1] * mult\n        colors[ix + 2] = baseCol[2] * mult\n        colors[ix + 3] = 1\n    }\n\n}\n\n\n\n\n\n\n\n\n/*\n *\n *\n *\n *\n *          SHARED HELPERS - used by both main classes\n *\n *\n *\n *\n *\n*/\n\n\n\n\n/**\n *\n *\n *\n *  packAOMask:\n *\n *    For a given face, find occlusion levels for each vertex, then\n *    pack 4 such (2-bit) values into one Uint8 value\n * \n *  Occlusion levels:\n *    1 is flat ground, 2 is partial occlusion, 3 is max (corners)\n *    0 is \"reverse occlusion\" - an unoccluded exposed edge \n *  Packing order var(bit offset):\n * \n *      B(2)  -  C(6)   ^  K\n *       -        -     +> J\n *      A(0)  -  D(4)\n * \n*/\n\nfunction packAOMask(isSolid, ipos, ineg, j, k, skipReverse = false) {\n    var A = 1\n    var B = 1\n    var D = 1\n    var C = 1\n\n    // inc occlusion of vertex next to obstructed side\n    if (isSolid(ipos, j + 1, k)) { ++D; ++C }\n    if (isSolid(ipos, j - 1, k)) { ++A; ++B }\n    if (isSolid(ipos, j, k + 1)) { ++B; ++C }\n    if (isSolid(ipos, j, k - 1)) { ++A; ++D }\n\n    // facing into a solid (non-opaque) block?\n    var facingSolid = isSolid(ipos, j, k)\n    if (facingSolid) {\n        // always 2, or 3 in corners\n        C = (C === 3 || isSolid(ipos, j + 1, k + 1)) ? 3 : 2\n        B = (B === 3 || isSolid(ipos, j - 1, k + 1)) ? 3 : 2\n        D = (D === 3 || isSolid(ipos, j + 1, k - 1)) ? 3 : 2\n        A = (A === 3 || isSolid(ipos, j - 1, k - 1)) ? 3 : 2\n        return C << 6 | D << 4 | B << 2 | A\n    }\n\n    // simpler logic if skipping reverse AO?\n    if (skipReverse) {\n        // treat corner as occlusion 3 only if not occluded already\n        if (C === 1 && (isSolid(ipos, j + 1, k + 1))) { C = 2 }\n        if (B === 1 && (isSolid(ipos, j - 1, k + 1))) { B = 2 }\n        if (D === 1 && (isSolid(ipos, j + 1, k - 1))) { D = 2 }\n        if (A === 1 && (isSolid(ipos, j - 1, k - 1))) { A = 2 }\n        return C << 6 | D << 4 | B << 2 | A\n    }\n\n    // check each corner, and if not present do reverse AO\n    if (C === 1) {\n        if (isSolid(ipos, j + 1, k + 1)) {\n            C = 2\n        } else if (!(isSolid(ineg, j, k + 1)) ||\n            !(isSolid(ineg, j + 1, k)) ||\n            !(isSolid(ineg, j + 1, k + 1))) {\n            C = 0\n        }\n    }\n\n    if (D === 1) {\n        if (isSolid(ipos, j + 1, k - 1)) {\n            D = 2\n        } else if (!(isSolid(ineg, j, k - 1)) ||\n            !(isSolid(ineg, j + 1, k)) ||\n            !(isSolid(ineg, j + 1, k - 1))) {\n            D = 0\n        }\n    }\n\n    if (B === 1) {\n        if (isSolid(ipos, j - 1, k + 1)) {\n            B = 2\n        } else if (!(isSolid(ineg, j, k + 1)) ||\n            !(isSolid(ineg, j - 1, k)) ||\n            !(isSolid(ineg, j - 1, k + 1))) {\n            B = 0\n        }\n    }\n\n    if (A === 1) {\n        if (isSolid(ipos, j - 1, k - 1)) {\n            A = 2\n        } else if (!(isSolid(ineg, j, k - 1)) ||\n            !(isSolid(ineg, j - 1, k)) ||\n            !(isSolid(ineg, j - 1, k - 1))) {\n            A = 0\n        }\n    }\n\n    return C << 6 | D << 4 | B << 2 | A\n}\n\n/**\n * \n *      Takes in a packed AO value representing a face,\n *      and returns four 2-bit numbers for the AO levels\n *      at the four corners.\n *      \n*/\nfunction unpackAOMask(aomask) {\n    var A = aomask & 3\n    var B = (aomask >> 2) & 3\n    var D = (aomask >> 4) & 3\n    var C = (aomask >> 6) & 3\n    return [A, B, C, D]\n}\n\n\n\n\n\n\n\n\nvar profile_hook = (PROFILE_EVERY) ?\n    makeProfileHook(PROFILE_EVERY, 'Meshing') : () => { }\n\n","\n\nvar defaults = {\n    texturePath: ''\n}\n\n// voxel ID now uses the whole Uint16Array element\nvar MAX_BLOCK_ID = (1 << 16) - 1\n\n\n\n\n\n/**\n * `noa.registry` - Where you register your voxel types, \n * materials, properties, and events.\n * \n * This module uses the following default options (from the options\n * object passed to the {@link Engine}):\n * \n * ```js\n * var defaults = {\n *     texturePath: ''\n * }\n * ```\n*/\n\nexport class Registry {\n\n\n    /** \n     * @internal \n     * @param {import('../index').Engine} noa\n    */\n    constructor(noa, opts) {\n        opts = Object.assign({}, defaults, opts)\n        /** @internal */\n        this.noa = noa\n\n        /** @internal */\n        this._texturePath = opts.texturePath\n\n        /** Maps block face material names to matIDs\n         * @type {Object.<string, number>} */\n        var matIDs = {}\n\n        // lookup arrays for block props and flags - all keyed by blockID\n        // fill in first value for the air block with id=0\n        var blockSolidity = [false]\n        var blockOpacity = [false]\n        var blockIsFluid = [false]\n        var blockIsObject = [false]\n        var blockProps = [null]     // less-often accessed properties\n        var blockMeshes = [null]    // custom mesh objects\n        var blockHandlers = [null]  // block event handlers\n        var blockIsPlain = [false]  // true if voxel is \"boring\" - solid/opaque, no special props\n\n        // this one is keyed by `blockID*6 + faceNumber`\n        var blockMats = [0, 0, 0, 0, 0, 0]\n\n        // and these are keyed by material id\n        var matColorLookup = [null]\n        var matAtlasIndexLookup = [-1]\n\n        /** \n         * Lookup array of block face material properties - keyed by matID (not blockID)\n         * @typedef MatDef\n         * @prop {number[]} color\n         * @prop {number} alpha\n         * @prop {string} texture\n         * @prop {boolean} texHasAlpha\n         * @prop {number} atlasIndex\n         * @prop {*} renderMat\n         */\n        /** @type {MatDef[]} */\n        var matDefs = []\n\n\n        /* \n         * \n         *      Block registration methods\n         * \n        */\n\n\n\n        /**\n         * Register (by integer ID) a block type and its parameters.\n         *  `id` param: integer, currently 1..65535. Generally you should \n         * specify sequential values for blocks, without gaps, but this \n         * isn't technically necessary.\n         * \n         * @param {number} id - sequential integer ID (from 1)\n         * @param {Partial<BlockOptions>} [options] \n         * @returns the `id` value specified\n         */\n        this.registerBlock = function (id = 1, options = null) {\n            var defaults = new BlockOptions(options && options.fluid)\n            var opts = Object.assign({}, defaults, options || {})\n\n            // console.log('register block: ', id, opts)\n            if (id < 1 || id > MAX_BLOCK_ID) throw 'Block id out of range: ' + id\n\n            // if block ID is greater than current highest ID, \n            // register fake blocks to avoid holes in lookup arrays\n            while (id > blockSolidity.length) {\n                this.registerBlock(blockSolidity.length, {})\n            }\n\n            // flags default to solid, opaque, nonfluid\n            blockSolidity[id] = !!opts.solid\n            blockOpacity[id] = !!opts.opaque\n            blockIsFluid[id] = !!opts.fluid\n\n            // store any custom mesh\n            blockIsObject[id] = !!opts.blockMesh\n            blockMeshes[id] = opts.blockMesh || null\n\n            // parse out material parameter\n            // always store 6 material IDs per blockID, so material lookup is monomorphic\n            var mat = opts.material || null\n            var mats\n            if (!mat) {\n                mats = [null, null, null, null, null, null]\n            } else if (typeof mat == 'string') {\n                mats = [mat, mat, mat, mat, mat, mat]\n            } else if (mat.length && mat.length == 2) {\n                // interpret as [top/bottom, sides]\n                mats = [mat[1], mat[1], mat[0], mat[0], mat[1], mat[1]]\n            } else if (mat.length && mat.length == 3) {\n                // interpret as [top, bottom, sides]\n                mats = [mat[2], mat[2], mat[0], mat[1], mat[2], mat[2]]\n            } else if (mat.length && mat.length == 6) {\n                // interpret as [-x, +x, -y, +y, -z, +z]\n                mats = mat\n            } else throw 'Invalid material parameter: ' + mat\n\n            // argument is material name, but store as material id, allocating one if needed\n            for (var i = 0; i < 6; ++i) {\n                blockMats[id * 6 + i] = getMaterialId(this, matIDs, mats[i], true)\n            }\n\n            // props data object - currently only used for fluid properties\n            blockProps[id] = {}\n\n            // if block is fluid, initialize properties if needed\n            if (blockIsFluid[id]) {\n                blockProps[id].fluidDensity = opts.fluidDensity\n                blockProps[id].viscosity = opts.viscosity\n            }\n\n            // event callbacks\n            var hasHandler = opts.onLoad || opts.onUnload || opts.onSet || opts.onUnset || opts.onCustomMeshCreate\n            blockHandlers[id] = (hasHandler) ? new BlockCallbackHolder(opts) : null\n\n            // special lookup for \"plain\"-ness\n            // plain means solid, opaque, not fluid, no mesh or events\n            var isPlain = blockSolidity[id] && blockOpacity[id]\n                && !hasHandler && !blockIsFluid[id] && !blockIsObject[id]\n            blockIsPlain[id] = isPlain\n\n            return id\n        }\n\n\n\n\n        /**\n         * Register (by name) a material and its parameters.\n         * \n         * @param {string} name of this material\n         * @param {Partial<MaterialOptions>} [options]\n         */\n\n        this.registerMaterial = function (name = '?', options = null) {\n            // catch calls to earlier signature\n            if (Array.isArray(options)) {\n                throw 'This API changed signatures in v0.33, please use: `noa.registry.registerMaterial(\"name\", optionsObj)`'\n            }\n\n            var opts = Object.assign(new MaterialOptions(), options || {})\n            var matID = matIDs[name] || matDefs.length\n            matIDs[name] = matID\n\n            var texURL = opts.textureURL ? this._texturePath + opts.textureURL : ''\n            var alpha = 1.0\n            var color = opts.color || [1.0, 1.0, 1.0]\n            if (color.length === 4) alpha = color.pop()\n            if (texURL) color = null\n\n            // populate lookup arrays for terrain meshing\n            matColorLookup[matID] = color\n            matAtlasIndexLookup[matID] = opts.atlasIndex\n\n            matDefs[matID] = {\n                color,\n                alpha,\n                texture: texURL,\n                texHasAlpha: !!opts.texHasAlpha,\n                atlasIndex: opts.atlasIndex,\n                renderMat: opts.renderMaterial,\n            }\n            return matID\n        }\n\n\n\n        /*\n         *      quick accessors for querying block ID stuff\n         */\n\n        /** \n         * block solidity (as in physics) \n         * @param id\n         */\n        this.getBlockSolidity = function (id) {\n            return blockSolidity[id]\n        }\n\n        /**\n         * block opacity - whether it obscures the whole voxel (dirt) or \n         * can be partially seen through (like a fencepost, etc)\n         * @param id\n         */\n        this.getBlockOpacity = function (id) {\n            return blockOpacity[id]\n        }\n\n        /** \n         * block is fluid or not\n         * @param id\n         */\n        this.getBlockFluidity = function (id) {\n            return blockIsFluid[id]\n        }\n\n        /** \n         * Get block property object passed in at registration\n         * @param id\n         */\n        this.getBlockProps = function (id) {\n            return blockProps[id]\n        }\n\n        // look up a block ID's face material\n        // dir is a value 0..5: [ +x, -x, +y, -y, +z, -z ]\n        this.getBlockFaceMaterial = function (blockId, dir) {\n            return blockMats[blockId * 6 + dir]\n        }\n\n\n        /**\n         * General lookup for all properties of a block material\n         * @param {number} matID \n         * @returns {MatDef}\n         */\n        this.getMaterialData = function (matID) {\n            return matDefs[matID]\n        }\n\n\n        /**\n         * Given a texture URL, does any material using that \n         * texture need alpha?\n         * @internal\n         * @returns {boolean}\n         */\n        this._textureNeedsAlpha = function (tex = '') {\n            return matDefs.some(def => {\n                if (def.texture !== tex) return false\n                return def.texHasAlpha\n            })\n        }\n\n\n\n\n\n        /*\n         * \n         *   Meant for internal use within the engine\n         * \n         */\n\n\n        // internal access to lookup arrays\n        /** @internal */\n        this._solidityLookup = blockSolidity\n        /** @internal */\n        this._opacityLookup = blockOpacity\n        /** @internal */\n        this._fluidityLookup = blockIsFluid\n        /** @internal */\n        this._objectLookup = blockIsObject\n        /** @internal */\n        this._blockMeshLookup = blockMeshes\n        /** @internal */\n        this._blockHandlerLookup = blockHandlers\n        /** @internal */\n        this._blockIsPlainLookup = blockIsPlain\n        /** @internal */\n        this._materialColorLookup = matColorLookup\n        /** @internal */\n        this._matAtlasIndexLookup = matAtlasIndexLookup\n\n\n\n        /*\n         * \n         *      default initialization\n         * \n         */\n\n        // add a default material and set ID=1 to it\n        // this is safe since registering new block data overwrites the old\n        this.registerMaterial('dirt', { color: [0.4, 0.3, 0] })\n        this.registerBlock(1, { material: 'dirt' })\n\n    }\n\n}\n\n/*\n * \n *          helpers\n * \n*/\n\n\n\n// look up material ID given its name\n// if lazy is set, pre-register the name and return an ID\nfunction getMaterialId(reg, matIDs, name, lazyInit) {\n    if (!name) return 0\n    var id = matIDs[name]\n    if (id === undefined && lazyInit) id = reg.registerMaterial(name)\n    return id\n}\n\n\n\n// data class for holding block callback references\nfunction BlockCallbackHolder(opts) {\n    this.onLoad = opts.onLoad || null\n    this.onUnload = opts.onUnload || null\n    this.onSet = opts.onSet || null\n    this.onUnset = opts.onUnset || null\n    this.onCustomMeshCreate = opts.onCustomMeshCreate || null\n}\n\n\n\n\n/**\n * Default options when registering a block type\n */\nfunction BlockOptions(isFluid = false) {\n    /** Solidity for physics purposes */\n    this.solid = (isFluid) ? false : true\n    /** Whether the block fully obscures neighboring blocks */\n    this.opaque = (isFluid) ? false : true\n    /** whether a nonsolid block is a fluid (buoyant, viscous..) */\n    this.fluid = false\n    /** The block material(s) for this voxel's faces. May be:\n     *   * one (String) material name\n     *   * array of 2 names: [top/bottom, sides]\n     *   * array of 3 names: [top, bottom, sides]\n     *   * array of 6 names: [-x, +x, -y, +y, -z, +z]\n     * @type {string|string[]}\n    */\n    this.material = null\n    /** Specifies a custom mesh for this voxel, instead of terrain  */\n    this.blockMesh = null\n    /** Fluid parameter for fluid blocks */\n    this.fluidDensity = 1.0\n    /** Fluid parameter for fluid blocks */\n    this.viscosity = 0.5\n    /** @type {(x:number, y:number, z:number) => void} */\n    this.onLoad = null\n    /** @type {(x:number, y:number, z:number) => void} */\n    this.onUnload = null\n    /** @type {(x:number, y:number, z:number) => void} */\n    this.onSet = null\n    /** @type {(x:number, y:number, z:number) => void} */\n    this.onUnset = null\n    /** @type {(mesh:TransformNode, x:number, y:number, z:number) => void} */\n    this.onCustomMeshCreate = null\n}\n\n/** @typedef {import('@babylonjs/core/Meshes').TransformNode} TransformNode */\n\n\n/**\n * Default options when registering a Block Material\n */\nfunction MaterialOptions() {\n    /** An array of 0..1 floats, either [R,G,B] or [R,G,B,A]\n     * @type {number[]}\n     */\n    this.color = null\n    /** Filename of texture image, if any\n     * @type {string}\n     */\n    this.textureURL = null\n    /** Whether the texture image has alpha */\n    this.texHasAlpha = false\n    /** Index into a (vertical strip) texture atlas, if applicable */\n    this.atlasIndex = -1\n    /**\n     * An optional Babylon.js `Material`. If specified, terrain for this voxel\n     * will be rendered with the supplied material (this can impact performance).\n     */\n    this.renderMaterial = null\n}\n","\nimport { Vector3 } from '@babylonjs/core/Maths/math.vector'\nimport { Octree } from '@babylonjs/core/Culling/Octrees/octree'\nimport { OctreeBlock } from '@babylonjs/core/Culling/Octrees/octreeBlock'\nimport { OctreeSceneComponent } from '@babylonjs/core/Culling/Octrees/octreeSceneComponent'\n\nimport { locationHasher, removeUnorderedListItem } from './util'\n\n\n/*\n * \n * \n * \n *          simple class to manage scene octree and octreeBlocks\n * \n * \n * \n*/\n\n/** @internal */\nexport class SceneOctreeManager {\n\n    /** @internal */\n    constructor(rendering, blockSize) {\n        var scene = rendering.scene\n        scene._addComponent(new OctreeSceneComponent(scene))\n\n        // mesh metadata flags\n        var octreeBlock = 'noa_octree_block'\n        var inDynamicList = 'noa_in_dynamic_list'\n        var inOctreeBlock = 'noa_in_octree_block'\n\n        // the root octree object\n        var octree = new Octree(NOP)\n        scene._selectionOctree = octree\n        octree.blocks = []\n        var octBlocksHash = {}\n\n\n        /*\n         * \n         *          public API\n         * \n        */\n\n        this.rebase = (offset) => { recurseRebaseBlocks(octree, offset) }\n\n        this.addMesh = (mesh, isStatic, pos, chunk) => {\n            if (!mesh.metadata) mesh.metadata = {}\n\n            // dynamic content is just rendered from a list on the octree\n            if (!isStatic) {\n                if (mesh.metadata[inDynamicList]) return\n                octree.dynamicContent.push(mesh)\n                mesh.metadata[inDynamicList] = true\n                return\n            }\n\n            // octreeBlock-space integer coords of mesh position, and hashed key\n            var ci = Math.floor(pos[0] / bs)\n            var cj = Math.floor(pos[1] / bs)\n            var ck = Math.floor(pos[2] / bs)\n            var mapKey = locationHasher(ci, cj, ck)\n\n            // get or create octreeBlock\n            var block = octBlocksHash[mapKey]\n            if (!block) {\n                // lower corner of new octree block position, in global/local\n                var gloc = [ci * bs, cj * bs, ck * bs]\n                var loc = [0, 0, 0]\n                rendering.noa.globalToLocal(gloc, null, loc)\n                // make the new octree block and store it\n                block = makeOctreeBlock(loc, bs)\n                octree.blocks.push(block)\n                octBlocksHash[mapKey] = block\n                block._noaMapKey = mapKey\n            }\n\n            // do the actual adding logic\n            block.entries.push(mesh)\n            mesh.metadata[octreeBlock] = block\n            mesh.metadata[inOctreeBlock] = true\n\n            // rely on octrees for selection, skipping bounds checks\n            mesh.alwaysSelectAsActiveMesh = true\n        }\n\n\n\n        this.removeMesh = (mesh) => {\n            if (!mesh.metadata) return\n\n            if (mesh.metadata[inDynamicList]) {\n                removeUnorderedListItem(octree.dynamicContent, mesh)\n                mesh.metadata[inDynamicList] = false\n            }\n            if (mesh.metadata[inOctreeBlock]) {\n                var block = mesh.metadata[octreeBlock]\n                if (block && block.entries) {\n                    removeUnorderedListItem(block.entries, mesh)\n                    if (block.entries.length === 0) {\n                        delete octBlocksHash[block._noaMapKey]\n                        removeUnorderedListItem(octree.blocks, block)\n                    }\n                }\n                mesh.metadata[octreeBlock] = null\n                mesh.metadata[inOctreeBlock] = false\n            }\n        }\n\n\n\n        // experimental helper\n        this.setMeshVisibility = (mesh, visible = false) => {\n            if (mesh.metadata[octreeBlock]) {\n                // mesh is static\n                if (mesh.metadata[inOctreeBlock] === visible) return\n                var block = mesh.metadata[octreeBlock]\n                if (block && block.entries) {\n                    if (visible) {\n                        block.entries.push(mesh)\n                    } else {\n                        removeUnorderedListItem(block.entries, mesh)\n                    }\n                }\n                mesh.metadata[inOctreeBlock] = visible\n            } else {\n                // mesh is dynamic\n                if (mesh.metadata[inDynamicList] === visible) return\n                if (visible) {\n                    octree.dynamicContent.push(mesh)\n                } else {\n                    removeUnorderedListItem(octree.dynamicContent, mesh)\n                }\n                mesh.metadata[inDynamicList] = visible\n            }\n        }\n\n        /*\n         * \n         *          internals\n         * \n        */\n\n        var NOP = () => { }\n        var bs = blockSize * rendering.noa.world._chunkSize\n\n        var recurseRebaseBlocks = (parent, offset) => {\n            parent.blocks.forEach(child => {\n                child.minPoint.subtractInPlace(offset)\n                child.maxPoint.subtractInPlace(offset)\n                child._boundingVectors.forEach(v => v.subtractInPlace(offset))\n                if (child.blocks) recurseRebaseBlocks(child, offset)\n            })\n        }\n\n        var makeOctreeBlock = (minPt, size) => {\n            var min = new Vector3(minPt[0], minPt[1], minPt[2])\n            var max = new Vector3(minPt[0] + size, minPt[1] + size, minPt[2] + size)\n            return new OctreeBlock(min, max, undefined, undefined, undefined, NOP)\n        }\n\n    }\n\n}\n","\nimport glvec3 from 'gl-vec3'\nimport { makeProfileHook } from './util'\n\nimport { SceneOctreeManager } from './sceneOctreeManager'\n\nimport { Scene, ScenePerformancePriority } from '@babylonjs/core/scene'\nimport { FreeCamera } from '@babylonjs/core/Cameras/freeCamera'\nimport { Engine } from '@babylonjs/core/Engines/engine'\nimport { DirectionalLight } from '@babylonjs/core/Lights/directionalLight'\nimport { StandardMaterial } from '@babylonjs/core/Materials/standardMaterial'\nimport { Color3, Color4 } from '@babylonjs/core/Maths/math.color'\nimport { Vector3 } from '@babylonjs/core/Maths/math.vector'\nimport { TransformNode } from '@babylonjs/core/Meshes/transformNode'\nimport { CreateLines } from '@babylonjs/core/Meshes/Builders/linesBuilder'\nimport { CreatePlane } from '@babylonjs/core/Meshes/Builders/planeBuilder'\n\n\n\n\n// profiling flag\nvar PROFILE = 0\n\n\n\nvar defaults = {\n    showFPS: false,\n    antiAlias: true,\n    clearColor: [0.8, 0.9, 1],\n    ambientColor: [0.5, 0.5, 0.5],\n    lightDiffuse: [1, 1, 1],\n    lightSpecular: [1, 1, 1],\n    lightVector: [1, -1, 0.5],\n    useAO: true,\n    AOmultipliers: [0.93, 0.8, 0.5],\n    reverseAOmultiplier: 1.0,\n    preserveDrawingBuffer: true,\n    octreeBlockSize: 2,\n    renderOnResize: true,\n}\n\n\n\n/**\n * `noa.rendering` - \n * Manages all rendering, and the BABYLON scene, materials, etc.\n * \n * This module uses the following default options (from the options\n * object passed to the {@link Engine}):\n * ```js\n * {\n *     showFPS: false,\n *     antiAlias: true,\n *     clearColor: [0.8, 0.9, 1],\n *     ambientColor: [0.5, 0.5, 0.5],\n *     lightDiffuse: [1, 1, 1],\n *     lightSpecular: [1, 1, 1],\n *     lightVector: [1, -1, 0.5],\n *     useAO: true,\n *     AOmultipliers: [0.93, 0.8, 0.5],\n *     reverseAOmultiplier: 1.0,\n *     preserveDrawingBuffer: true,\n *     octreeBlockSize: 2,\n *     renderOnResize: true,\n * }\n * ```\n*/\n\nexport class Rendering {\n\n    /** \n     * @internal \n     * @param {import('../index').Engine} noa  \n    */\n    constructor(noa, opts, canvas) {\n        opts = Object.assign({}, defaults, opts)\n        /** @internal */\n        this.noa = noa\n\n        // settings\n        /** Whether to redraw the screen when the game is resized while paused */\n        this.renderOnResize = !!opts.renderOnResize\n\n        // internals\n        /** @internal */\n        this.useAO = !!opts.useAO\n        /** @internal */\n        this.aoVals = opts.AOmultipliers\n        /** @internal */\n        this.revAoVal = opts.reverseAOmultiplier\n        /** @internal */\n        this.meshingCutoffTime = 6 // ms\n\n        /** the Babylon.js Engine object for the scene */\n        this.engine = null\n        /** the Babylon.js Scene object for the world */\n        this.scene = null\n        /** a Babylon.js DirectionalLight that is added to the scene */\n        this.light = null\n        /** the Babylon.js FreeCamera that renders the scene */\n        this.camera = null\n\n        // sets up babylon scene, lights, etc\n        this._initScene(canvas, opts)\n\n        // for debugging\n        if (opts.showFPS) setUpFPS()\n    }\n\n\n\n\n    /**\n     * Constructor helper - set up the Babylon.js scene and basic components\n     * @internal\n     */\n    _initScene(canvas, opts) {\n\n        // init internal properties\n        this.engine = new Engine(canvas, opts.antiAlias, {\n            preserveDrawingBuffer: opts.preserveDrawingBuffer,\n        })\n        var scene = new Scene(this.engine)\n        this.scene = scene\n        // remove built-in listeners\n        scene.detachControl()\n\n        // this disables a few babylon features that noa doesn't use\n        scene.performancePriority = ScenePerformancePriority.Intermediate\n        scene.autoClear = true\n\n        // octree manager class\n        var blockSize = Math.round(opts.octreeBlockSize)\n        /** @internal */\n        this._octreeManager = new SceneOctreeManager(this, blockSize)\n\n        // camera, and a node to hold it and accumulate rotations\n        /** @internal */\n        this._cameraHolder = new TransformNode('camHolder', scene)\n        this.camera = new FreeCamera('camera', new Vector3(0, 0, 0), scene)\n        this.camera.parent = this._cameraHolder\n        this.camera.minZ = .01\n\n        // plane obscuring the camera - for overlaying an effect on the whole view\n        /** @internal */\n        this._camScreen = CreatePlane('camScreen', { size: 10 }, scene)\n        this.addMeshToScene(this._camScreen)\n        this._camScreen.position.z = .1\n        this._camScreen.parent = this.camera\n        /** @internal */\n        this._camScreenMat = this.makeStandardMaterial('camera_screen_mat')\n        this._camScreen.material = this._camScreenMat\n        this._camScreen.setEnabled(false)\n        this._camScreenMat.freeze()\n        /** @internal */\n        this._camLocBlock = 0\n\n        // apply some defaults\n        scene.clearColor = Color4.FromArray(opts.clearColor)\n        scene.ambientColor = Color3.FromArray(opts.ambientColor)\n\n        var lightVec = Vector3.FromArray(opts.lightVector)\n        this.light = new DirectionalLight('light', lightVec, scene)\n        this.light.diffuse = Color3.FromArray(opts.lightDiffuse)\n        this.light.specular = Color3.FromArray(opts.lightSpecular)\n\n        // scene options\n        scene.skipPointerMovePicking = true\n    }\n}\n\n\n\n/*\n *   PUBLIC API \n */\n\n\n/** The Babylon `scene` object representing the game world. */\nRendering.prototype.getScene = function () {\n    return this.scene\n}\n\n// per-tick listener for rendering-related stuff\n/** @internal */\nRendering.prototype.tick = function (dt) {\n    // nothing here at the moment\n}\n\n\n\n\n/** @internal */\nRendering.prototype.render = function () {\n    profile_hook('start')\n    updateCameraForRender(this)\n    profile_hook('updateCamera')\n    this.engine.beginFrame()\n    profile_hook('beginFrame')\n    this.scene.render()\n    profile_hook('render')\n    fps_hook()\n    this.engine.endFrame()\n    profile_hook('endFrame')\n    profile_hook('end')\n}\n\n\n/** @internal */\nRendering.prototype.postRender = function () {\n    // nothing currently\n}\n\n\n/** @internal */\nRendering.prototype.resize = function () {\n    this.engine.resize()\n    if (this.noa._paused && this.renderOnResize) {\n        this.scene.render()\n    }\n}\n\n\n/** @internal */\nRendering.prototype.highlightBlockFace = function (show, posArr, normArr) {\n    var m = getHighlightMesh(this)\n    if (show) {\n        // floored local coords for highlight mesh\n        this.noa.globalToLocal(posArr, null, hlpos)\n        // offset to avoid z-fighting, bigger when camera is far away\n        var dist = glvec3.dist(this.noa.camera._localGetPosition(), hlpos)\n        var slop = 0.001 + 0.001 * dist\n        for (var i = 0; i < 3; i++) {\n            if (normArr[i] === 0) {\n                hlpos[i] += 0.5\n            } else {\n                hlpos[i] += (normArr[i] > 0) ? 1 + slop : -slop\n            }\n        }\n        m.position.copyFromFloats(hlpos[0], hlpos[1], hlpos[2])\n        m.rotation.x = (normArr[1]) ? Math.PI / 2 : 0\n        m.rotation.y = (normArr[0]) ? Math.PI / 2 : 0\n    }\n    m.setEnabled(show)\n}\nvar hlpos = []\n\n\n\n\n/**\n * Adds a mesh to the engine's selection/octree logic so that it renders.\n * \n * @param mesh the mesh to add to the scene\n * @param isStatic pass in true if mesh never moves (i.e. never changes chunks)\n * @param pos (optional) global position where the mesh should be\n * @param containingChunk (optional) chunk to which the mesh is statically bound\n */\nRendering.prototype.addMeshToScene = function (mesh, isStatic = false, pos = null, containingChunk = null) {\n    if (!mesh.metadata) mesh.metadata = {}\n\n    // if mesh is already added, just make sure it's visisble\n    if (mesh.metadata[addedToSceneFlag]) {\n        this._octreeManager.setMeshVisibility(mesh, true)\n        return\n    }\n    mesh.metadata[addedToSceneFlag] = true\n\n    // find local position for mesh and move it there (unless it's parented)\n    if (!mesh.parent) {\n        if (!pos) pos = mesh.position.asArray()\n        var lpos = this.noa.globalToLocal(pos, null, [])\n        mesh.position.fromArray(lpos)\n    }\n\n    // add to the octree, and remove again on disposal\n    this._octreeManager.addMesh(mesh, isStatic, pos, containingChunk)\n    mesh.onDisposeObservable.add(() => {\n        this._octreeManager.removeMesh(mesh)\n        mesh.metadata[addedToSceneFlag] = false\n    })\n}\nvar addedToSceneFlag = 'noa_added_to_scene'\n\n\n\n\n/**\n * Use this to toggle the visibility of a mesh without disposing it or\n * removing it from the scene.\n * \n * @param {import('@babylonjs/core/Meshes').Mesh} mesh\n * @param {boolean} visible\n */\nRendering.prototype.setMeshVisibility = function (mesh, visible = false) {\n    if (!mesh.metadata) mesh.metadata = {}\n    if (mesh.metadata[addedToSceneFlag]) {\n        this._octreeManager.setMeshVisibility(mesh, visible)\n    } else {\n        if (visible) this.addMeshToScene(mesh)\n    }\n}\n\n\n\n\n\n\n\n\n/**\n * Create a default standardMaterial:      \n * flat, nonspecular, fully reflects diffuse and ambient light\n * @returns {StandardMaterial}\n */\nRendering.prototype.makeStandardMaterial = function (name) {\n    var mat = new StandardMaterial(name, this.scene)\n    mat.specularColor.copyFromFloats(0, 0, 0)\n    mat.ambientColor.copyFromFloats(1, 1, 1)\n    mat.diffuseColor.copyFromFloats(1, 1, 1)\n    return mat\n}\n\n\n\n\n\n\n\n/*\n *\n *   INTERNALS\n *\n */\n\n\n\n\n\n/*\n *\n * \n *   ACCESSORS FOR CHUNK ADD/REMOVAL/MESHING\n *\n * \n */\n/** @internal */\nRendering.prototype.prepareChunkForRendering = function (chunk) {\n    // currently no logic needed here, but I may need it again...\n}\n\n/** @internal */\nRendering.prototype.disposeChunkForRendering = function (chunk) {\n    // nothing currently\n}\n\n\n\n\n\n\n// change world origin offset, and rebase everything with a position\n/** @internal */\nRendering.prototype._rebaseOrigin = function (delta) {\n    var dvec = new Vector3(delta[0], delta[1], delta[2])\n\n    this.scene.meshes.forEach(mesh => {\n        // parented meshes don't live in the world coord system\n        if (mesh.parent) return\n\n        // move each mesh by delta (even though most are managed by components)\n        mesh.position.subtractInPlace(dvec)\n\n        if (mesh.isWorldMatrixFrozen) {\n            // paradoxically this unfreezes, then re-freezes the matrix\n            mesh.freezeWorldMatrix()\n        }\n    })\n\n    // updates position of all octree blocks\n    this._octreeManager.rebase(dvec)\n}\n\n\n\n\n\n// updates camera position/rotation to match settings from noa.camera\n\nfunction updateCameraForRender(self) {\n    var cam = self.noa.camera\n    var tgtLoc = cam._localGetTargetPosition()\n    self._cameraHolder.position.copyFromFloats(tgtLoc[0], tgtLoc[1], tgtLoc[2])\n    self._cameraHolder.rotation.x = cam.pitch\n    self._cameraHolder.rotation.y = cam.heading\n    self.camera.position.z = -cam.currentZoom\n\n    // applies screen effect when camera is inside a transparent voxel\n    var cloc = cam._localGetPosition()\n    var off = self.noa.worldOriginOffset\n    var cx = Math.floor(cloc[0] + off[0])\n    var cy = Math.floor(cloc[1] + off[1])\n    var cz = Math.floor(cloc[2] + off[2])\n    var id = self.noa.getBlock(cx, cy, cz)\n    checkCameraEffect(self, id)\n}\n\n\n\n//  If camera's current location block id has alpha color (e.g. water), apply/remove an effect\n\nfunction checkCameraEffect(self, id) {\n    if (id === self._camLocBlock) return\n    if (id === 0) {\n        self._camScreen.setEnabled(false)\n    } else {\n        var matId = self.noa.registry.getBlockFaceMaterial(id, 0)\n        if (matId) {\n            var matData = self.noa.registry.getMaterialData(matId)\n            var col = matData.color\n            var alpha = matData.alpha\n            if (col && alpha && alpha < 1) {\n                self._camScreenMat.diffuseColor.set(0, 0, 0)\n                self._camScreenMat.ambientColor.set(col[0], col[1], col[2])\n                self._camScreenMat.alpha = alpha\n                self._camScreen.setEnabled(true)\n            }\n        }\n    }\n    self._camLocBlock = id\n}\n\n\n\n\n\n\n// make or get a mesh for highlighting active voxel\nfunction getHighlightMesh(rendering) {\n    var mesh = rendering._highlightMesh\n    if (!mesh) {\n        mesh = CreatePlane(\"highlight\", { size: 1.0 }, rendering.scene)\n        var hlm = rendering.makeStandardMaterial('block_highlight_mat')\n        hlm.backFaceCulling = false\n        hlm.emissiveColor = new Color3(1, 1, 1)\n        hlm.alpha = 0.2\n        hlm.freeze()\n        mesh.material = hlm\n\n        // outline\n        var s = 0.5\n        var lines = CreateLines(\"hightlightLines\", {\n            points: [\n                new Vector3(s, s, 0),\n                new Vector3(s, -s, 0),\n                new Vector3(-s, -s, 0),\n                new Vector3(-s, s, 0),\n                new Vector3(s, s, 0)\n            ]\n        }, rendering.scene)\n        lines.color = new Color3(1, 1, 1)\n        lines.parent = mesh\n\n        rendering.addMeshToScene(mesh)\n        rendering.addMeshToScene(lines)\n        rendering._highlightMesh = mesh\n    }\n    return mesh\n}\n\n\n\n\n\n\n\n\n\n\n/*\n * \n *      sanity checks:\n * \n */\n/** @internal */\nRendering.prototype.debug_SceneCheck = function () {\n    var meshes = this.scene.meshes\n    var octree = this.scene._selectionOctree\n    var dyns = octree.dynamicContent\n    var octs = []\n    var numOcts = 0\n    var numSubs = 0\n    var mats = this.scene.materials\n    var allmats = []\n    mats.forEach(mat => {\n        // @ts-ignore\n        if (mat.subMaterials) mat.subMaterials.forEach(mat => allmats.push(mat))\n        else allmats.push(mat)\n    })\n    octree.blocks.forEach(function (block) {\n        numOcts++\n        block.entries.forEach(m => octs.push(m))\n    })\n    meshes.forEach(function (m) {\n        if (m.isDisposed()) warn(m, 'disposed mesh in scene')\n        if (empty(m)) return\n        if (missing(m, dyns, octs)) warn(m, 'non-empty mesh missing from octree')\n        if (!m.material) { warn(m, 'non-empty scene mesh with no material'); return }\n        numSubs += (m.subMeshes) ? m.subMeshes.length : 1\n        // @ts-ignore\n        var mats = m.material.subMaterials || [m.material]\n        mats.forEach(function (mat) {\n            if (missing(mat, mats)) warn(mat, 'mesh material not in scene')\n        })\n    })\n    var unusedMats = []\n    allmats.forEach(mat => {\n        var used = false\n        meshes.forEach(mesh => {\n            if (mesh.material === mat) used = true\n            if (!mesh.material) return\n            // @ts-ignore\n            var mats = mesh.material.subMaterials || [mesh.material]\n            if (mats.includes(mat)) used = true\n        })\n        if (!used) unusedMats.push(mat.name)\n    })\n    if (unusedMats.length) {\n        console.warn('Materials unused by any mesh: ', unusedMats.join(', '))\n    }\n    dyns.forEach(function (m) {\n        if (missing(m, meshes)) warn(m, 'octree/dynamic mesh not in scene')\n    })\n    octs.forEach(function (m) {\n        if (missing(m, meshes)) warn(m, 'octree block mesh not in scene')\n    })\n    var avgPerOct = Math.round(10 * octs.length / numOcts) / 10\n    console.log('meshes - octree:', octs.length, '  dynamic:', dyns.length,\n        '   subMeshes:', numSubs,\n        '   avg meshes/octreeBlock:', avgPerOct)\n\n    function warn(obj, msg) { console.warn(obj.name + ' --- ' + msg) }\n\n    function empty(mesh) { return (mesh.getIndices().length === 0) }\n\n    function missing(obj, list1, list2) {\n        if (!obj) return false\n        if (list1.includes(obj)) return false\n        if (list2 && list2.includes(obj)) return false\n        return true\n    }\n    return 'done.'\n}\n\n\n/** @internal */\nRendering.prototype.debug_MeshCount = function () {\n    var ct = {}\n    this.scene.meshes.forEach(m => {\n        var n = m.name || ''\n        n = n.replace(/-\\d+.*/, '#')\n        n = n.replace(/\\d+.*/, '#')\n        n = n.replace(/(rotHolder|camHolder|camScreen)/, 'rendering use')\n        n = n.replace(/atlas sprite .*/, 'atlas sprites')\n        ct[n] = ct[n] || 0\n        ct[n]++\n    })\n    for (var s in ct) console.log('   ' + (ct[s] + '       ').substr(0, 7) + s)\n}\n\n\n\n\n\n\n\nvar profile_hook = (PROFILE) ?\n    makeProfileHook(200, 'render internals') : () => { }\n\n\n\nvar fps_hook = function () { }\n\nfunction setUpFPS() {\n    var div = document.createElement('div')\n    div.id = 'noa_fps'\n    div.style.position = 'absolute'\n    div.style.top = '0'\n    div.style.right = '0'\n    div.style.zIndex = '0'\n    div.style.color = 'white'\n    div.style.backgroundColor = 'rgba(0,0,0,0.5)'\n    div.style.font = '14px monospace'\n    div.style.textAlign = 'center'\n    div.style.minWidth = '2em'\n    div.style.margin = '4px'\n    document.body.appendChild(div)\n    var every = 1000\n    var ct = 0\n    var longest = 0\n    var start = performance.now()\n    var last = start\n    fps_hook = function () {\n        ct++\n        var nt = performance.now()\n        if (nt - last > longest) longest = nt - last\n        last = nt\n        if (nt - start < every) return\n        var fps = Math.round(ct / (nt - start) * 1000)\n        var min = Math.round(1 / longest * 1000)\n        div.innerHTML = fps + '<br>' + min\n        ct = 0\n        longest = 0\n        start = nt\n    }\n}\n","\nimport aabb from 'aabb-3d'\nimport vec3 from 'gl-vec3'\n\nvar DEBUG = 0\n\n\n\n/*\n *    RIGID BODY - internal data structure\n *  Only AABB bodies right now. Someday will likely need spheres?\n*/\n\nexport class RigidBody {\n    constructor(_aabb, mass, friction, restitution, gravMult, onCollide, autoStep) {\n        this.aabb = new aabb(_aabb.base, _aabb.vec) // clone\n        this.mass = mass\n        this.friction = friction\n        this.restitution = restitution\n        this.gravityMultiplier = gravMult\n        this.onCollide = onCollide\n        this.autoStep = !!autoStep\n        this.airDrag = -1   // overrides global airDrag when >= 0\n        this.fluidDrag = -1 // overrides global fluidDrag when >= 0\n        this.onStep = null\n\n        // internal state\n        this.velocity = vec3.create()\n        this.resting = [0, 0, 0]\n        this.inFluid = false\n\n        // internals\n        /** @internal */\n        this._ratioInFluid = 0\n        /** @internal */\n        this._forces = vec3.create()\n        /** @internal */\n        this._impulses = vec3.create()\n        /** @internal */\n        this._sleepFrameCount = 10 | 0\n    }\n\n    setPosition(p) {\n        sanityCheck(p)\n        vec3.subtract(p, p, this.aabb.base)\n        this.aabb.translate(p)\n        this._markActive()\n    }\n    getPosition() {\n        return vec3.clone(this.aabb.base)\n    }\n    applyForce(f) {\n        sanityCheck(f)\n        vec3.add(this._forces, this._forces, f)\n        this._markActive()\n    }\n    applyImpulse(i) {\n        sanityCheck(i)\n        vec3.add(this._impulses, this._impulses, i)\n        this._markActive()\n    }\n\n    /** @internal */\n    _markActive() {\n        this._sleepFrameCount = 10 | 0\n    }\n\n\n\n    // temp\n    atRestX() { return this.resting[0] }\n    atRestY() { return this.resting[1] }\n    atRestZ() { return this.resting[2] }\n}\n\n\n\n\nvar sanityCheck = (v) => { }\nif (DEBUG) sanityCheck = (v) => {\n    if (isNaN(vec3.length(v))) throw 'Vector with NAN: ' + v\n}\n","\nimport aabb from 'aabb-3d'\nimport vec3 from 'gl-vec3'\nimport sweep from 'voxel-aabb-sweep'\n\nimport { RigidBody } from './rigidBody'\nexport { RigidBody }\n\n\nvar DEBUG = 0\n\n\nexport function DefaultOptions() {\n    this.airDrag = 0.1\n    this.fluidDrag = 0.4\n    this.fluidDensity = 2.0\n    this.gravity = [0, -10, 0]\n    this.minBounceImpulse = .5 // lowest collision impulse that bounces\n}\n\n\n\n\n/**\n *          Voxel Physics Engine\n * \n * Models a world of rigid bodies, to be integrated against\n * solid or liquid voxel terrain.\n * \n * Takes `testSolid(x,y,z)` function to query block solidity\n * Takes `testFluid(x,y,z)` function to query if a block is a fluid\n *  \n * The `options` argument can take the following params:\n * \n * ```js\n * {\n *     airDrag: 0.1,\n *     fluidDrag: 0.4,\n *     fluidDensity: 2.0,\n *     gravity: [0, -10, 0],\n *     minBounceImpulse: .5, // lowest collision impulse that bounces\n * }\n * ```\n * \n * @param {(x:number, y:number, z:number) => boolean} testSolid\n * @param {(x:number, y:number, z:number) => boolean} testFluid\n * \n*/\nexport function Physics(opts, testSolid, testFluid) {\n    opts = Object.assign(new DefaultOptions(), opts)\n\n    this.gravity = opts.gravity || [0, -10, 0]\n    this.airDrag = opts.airDrag || 0.1\n    this.fluidDensity = opts.fluidDensity || 2.0\n    this.fluidDrag = opts.fluidDrag || 0.4\n    this.minBounceImpulse = opts.minBounceImpulse\n    this.bodies = []\n\n    // collision function - TODO: abstract this into a setter?\n    this.testSolid = testSolid\n    this.testFluid = testFluid\n}\n\n\n/** \n * Adds a physics body to the simulation\n * @returns {RigidBody}\n*/\nPhysics.prototype.addBody = function (_aabb, mass, friction,\n    restitution, gravMult, onCollide) {\n    _aabb = _aabb || new aabb([0, 0, 0], [1, 1, 1])\n    if (typeof mass == 'undefined') mass = 1\n    if (typeof friction == 'undefined') friction = 1\n    if (typeof restitution == 'undefined') restitution = 0\n    if (typeof gravMult == 'undefined') gravMult = 1\n    var b = new RigidBody(_aabb, mass, friction, restitution, gravMult, onCollide)\n    this.bodies.push(b)\n    return b\n}\n\n/** Removes a body, by direct reference */\nPhysics.prototype.removeBody = function (b) {\n    var i = this.bodies.indexOf(b)\n    if (i < 0) return undefined\n    this.bodies.splice(i, 1)\n    b.aabb = b.onCollide = null\n}\n\n\n\n\n/*\n *    PHYSICS AND COLLISIONS\n*/\n\nvar a = vec3.create()\nvar dv = vec3.create()\nvar dx = vec3.create()\nvar impacts = vec3.create()\nvar oldResting = vec3.create()\n\n\n/* Ticks the simulation forwards in time. */\nPhysics.prototype.tick = function (dt) {\n    // convert dt to seconds\n    dt = dt / 1000\n    var noGravity = equals(0, vec3.squaredLength(this.gravity))\n    this.bodies.forEach(b => iterateBody(this, b, dt, noGravity))\n}\n\n\n\n/*\n *    PER-BODY MAIN PHYSICS ROUTINE\n*/\n\nfunction iterateBody(self, b, dt, noGravity) {\n    vec3.copy(oldResting, b.resting)\n\n    // treat bodies with <= mass as static\n    if (b.mass <= 0) {\n        vec3.set(b.velocity, 0, 0, 0)\n        vec3.set(b._forces, 0, 0, 0)\n        vec3.set(b._impulses, 0, 0, 0)\n        return\n    }\n\n    // skip bodies if static or no velocity/forces/impulses\n    var localNoGrav = noGravity || (b.gravityMultiplier === 0)\n    if (bodyAsleep(self, b, dt, localNoGrav)) return\n    b._sleepFrameCount--\n\n    // check if under water, if so apply buoyancy and drag forces\n    applyFluidForces(self, b)\n\n    // debug hooks\n    sanityCheck(b._forces)\n    sanityCheck(b._impulses)\n    sanityCheck(b.velocity)\n    sanityCheck(b.resting)\n\n    // semi-implicit Euler integration\n\n    // a = f/m + gravity*gravityMultiplier\n    vec3.scale(a, b._forces, 1 / b.mass)\n    vec3.scaleAndAdd(a, a, self.gravity, b.gravityMultiplier)\n\n    // dv = i/m + a*dt\n    // v1 = v0 + dv\n    vec3.scale(dv, b._impulses, 1 / b.mass)\n    vec3.scaleAndAdd(dv, dv, a, dt)\n    vec3.add(b.velocity, b.velocity, dv)\n\n    // apply friction based on change in velocity this frame\n    if (b.friction) {\n        applyFrictionByAxis(0, b, dv)\n        applyFrictionByAxis(1, b, dv)\n        applyFrictionByAxis(2, b, dv)\n    }\n\n    // linear air or fluid friction - effectively v *= drag\n    // body settings override global settings\n    var drag = (b.airDrag >= 0) ? b.airDrag : self.airDrag\n    if (b.inFluid) {\n        drag = (b.fluidDrag >= 0) ? b.fluidDrag : self.fluidDrag\n        drag *= 1 - (1 - b.ratioInFluid) ** 2\n    }\n    var mult = Math.max(1 - drag * dt / b.mass, 0)\n    vec3.scale(b.velocity, b.velocity, mult)\n\n    // x1-x0 = v1*dt\n    vec3.scale(dx, b.velocity, dt)\n\n    // clear forces and impulses for next timestep\n    vec3.set(b._forces, 0, 0, 0)\n    vec3.set(b._impulses, 0, 0, 0)\n\n    // cache old position for use in autostepping\n    if (b.autoStep) {\n        cloneAABB(tmpBox, b.aabb)\n    }\n\n    // sweeps aabb along dx and accounts for collisions\n    processCollisions(self, b.aabb, dx, b.resting)\n\n    // if autostep, and on ground, run collisions again with stepped up aabb\n    if (b.autoStep) {\n        tryAutoStepping(self, b, tmpBox, dx)\n    }\n\n    // Collision impacts. b.resting shows which axes had collisions:\n    for (var i = 0; i < 3; ++i) {\n        impacts[i] = 0\n        if (b.resting[i]) {\n            // count impact only if wasn't collided last frame\n            if (!oldResting[i]) impacts[i] = -b.velocity[i]\n            b.velocity[i] = 0\n        }\n    }\n    var mag = vec3.length(impacts)\n    if (mag > .001) { // epsilon\n        // send collision event - allows client to optionally change\n        // body's restitution depending on what terrain it hit\n        // event argument is impulse J = m * dv\n        vec3.scale(impacts, impacts, b.mass)\n        if (b.onCollide) b.onCollide(impacts)\n\n        // bounce depending on restitution and minBounceImpulse\n        if (b.restitution > 0 && mag > self.minBounceImpulse) {\n            vec3.scale(impacts, impacts, b.restitution)\n            b.applyImpulse(impacts)\n        }\n    }\n\n\n    // sleep check\n    var vsq = vec3.squaredLength(b.velocity)\n    if (vsq > 1e-5) b._markActive()\n}\n\n\n\n\n\n\n\n\n/*\n *    FLUIDS\n*/\n\nfunction applyFluidForces(self, body) {\n    // First pass at handling fluids. Assumes fluids are settled\n    //   thus, only check at corner of body, and only from bottom up\n    var box = body.aabb\n    var cx = Math.floor(box.base[0])\n    var cz = Math.floor(box.base[2])\n    var y0 = Math.floor(box.base[1])\n    var y1 = Math.floor(box.max[1])\n\n    if (!self.testFluid(cx, y0, cz)) {\n        body.inFluid = false\n        body.ratioInFluid = 0\n        return\n    }\n\n    // body is in a fluid - find out how much of body is submerged\n    var submerged = 1\n    var cy = y0 + 1\n    while (cy <= y1 && self.testFluid(cx, cy, cz)) {\n        submerged++\n        cy++\n    }\n    var fluidLevel = y0 + submerged\n    var heightInFluid = fluidLevel - box.base[1]\n    var ratioInFluid = heightInFluid / box.vec[1]\n    if (ratioInFluid > 1) ratioInFluid = 1\n    var vol = box.vec[0] * box.vec[1] * box.vec[2]\n    var displaced = vol * ratioInFluid\n    // bouyant force = -gravity * fluidDensity * volumeDisplaced\n    var f = _fluidVec\n    vec3.scale(f, self.gravity, -self.fluidDensity * displaced)\n    body.applyForce(f)\n\n    body.inFluid = true\n    body.ratioInFluid = ratioInFluid\n}\n\nvar _fluidVec = vec3.create()\n\n\n\n\n\n/*\n *    FRICTION\n*/\n\n\nfunction applyFrictionByAxis(axis, body, dvel) {\n    // friction applies only if moving into a touched surface\n    var restDir = body.resting[axis]\n    var vNormal = dvel[axis]\n    if (restDir === 0) return\n    if (restDir * vNormal <= 0) return\n\n    // current vel lateral to friction axis\n    vec3.copy(lateralVel, body.velocity)\n    lateralVel[axis] = 0\n    var vCurr = vec3.length(lateralVel)\n    if (equals(vCurr, 0)) return\n\n    // treat current change in velocity as the result of a pseudoforce\n    //        Fpseudo = m*dv/dt\n    // Base friction force on normal component of the pseudoforce\n    //        Ff = u * Fnormal\n    //        Ff = u * m * dvnormal / dt\n    // change in velocity due to friction force\n    //        dvF = dt * Ff / m\n    //            = dt * (u * m * dvnormal / dt) / m\n    //            = u * dvnormal\n    var dvMax = Math.abs(body.friction * vNormal)\n\n    // decrease lateral vel by dvMax (or clamp to zero)\n    var scaler = (vCurr > dvMax) ? (vCurr - dvMax) / vCurr : 0\n    body.velocity[(axis + 1) % 3] *= scaler\n    body.velocity[(axis + 2) % 3] *= scaler\n}\nvar lateralVel = vec3.create()\n\n\n\n\n\n\n/*\n *    COLLISION HANDLER\n*/\n\n// sweep aabb along velocity vector and set resting vector\nfunction processCollisions(self, box, velocity, resting) {\n    vec3.set(resting, 0, 0, 0)\n    return sweep(self.testSolid, box, velocity, function (dist, axis, dir, vec) {\n        resting[axis] = dir\n        vec[axis] = 0\n    })\n}\n\n\n\n\n\n/*\n *    AUTO-STEPPING\n*/\n\nvar tmpBox = new aabb([], [])\nvar tmpResting = vec3.create()\nvar targetPos = vec3.create()\nvar upvec = vec3.create()\nvar leftover = vec3.create()\n\nfunction tryAutoStepping(self, b, oldBox, dx) {\n    if (b.resting[1] >= 0 && !b.inFluid) return\n\n    // // direction movement was blocked before trying a step\n    var xBlocked = (b.resting[0] !== 0)\n    var zBlocked = (b.resting[2] !== 0)\n    if (!(xBlocked || zBlocked)) return\n\n    // continue autostepping only if headed sufficiently into obstruction\n    var ratio = Math.abs(dx[0] / dx[2])\n    var cutoff = 4\n    if (!xBlocked && ratio > cutoff) return\n    if (!zBlocked && ratio < 1 / cutoff) return\n\n    // original target position before being obstructed\n    vec3.add(targetPos, oldBox.base, dx)\n\n    // move towards the target until the first X/Z collision\n    var getVoxels = self.testSolid\n    sweep(getVoxels, oldBox, dx, function (dist, axis, dir, vec) {\n        if (axis === 1) vec[axis] = 0\n        else return true\n    })\n\n    var y = b.aabb.base[1]\n    var ydist = Math.floor(y + 1.001) - y\n    vec3.set(upvec, 0, ydist, 0)\n    var collided = false\n    // sweep up, bailing on any obstruction\n    sweep(getVoxels, oldBox, upvec, function (dist, axis, dir, vec) {\n        collided = true\n        return true\n    })\n    if (collided) return // could't move upwards\n\n    // now move in X/Z however far was left over before hitting the obstruction\n    vec3.subtract(leftover, targetPos, oldBox.base)\n    leftover[1] = 0\n    processCollisions(self, oldBox, leftover, tmpResting)\n\n    // bail if no movement happened in the originally blocked direction\n    if (xBlocked && !equals(oldBox.base[0], targetPos[0])) return\n    if (zBlocked && !equals(oldBox.base[2], targetPos[2])) return\n\n    // done - oldBox is now at the target autostepped position\n    cloneAABB(b.aabb, oldBox)\n    b.resting[0] = tmpResting[0]\n    b.resting[2] = tmpResting[2]\n    if (b.onStep) b.onStep()\n}\n\n\n\n\n\n/*\n *    SLEEP CHECK\n*/\n\nfunction bodyAsleep(self, body, dt, noGravity) {\n    if (body._sleepFrameCount > 0) return false\n    // without gravity bodies stay asleep until a force/impulse wakes them up\n    if (noGravity) return true\n    // otherwise check body is resting against something\n    // i.e. sweep along by distance d = 1/2 g*t^2\n    // and check there's still a collision\n    var isResting = false\n    var gmult = 0.5 * dt * dt * body.gravityMultiplier\n    vec3.scale(sleepVec, self.gravity, gmult)\n    sweep(self.testSolid, body.aabb, sleepVec, function () {\n        isResting = true\n        return true\n    }, true)\n    return isResting\n}\nvar sleepVec = vec3.create()\n\n\n\n\n\nfunction equals(a, b) { return Math.abs(a - b) < 1e-5 }\n\nfunction cloneAABB(tgt, src) {\n    for (var i = 0; i < 3; i++) {\n        tgt.base[i] = src.base[i]\n        tgt.max[i] = src.max[i]\n        tgt.vec[i] = src.vec[i]\n    }\n}\n\n\n\nvar sanityCheck = function (v) { }\nif (DEBUG) sanityCheck = function (v) {\n    if (isNaN(vec3.length(v))) throw 'Vector with NAN: ' + v\n}\n","\nimport { Physics as VoxelPhysics } from 'voxel-physics-engine'\n\n\n\n\nvar defaultOptions = {\n    gravity: [0, -10, 0],\n    airDrag: 0.1,\n}\n\n/**\n * `noa.physics` - Wrapper module for the physics engine.\n * \n * This module extends \n * [voxel-physics-engine](https://github.com/fenomas/voxel-physics-engine),\n * so turn on \"Inherited\" to see its APIs here, or view the base module \n * for full docs.\n * \n * This module uses the following default options (from the options\n * object passed to the {@link Engine}):\n * \n * ```js\n * {\n *     gravity: [0, -10, 0],\n *     airDrag: 0.1,\n *     fluidDrag: 0.4,\n *     fluidDensity: 2.0,\n *     minBounceImpulse: .5,      // cutoff for a bounce to occur\n * }\n * ```\n*/\n\nexport class Physics extends VoxelPhysics {\n\n    /** \n     * @internal \n     * @param {import('../index').Engine} noa\n    */\n    constructor(noa, opts) {\n        opts = Object.assign({}, defaultOptions, opts)\n        var world = noa.world\n        var solidLookup = noa.registry._solidityLookup\n        var fluidLookup = noa.registry._fluidityLookup\n\n        // physics engine runs in offset coords, so voxel getters need to match\n        var offset = noa.worldOriginOffset\n\n        var blockGetter = (x, y, z) => {\n            var id = world.getBlockID(x + offset[0], y + offset[1], z + offset[2])\n            return solidLookup[id]\n        }\n        var isFluidGetter = (x, y, z) => {\n            var id = world.getBlockID(x + offset[0], y + offset[1], z + offset[2])\n            return fluidLookup[id]\n        }\n\n        super(opts, blockGetter, isFluidGetter)\n    }\n\n}\n\n\n\n","\nimport { LocationQueue } from './util'\nimport ndarray from 'ndarray'\n\n\n\n\n/* \n * \n *   Chunk\n * \n *  Stores and manages voxel ids and flags for each voxel within chunk\n * \n */\n\n\n\n\n\n/*\n *\n *    Chunk constructor\n *\n */\n\n/** @param {import('../index').Engine} noa */\nexport function Chunk(noa, requestID, ci, cj, ck, size, dataArray, fillVoxelID = -1) {\n    this.noa = noa\n    this.isDisposed = false\n\n    // arbitrary data passed in by client when generating world\n    this.userData = null\n\n    // voxel data and properties\n    this.requestID = requestID     // id sent to game client\n    this.voxels = dataArray\n    this.i = ci\n    this.j = cj\n    this.k = ck\n    this.size = size\n    this.x = ci * size\n    this.y = cj * size\n    this.z = ck * size\n    this.pos = [this.x, this.y, this.z]\n\n    // flags to track if things need re-meshing\n    this._terrainDirty = false\n    this._objectsDirty = false\n\n    // inits state of terrain / object meshing\n    this._terrainMeshes = []\n    noa._terrainMesher.initChunk(this)\n    noa._objectMesher.initChunk(this)\n\n    this._isFull = false\n    this._isEmpty = false\n\n    this._wholeLayerVoxel = Array(size).fill(-1)\n    if (fillVoxelID >= 0) {\n        this.voxels.data.fill(fillVoxelID, 0, this.voxels.size)\n        this._wholeLayerVoxel.fill(fillVoxelID)\n    }\n\n    // references to neighboring chunks, if they exist (filled in by `world`)\n    var narr = Array.from(Array(27), () => null)\n    this._neighbors = ndarray(narr, [3, 3, 3]).lo(1, 1, 1)\n    this._neighbors.set(0, 0, 0, this)\n    this._neighborCount = 0\n    this._timesMeshed = 0\n\n    // location queue of voxels in this chunk with block handlers (assume it's rare)\n    /** @internal */\n    this._blockHandlerLocs = new LocationQueue()\n\n    // passes through voxel contents, calling block handlers etc.\n    scanVoxelData(this)\n}\n\n\n// expose logic internally to create and update the voxel data array\nChunk._createVoxelArray = function (size) {\n    var arr = new Uint16Array(size * size * size)\n    return ndarray(arr, [size, size, size])\n}\n\nChunk.prototype._updateVoxelArray = function (dataArray, fillVoxelID = -1) {\n    // dispose current object blocks\n    callAllBlockHandlers(this, 'onUnload')\n    this.noa._objectMesher.disposeChunk(this)\n    this.noa._terrainMesher.disposeChunk(this)\n    this.voxels = dataArray\n    this._terrainDirty = false\n    this._objectsDirty = false\n    this._blockHandlerLocs.empty()\n    this.noa._objectMesher.initChunk(this)\n    this.noa._terrainMesher.initChunk(this)\n\n    if (fillVoxelID >= 0) {\n        this._wholeLayerVoxel.fill(fillVoxelID)\n    } else {\n        this._wholeLayerVoxel.fill(-1)\n    }\n\n    scanVoxelData(this)\n}\n\n\n\n\n\n\n\n\n/*\n *\n *    Chunk API\n *\n */\n\n// get/set deal with block IDs, so that this class acts like an ndarray\n\nChunk.prototype.get = function (i, j, k) {\n    return this.voxels.get(i, j, k)\n}\n\nChunk.prototype.getSolidityAt = function (i, j, k) {\n    var solidLookup = this.noa.registry._solidityLookup\n    return solidLookup[this.voxels.get(i, j, k)]\n}\n\nChunk.prototype.set = function (i, j, k, newID) {\n    var oldID = this.voxels.get(i, j, k)\n    if (newID === oldID) return\n\n    // update voxel data\n    this.voxels.set(i, j, k, newID)\n\n    // lookup tables from registry, etc\n    var solidLookup = this.noa.registry._solidityLookup\n    var objectLookup = this.noa.registry._objectLookup\n    var opaqueLookup = this.noa.registry._opacityLookup\n    var handlerLookup = this.noa.registry._blockHandlerLookup\n\n    // track invariants about chunk data\n    if (!opaqueLookup[newID]) this._isFull = false\n    if (newID !== 0) this._isEmpty = false\n    if (this._wholeLayerVoxel[j] !== newID) this._wholeLayerVoxel[j] = -1\n\n    // voxel lifecycle handling\n    var hold = handlerLookup[oldID]\n    var hnew = handlerLookup[newID]\n    if (hold) callBlockHandler(this, hold, 'onUnset', i, j, k)\n    if (hnew) {\n        callBlockHandler(this, hnew, 'onSet', i, j, k)\n        this._blockHandlerLocs.add(i, j, k)\n    } else {\n        this._blockHandlerLocs.remove(i, j, k)\n    }\n\n    // track object block states\n    var objMesher = this.noa._objectMesher\n    var objOld = objectLookup[oldID]\n    var objNew = objectLookup[newID]\n    if (objOld) objMesher.setObjectBlock(this, 0, i, j, k)\n    if (objNew) objMesher.setObjectBlock(this, newID, i, j, k)\n\n    // decide dirtiness states\n    var solidityChanged = (solidLookup[oldID] !== solidLookup[newID])\n    var opacityChanged = (opaqueLookup[oldID] !== opaqueLookup[newID])\n    var wasTerrain = !objOld && (oldID !== 0)\n    var nowTerrain = !objNew && (newID !== 0)\n\n    if (objOld || objNew) this._objectsDirty = true\n    if (solidityChanged || opacityChanged || wasTerrain || nowTerrain) {\n        this._terrainDirty = true\n    }\n\n    if (this._terrainDirty || this._objectsDirty) {\n        this.noa.world._queueChunkForRemesh(this)\n    }\n\n    // neighbors only affected if solidity or opacity changed on an edge\n    if (solidityChanged || opacityChanged) {\n        var edge = this.size - 1\n        var imin = (i === 0) ? -1 : 0\n        var jmin = (j === 0) ? -1 : 0\n        var kmin = (k === 0) ? -1 : 0\n        var imax = (i === edge) ? 1 : 0\n        var jmax = (j === edge) ? 1 : 0\n        var kmax = (k === edge) ? 1 : 0\n        for (var ni = imin; ni <= imax; ni++) {\n            for (var nj = jmin; nj <= jmax; nj++) {\n                for (var nk = kmin; nk <= kmax; nk++) {\n                    if ((ni | nj | nk) === 0) continue\n                    var nab = this._neighbors.get(ni, nj, nk)\n                    if (!nab) continue\n                    nab._terrainDirty = true\n                    this.noa.world._queueChunkForRemesh(nab)\n                }\n            }\n        }\n    }\n}\n\n\n\n// helper to call handler of a given type at a particular xyz\nfunction callBlockHandler(chunk, handlers, type, i, j, k) {\n    var handler = handlers[type]\n    if (!handler) return\n    handler(chunk.x + i, chunk.y + j, chunk.z + k)\n}\n\n\n// gets called by World when this chunk has been queued for remeshing\nChunk.prototype.updateMeshes = function () {\n    if (this._terrainDirty) {\n        this.noa._terrainMesher.meshChunk(this)\n        this._timesMeshed++\n        this._terrainDirty = false\n    }\n    if (this._objectsDirty) {\n        this.noa._objectMesher.buildObjectMeshes()\n        this._objectsDirty = false\n    }\n}\n\n\n\n\n\n\n\n\n\n\n\n\n/*\n * \n *      Init\n * \n *  Scans voxel data, processing object blocks and setting chunk flags\n * \n*/\n\nfunction scanVoxelData(chunk) {\n    var voxels = chunk.voxels\n    var data = voxels.data\n    var len = voxels.shape[0]\n    var opaqueLookup = chunk.noa.registry._opacityLookup\n    var handlerLookup = chunk.noa.registry._blockHandlerLookup\n    var objectLookup = chunk.noa.registry._objectLookup\n    var plainLookup = chunk.noa.registry._blockIsPlainLookup\n    var objMesher = chunk.noa._objectMesher\n\n    // flags for tracking if chunk is entirely opaque or transparent\n    var fullyOpaque = true\n    var fullyAir = true\n\n    // scan vertically..\n    for (var j = 0; j < len; ++j) {\n\n        // fastest case where whole layer is air/dirt/etc\n        var layerID = chunk._wholeLayerVoxel[j]\n        if (layerID >= 0 && !objMesher[layerID] && !handlerLookup[layerID]) {\n            if (!opaqueLookup[layerID]) fullyOpaque = false\n            if (layerID !== 0) fullyAir = false\n            continue\n        }\n\n        var constantID = voxels.get(0, j, 0)\n\n        for (var i = 0; i < len; ++i) {\n            var index = voxels.index(i, j, 0)\n            for (var k = 0; k < len; ++k, ++index) {\n                var id = data[index]\n\n                // detect constant layer ID if there is one\n                if (constantID >= 0 && id !== constantID) constantID = -1\n\n                // most common cases: air block...\n                if (id === 0) {\n                    fullyOpaque = false\n                    continue\n                }\n                // ...or plain boring block (no mesh, handlers, etc)\n                if (plainLookup[id]) {\n                    fullyAir = false\n                    continue\n                }\n                // otherwise check opacity, object mesh, and handlers\n                fullyOpaque = fullyOpaque && opaqueLookup[id]\n                fullyAir = false\n                if (objectLookup[id]) {\n                    objMesher.setObjectBlock(chunk, id, i, j, k)\n                    chunk._objectsDirty = true\n                }\n                var handlers = handlerLookup[id]\n                if (handlers) {\n                    chunk._blockHandlerLocs.add(i, j, k)\n                    callBlockHandler(chunk, handlers, 'onLoad', i, j, k)\n                }\n            }\n        }\n\n        if (constantID >= 0) chunk._wholeLayerVoxel[j] = constantID\n    }\n\n    chunk._isFull = fullyOpaque\n    chunk._isEmpty = fullyAir\n    chunk._terrainDirty = !chunk._isEmpty\n}\n\n\n\n\n\n\n\n\n\n\n// dispose function - just clears properties and references\n\nChunk.prototype.dispose = function () {\n    // look through the data for onUnload handlers\n    callAllBlockHandlers(this, 'onUnload')\n    this._blockHandlerLocs.empty()\n\n    // let meshers dispose their stuff\n    this.noa._objectMesher.disposeChunk(this)\n    this.noa._terrainMesher.disposeChunk(this)\n\n    // apparently there's no way to dispose typed arrays, so just null everything\n    this.voxels.data = null\n    this.voxels = null\n    this._neighbors.data = null\n    this._neighbors = null\n\n    this.isDisposed = true\n}\n\n\n\n// helper to call a given handler for all blocks in the chunk\nfunction callAllBlockHandlers(chunk, type) {\n    var voxels = chunk.voxels\n    var handlerLookup = chunk.noa.registry._blockHandlerLookup\n    chunk._blockHandlerLocs.arr.forEach(([i, j, k]) => {\n        var id = voxels.get(i, j, k)\n        callBlockHandler(chunk, handlerLookup[id], type, i, j, k)\n    })\n}\n","\nimport EventEmitter from 'events'\nimport { Chunk } from './chunk'\nimport { LocationQueue, ChunkStorage, locationHasher } from './util'\n\nvar PROFILE_EVERY = 0               // ticks\nvar PROFILE_QUEUES_EVERY = 0        // ticks\n\n\n\n\n\n\nvar defaultOptions = {\n    chunkSize: 24,\n    chunkAddDistance: [2, 2],           // [horizontal, vertical]\n    chunkRemoveDistance: [3, 3],        // [horizontal, vertical]\n    worldGenWhilePaused: false,\n    manuallyControlChunkLoading: false,\n}\n\n/**\n * `noa.world` - manages world data, chunks, voxels.\n * \n * This module uses the following default options (from the options\n * object passed to the {@link Engine}):\n * ```js\n * var defaultOptions = {\n *   chunkSize: 24,\n *   chunkAddDistance: [2, 2],           // [horizontal, vertical]\n *   chunkRemoveDistance: [3, 3],        // [horizontal, vertical]\n *   worldGenWhilePaused: false,\n *   manuallyControlChunkLoading: false,\n * }\n * ```\n * \n * **Events:**\n *  + `worldDataNeeded = (requestID, dataArr, x, y, z, worldName)`  \n *    Alerts client that a new chunk of world data is needed.\n *  + `playerEnteredChunk => (i, j, k)`    \n *    Fires when player enters a new chunk\n *  + `chunkAdded => (chunk)`  \n *    Fires after a new chunk object is added to the world\n *  + `chunkBeingRemoved = (requestID, dataArr, userData)`  \n *    Fires before a chunk is removed from world\n*/\nexport class World extends EventEmitter {\n\n    /** @internal */\n    constructor(noa, opts) {\n        super()\n        opts = Object.assign({}, defaultOptions, opts)\n        /** @internal */\n        this.noa = noa\n\n        /** @internal */\n        this.playerChunkLoaded = false\n\n        /** @internal */\n        this.Chunk = Chunk // expose this class for ...reasons\n\n        /**\n         * Game clients should set this if they need to manually control \n         * which chunks to load and unload. When set, client should call \n         * `noa.world.manuallyLoadChunk` / `manuallyUnloadChunk` as needed.\n         */\n        this.manuallyControlChunkLoading = !!opts.manuallyControlChunkLoading\n\n        /**\n         * Defining this function sets a custom order in which to create chunks.\n         * The function should look like:\n         * ```js\n         *   (i, j, k) => 1 // return a smaller number for chunks to process first\n         * ```\n         */\n        this.chunkSortingDistFn = defaultSortDistance\n\n        /**\n         * Set this higher to cause chunks not to mesh until they have some neighbors.\n         * Max legal value is 26 (each chunk will mesh only when all neighbors are present)\n         */\n        this.minNeighborsToMesh = 6\n\n        /** When true, worldgen queues will keep running if engine is paused. */\n        this.worldGenWhilePaused = !!opts.worldGenWhilePaused\n\n        /** Limit the size of internal chunk processing queues \n         * @type {number} \n        */\n        this.maxChunksPendingCreation = 50\n\n        /** Limit the size of internal chunk processing queues \n         * @type {number} \n        */\n        this.maxChunksPendingMeshing = 50\n\n        /** Cutoff (in ms) of time spent each **tick** \n         * @type {number}\n        */\n        this.maxProcessingPerTick = 5\n\n        /** Cutoff (in ms) of time spent each **render** \n         * @type {number}\n        */\n        this.maxProcessingPerRender = 3\n\n\n        // set up internal state\n\n\n        /** @internal */\n        this._chunkSize = opts.chunkSize\n        /** @internal */\n        this._chunkAddDistance = [2, 2]\n        /** @internal */\n        this._chunkRemoveDistance = [3, 3]\n        /** @internal */\n        this._addDistanceFn = null\n        /** @internal */\n        this._remDistanceFn = null\n        /** @internal */\n        this._prevWorldName = ''\n        /** @internal */\n        this._prevPlayerChunkHash = 0\n        /** @internal */\n        this._chunkAddSearchFrom = 0\n        /** @internal */\n        this._prevSortingFn = null\n        /** @internal */\n        this._sortMeshQueueEvery = 0\n\n\n        // Init internal chunk queues:\n\n        /** @internal All chunks existing in any queue */\n        this._chunksKnown = new LocationQueue()\n\n        /** @internal in range but not yet requested from client */\n        this._chunksToRequest = new LocationQueue()\n        /** @internal known to have invalid data (wrong world, eg) */\n        this._chunksInvalidated = new LocationQueue()\n        /** @internal out of range, and waiting to be removed */\n        this._chunksToRemove = new LocationQueue()\n\n        /** @internal requested, awaiting data event from client */\n        this._chunksPending = new LocationQueue()\n        /** @internal has data, waiting to be (re-)meshed */\n        this._chunksToMesh = new LocationQueue()\n        /** @internal priority queue for chunks to re-mesh */\n        this._chunksToMeshFirst = new LocationQueue()\n\n        /** \n         * @internal A queue of chunk locations, rather than chunk references.\n         * Has only the positive 1/16 quadrant, sorted (reverse order!) */\n        this._chunksSortedLocs = new LocationQueue()\n\n        // validate add/remove sizes through a setter that clients can use later\n        this.setAddRemoveDistance(opts.chunkAddDistance, opts.chunkRemoveDistance)\n\n        // chunks stored in a data structure for quick lookup\n        // note that the hash wraps around every 1024 chunk indexes!!\n        // i.e. two chunks that far apart can't be loaded at the same time\n        /** @internal */\n        this._storage = new ChunkStorage()\n\n        // coordinate converter functions - default versions first:\n        var cs = this._chunkSize\n        /** @internal */\n        this._coordsToChunkIndexes = chunkCoordsToIndexesGeneral\n        /** @internal */\n        this._coordsToChunkLocals = chunkCoordsToLocalsGeneral\n\n        // when chunk size is a power of two, override with bit-twiddling:\n        var powerOfTwo = ((cs & cs - 1) === 0)\n        if (powerOfTwo) {\n            /** @internal */\n            this._coordShiftBits = Math.log2(cs) | 0\n            /** @internal */\n            this._coordMask = (cs - 1) | 0\n            this._coordsToChunkIndexes = chunkCoordsToIndexesPowerOfTwo\n            this._coordsToChunkLocals = chunkCoordsToLocalsPowerOfTwo\n        }\n    }\n}\n\n\n\n\n\n/*\n *\n *\n *\n *\n *                  PUBLIC API \n *\n *\n *\n *\n*/\n\nWorld.prototype.getBlockID = function (x = 0, y = 0, z = 0) {\n    var [ci, cj, ck] = this._coordsToChunkIndexes(x, y, z)\n    var chunk = this._storage.getChunkByIndexes(ci, cj, ck)\n    if (!chunk) return 0\n    var [i, j, k] = this._coordsToChunkLocals(x, y, z)\n    return chunk.voxels.get(i, j, k)\n}\n\nWorld.prototype.getBlockSolidity = function (x = 0, y = 0, z = 0) {\n    var [ci, cj, ck] = this._coordsToChunkIndexes(x, y, z)\n    var chunk = this._storage.getChunkByIndexes(ci, cj, ck)\n    if (!chunk) return false\n    var [i, j, k] = this._coordsToChunkLocals(x, y, z)\n    return !!chunk.getSolidityAt(i, j, k)\n}\n\nWorld.prototype.getBlockOpacity = function (x = 0, y = 0, z = 0) {\n    var id = this.getBlockID(x, y, z)\n    return this.noa.registry.getBlockOpacity(id)\n}\n\nWorld.prototype.getBlockFluidity = function (x = 0, y = 0, z = 0) {\n    var id = this.getBlockID(x, y, z)\n    return this.noa.registry.getBlockFluidity(id)\n}\n\nWorld.prototype.getBlockProperties = function (x = 0, y = 0, z = 0) {\n    var id = this.getBlockID(x, y, z)\n    return this.noa.registry.getBlockProps(id)\n}\n\n\nWorld.prototype.setBlockID = function (id = 0, x = 0, y = 0, z = 0) {\n    var [ci, cj, ck] = this._coordsToChunkIndexes(x, y, z)\n    var chunk = this._storage.getChunkByIndexes(ci, cj, ck)\n    if (!chunk) return\n    var [i, j, k] = this._coordsToChunkLocals(x, y, z)\n    return chunk.set(i, j, k, id)\n}\n\n\n/** @param box */\nWorld.prototype.isBoxUnobstructed = function (box) {\n    var base = box.base\n    var max = box.max\n    for (var i = Math.floor(base[0]); i < max[0] + 1; i++) {\n        for (var j = Math.floor(base[1]); j < max[1] + 1; j++) {\n            for (var k = Math.floor(base[2]); k < max[2] + 1; k++) {\n                if (this.getBlockSolidity(i, j, k)) return false\n            }\n        }\n    }\n    return true\n}\n\n\n/** \n * Clients should call this after creating a chunk's worth of data (as an ndarray)  \n * If userData is passed in it will be attached to the chunk\n * @param {string} id - the string specified when the chunk was requested \n * @param {*} array - an ndarray of voxel data\n * @param {*} userData - an arbitrary value for game client use\n * @param {number} fillVoxelID - specify a voxel ID here if you want to signify that \n * the entire chunk should be solidly filled with that voxel (e.g. `0` for air). \n * If you do this, the voxel array data will be overwritten and the engine will \n * take a fast path through some initialization steps.\n */\nWorld.prototype.setChunkData = function (id, array, userData = null, fillVoxelID = -1) {\n    setChunkData(this, id, array, userData, fillVoxelID)\n}\n\n\n\n/** \n * Sets the distances within which to load new chunks, and beyond which \n * to unload them. Generally you want the remove distance to be somewhat\n * farther, so that moving back and forth across the same chunk border doesn't\n * keep loading/unloading the same distant chunks.\n * \n * Both arguments can be numbers (number of voxels), or arrays like:\n * `[horiz, vert]` specifying different horizontal and vertical distances.\n * @param {number | number[]} addDist\n * @param {number | number[]} remDist\n */\nWorld.prototype.setAddRemoveDistance = function (addDist = 2, remDist = 3) {\n    var addArr = Array.isArray(addDist) ? addDist : [addDist, addDist]\n    var remArr = Array.isArray(remDist) ? remDist : [remDist, remDist]\n    var minGap = 1\n    if (remArr[0] < addArr[0] + minGap) remArr[0] = addArr[0] + minGap\n    if (remArr[1] < addArr[1] + minGap) remArr[1] = addArr[1] + minGap\n    this._chunkAddDistance = addArr\n    this._chunkRemoveDistance = remArr\n    // rebuild chunk distance functions and add search locations\n    this._addDistanceFn = makeDistanceTestFunction(addArr[0], addArr[1])\n    this._remDistanceFn = makeDistanceTestFunction(remArr[0], remArr[1])\n    this._chunksSortedLocs.empty()\n    // this queue holds only 1/16th the search space: i=0..max, j=0..i, k=0..max\n    for (var i = 0; i <= addArr[0]; i++) {\n        for (var k = 0; k <= i; k++) {\n            for (var j = 0; j <= addArr[1]; j++) {\n                if (!this._addDistanceFn(i, j, k)) continue\n                this._chunksSortedLocs.add(i, j, k)\n            }\n        }\n    }\n    // resets state of nearby chunk search\n    this._prevSortingFn = null\n    this._chunkAddSearchFrom = 0\n}\n\n\n\n\n\n\n/** \n * Tells noa to discard voxel data within a given `AABB` (e.g. because \n * the game client received updated data from a server). \n * The engine will mark all affected chunks for removal, and will later emit \n * new `worldDataNeeded` events (if the chunk is still in draw range).\n */\nWorld.prototype.invalidateVoxelsInAABB = function (box) {\n    invalidateChunksInBox(this, box)\n}\n\n\n/** When manually controlling chunk loading, tells the engine that the \n * chunk containing the specified (x,y,z) needs to be created and loaded.\n * > Note: throws unless `noa.world.manuallyControlChunkLoading` is set.\n * @param x, y, z\n */\nWorld.prototype.manuallyLoadChunk = function (x = 0, y = 0, z = 0) {\n    if (!this.manuallyControlChunkLoading) throw manualErr\n    var [i, j, k] = this._coordsToChunkIndexes(x, y, z)\n    this._chunksKnown.add(i, j, k)\n    this._chunksToRequest.add(i, j, k)\n}\n\n/** When manually controlling chunk loading, tells the engine that the \n * chunk containing the specified (x,y,z) needs to be unloaded and disposed.\n * > Note: throws unless `noa.world.manuallyControlChunkLoading` is set.\n * @param x, y, z\n */\nWorld.prototype.manuallyUnloadChunk = function (x = 0, y = 0, z = 0) {\n    if (!this.manuallyControlChunkLoading) throw manualErr\n    var [i, j, k] = this._coordsToChunkIndexes(x, y, z)\n    this._chunksToRemove.add(i, j, k)\n    this._chunksToMesh.remove(i, j, k)\n    this._chunksToRequest.remove(i, j, k)\n    this._chunksToMeshFirst.remove(i, j, k)\n}\nvar manualErr = 'Set `noa.world.manuallyControlChunkLoading` if you need this API'\n\n\n\n\n/*\n * \n * \n * \n *                  internals:\n * \n *          tick functions that process queues and trigger events\n * \n * \n * \n*/\n\n/** @internal */\nWorld.prototype.tick = function () {\n    var tickStartTime = performance.now()\n\n    // get indexes of player's current chunk, and has it changed since last tick?\n    var [ci, cj, ck] = getPlayerChunkIndexes(this)\n    var chunkLocHash = locationHasher(ci, cj, ck)\n    var changedChunks = (chunkLocHash !== this._prevPlayerChunkHash)\n    if (changedChunks) {\n        this.emit('playerEnteredChunk', ci, cj, ck)\n        this._prevPlayerChunkHash = chunkLocHash\n        this._chunkAddSearchFrom = 0\n    }\n\n    // if world has changed, invalidate everything and ping\n    // removals queue so that player's chunk gets loaded back quickly\n    if (this._prevWorldName !== this.noa.worldName) {\n        if (!this.manuallyControlChunkLoading) {\n            markAllChunksInvalid(this)\n            this._chunkAddSearchFrom = 0\n            processRemoveQueue(this)\n        }\n        this._prevWorldName = this.noa.worldName\n    }\n\n    profile_hook('start')\n    profile_queues_hook('start')\n\n    // scan for chunks to add/remove (unless client handles manually)\n    if (!this.manuallyControlChunkLoading) {\n        findDistantChunksToRemove(this, ci, cj, ck)\n        profile_hook('remQueue')\n        findChunksToRequest(this, ci, cj, ck)\n        profile_hook('addQueue')\n    }\n\n    // possibly scan for additions to meshing queue if it's empty\n    findChunksToMesh(this)\n\n    // process (create or mesh) some chunks, up to max iteration time\n    var t = performance.now()\n    var t1 = tickStartTime + (this.maxProcessingPerTick || 0)\n    if (t < t1) t1 = t + 1\n    var done1 = false\n    var done2 = false\n    var done3 = false\n    while (t < t1) {\n        if (!done1) {\n            done1 = processRemoveQueue(this)\n                || processRemoveQueue(this)\n            profile_hook('removes')\n        }\n        if (!done2) {\n            done2 = processRequestQueue(this)\n            profile_hook('requests')\n        }\n        if (!done3) {\n            done3 = processMeshingQueue(this, false)\n            profile_hook('meshes')\n        }\n        if (done1 && done2 && done3) break\n        t = performance.now()\n    }\n\n    // track whether the player's local chunk is loaded and ready or not\n    var pChunk = this._storage.getChunkByIndexes(ci, cj, ck)\n    this.playerChunkLoaded = !!pChunk\n\n    profile_queues_hook('end', this)\n    profile_hook('end')\n}\n\n\n/** @internal */\nWorld.prototype.render = function () {\n    // on render, quickly process the high-priority meshing queue\n    // to help avoid flashes of background while neighboring chunks update\n    var t = performance.now()\n    var t1 = t + this.maxProcessingPerRender\n    while (t < t1) {\n        var done = processMeshingQueue(this, true)\n        if (done) break\n        t = performance.now()\n    }\n}\n\n\n/** @internal */\nWorld.prototype._getChunkByCoords = function (x = 0, y = 0, z = 0) {\n    // let internal modules request a chunk object\n    var [i, j, k] = this._coordsToChunkIndexes(x, y, z)\n    return this._storage.getChunkByIndexes(i, j, k)\n}\n\n\n\n\n\n\n\n\n\n\n/*\n * \n * \n * \n *              chunk queues and queue processing\n * \n * \n * \n*/\n\n// internal accessor for chunks to queue themeselves for remeshing \n// after their data changes\nWorld.prototype._queueChunkForRemesh = function (chunk) {\n    possiblyQueueChunkForMeshing(this, chunk)\n}\n\n\n\n/** \n * helper - chunk indexes of where the player is\n * @param {World} world \n*/\nfunction getPlayerChunkIndexes(world) {\n    var [x, y, z] = world.noa.entities.getPosition(world.noa.playerEntity)\n    return world._coordsToChunkIndexes(x, y, z)\n}\n\n\n\n\n/** \n * Gradually scan neighborhood chunk locs; add missing ones to \"toRequest\".\n * @param {World} world \n*/\nfunction findChunksToRequest(world, ci, cj, ck) {\n    var toRequest = world._chunksToRequest\n    var numQueued = toRequest.count()\n    var maxQueued = 50\n    if (numQueued >= maxQueued) return\n\n    // handle changes to chunk sorting function\n    var sortDistFn = world.chunkSortingDistFn || defaultSortDistance\n    if (sortDistFn !== world._prevSortingFn) {\n        sortQueueByDistanceFrom(world, world._chunksSortedLocs, 0, 0, 0, true)\n        world._prevSortingFn = sortDistFn\n    }\n\n    // consume the pre-sorted positions array, checking each loc and \n    // its reflections for locations that need to be added to request queue\n    var locsArr = world._chunksSortedLocs.arr\n    var ix = world._chunkAddSearchFrom\n    var maxIter = Math.min(20, locsArr.length / 10)\n    for (var ct = 0; ct < maxIter; ct++) {\n        var [di, dj, dk] = locsArr[ix++ % locsArr.length]\n        checkReflectedLocations(world, ci, cj, ck, di, dj, dk)\n        if (toRequest.count() >= maxQueued) break\n    }\n\n    // only advance start point if nothing is invalidated, \n    // so that nearyby chunks stay at high priority in that case\n    if (world._chunksInvalidated.isEmpty()) {\n        world._chunkAddSearchFrom = ix % locsArr.length\n    }\n\n    // queue should be mostly sorted, but may not have been empty\n    sortQueueByDistanceFrom(world, toRequest, ci, cj, ck, false)\n}\n\n// Helpers for checking whether to add a location, and reflections of it\nvar checkReflectedLocations = (world, ci, cj, ck, i, j, k) => {\n    checkOneLocation(world, ci + i, cj + j, ck + k)\n    if (i !== k) checkOneLocation(world, ci + k, cj + j, ck + i)\n    if (i > 0) checkReflectedLocations(world, ci, cj, ck, -i, j, k)\n    if (j > 0) checkReflectedLocations(world, ci, cj, ck, i, -j, k)\n    if (k > 0) checkReflectedLocations(world, ci, cj, ck, i, j, -k)\n}\n// finally, the logic for each reflected location checked\nvar checkOneLocation = (world, i, j, k) => {\n    if (world._chunksKnown.includes(i, j, k)) return\n    world._chunksKnown.add(i, j, k)\n    world._chunksToRequest.add(i, j, k, true)\n}\n\n\n\n\n\n/** \n * Incrementally scan known chunks for any that are no longer in range.\n * Assume that the order they're removed in isn't very important.\n * @param {World} world \n*/\nfunction findDistantChunksToRemove(world, ci, cj, ck) {\n    var distCheck = world._remDistanceFn\n    var toRemove = world._chunksToRemove\n    var numQueued = toRemove.count() + world._chunksInvalidated.count()\n    var maxQueued = 50\n    if (numQueued >= maxQueued) return\n\n    var knownArr = world._chunksKnown.arr\n    if (knownArr.length === 0) return\n    var maxIter = Math.min(100, knownArr.length / 10)\n    var found = false\n    for (var ct = 0; ct < maxIter; ct++) {\n        var [i, j, k] = knownArr[removeCheckIndex++ % knownArr.length]\n        if (toRemove.includes(i, j, k)) continue\n        if (distCheck(i - ci, j - cj, k - ck)) continue\n        // flag chunk for removal and remove it from work queues\n        world._chunksToRemove.add(i, j, k)\n        world._chunksToRequest.remove(i, j, k)\n        world._chunksToMesh.remove(i, j, k)\n        world._chunksToMeshFirst.remove(i, j, k)\n        found = true\n        numQueued++\n        if (numQueued > maxQueued) break\n    }\n    removeCheckIndex = removeCheckIndex % knownArr.length\n    if (found) sortQueueByDistanceFrom(world, toRemove, ci, cj, ck)\n}\nvar removeCheckIndex = 0\n\n\n/** \n * Incrementally look for chunks that could be re-meshed\n * @param {World} world \n*/\nfunction findChunksToMesh(world) {\n    var maxQueued = 10\n    var numQueued = world._chunksToMesh.count() + world._chunksToMeshFirst.count()\n    if (numQueued > maxQueued) return\n    var knownArr = world._chunksKnown.arr\n    var maxIter = Math.min(50, knownArr.length / 10)\n    for (var ct = 0; ct < maxIter; ct++) {\n        var [i, j, k] = knownArr[meshCheckIndex++ % knownArr.length]\n        var chunk = world._storage.getChunkByIndexes(i, j, k)\n        if (!chunk) continue\n        var res = possiblyQueueChunkForMeshing(world, chunk)\n        if (res) numQueued++\n        if (numQueued > maxQueued) break\n    }\n    meshCheckIndex %= knownArr.length\n}\nvar meshCheckIndex = 0\n\n\n\n\n\n\n/** \n * invalidate chunks overlapping the given AABB\n * @param {World} world \n*/\nfunction invalidateChunksInBox(world, box) {\n    var min = world._coordsToChunkIndexes(box.base[0], box.base[1], box.base[2])\n    var max = world._coordsToChunkIndexes(box.max[0], box.max[1], box.max[2])\n    for (var i = 0; i < 3; i++) {\n        if (!Number.isFinite(box.base[i])) min[i] = box.base[i]\n        if (!Number.isFinite(box.max[i])) max[i] = box.max[i]\n    }\n    world._chunksKnown.forEach(loc => {\n        var [i, j, k] = loc\n        if (i < min[0] || i >= max[0]) return\n        if (j < min[1] || j >= max[1]) return\n        if (k < min[2] || k >= max[2]) return\n        world._chunksInvalidated.add(i, j, k)\n        world._chunksToRemove.remove(i, j, k)\n        world._chunksToRequest.remove(i, j, k)\n        world._chunksToMesh.remove(i, j, k)\n        world._chunksToMeshFirst.remove(i, j, k)\n    })\n}\n\n\n\n/** \n * when current world changes - empty work queues and mark all for removal\n * @param {World} world \n*/\nfunction markAllChunksInvalid(world) {\n    world._chunksInvalidated.copyFrom(world._chunksKnown)\n    world._chunksToRemove.empty()\n    world._chunksToRequest.empty()\n    world._chunksToMesh.empty()\n    world._chunksToMeshFirst.empty()\n    sortQueueByDistanceFrom(world, world._chunksInvalidated)\n}\n\n\n\n\n\n\n\n\n/** \n * Run through chunk tracking queues looking for work to do next\n * @param {World} world \n*/\nfunction processRequestQueue(world) {\n    var toRequest = world._chunksToRequest\n    if (toRequest.isEmpty()) return true\n    // skip if too many outstanding requests, or if meshing queue is full\n    var pending = world._chunksPending.count()\n    var toMesh = world._chunksToMesh.count()\n    if (pending >= world.maxChunksPendingCreation) return true\n    if (toMesh >= world.maxChunksPendingMeshing) return true\n    var [i, j, k] = toRequest.pop()\n    requestNewChunk(world, i, j, k)\n    return toRequest.isEmpty()\n}\n\n\n/** @param {World} world */\nfunction processRemoveQueue(world) {\n    var queue = world._chunksInvalidated\n    if (queue.isEmpty()) queue = world._chunksToRemove\n    if (queue.isEmpty()) return true\n    var [i, j, k] = queue.pop()\n    removeChunk(world, i, j, k)\n    return (queue.isEmpty())\n}\n\n\n/** \n * similar to above but for chunks waiting to be meshed\n * @param {World} world \n*/\nfunction processMeshingQueue(world, firstOnly) {\n    var queue = world._chunksToMeshFirst\n    if (queue.isEmpty() && !firstOnly) queue = world._chunksToMesh\n    if (queue.isEmpty()) return true\n    var [i, j, k] = queue.pop()\n    if (world._chunksToRemove.includes(i, j, k)) return\n    var chunk = world._storage.getChunkByIndexes(i, j, k)\n    if (chunk) doChunkRemesh(world, chunk)\n}\n\n\n/** @param {World} world */\nfunction possiblyQueueChunkForMeshing(world, chunk) {\n    if (!(chunk._terrainDirty || chunk._objectsDirty)) return false\n    if (chunk._neighborCount < chunk.minNeighborsToMesh) return false\n    if (world._chunksToMesh.includes(chunk.i, chunk.j, chunk.k)) return false\n    if (world._chunksToMeshFirst.includes(chunk.i, chunk.j, chunk.k)) return false\n    var queue = (chunk._neighborCount === 26) ?\n        world._chunksToMeshFirst : world._chunksToMesh\n    queue.add(chunk.i, chunk.j, chunk.k)\n    world._sortMeshQueueEvery++\n    if (world._sortMeshQueueEvery > 20) {\n        sortQueueByDistanceFrom(world, queue)\n        world._sortMeshQueueEvery = 0\n    }\n    return true\n}\n\n\n\n\n\n\n/*\n * \n * \n * \n *              chunk lifecycle - create / set / remove / modify\n * \n * \n * \n*/\n\n\n/** \n * create chunk object and request voxel data from client\n * @param {World} world \n*/\nfunction requestNewChunk(world, i, j, k) {\n    var size = world._chunkSize\n    var dataArr = Chunk._createVoxelArray(world._chunkSize)\n    var worldName = world.noa.worldName\n    var requestID = [i, j, k, worldName].join('|')\n    var x = i * size\n    var y = j * size\n    var z = k * size\n    world._chunksPending.add(i, j, k)\n    world.emit('worldDataNeeded', requestID, dataArr, x, y, z, worldName)\n    profile_queues_hook('request')\n}\n\n/** \n * called when client sets a chunk's voxel data\n * If userData is passed in it will be attached to the chunk\n * @param {World} world \n*/\nfunction setChunkData(world, reqID, array, userData, fillVoxelID) {\n    var arr = reqID.split('|')\n    var i = parseInt(arr.shift())\n    var j = parseInt(arr.shift())\n    var k = parseInt(arr.shift())\n    var worldName = arr.join('|')\n    world._chunksPending.remove(i, j, k)\n    // discard data if it's for a world that's no longer current\n    if (worldName !== world.noa.worldName) return\n    // discard if chunk is no longer needed\n    if (!world._chunksKnown.includes(i, j, k)) return\n    if (world._chunksToRemove.includes(i, j, k)) return\n\n    var chunk = world._storage.getChunkByIndexes(i, j, k)\n    if (!chunk) {\n        // if chunk doesn't exist, create and init\n        var size = world._chunkSize\n        chunk = new Chunk(world.noa, reqID, i, j, k, size, array, fillVoxelID)\n        world._storage.storeChunkByIndexes(i, j, k, chunk)\n        chunk.userData = userData\n        world.noa.rendering.prepareChunkForRendering(chunk)\n        world.emit('chunkAdded', chunk)\n    } else {\n        // else we're updating data for an existing chunk\n        chunk._updateVoxelArray(array, fillVoxelID)\n    }\n    // chunk can now be meshed, and ping neighbors\n    possiblyQueueChunkForMeshing(world, chunk)\n    updateNeighborsOfChunk(world, i, j, k, chunk)\n\n    profile_queues_hook('receive')\n}\n\n\n\n/** \n * remove a chunk that wound up in the remove queue\n * @param {World} world \n*/\nfunction removeChunk(world, i, j, k) {\n    var chunk = world._storage.getChunkByIndexes(i, j, k)\n\n    if (chunk) {\n        world.emit('chunkBeingRemoved', chunk.requestID, chunk.voxels, chunk.userData)\n        world.noa.rendering.disposeChunkForRendering(chunk)\n        chunk.dispose()\n        profile_queues_hook('dispose')\n        updateNeighborsOfChunk(world, i, j, k, null)\n    }\n\n    world._storage.removeChunkByIndexes(i, j, k)\n    world._chunksKnown.remove(i, j, k)\n    world._chunksToMesh.remove(i, j, k)\n    world._chunksToRemove.remove(i, j, k)\n    world._chunksToMeshFirst.remove(i, j, k)\n}\n\n\n/** @param {World} world */\nfunction doChunkRemesh(world, chunk) {\n    world._chunksToMesh.remove(chunk.i, chunk.j, chunk.k)\n    world._chunksToMeshFirst.remove(chunk.i, chunk.j, chunk.k)\n    chunk.updateMeshes()\n    profile_queues_hook('mesh')\n}\n\n\n\n\n\n\n\n\n\n\n/*\n * \n * \n *          two different versions of logic to convert\n *          chunk coords to chunk indexes or local scope\n * \n * \n*/\n\nfunction chunkCoordsToIndexesGeneral(x, y, z) {\n    var cs = this._chunkSize\n    return [Math.floor(x / cs) | 0, Math.floor(y / cs) | 0, Math.floor(z / cs) | 0]\n}\nfunction chunkCoordsToLocalsGeneral(x, y, z) {\n    var cs = this._chunkSize\n    var i = (x % cs) | 0; if (i < 0) i += cs\n    var j = (y % cs) | 0; if (j < 0) j += cs\n    var k = (z % cs) | 0; if (k < 0) k += cs\n    return [i, j, k]\n}\nfunction chunkCoordsToIndexesPowerOfTwo(x, y, z) {\n    var shift = this._coordShiftBits\n    return [(x >> shift) | 0, (y >> shift) | 0, (z >> shift) | 0]\n}\nfunction chunkCoordsToLocalsPowerOfTwo(x, y, z) {\n    var mask = this._coordMask\n    return [(x & mask) | 0, (y & mask) | 0, (z & mask) | 0]\n}\n\n\n\n\n\n\n\n/*\n * \n * \n * \n *          misc helpers and implementation functions\n * \n * \n * \n*/\n\n/** \n * sorts DESCENDING, unless reversed\n * @param {World} world \n*/\nfunction sortQueueByDistanceFrom(world, queue, pi, pj, pk, reverse = false) {\n    var distFn = world.chunkSortingDistFn || defaultSortDistance\n    var localDist = (i, j, k) => distFn(pi - i, pj - j, pk - k)\n    if (pi === undefined) {\n        [pi, pj, pk] = getPlayerChunkIndexes(world)\n    }\n    queue.sortByDistance(localDist, reverse)\n}\nvar defaultSortDistance = (i, j, k) => (i * i) + (j * j) + (k * k)\n\n\n\n\n/** \n * keep neighbor data updated when chunk is added or removed\n * @param {World} world \n*/\nfunction updateNeighborsOfChunk(world, ci, cj, ck, chunk) {\n    var terrainChanged = (!chunk) || (chunk && !chunk.isEmpty)\n    for (var i = -1; i <= 1; i++) {\n        for (var j = -1; j <= 1; j++) {\n            for (var k = -1; k <= 1; k++) {\n                if ((i | j | k) === 0) continue\n                var neighbor = world._storage.getChunkByIndexes(ci + i, cj + j, ck + k)\n                if (!neighbor) continue\n                // flag neighbor, assume terrain needs remeshing\n                if (terrainChanged) neighbor._terrainDirty = true\n                // update neighbor counts and references, both ways\n                if (chunk && !chunk._neighbors.get(i, j, k)) {\n                    chunk._neighborCount++\n                    chunk._neighbors.set(i, j, k, neighbor)\n                }\n                var nabRef = neighbor._neighbors.get(-i, -j, -k)\n                if (chunk && !nabRef) {\n                    neighbor._neighborCount++\n                    neighbor._neighbors.set(-i, -j, -k, chunk)\n                    // immediately queue neighbor if it's surrounded\n                    if (neighbor._neighborCount === 26) {\n                        possiblyQueueChunkForMeshing(world, neighbor)\n                    }\n                }\n                if (!chunk && nabRef) {\n                    neighbor._neighborCount--\n                    neighbor._neighbors.set(-i, -j, -k, null)\n                }\n            }\n        }\n    }\n}\n\n\n// make a function to check if an (i,j,k) is within a sphere/ellipse of given size\nfunction makeDistanceTestFunction(xsize, ysize) {\n    var asq = xsize * xsize\n    var bsq = ysize * ysize\n    // spherical case\n    if (xsize === ysize) return (i, j, k) => (i * i + j * j + k * k <= asq)\n    // otherwise do clipped spheres for now\n    if (xsize > ysize) return (i, j, k) => {\n        if (Math.abs(j) > ysize) return false\n        return (i * i + j * j + k * k <= asq)\n    }\n    return (i, j, k) => {\n        var dxsq = i * i + k * k\n        if (dxsq > asq) return false\n        return (dxsq + j * j <= bsq)\n    }\n}\n\n\n\n\n\n\n\n\n\n\n/*\n * \n * \n * \n * \n *                  debugging\n * \n * \n * \n * \n*/\n\n/** @internal */\nWorld.prototype.report = function () {\n    console.log('World report - playerChunkLoaded: ', this.playerChunkLoaded)\n    _report(this, '  known:     ', this._chunksKnown.arr, true)\n    _report(this, '  to request:', this._chunksToRequest.arr, 0)\n    _report(this, '  to remove: ', this._chunksToRemove.arr, 0)\n    _report(this, '  invalid:   ', this._chunksInvalidated.arr, 0)\n    _report(this, '  creating:  ', this._chunksPending.arr, 0)\n    _report(this, '  to mesh:   ', this._chunksToMesh.arr, 0)\n    _report(this, '  mesh 1st:  ', this._chunksToMeshFirst.arr, 0)\n}\n\nfunction _report(world, name, arr, ext) {\n    var full = 0,\n        empty = 0,\n        exist = 0,\n        surrounded = 0,\n        remeshes = []\n    arr.forEach(loc => {\n        var chunk = world._storage.getChunkByIndexes(loc[0], loc[1], loc[2])\n        if (!chunk) return\n        exist++\n        remeshes.push(chunk._timesMeshed)\n        if (chunk._isFull) full++\n        if (chunk._isEmpty) empty++\n        if (chunk._neighborCount === 26) surrounded++\n    })\n    var out = arr.length.toString().padEnd(8)\n    out += ('exist: ' + exist).padEnd(12)\n    out += ('full: ' + full).padEnd(12)\n    out += ('empty: ' + empty).padEnd(12)\n    out += ('surr: ' + surrounded).padEnd(12)\n    if (ext) {\n        var sum = remeshes.reduce((acc, val) => acc + val, 0)\n        var max = remeshes.reduce((acc, val) => Math.max(acc, val), 0)\n        var min = remeshes.reduce((acc, val) => Math.min(acc, val), 0)\n        out += 'times meshed: avg ' + (sum / exist).toFixed(2)\n        out += '  max ' + max\n        out += '  min ' + min\n    }\n    console.log(name, out)\n}\n\n\nimport { makeProfileHook } from './util'\nvar profile_hook = makeProfileHook(PROFILE_EVERY, 'world ticks:', 1)\nvar profile_queues_hook = ((every) => {\n    if (!(every > 0)) return () => { }\n    var iter = 0\n    var counts = {}\n    var queues = {}\n    var started = performance.now()\n    return function profile_queues_hook(state, world) {\n        if (state === 'start') return\n        if (state !== 'end') return counts[state] = (counts[state] || 0) + 1\n        queues.toreq = (queues.toreq || 0) + world._chunksToRequest.count()\n        queues.toget = (queues.toget || 0) + world._chunksPending.count()\n        queues.tomesh = (queues.tomesh || 0) + world._chunksToMesh.count() + world._chunksToMeshFirst.count()\n        queues.tomesh1 = (queues.tomesh1 || 0) + world._chunksToMeshFirst.count()\n        queues.torem = (queues.torem || 0) + world._chunksToRemove.count()\n        if (++iter < every) return\n        var t = performance.now(), dt = t - started\n        var res = {}\n        Object.keys(queues).forEach(k => {\n            var num = Math.round((queues[k] || 0) / iter)\n            res[k] = `[${num}]`.padStart(5)\n        })\n        Object.keys(counts).forEach(k => {\n            var num = Math.round((counts[k] || 0) * 1000 / dt)\n            res[k] = ('' + num).padStart(3)\n        })\n        console.log('chunk flow: ',\n            `${res.toreq}-> ${res.request || 0} req/s  `,\n            `${res.toget}-> ${res.receive || 0} got/s  `,\n            `${(res.tomesh)}-> ${res.mesh || 0} mesh/s  `,\n            `${res.torem}-> ${res.dispose || 0} rem/s  `,\n            `(meshFirst: ${res.tomesh1.trim()})`,\n        )\n        iter = 0\n        counts = {}\n        queues = {}\n        started = performance.now()\n    }\n})(PROFILE_QUEUES_EVERY)\n","\n/*!\n * noa: an experimental voxel game engine.\n * @url      github.com/fenomas/noa\n * @author   Andy Hall <andy@fenomas.com>\n * @license  MIT\n */\n\nimport './lib/shims'\n\nimport { EventEmitter } from 'events'\nimport vec3 from 'gl-vec3'\nimport ndarray from 'ndarray'\nimport raycast from 'fast-voxel-raycast'\n\nimport { Inputs } from './lib/inputs'\nimport { Container } from './lib/container'\nimport { Camera } from './lib/camera'\nimport { Entities } from './lib/entities'\nimport { ObjectMesher } from './lib/objectMesher'\nimport { TerrainMesher } from './lib/terrainMesher'\nimport { Registry } from './lib/registry'\nimport { Rendering } from './lib/rendering'\nimport { Physics } from './lib/physics'\nimport { World } from './lib/world'\nimport { locationHasher } from './lib/util'\nimport { makeProfileHook } from './lib/util'\n\n\nimport packageJSON from '../package.json'\nvar version = packageJSON.version\n\n\n\n// profile every N ticks/renders\nvar PROFILE = 0\nvar PROFILE_RENDER = 0\n\n\nvar defaultOptions = {\n    debug: false,\n    silent: false,\n    silentBabylon: false,\n    playerHeight: 1.8,\n    playerWidth: 0.6,\n    playerStart: [0, 10, 0],\n    playerAutoStep: false,\n    playerShadowComponent: true,\n    tickRate: 30,           // ticks per second\n    maxRenderRate: 0,       // max FPS, 0 for uncapped \n    blockTestDistance: 10,\n    stickyPointerLock: true,\n    dragCameraOutsidePointerLock: true,\n    stickyFullscreen: false,\n    skipDefaultHighlighting: false,\n    originRebaseDistance: 25,\n}\n\n\n/**\n * Main engine class.  \n * Takes an object full of optional settings as a parameter.\n * \n * ```js\n * import { Engine } from 'noa-engine'\n * var noa = new Engine({\n *    debug: false,\n * })\n * ```\n * \n * Note that the options object is also passed to noa's \n * child modules ({@link Rendering}, {@link Container}, etc).\n * See docs for each module for their options.\n * \n*/\n\nexport class Engine extends EventEmitter {\n\n    /**\n     * The core Engine constructor uses the following options:\n     * \n     * ```js\n     * var defaultOptions = {\n     *    debug: false,\n     *    silent: false,\n     *    playerHeight: 1.8,\n     *    playerWidth: 0.6,\n     *    playerStart: [0, 10, 0],\n     *    playerAutoStep: false,\n     *    playerShadowComponent: true,\n     *    tickRate: 30,           // ticks per second\n     *    maxRenderRate: 0,       // max FPS, 0 for uncapped \n     *    blockTestDistance: 10,\n     *    stickyPointerLock: true,\n     *    dragCameraOutsidePointerLock: true,\n     *    stickyFullscreen: false,\n     *    skipDefaultHighlighting: false,\n     *    originRebaseDistance: 25,\n     * }\n     * ```\n     * \n     * **Events:**\n     *  + `tick => (dt)`  \n     *    Tick update, `dt` is (fixed) tick duration in ms\n     *  + `beforeRender => (dt)`  \n     *    `dt` is the time (in ms) since the most recent tick\n     *  + `afterRender => (dt)`  \n     *    `dt` is the time (in ms) since the most recent tick\n     *  + `targetBlockChanged => (blockInfo)`  \n     *    Emitted each time the user's targeted world block changes\n     *  + `addingTerrainMesh => (mesh)`  \n     *    Alerts client about a terrain mesh being added to the scene\n     *  + `removingTerrainMesh => (mesh)`  \n     *    Alerts client before a terrain mesh is removed.\n    */\n    constructor(opts = {}) {\n        super()\n        opts = Object.assign({}, defaultOptions, opts)\n\n        /** Version string, e.g. `\"0.25.4\"` */\n        this.version = version\n        if (!opts.silent) {\n            var debugstr = (opts.debug) ? ' (debug)' : ''\n            console.log(`noa-engine v${this.version}${debugstr}`)\n        }\n\n        /** @internal */\n        this._paused = false\n\n        /** @internal */\n        this._originRebaseDistance = opts.originRebaseDistance\n\n        // world origin offset, used throughout engine for origin rebasing\n        /** @internal */\n        this.worldOriginOffset = [0, 0, 0]\n\n        // how far engine is into the current tick. Updated each render.\n        /** @internal */\n        this.positionInCurrentTick = 0\n\n        /** \n         * String identifier for the current world. \n         * It's safe to ignore this if your game has only one level/world. \n        */\n        this.worldName = 'default'\n\n        /**\n         * Multiplier for how fast time moves. Setting this to a value other than \n         * `1` will make the game speed up or slow down. This can significantly \n         * affect how core systems behave (particularly physics!).\n        */\n        this.timeScale = 1\n\n        /** Child module for managing the game's container, canvas, etc. */\n        this.container = new Container(this, opts)\n\n        /** The game's tick rate (number of ticks per second) \n         * @type {number}\n         * @readonly \n        */\n        this.tickRate = this.container._shell.tickRate\n        Object.defineProperty(this, 'tickRate', {\n            get: () => this.container._shell.tickRate\n        })\n\n        /** The game's max framerate (use `0` for uncapped)\n         * @type {number}\n         */\n        this.maxRenderRate = this.container._shell.maxRenderRate\n        Object.defineProperty(this, 'maxRenderRate', {\n            get: () => this.container._shell.maxRenderRate,\n            set: (v) => { this.container._shell.maxRenderRate = v || 0 },\n        })\n\n\n        /** Manages key and mouse input bindings */\n        this.inputs = new Inputs(this, opts, this.container.element)\n\n        /** A registry where voxel/material properties are managed */\n        this.registry = new Registry(this, opts)\n\n        /** Manages the world, chunks, and all voxel data */\n        this.world = new World(this, opts)\n\n        var _consoleLog = console.log\n        if (opts.silentBabylon) console.log = () => { }\n\n        /** Rendering manager */\n        this.rendering = new Rendering(this, opts, this.container.canvas)\n\n        if (opts.silentBabylon) console.log = _consoleLog\n\n        /** Physics engine - solves collisions, properties, etc. */\n        this.physics = new Physics(this, opts)\n\n        /** Entity manager / Entity Component System (ECS) */\n        this.entities = new Entities(this, opts)\n\n        /** Alias to `noa.entities` */\n        this.ents = this.entities\n        var ents = this.entities\n\n        /** Entity id for the player entity */\n        this.playerEntity = ents.add(\n            opts.playerStart, // starting location\n            opts.playerWidth, opts.playerHeight,\n            null, null, // no mesh for now, no meshOffset, \n            true, opts.playerShadowComponent,\n        )\n\n        // make player entity it collide with terrain and other entities\n        ents.addComponent(this.playerEntity, ents.names.collideTerrain)\n        ents.addComponent(this.playerEntity, ents.names.collideEntities)\n\n        // adjust default physics parameters\n        var body = ents.getPhysics(this.playerEntity).body\n        body.gravityMultiplier = 2 // less floaty\n        body.autoStep = opts.playerAutoStep // auto step onto blocks\n\n        // input component - sets entity's movement state from key inputs\n        ents.addComponent(this.playerEntity, ents.names.receivesInputs)\n\n        // add a component to make player mesh fade out when zooming in\n        ents.addComponent(this.playerEntity, ents.names.fadeOnZoom)\n\n        // movement component - applies movement forces\n        ents.addComponent(this.playerEntity, ents.names.movement, {\n            airJumps: 1\n        })\n\n        /** Manages the game's camera, view angle, sensitivity, etc. */\n        this.camera = new Camera(this, opts)\n\n        /** How far to check for a solid voxel the player is currently looking at \n         * @type {number}\n        */\n        this.blockTestDistance = opts.blockTestDistance\n\n        /** \n         * Callback to determine which voxels can be targeted. \n         * Defaults to a solidity check, but can be overridden with arbitrary logic.\n         * @type {(blockID: number) => boolean} \n        */\n        this.blockTargetIdCheck = this.registry.getBlockSolidity\n\n        /** \n         * Dynamically updated object describing the currently targeted block.\n         * @type {null | { \n         *      blockID:number,\n         *      position: number[],\n         *      normal: number[],\n         *      adjacent: number[],\n         * }} \n        */\n        this.targetedBlock = null\n\n        // add a default block highlighting function\n        if (!opts.skipDefaultHighlighting) {\n            // the default listener, defined onto noa in case people want to remove it later\n            this.defaultBlockHighlightFunction = (tgt) => {\n                if (tgt) {\n                    this.rendering.highlightBlockFace(true, tgt.position, tgt.normal)\n                } else {\n                    this.rendering.highlightBlockFace(false)\n                }\n            }\n            this.on('targetBlockChanged', this.defaultBlockHighlightFunction)\n        }\n\n\n        /*\n         *\n         *      Various internals...\n         *\n        */\n\n        /** @internal */\n        this._terrainMesher = new TerrainMesher(this)\n\n        /** @internal */\n        this._objectMesher = new ObjectMesher(this)\n\n        /** @internal */\n        this._targetedBlockDat = {\n            blockID: 0,\n            position: vec3.create(),\n            normal: vec3.create(),\n            adjacent: vec3.create(),\n        }\n\n        /** @internal */\n        this._prevTargetHash = 0\n\n\n        /** @internal */\n        this._pickPos = vec3.create()\n\n        /** @internal */\n        this._pickResult = {\n            _localPosition: vec3.create(),\n            position: [0, 0, 0],\n            normal: [0, 0, 0],\n        }\n\n\n\n\n\n        // temp hacks for development\n        if (opts.debug) {\n            // expose often-used classes\n            /** @internal */\n            this.vec3 = vec3\n            /** @internal */\n            this.ndarray = ndarray\n            // gameplay tweaks\n            ents.getMovement(1).airJumps = 999\n            // decorate window while making TS happy\n            var win = /** @type {any} */ (window)\n            win.noa = this\n            win.vec3 = vec3\n            win.ndarray = ndarray\n            win.scene = this.rendering.scene\n        }\n\n        // add hooks to throw helpful errors when using deprecated methods\n        deprecateStuff(this)\n    }\n\n\n\n    /*\n     *\n     *\n     *              Core Engine APIs\n     *\n     *\n    */\n\n    /**\n     * Tick function, called by container module at a fixed timestep. \n     * Clients should not normally need to call this manually.\n     * @internal\n    */\n\n    tick(dt) {\n        dt *= this.timeScale || 1\n\n        // note dt is a fixed value, not an observed delay\n        if (this._paused) {\n            if (this.world.worldGenWhilePaused) this.world.tick()\n            return\n        }\n        profile_hook('start')\n        checkWorldOffset(this)\n        this.world.tick() // chunk creation/removal\n        profile_hook('world')\n        if (!this.world.playerChunkLoaded) {\n            // when waiting on worldgen, just tick the meshing queue and exit\n            this.rendering.tick(dt)\n            return\n        }\n        this.physics.tick(dt) // iterates physics\n        profile_hook('physics')\n        this._objectMesher.tick() // rebuild objects if needed\n        this.rendering.tick(dt) // does deferred chunk meshing\n        profile_hook('rendering')\n        updateBlockTargets(this) // finds targeted blocks, and highlights one if needed\n        profile_hook('targets')\n        this.entities.tick(dt) // runs all entity systems\n        profile_hook('entities')\n        this.emit('tick', dt)\n        profile_hook('tick event')\n        profile_hook('end')\n        // clear accumulated scroll inputs (mouseMove is cleared on render)\n        var pst = this.inputs.pointerState\n        pst.scrollx = pst.scrolly = pst.scrollz = 0\n    }\n\n\n\n\n    /**\n     * Render function, called every animation frame. Emits #beforeRender(dt), #afterRender(dt) \n     * where dt is the time in ms *since the last tick*.\n     * Clients should not normally need to call this manually.\n     * @internal\n    */\n    render(dt, framePart) {\n        dt *= this.timeScale || 1\n\n        // note: framePart is how far we are into the current tick\n        // dt is the *actual* time (ms) since last render, for\n        // animating things that aren't tied to game tick rate\n\n        // frame position - for rendering movement between ticks\n        this.positionInCurrentTick = framePart\n\n        // when paused, just optionally ping worldgen, then exit\n        if (this._paused) {\n            if (this.world.worldGenWhilePaused) this.world.render()\n            return\n        }\n\n        profile_hook_render('start')\n\n        // rotate camera per user inputs - specific rules for this in `camera`\n        this.camera.applyInputsToCamera()\n        profile_hook_render('init')\n\n        // brief run through meshing queue\n        this.world.render()\n        profile_hook_render('meshing')\n\n        // entity render systems\n        this.camera.updateBeforeEntityRenderSystems()\n        this.entities.render(dt)\n        this.camera.updateAfterEntityRenderSystems()\n        profile_hook_render('entities')\n\n        // events and render\n        this.emit('beforeRender', dt)\n        profile_hook_render('before render')\n\n        this.rendering.render()\n        this.rendering.postRender()\n        profile_hook_render('render')\n\n        this.emit('afterRender', dt)\n        profile_hook_render('after render')\n        profile_hook_render('end')\n\n        // clear accumulated mouseMove inputs (scroll inputs cleared on render)\n        this.inputs.pointerState.dx = this.inputs.pointerState.dy = 0\n    }\n\n\n\n\n    /** Pausing the engine will also stop render/tick events, etc. */\n    setPaused(paused = false) {\n        this._paused = !!paused\n        // when unpausing, clear any built-up mouse inputs\n        if (!paused) {\n            this.inputs.pointerState.dx = this.inputs.pointerState.dy = 0\n        }\n    }\n\n    /** \n     * Get the voxel ID at the specified position\n    */\n    getBlock(x, y = 0, z = 0) {\n        if (x.length) return this.world.getBlockID(x[0], x[1], x[2])\n        return this.world.getBlockID(x, y, z)\n    }\n\n    /** \n     * Sets the voxel ID at the specified position. \n     * Does not check whether any entities are in the way! \n     */\n    setBlock(id, x, y = 0, z = 0) {\n        if (x.length) return this.world.setBlockID(id, x[0], x[1], x[2])\n        return this.world.setBlockID(id, x, y, z)\n    }\n\n    /**\n     * Adds a block, unless there's an entity in the way.\n    */\n    addBlock(id, x, y = 0, z = 0) {\n        // add a new terrain block, if nothing blocks the terrain there\n        if (x.length) {\n            if (this.entities.isTerrainBlocked(x[0], x[1], x[2])) return\n            this.world.setBlockID(id, x[0], x[1], x[2])\n            return id\n        } else {\n            if (this.entities.isTerrainBlocked(x, y, z)) return\n            this.world.setBlockID(id, x, y, z)\n            return id\n        }\n    }\n\n\n\n\n\n\n\n    /*\n     *              Rebasing local <-> global coords\n    */\n\n\n    /** \n     * Precisely converts a world position to the current internal \n     * local frame of reference.\n     * \n     * See `/docs/positions.md` for more info.\n     * \n     * Params: \n     *  * `global`: input position in global coords\n     *  * `globalPrecise`: (optional) sub-voxel offset to the global position\n     *  * `local`: output array which will receive the result\n     */\n    globalToLocal(global, globalPrecise, local) {\n        var off = this.worldOriginOffset\n        if (globalPrecise) {\n            for (var i = 0; i < 3; i++) {\n                var coord = global[i] - off[i]\n                coord += globalPrecise[i]\n                local[i] = coord\n            }\n            return local\n        } else {\n            return vec3.subtract(local, global, off)\n        }\n    }\n\n    /** \n     * Precisely converts a world position to the current internal \n     * local frame of reference.\n     * \n     * See `/docs/positions.md` for more info.\n     * \n     * Params: \n     *  * `local`: input array of local coords\n     *  * `global`: output array which receives the result\n     *  * `globalPrecise`: (optional) sub-voxel offset to the output global position\n     * \n     * If both output arrays are passed in, `global` will get int values and \n     * `globalPrecise` will get fractional parts. If only one array is passed in,\n     * `global` will get the whole output position.\n    */\n    localToGlobal(local, global, globalPrecise = null) {\n        var off = this.worldOriginOffset\n        if (globalPrecise) {\n            for (var i = 0; i < 3; i++) {\n                var floored = Math.floor(local[i])\n                global[i] = floored + off[i]\n                globalPrecise[i] = local[i] - floored\n            }\n            return global\n        } else {\n            return vec3.add(global, local, off)\n        }\n    }\n\n\n\n\n    /*\n     *              Picking / raycasting\n    */\n\n    /**\n     * Raycast through the world, returning a result object for any non-air block\n     * \n     * See `/docs/positions.md` for info on working with precise positions.\n     * \n     * @param {number[]} pos where to pick from (default: player's eye pos)\n     * @param {number[]} dir direction to pick along (default: camera vector)\n     * @param {number} dist pick distance (default: `noa.blockTestDistance`)\n     * @param {(id:number) => boolean} blockTestFunction which voxel IDs can be picked (default: any solid voxel)\n    */\n    pick(pos = null, dir = null, dist = -1, blockTestFunction = null) {\n        if (dist === 0) return null\n        // input position to local coords, if any\n        var pickPos = this._pickPos\n        if (pos) {\n            this.globalToLocal(pos, null, pickPos)\n            pos = pickPos\n        }\n        return this._localPick(pos, dir, dist, blockTestFunction)\n    }\n\n\n    /**\n     * @internal\n     * Do a raycast in local coords. \n     * See `/docs/positions.md` for more info.\n     * @param {number[]} pos where to pick from (default: player's eye pos)\n     * @param {number[]} dir direction to pick along (default: camera vector)\n     * @param {number} dist pick distance (default: `noa.blockTestDistance`)\n     * @param {(id:number) => boolean} blockTestFunction which voxel IDs can be picked (default: any solid voxel)\n     * @returns { null | {\n     *      position: number[],\n     *      normal: number[],\n     *      _localPosition: number[],\n     * }}\n     */\n    _localPick(pos = null, dir = null, dist = -1, blockTestFunction = null) {\n        // do a raycast in local coords - result obj will be in global coords\n        if (dist === 0) return null\n        var testFn = blockTestFunction || this.registry.getBlockSolidity\n        var world = this.world\n        var off = this.worldOriginOffset\n        var testVoxel = function (x, y, z) {\n            var id = world.getBlockID(x + off[0], y + off[1], z + off[2])\n            return testFn(id)\n        }\n        if (!pos) pos = this.camera._localGetTargetPosition()\n        dir = dir || this.camera.getDirection()\n        dist = dist || -1\n        if (dist < 0) dist = this.blockTestDistance\n        var result = this._pickResult\n        var rpos = result._localPosition\n        var rnorm = result.normal\n        var hit = raycast(testVoxel, pos, dir, dist, rpos, rnorm)\n        if (!hit) return null\n        // position is right on a voxel border - adjust it so that flooring works reliably\n        // adjust along normal direction, i.e. away from the block struck\n        vec3.scaleAndAdd(rpos, rpos, rnorm, 0.01)\n        // add global result\n        this.localToGlobal(rpos, result.position)\n        return result\n    }\n\n}\n\n\n\n/*\n * \n * \n * \n *                  INTERNAL HELPERS\n * \n * \n * \n * \n*/\n\n\n\n\n/*\n *\n *      rebase world origin offset around the player if necessary\n *\n*/\nfunction checkWorldOffset(noa) {\n    var lpos = noa.ents.getPositionData(noa.playerEntity)._localPosition\n    var cutoff = noa._originRebaseDistance\n    if (vec3.sqrLen(lpos) < cutoff * cutoff) return\n    var delta = []\n    for (var i = 0; i < 3; i++) {\n        delta[i] = Math.floor(lpos[i])\n        noa.worldOriginOffset[i] += delta[i]\n    }\n    noa.rendering._rebaseOrigin(delta)\n    noa.entities._rebaseOrigin(delta)\n    noa._objectMesher._rebaseOrigin(delta)\n}\n\n\n\n\n\n// Each frame, by default pick along the player's view vector \n// and tell rendering to highlight the struck block face\nfunction updateBlockTargets(noa) {\n    var newhash = 0\n    var blockIdFn = noa.blockTargetIdCheck || noa.registry.getBlockSolidity\n    var result = noa._localPick(null, null, null, blockIdFn)\n    if (result) {\n        var dat = noa._targetedBlockDat\n        // pick stops just shy of voxel boundary, so floored pos is the adjacent voxel\n        vec3.floor(dat.adjacent, result.position)\n        vec3.copy(dat.normal, result.normal)\n        vec3.subtract(dat.position, dat.adjacent, dat.normal)\n        dat.blockID = noa.world.getBlockID(dat.position[0], dat.position[1], dat.position[2])\n        noa.targetedBlock = dat\n        // arbitrary hash so we know when the targeted blockID/pos/face changes\n        var pos = dat.position, norm = dat.normal\n        var x = locationHasher(pos[0] + dat.blockID, pos[1], pos[2])\n        x ^= locationHasher(norm[0], norm[1] + dat.blockID, norm[2])\n        newhash = x\n    } else {\n        noa.targetedBlock = null\n    }\n    if (newhash != noa._prevTargetHash) {\n        noa.emit('targetBlockChanged', noa.targetedBlock)\n        noa._prevTargetHash = newhash\n    }\n}\n\n\n\n/*\n * \n *  add some hooks for guidance on removed APIs\n * \n */\n\nfunction deprecateStuff(noa) {\n    var ver = `0.27`\n    var dep = (loc, name, msg) => {\n        var throwFn = () => { throw `This property changed in ${ver} - ${msg}` }\n        Object.defineProperty(loc, name, { get: throwFn, set: throwFn })\n    }\n    dep(noa, 'getPlayerEyePosition', 'to get the camera/player offset see API docs for `noa.camera.cameraTarget`')\n    dep(noa, 'setPlayerEyePosition', 'to set the camera/player offset see API docs for `noa.camera.cameraTarget`')\n    dep(noa, 'getPlayerPosition', 'use `noa.ents.getPosition(noa.playerEntity)` or similar')\n    dep(noa, 'getCameraVector', 'use `noa.camera.getDirection`')\n    dep(noa, 'getPlayerMesh', 'use `noa.ents.getMeshData(noa.playerEntity).mesh` or similar')\n    dep(noa, 'playerBody', 'use `noa.ents.getPhysicsBody(noa.playerEntity)`')\n    dep(noa.rendering, 'zoomDistance', 'use `noa.camera.zoomDistance`')\n    dep(noa.rendering, '_currentZoom', 'use `noa.camera.currentZoom`')\n    dep(noa.rendering, '_cameraZoomSpeed', 'use `noa.camera.zoomSpeed`')\n    dep(noa.rendering, 'getCameraVector', 'use `noa.camera.getDirection`')\n    dep(noa.rendering, 'getCameraPosition', 'use `noa.camera.getLocalPosition`')\n    dep(noa.rendering, 'getCameraRotation', 'use `noa.camera.heading` and `noa.camera.pitch`')\n    dep(noa.rendering, 'setCameraRotation', 'to customize camera behavior see API docs for `noa.camera`')\n    ver = '0.28'\n    dep(noa.rendering, 'makeMeshInstance', 'removed, use Babylon\\'s `mesh.createInstance`')\n    dep(noa.world, '_maxChunksPendingCreation', 'use `maxChunksPendingCreation` (no \"_\")')\n    dep(noa.world, '_maxChunksPendingMeshing', 'use `maxChunksPendingMeshing` (no \"_\")')\n    dep(noa.world, '_maxProcessingPerTick', 'use `maxProcessingPerTick` (no \"_\")')\n    dep(noa.world, '_maxProcessingPerRender', 'use `maxProcessingPerRender` (no \"_\")')\n    ver = '0.29'\n    dep(noa, '_constants', 'removed, voxel IDs are no longer packed with bit flags')\n    ver = '0.30'\n    dep(noa, '_tickRate', 'tickRate is now at `noa.tickRate`')\n    dep(noa.container, '_tickRate', 'tickRate is now at `noa.tickRate`')\n    ver = '0.31'\n    dep(noa.world, 'chunkSize', 'effectively an internal, so changed to `_chunkSize`')\n    dep(noa.world, 'chunkAddDistance', 'set this with `noa.world.setAddRemoveDistance`')\n    dep(noa.world, 'chunkRemoveDistance', 'set this with `noa.world.setAddRemoveDistance`')\n    ver = '0.33'\n    dep(noa.rendering, 'postMaterialCreationHook', 'Removed - use mesh post-creation hook instead`')\n}\n\n\n\nvar profile_hook = (PROFILE > 0) ?\n    makeProfileHook(PROFILE, 'tick   ') : () => { }\nvar profile_hook_render = (PROFILE_RENDER > 0) ?\n    makeProfileHook(PROFILE_RENDER, 'render ') : () => { }\n","import { Engine } from 'noa-engine'\r\nimport { CreateBox } from '@babylonjs/core/Meshes/Builders/boxBuilder'\r\n\r\n// --------------------------\r\n//   noa\r\n// --------------------------\r\nconst opts = {\r\n    debug: true,\r\n    showFPS: true,\r\n    chunkSize: 32,\r\n    chunkAddDistance: 2.5,\r\n    chunkRemoveDistance: 3.5,\r\n}\r\nconst noa = new Engine(opts)\r\n\r\n// --------------------------\r\n//      require.context (Webpack)\r\n// --------------------------\r\nconst context = require.context('../textures/grass', false, /\\.png$/)\r\nconst grassPaths = context.keys().map(context)\r\n\r\n// ,    \r\nif (grassPaths.length === 0) {\r\n    console.error('   PNG-  ../textures/grass/')\r\n} else {\r\n    console.log('   :', grassPaths)\r\n}\r\n\r\n//   \r\nconst grassTexture = grassPaths[Math.floor(Math.random() * grassPaths.length)]\r\nconsole.log('   :', grassTexture)\r\n\r\n// --------------------------\r\n//  \r\n// --------------------------\r\nnoa.registry.registerMaterial('dirt', { color: [0.45, 0.36, 0.22] })\r\nnoa.registry.registerMaterial('grass', { textureURL: grassTexture })\r\nnoa.registry.registerMaterial('stone', { textureURL: './textures/stone1.png' })\r\n\r\n// --------------------------\r\n//  \r\n// --------------------------\r\nconst dirtID = noa.registry.registerBlock(1, { material: 'dirt' })\r\nconst grassID = noa.registry.registerBlock(2, { material: 'grass' })\r\nconst stoneID = noa.registry.registerBlock(3, { material: 'stone' })\r\n\r\n// --------------------------\r\n//  \r\n// --------------------------\r\nfunction getVoxelID(x, y, z) {\r\n    if (y < -3) return stoneID\r\n    if (y < 0) return dirtID\r\n    const height = 2 * Math.sin(x / 10) + 3 * Math.cos(z / 20)\r\n    if (y < height) return grassID\r\n    return 0\r\n}\r\n\r\nnoa.world.on('worldDataNeeded', (id, data, x0, y0, z0) => {\r\n    for (let i = 0; i < data.shape[0]; i++)\r\n        for (let j = 0; j < data.shape[1]; j++)\r\n            for (let k = 0; k < data.shape[2]; k++)\r\n                data.set(i, j, k, getVoxelID(x0 + i, y0 + j, z0 + k))\r\n    noa.world.setChunkData(id, data)\r\n})\r\n\r\n// --------------------------\r\n// \r\n// --------------------------\r\nconst player = noa.playerEntity\r\nconst dat = noa.entities.getPositionData(player)\r\nconst mesh = CreateBox('player-mesh', {}, noa.rendering.getScene())\r\nmesh.scaling.x = dat.width\r\nmesh.scaling.y = dat.height\r\nmesh.scaling.z = dat.width\r\nmesh.material = noa.rendering.makeStandardMaterial()\r\nnoa.entities.addComponent(player, noa.entities.names.mesh, { mesh, offset: [0, dat.height / 2, 0] })\r\n\r\n// --------------------------\r\n// \r\n// --------------------------\r\nnoa.inputs.down.on('fire', () => {\r\n    if (noa.targetedBlock) {\r\n        const pos = noa.targetedBlock.position\r\n        noa.setBlock(0, pos[0], pos[1], pos[2])\r\n    }\r\n})\r\n\r\nnoa.inputs.down.on('alt-fire', () => {\r\n    if (noa.targetedBlock) {\r\n        const pos = noa.targetedBlock.adjacent\r\n        noa.setBlock(grassID, pos[0], pos[1], pos[2])\r\n    }\r\n})\r\n\r\nnoa.inputs.bind('alt-fire', 'KeyE')\r\n\r\n// --------------------------\r\n// Zoom  \r\n// --------------------------\r\nnoa.on('tick', () => {\r\n    const scroll = noa.inputs.pointerState.scrolly\r\n    if (scroll !== 0) {\r\n        noa.camera.zoomDistance += scroll > 0 ? 1 : -1\r\n        if (noa.camera.zoomDistance < 0) noa.camera.zoomDistance = 0\r\n        if (noa.camera.zoomDistance > 10) noa.camera.zoomDistance = 10\r\n    }\r\n})\r\n","module.exports = scaleAndAdd;\n\n/**\n * Adds two vec3's after scaling the second operand by a scalar value\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @param {Number} scale the amount to scale b by before adding\n * @returns {vec3} out\n */\nfunction scaleAndAdd(out, a, b, scale) {\n    out[0] = a[0] + (b[0] * scale)\n    out[1] = a[1] + (b[1] * scale)\n    out[2] = a[2] + (b[2] * scale)\n    return out\n}","module.exports = forEach;\n\nvar vec = require('./create')()\n\n/**\n * Perform some operation over an array of vec3s.\n *\n * @param {Array} a the array of vectors to iterate over\n * @param {Number} stride Number of elements between the start of each vec3. If 0 assumes tightly packed\n * @param {Number} offset Number of elements to skip at the beginning of the array\n * @param {Number} count Number of vec3s to iterate over. If 0 iterates over entire array\n * @param {Function} fn Function to call for each vector in the array\n * @param {Object} [arg] additional argument to pass to fn\n * @returns {Array} a\n * @function\n */\nfunction forEach(a, stride, offset, count, fn, arg) {\n        var i, l\n        if(!stride) {\n            stride = 3\n        }\n\n        if(!offset) {\n            offset = 0\n        }\n        \n        if(count) {\n            l = Math.min((count * stride) + offset, a.length)\n        } else {\n            l = a.length\n        }\n\n        for(i = offset; i < l; i += stride) {\n            vec[0] = a[i] \n            vec[1] = a[i+1] \n            vec[2] = a[i+2]\n            fn(vec, vec, arg)\n            a[i] = vec[0] \n            a[i+1] = vec[1] \n            a[i+2] = vec[2]\n        }\n        \n        return a\n}","'use strict'\n\nmodule.exports = findMedian\n\nvar genPartition = require('./partition')\n\nvar partitionStartLessThan = genPartition('lo<p0', ['p0'])\n\nvar PARTITION_THRESHOLD = 8   //Cut off for using insertion sort in findMedian\n\n//Base case for median finding:  Use insertion sort\nfunction insertionSort(d, axis, start, end, boxes, ids) {\n  var elemSize = 2 * d\n  var boxPtr = elemSize * (start+1) + axis\n  for(var i=start+1; i<end; ++i, boxPtr+=elemSize) {\n    var x = boxes[boxPtr]\n    for(var j=i, ptr=elemSize*(i-1); \n        j>start && boxes[ptr+axis] > x; \n        --j, ptr-=elemSize) {\n      //Swap\n      var aPtr = ptr\n      var bPtr = ptr+elemSize\n      for(var k=0; k<elemSize; ++k, ++aPtr, ++bPtr) {\n        var y = boxes[aPtr]\n        boxes[aPtr] = boxes[bPtr]\n        boxes[bPtr] = y\n      }\n      var tmp = ids[j]\n      ids[j] = ids[j-1]\n      ids[j-1] = tmp\n    }\n  }\n}\n\n//Find median using quick select algorithm\n//  takes O(n) time with high probability\nfunction findMedian(d, axis, start, end, boxes, ids) {\n  if(end <= start+1) {\n    return start\n  }\n\n  var lo       = start\n  var hi       = end\n  var mid      = ((end + start) >>> 1)\n  var elemSize = 2*d\n  var pivot    = mid\n  var value    = boxes[elemSize*mid+axis]\n  \n  while(lo < hi) {\n    if(hi - lo < PARTITION_THRESHOLD) {\n      insertionSort(d, axis, lo, hi, boxes, ids)\n      value = boxes[elemSize*mid+axis]\n      break\n    }\n    \n    //Select pivot using median-of-3\n    var count  = hi - lo\n    var pivot0 = (Math.random()*count+lo)|0\n    var value0 = boxes[elemSize*pivot0 + axis]\n    var pivot1 = (Math.random()*count+lo)|0\n    var value1 = boxes[elemSize*pivot1 + axis]\n    var pivot2 = (Math.random()*count+lo)|0\n    var value2 = boxes[elemSize*pivot2 + axis]\n    if(value0 <= value1) {\n      if(value2 >= value1) {\n        pivot = pivot1\n        value = value1\n      } else if(value0 >= value2) {\n        pivot = pivot0\n        value = value0\n      } else {\n        pivot = pivot2\n        value = value2\n      }\n    } else {\n      if(value1 >= value2) {\n        pivot = pivot1\n        value = value1\n      } else if(value2 >= value0) {\n        pivot = pivot0\n        value = value0\n      } else {\n        pivot = pivot2\n        value = value2\n      }\n    }\n\n    //Swap pivot to end of array\n    var aPtr = elemSize * (hi-1)\n    var bPtr = elemSize * pivot\n    for(var i=0; i<elemSize; ++i, ++aPtr, ++bPtr) {\n      var x = boxes[aPtr]\n      boxes[aPtr] = boxes[bPtr]\n      boxes[bPtr] = x\n    }\n    var y = ids[hi-1]\n    ids[hi-1] = ids[pivot]\n    ids[pivot] = y\n\n    //Partition using pivot\n    pivot = partitionStartLessThan(\n      d, axis, \n      lo, hi-1, boxes, ids,\n      value)\n\n    //Swap pivot back\n    var aPtr = elemSize * (hi-1)\n    var bPtr = elemSize * pivot\n    for(var i=0; i<elemSize; ++i, ++aPtr, ++bPtr) {\n      var x = boxes[aPtr]\n      boxes[aPtr] = boxes[bPtr]\n      boxes[bPtr] = x\n    }\n    var y = ids[hi-1]\n    ids[hi-1] = ids[pivot]\n    ids[pivot] = y\n\n    //Swap pivot to last pivot\n    if(mid < pivot) {\n      hi = pivot-1\n      while(lo < hi && \n        boxes[elemSize*(hi-1)+axis] === value) {\n        hi -= 1\n      }\n      hi += 1\n    } else if(pivot < mid) {\n      lo = pivot + 1\n      while(lo < hi &&\n        boxes[elemSize*lo+axis] === value) {\n        lo += 1\n      }\n    } else {\n      break\n    }\n  }\n\n  //Make sure pivot is at start\n  return partitionStartLessThan(\n    d, axis, \n    start, mid, boxes, ids,\n    boxes[elemSize*mid+axis])\n}","'use strict'\n\n\n// reused array instances\n\nvar tr_arr = []\nvar ldi_arr = []\nvar tri_arr = []\nvar step_arr = []\nvar tDelta_arr = []\nvar tNext_arr = []\nvar vec_arr = []\nvar normed_arr = []\nvar base_arr = []\nvar max_arr = []\nvar left_arr = []\nvar result_arr = []\n\n\n\n// core implementation:\n\nfunction sweep_impl(getVoxel, callback, vec, base, max, epsilon) {\n\n    // consider algo as a raycast along the AABB's leading corner\n    // as raycast enters each new voxel, iterate in 2D over the AABB's \n    // leading face in that axis looking for collisions\n    // \n    // original raycast implementation: https://github.com/andyhall/fast-voxel-raycast\n    // original raycast paper: http://www.cse.chalmers.se/edu/year/2010/course/TDA361/grid.pdf\n\n    var tr = tr_arr\n    var ldi = ldi_arr\n    var tri = tri_arr\n    var step = step_arr\n    var tDelta = tDelta_arr\n    var tNext = tNext_arr\n    var normed = normed_arr\n\n    var floor = Math.floor\n    var cumulative_t = 0.0\n    var t = 0.0\n    var max_t = 0.0\n    var axis = 0\n    var i = 0\n\n\n    // init for the current sweep vector and take first step\n    initSweep()\n    if (max_t === 0) return 0\n\n    axis = stepForward()\n\n    // loop along raycast vector\n    while (t <= max_t) {\n\n        // sweeps over leading face of AABB\n        if (checkCollision(axis)) {\n            // calls the callback and decides whether to continue\n            var done = handleCollision()\n            if (done) return cumulative_t\n        }\n\n        axis = stepForward()\n    }\n\n    // reached the end of the vector unobstructed, finish and exit\n    cumulative_t += max_t\n    for (i = 0; i < 3; i++) {\n        base[i] += vec[i]\n        max[i] += vec[i]\n    }\n    return cumulative_t\n\n\n\n\n\n    // low-level implementations of each step:\n    function initSweep() {\n\n        // parametrization t along raycast\n        t = 0.0\n        max_t = Math.sqrt(vec[0] * vec[0] + vec[1] * vec[1] + vec[2] * vec[2])\n        if (max_t === 0) return\n        for (var i = 0; i < 3; i++) {\n            var dir = (vec[i] >= 0)\n            step[i] = dir ? 1 : -1\n            // trailing / trailing edge coords\n            var lead = dir ? max[i] : base[i]\n            tr[i] = dir ? base[i] : max[i]\n            // int values of lead/trail edges\n            ldi[i] = leadEdgeToInt(lead, step[i])\n            tri[i] = trailEdgeToInt(tr[i], step[i])\n            // normed vector\n            normed[i] = vec[i] / max_t\n            // distance along t required to move one voxel in each axis\n            tDelta[i] = Math.abs(1 / normed[i])\n            // location of nearest voxel boundary, in units of t \n            var dist = dir ? (ldi[i] + 1 - lead) : (lead - ldi[i])\n            tNext[i] = (tDelta[i] < Infinity) ? tDelta[i] * dist : Infinity\n        }\n\n    }\n\n\n    // check for collisions - iterate over the leading face on the advancing axis\n\n    function checkCollision(i_axis) {\n        var stepx = step[0]\n        var x0 = (i_axis === 0) ? ldi[0] : tri[0]\n        var x1 = ldi[0] + stepx\n\n        var stepy = step[1]\n        var y0 = (i_axis === 1) ? ldi[1] : tri[1]\n        var y1 = ldi[1] + stepy\n\n        var stepz = step[2]\n        var z0 = (i_axis === 2) ? ldi[2] : tri[2]\n        var z1 = ldi[2] + stepz\n\n        // var j_axis = (i_axis + 1) % 3\n        // var k_axis = (i_axis + 2) % 3\n        // var s = ['x', 'y', 'z'][i_axis]\n        // var js = ['x', 'y', 'z'][j_axis]\n        // var ks = ['x', 'y', 'z'][k_axis]\n        // var i0 = [x0, y0, z0][i_axis]\n        // var j0 = [x0, y0, z0][j_axis]\n        // var k0 = [x0, y0, z0][k_axis]\n        // var i1 = [x1 - stepx, y1 - stepy, z1 - stepz][i_axis]\n        // var j1 = [x1 - stepx, y1 - stepy, z1 - stepz][j_axis]\n        // var k1 = [x1 - stepx, y1 - stepy, z1 - stepz][k_axis]\n        // console.log('=== step', s, 'to', i0, '   sweep', js, j0 + ',' + j1, '   ', ks, k0 + ',' + k1)\n\n        for (var x = x0; x != x1; x += stepx) {\n            for (var y = y0; y != y1; y += stepy) {\n                for (var z = z0; z != z1; z += stepz) {\n                    if (getVoxel(x, y, z)) return true\n                }\n            }\n        }\n        return false\n    }\n\n\n    // on collision - call the callback and return or set up for the next sweep\n\n    function handleCollision() {\n\n        // set up for callback\n        cumulative_t += t\n        var dir = step[axis]\n\n        // vector moved so far, and left to move\n        var done = t / max_t\n        var left = left_arr\n        for (i = 0; i < 3; i++) {\n            var dv = vec[i] * done\n            base[i] += dv\n            max[i] += dv\n            left[i] = vec[i] - dv\n        }\n\n        // set leading edge of stepped axis exactly to voxel boundary\n        // else we'll sometimes rounding error beyond it\n        if (dir > 0) {\n            max[axis] = Math.round(max[axis])\n        } else {\n            base[axis] = Math.round(base[axis])\n        }\n        \n        // call back to let client update the \"left to go\" vector\n        var res = callback(cumulative_t, axis, dir, left)\n\n        // bail out out on truthy response\n        if (res) return true\n\n        // init for new sweep along vec\n        for (i = 0; i < 3; i++) vec[i] = left[i]\n        initSweep()\n        if (max_t === 0) return true // no vector left\n\n        return false\n    }\n\n\n    // advance to next voxel boundary, and return which axis was stepped\n\n    function stepForward() {\n        var axis = (tNext[0] < tNext[1]) ?\n            ((tNext[0] < tNext[2]) ? 0 : 2) :\n            ((tNext[1] < tNext[2]) ? 1 : 2)\n        var dt = tNext[axis] - t\n        t = tNext[axis]\n        ldi[axis] += step[axis]\n        tNext[axis] += tDelta[axis]\n        for (i = 0; i < 3; i++) {\n            tr[i] += dt * normed[i]\n            tri[i] = trailEdgeToInt(tr[i], step[i])\n        }\n\n        return axis\n    }\n\n\n\n    function leadEdgeToInt(coord, step) {\n        return floor(coord - step * epsilon)\n    }\n    function trailEdgeToInt(coord, step) {\n        return floor(coord + step * epsilon)\n    }\n\n}\n\n\n\n\n\n// conform inputs\n\nfunction sweep(getVoxel, box, dir, callback, noTranslate, epsilon) {\n\n    var vec = vec_arr\n    var base = base_arr\n    var max = max_arr\n    var result = result_arr\n\n    // init parameter float arrays\n    for (var i = 0; i < 3; i++) {\n        vec[i] = +dir[i]\n        max[i] = +box.max[i]\n        base[i] = +box.base[i]\n    }\n\n    if (!epsilon) epsilon = 1e-10\n\n    // run sweep implementation\n    var dist = sweep_impl(getVoxel, callback, vec, base, max, epsilon)\n\n    // translate box by distance needed to updated base value\n    if (!noTranslate) {\n        for (i = 0; i < 3; i++) {\n            result[i] = (dir[i] > 0) ? max[i] - box.max[i] : base[i] - box.base[i]\n        }\n        box.translate(result)\n    }\n\n    // return value is total distance moved (not necessarily magnitude of [end]-[start])\n    return dist\n}\n\nmodule.exports = sweep\n\n","module.exports = negate;\n\n/**\n * Negates the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a vector to negate\n * @returns {vec3} out\n */\nfunction negate(out, a) {\n    out[0] = -a[0]\n    out[1] = -a[1]\n    out[2] = -a[2]\n    return out\n}","/*!\n * Determine if an object is a Buffer\n *\n * @author   Feross Aboukhadijeh <https://feross.org>\n * @license  MIT\n */\n\nmodule.exports = function isBuffer (obj) {\n  return obj != null && obj.constructor != null &&\n    typeof obj.constructor.isBuffer === 'function' && obj.constructor.isBuffer(obj)\n}\n","module.exports = {\n  EPSILON: require('./epsilon')\n  , create: require('./create')\n  , clone: require('./clone')\n  , angle: require('./angle')\n  , fromValues: require('./fromValues')\n  , copy: require('./copy')\n  , set: require('./set')\n  , equals: require('./equals')\n  , exactEquals: require('./exactEquals')\n  , add: require('./add')\n  , subtract: require('./subtract')\n  , sub: require('./sub')\n  , multiply: require('./multiply')\n  , mul: require('./mul')\n  , divide: require('./divide')\n  , div: require('./div')\n  , min: require('./min')\n  , max: require('./max')\n  , floor: require('./floor')\n  , ceil: require('./ceil')\n  , round: require('./round')\n  , scale: require('./scale')\n  , scaleAndAdd: require('./scaleAndAdd')\n  , distance: require('./distance')\n  , dist: require('./dist')\n  , squaredDistance: require('./squaredDistance')\n  , sqrDist: require('./sqrDist')\n  , length: require('./length')\n  , len: require('./len')\n  , squaredLength: require('./squaredLength')\n  , sqrLen: require('./sqrLen')\n  , negate: require('./negate')\n  , inverse: require('./inverse')\n  , normalize: require('./normalize')\n  , dot: require('./dot')\n  , cross: require('./cross')\n  , lerp: require('./lerp')\n  , random: require('./random')\n  , transformMat4: require('./transformMat4')\n  , transformMat3: require('./transformMat3')\n  , transformQuat: require('./transformQuat')\n  , rotateX: require('./rotateX')\n  , rotateY: require('./rotateY')\n  , rotateZ: require('./rotateZ')\n  , forEach: require('./forEach')\n}\n","var map = {\n\t\"./grass_001_score0.0277.png\": 9236,\n\t\"./grass_002_score0.0286.png\": 5775,\n\t\"./grass_003_score0.0261.png\": 1659,\n\t\"./grass_004_score0.0268.png\": 1749,\n\t\"./grass_005_score0.0290.png\": 5189,\n\t\"./grass_006_score0.0297.png\": 9397,\n\t\"./grass_007_score0.0283.png\": 371,\n\t\"./grass_008_score0.0294.png\": 380,\n\t\"./grass_009_score0.0298.png\": 4217,\n\t\"./grass_010_score0.0294.png\": 3795,\n\t\"./grass_011_score0.0267.png\": 9460,\n\t\"./grass_012_score0.0288.png\": 3526,\n\t\"./grass_013_score0.0299.png\": 689,\n\t\"./grass_014_score0.0294.png\": 1095,\n\t\"./grass_015_score0.0295.png\": 1959,\n\t\"./grass_016_score0.0288.png\": 5234,\n\t\"./grass_017_score0.0289.png\": 9958,\n\t\"./grass_018_score0.0281.png\": 8445,\n\t\"./grass_019_score0.0276.png\": 9918\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 5625;","'use strict'\n\nmodule.exports = genPartition\n\nvar code = 'for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m'\n\nfunction genPartition(predicate, args) {\n  var fargs ='abcdef'.split('').concat(args)\n  var reads = []\n  if(predicate.indexOf('lo') >= 0) {\n    reads.push('lo=e[k+n]')\n  }\n  if(predicate.indexOf('hi') >= 0) {\n    reads.push('hi=e[k+o]')\n  }\n  fargs.push(\n    code.replace('_', reads.join())\n        .replace('$', predicate))\n  return Function.apply(void 0, fargs)\n}","module.exports = subtract;\n\n/**\n * Subtracts vector b from vector a\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @returns {vec3} out\n */\nfunction subtract(out, a, b) {\n    out[0] = a[0] - b[0]\n    out[1] = a[1] - b[1]\n    out[2] = a[2] - b[2]\n    return out\n}","module.exports = set;\n\n/**\n * Set the components of a vec3 to the given values\n *\n * @param {vec3} out the receiving vector\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @returns {vec3} out\n */\nfunction set(out, x, y, z) {\n    out[0] = x\n    out[1] = y\n    out[2] = z\n    return out\n}","\"use strict\"\n\nfunction iota(n) {\n  var result = new Array(n)\n  for(var i=0; i<n; ++i) {\n    result[i] = i\n  }\n  return result\n}\n\nmodule.exports = iota","var iota = require(\"iota-array\")\nvar isBuffer = require(\"is-buffer\")\n\nvar hasTypedArrays  = ((typeof Float64Array) !== \"undefined\")\n\nfunction compare1st(a, b) {\n  return a[0] - b[0]\n}\n\nfunction order() {\n  var stride = this.stride\n  var terms = new Array(stride.length)\n  var i\n  for(i=0; i<terms.length; ++i) {\n    terms[i] = [Math.abs(stride[i]), i]\n  }\n  terms.sort(compare1st)\n  var result = new Array(terms.length)\n  for(i=0; i<result.length; ++i) {\n    result[i] = terms[i][1]\n  }\n  return result\n}\n\nfunction compileConstructor(dtype, dimension) {\n  var className = [\"View\", dimension, \"d\", dtype].join(\"\")\n  if(dimension < 0) {\n    className = \"View_Nil\" + dtype\n  }\n  var useGetters = (dtype === \"generic\")\n\n  if(dimension === -1) {\n    //Special case for trivial arrays\n    var code =\n      \"function \"+className+\"(a){this.data=a;};\\\nvar proto=\"+className+\".prototype;\\\nproto.dtype='\"+dtype+\"';\\\nproto.index=function(){return -1};\\\nproto.size=0;\\\nproto.dimension=-1;\\\nproto.shape=proto.stride=proto.order=[];\\\nproto.lo=proto.hi=proto.transpose=proto.step=\\\nfunction(){return new \"+className+\"(this.data);};\\\nproto.get=proto.set=function(){};\\\nproto.pick=function(){return null};\\\nreturn function construct_\"+className+\"(a){return new \"+className+\"(a);}\"\n    var procedure = new Function(code)\n    return procedure()\n  } else if(dimension === 0) {\n    //Special case for 0d arrays\n    var code =\n      \"function \"+className+\"(a,d) {\\\nthis.data = a;\\\nthis.offset = d\\\n};\\\nvar proto=\"+className+\".prototype;\\\nproto.dtype='\"+dtype+\"';\\\nproto.index=function(){return this.offset};\\\nproto.dimension=0;\\\nproto.size=1;\\\nproto.shape=\\\nproto.stride=\\\nproto.order=[];\\\nproto.lo=\\\nproto.hi=\\\nproto.transpose=\\\nproto.step=function \"+className+\"_copy() {\\\nreturn new \"+className+\"(this.data,this.offset)\\\n};\\\nproto.pick=function \"+className+\"_pick(){\\\nreturn TrivialArray(this.data);\\\n};\\\nproto.valueOf=proto.get=function \"+className+\"_get(){\\\nreturn \"+(useGetters ? \"this.data.get(this.offset)\" : \"this.data[this.offset]\")+\n\"};\\\nproto.set=function \"+className+\"_set(v){\\\nreturn \"+(useGetters ? \"this.data.set(this.offset,v)\" : \"this.data[this.offset]=v\")+\"\\\n};\\\nreturn function construct_\"+className+\"(a,b,c,d){return new \"+className+\"(a,d)}\"\n    var procedure = new Function(\"TrivialArray\", code)\n    return procedure(CACHED_CONSTRUCTORS[dtype][0])\n  }\n\n  var code = [\"'use strict'\"]\n\n  //Create constructor for view\n  var indices = iota(dimension)\n  var args = indices.map(function(i) { return \"i\"+i })\n  var index_str = \"this.offset+\" + indices.map(function(i) {\n        return \"this.stride[\" + i + \"]*i\" + i\n      }).join(\"+\")\n  var shapeArg = indices.map(function(i) {\n      return \"b\"+i\n    }).join(\",\")\n  var strideArg = indices.map(function(i) {\n      return \"c\"+i\n    }).join(\",\")\n  code.push(\n    \"function \"+className+\"(a,\" + shapeArg + \",\" + strideArg + \",d){this.data=a\",\n      \"this.shape=[\" + shapeArg + \"]\",\n      \"this.stride=[\" + strideArg + \"]\",\n      \"this.offset=d|0}\",\n    \"var proto=\"+className+\".prototype\",\n    \"proto.dtype='\"+dtype+\"'\",\n    \"proto.dimension=\"+dimension)\n\n  //view.size:\n  code.push(\"Object.defineProperty(proto,'size',{get:function \"+className+\"_size(){\\\nreturn \"+indices.map(function(i) { return \"this.shape[\"+i+\"]\" }).join(\"*\"),\n\"}})\")\n\n  //view.order:\n  if(dimension === 1) {\n    code.push(\"proto.order=[0]\")\n  } else {\n    code.push(\"Object.defineProperty(proto,'order',{get:\")\n    if(dimension < 4) {\n      code.push(\"function \"+className+\"_order(){\")\n      if(dimension === 2) {\n        code.push(\"return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})\")\n      } else if(dimension === 3) {\n        code.push(\n\"var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);\\\nif(s0>s1){\\\nif(s1>s2){\\\nreturn [2,1,0];\\\n}else if(s0>s2){\\\nreturn [1,2,0];\\\n}else{\\\nreturn [1,0,2];\\\n}\\\n}else if(s0>s2){\\\nreturn [2,0,1];\\\n}else if(s2>s1){\\\nreturn [0,1,2];\\\n}else{\\\nreturn [0,2,1];\\\n}}})\")\n      }\n    } else {\n      code.push(\"ORDER})\")\n    }\n  }\n\n  //view.set(i0, ..., v):\n  code.push(\n\"proto.set=function \"+className+\"_set(\"+args.join(\",\")+\",v){\")\n  if(useGetters) {\n    code.push(\"return this.data.set(\"+index_str+\",v)}\")\n  } else {\n    code.push(\"return this.data[\"+index_str+\"]=v}\")\n  }\n\n  //view.get(i0, ...):\n  code.push(\"proto.get=function \"+className+\"_get(\"+args.join(\",\")+\"){\")\n  if(useGetters) {\n    code.push(\"return this.data.get(\"+index_str+\")}\")\n  } else {\n    code.push(\"return this.data[\"+index_str+\"]}\")\n  }\n\n  //view.index:\n  code.push(\n    \"proto.index=function \"+className+\"_index(\", args.join(), \"){return \"+index_str+\"}\")\n\n  //view.hi():\n  code.push(\"proto.hi=function \"+className+\"_hi(\"+args.join(\",\")+\"){return new \"+className+\"(this.data,\"+\n    indices.map(function(i) {\n      return [\"(typeof i\",i,\"!=='number'||i\",i,\"<0)?this.shape[\", i, \"]:i\", i,\"|0\"].join(\"\")\n    }).join(\",\")+\",\"+\n    indices.map(function(i) {\n      return \"this.stride[\"+i + \"]\"\n    }).join(\",\")+\",this.offset)}\")\n\n  //view.lo():\n  var a_vars = indices.map(function(i) { return \"a\"+i+\"=this.shape[\"+i+\"]\" })\n  var c_vars = indices.map(function(i) { return \"c\"+i+\"=this.stride[\"+i+\"]\" })\n  code.push(\"proto.lo=function \"+className+\"_lo(\"+args.join(\",\")+\"){var b=this.offset,d=0,\"+a_vars.join(\",\")+\",\"+c_vars.join(\",\"))\n  for(var i=0; i<dimension; ++i) {\n    code.push(\n\"if(typeof i\"+i+\"==='number'&&i\"+i+\">=0){\\\nd=i\"+i+\"|0;\\\nb+=c\"+i+\"*d;\\\na\"+i+\"-=d}\")\n  }\n  code.push(\"return new \"+className+\"(this.data,\"+\n    indices.map(function(i) {\n      return \"a\"+i\n    }).join(\",\")+\",\"+\n    indices.map(function(i) {\n      return \"c\"+i\n    }).join(\",\")+\",b)}\")\n\n  //view.step():\n  code.push(\"proto.step=function \"+className+\"_step(\"+args.join(\",\")+\"){var \"+\n    indices.map(function(i) {\n      return \"a\"+i+\"=this.shape[\"+i+\"]\"\n    }).join(\",\")+\",\"+\n    indices.map(function(i) {\n      return \"b\"+i+\"=this.stride[\"+i+\"]\"\n    }).join(\",\")+\",c=this.offset,d=0,ceil=Math.ceil\")\n  for(var i=0; i<dimension; ++i) {\n    code.push(\n\"if(typeof i\"+i+\"==='number'){\\\nd=i\"+i+\"|0;\\\nif(d<0){\\\nc+=b\"+i+\"*(a\"+i+\"-1);\\\na\"+i+\"=ceil(-a\"+i+\"/d)\\\n}else{\\\na\"+i+\"=ceil(a\"+i+\"/d)\\\n}\\\nb\"+i+\"*=d\\\n}\")\n  }\n  code.push(\"return new \"+className+\"(this.data,\"+\n    indices.map(function(i) {\n      return \"a\" + i\n    }).join(\",\")+\",\"+\n    indices.map(function(i) {\n      return \"b\" + i\n    }).join(\",\")+\",c)}\")\n\n  //view.transpose():\n  var tShape = new Array(dimension)\n  var tStride = new Array(dimension)\n  for(var i=0; i<dimension; ++i) {\n    tShape[i] = \"a[i\"+i+\"]\"\n    tStride[i] = \"b[i\"+i+\"]\"\n  }\n  code.push(\"proto.transpose=function \"+className+\"_transpose(\"+args+\"){\"+\n    args.map(function(n,idx) { return n + \"=(\" + n + \"===undefined?\" + idx + \":\" + n + \"|0)\"}).join(\";\"),\n    \"var a=this.shape,b=this.stride;return new \"+className+\"(this.data,\"+tShape.join(\",\")+\",\"+tStride.join(\",\")+\",this.offset)}\")\n\n  //view.pick():\n  code.push(\"proto.pick=function \"+className+\"_pick(\"+args+\"){var a=[],b=[],c=this.offset\")\n  for(var i=0; i<dimension; ++i) {\n    code.push(\"if(typeof i\"+i+\"==='number'&&i\"+i+\">=0){c=(c+this.stride[\"+i+\"]*i\"+i+\")|0}else{a.push(this.shape[\"+i+\"]);b.push(this.stride[\"+i+\"])}\")\n  }\n  code.push(\"var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}\")\n\n  //Add return statement\n  code.push(\"return function construct_\"+className+\"(data,shape,stride,offset){return new \"+className+\"(data,\"+\n    indices.map(function(i) {\n      return \"shape[\"+i+\"]\"\n    }).join(\",\")+\",\"+\n    indices.map(function(i) {\n      return \"stride[\"+i+\"]\"\n    }).join(\",\")+\",offset)}\")\n\n  //Compile procedure\n  var procedure = new Function(\"CTOR_LIST\", \"ORDER\", code.join(\"\\n\"))\n  return procedure(CACHED_CONSTRUCTORS[dtype], order)\n}\n\nfunction arrayDType(data) {\n  if(isBuffer(data)) {\n    return \"buffer\"\n  }\n  if(hasTypedArrays) {\n    switch(Object.prototype.toString.call(data)) {\n      case \"[object Float64Array]\":\n        return \"float64\"\n      case \"[object Float32Array]\":\n        return \"float32\"\n      case \"[object Int8Array]\":\n        return \"int8\"\n      case \"[object Int16Array]\":\n        return \"int16\"\n      case \"[object Int32Array]\":\n        return \"int32\"\n      case \"[object Uint8Array]\":\n        return \"uint8\"\n      case \"[object Uint16Array]\":\n        return \"uint16\"\n      case \"[object Uint32Array]\":\n        return \"uint32\"\n      case \"[object Uint8ClampedArray]\":\n        return \"uint8_clamped\"\n      case \"[object BigInt64Array]\":\n        return \"bigint64\"\n      case \"[object BigUint64Array]\":\n        return \"biguint64\"\n    }\n  }\n  if(Array.isArray(data)) {\n    return \"array\"\n  }\n  return \"generic\"\n}\n\nvar CACHED_CONSTRUCTORS = {\n  \"float32\":[],\n  \"float64\":[],\n  \"int8\":[],\n  \"int16\":[],\n  \"int32\":[],\n  \"uint8\":[],\n  \"uint16\":[],\n  \"uint32\":[],\n  \"array\":[],\n  \"uint8_clamped\":[],\n  \"bigint64\": [],\n  \"biguint64\": [],\n  \"buffer\":[],\n  \"generic\":[]\n}\n\n;(function() {\n  for(var id in CACHED_CONSTRUCTORS) {\n    CACHED_CONSTRUCTORS[id].push(compileConstructor(id, -1))\n  }\n});\n\nfunction wrappedNDArrayCtor(data, shape, stride, offset) {\n  if(data === undefined) {\n    var ctor = CACHED_CONSTRUCTORS.array[0]\n    return ctor([])\n  } else if(typeof data === \"number\") {\n    data = [data]\n  }\n  if(shape === undefined) {\n    shape = [ data.length ]\n  }\n  var d = shape.length\n  if(stride === undefined) {\n    stride = new Array(d)\n    for(var i=d-1, sz=1; i>=0; --i) {\n      stride[i] = sz\n      sz *= shape[i]\n    }\n  }\n  if(offset === undefined) {\n    offset = 0\n    for(var i=0; i<d; ++i) {\n      if(stride[i] < 0) {\n        offset -= (shape[i]-1)*stride[i]\n      }\n    }\n  }\n  var dtype = arrayDType(data)\n  var ctor_list = CACHED_CONSTRUCTORS[dtype]\n  while(ctor_list.length <= d+1) {\n    ctor_list.push(compileConstructor(dtype, ctor_list.length-1))\n  }\n  var ctor = ctor_list[d+1]\n  return ctor(data, shape, stride, offset)\n}\n\nmodule.exports = wrappedNDArrayCtor\n","module.exports = require('./divide')\n","\"use strict\"\n\nfunction traceRay_impl( getVoxel,\n\tpx, py, pz,\n\tdx, dy, dz,\n\tmax_d, hit_pos, hit_norm) {\n\t\n\t// consider raycast vector to be parametrized by t\n\t//   vec = [px,py,pz] + t * [dx,dy,dz]\n\t\n\t// algo below is as described by this paper:\n\t// http://www.cse.chalmers.se/edu/year/2010/course/TDA361/grid.pdf\n\t\n\tvar t = 0.0\n\t\t, floor = Math.floor\n\t\t, ix = floor(px) | 0\n\t\t, iy = floor(py) | 0\n\t\t, iz = floor(pz) | 0\n\n\t\t, stepx = (dx > 0) ? 1 : -1\n\t\t, stepy = (dy > 0) ? 1 : -1\n\t\t, stepz = (dz > 0) ? 1 : -1\n\t\t\n\t// dx,dy,dz are already normalized\n\t\t, txDelta = Math.abs(1 / dx)\n\t\t, tyDelta = Math.abs(1 / dy)\n\t\t, tzDelta = Math.abs(1 / dz)\n\n\t\t, xdist = (stepx > 0) ? (ix + 1 - px) : (px - ix)\n\t\t, ydist = (stepy > 0) ? (iy + 1 - py) : (py - iy)\n\t\t, zdist = (stepz > 0) ? (iz + 1 - pz) : (pz - iz)\n\t\t\n\t// location of nearest voxel boundary, in units of t \n\t\t, txMax = (txDelta < Infinity) ? txDelta * xdist : Infinity\n\t\t, tyMax = (tyDelta < Infinity) ? tyDelta * ydist : Infinity\n\t\t, tzMax = (tzDelta < Infinity) ? tzDelta * zdist : Infinity\n\n\t\t, steppedIndex = -1\n\t\n\t// main loop along raycast vector\n\twhile (t <= max_d) {\n\t\t\n\t\t// exit check\n\t\tvar b = getVoxel(ix, iy, iz)\n\t\tif (b) {\n\t\t\tif (hit_pos) {\n\t\t\t\thit_pos[0] = px + t * dx\n\t\t\t\thit_pos[1] = py + t * dy\n\t\t\t\thit_pos[2] = pz + t * dz\n\t\t\t}\n\t\t\tif (hit_norm) {\n\t\t\t\thit_norm[0] = hit_norm[1] = hit_norm[2] = 0\n\t\t\t\tif (steppedIndex === 0) hit_norm[0] = -stepx\n\t\t\t\tif (steppedIndex === 1) hit_norm[1] = -stepy\n\t\t\t\tif (steppedIndex === 2) hit_norm[2] = -stepz\n\t\t\t}\n\t\t\treturn b\n\t\t}\n\t\t\n\t\t// advance t to next nearest voxel boundary\n\t\tif (txMax < tyMax) {\n\t\t\tif (txMax < tzMax) {\n\t\t\t\tix += stepx\n\t\t\t\tt = txMax\n\t\t\t\ttxMax += txDelta\n\t\t\t\tsteppedIndex = 0\n\t\t\t} else {\n\t\t\t\tiz += stepz\n\t\t\t\tt = tzMax\n\t\t\t\ttzMax += tzDelta\n\t\t\t\tsteppedIndex = 2\n\t\t\t}\n\t\t} else {\n\t\t\tif (tyMax < tzMax) {\n\t\t\t\tiy += stepy\n\t\t\t\tt = tyMax\n\t\t\t\ttyMax += tyDelta\n\t\t\t\tsteppedIndex = 1\n\t\t\t} else {\n\t\t\t\tiz += stepz\n\t\t\t\tt = tzMax\n\t\t\t\ttzMax += tzDelta\n\t\t\t\tsteppedIndex = 2\n\t\t\t}\n\t\t}\n\n\t}\n\t\n\t// no voxel hit found\n\tif (hit_pos) {\n\t\thit_pos[0] = px + t * dx\n\t\thit_pos[1] = py + t * dy\n\t\thit_pos[2] = pz + t * dz\n\t}\n\tif (hit_norm) {\n\t\thit_norm[0] = hit_norm[1] = hit_norm[2] = 0\n\t}\n\n\treturn 0\n\n}\n\n\n// conform inputs\n\nfunction traceRay(getVoxel, origin, direction, max_d, hit_pos, hit_norm) {\n\tvar px = +origin[0]\n\t\t, py = +origin[1]\n\t\t, pz = +origin[2]\n\t\t, dx = +direction[0]\n\t\t, dy = +direction[1]\n\t\t, dz = +direction[2]\n\t\t, ds = Math.sqrt(dx * dx + dy * dy + dz * dz)\n\n\tif (ds === 0) {\n\t\tthrow new Error(\"Can't raycast along a zero vector\")\n\t}\n\n\tdx /= ds\n\tdy /= ds\n\tdz /= ds\n\tif (typeof (max_d) === \"undefined\") {\n\t\tmax_d = 64.0\n\t} else {\n\t\tmax_d = +max_d\n\t}\n\treturn traceRay_impl(getVoxel, px, py, pz, dx, dy, dz, max_d, hit_pos, hit_norm)\n}\n\nmodule.exports = traceRay","module.exports = exactEquals\n\n/**\n * Returns whether or not the vectors exactly have the same elements in the same position (when compared with ===)\n *\n * @param {vec3} a The first vector.\n * @param {vec3} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\nfunction exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2]\n}\n","module.exports = 0.000001\n","'use strict'\n\nvar DIMENSION   = 'd'\nvar AXIS        = 'ax'\nvar VISIT       = 'vv'\nvar FLIP        = 'fp'\n\nvar ELEM_SIZE   = 'es'\n\nvar RED_START   = 'rs'\nvar RED_END     = 're'\nvar RED_BOXES   = 'rb'\nvar RED_INDEX   = 'ri'\nvar RED_PTR     = 'rp'\n\nvar BLUE_START  = 'bs'\nvar BLUE_END    = 'be'\nvar BLUE_BOXES  = 'bb'\nvar BLUE_INDEX  = 'bi'\nvar BLUE_PTR    = 'bp'\n\nvar RETVAL      = 'rv'\n\nvar INNER_LABEL = 'Q'\n\nvar ARGS = [\n  DIMENSION,\n  AXIS,\n  VISIT,\n  RED_START,\n  RED_END,\n  RED_BOXES,\n  RED_INDEX,\n  BLUE_START,\n  BLUE_END,\n  BLUE_BOXES,\n  BLUE_INDEX\n]\n\nfunction generateBruteForce(redMajor, flip, full) {\n  var funcName = 'bruteForce' + \n    (redMajor ? 'Red' : 'Blue') + \n    (flip ? 'Flip' : '') +\n    (full ? 'Full' : '')\n\n  var code = ['function ', funcName, '(', ARGS.join(), '){',\n    'var ', ELEM_SIZE, '=2*', DIMENSION, ';']\n\n  var redLoop = \n    'for(var i=' + RED_START + ',' + RED_PTR + '=' + ELEM_SIZE + '*' + RED_START + ';' +\n        'i<' + RED_END +';' +\n        '++i,' + RED_PTR + '+=' + ELEM_SIZE + '){' +\n        'var x0=' + RED_BOXES + '[' + AXIS + '+' + RED_PTR + '],' +\n            'x1=' + RED_BOXES + '[' + AXIS + '+' + RED_PTR + '+' + DIMENSION + '],' +\n            'xi=' + RED_INDEX + '[i];'\n\n  var blueLoop = \n    'for(var j=' + BLUE_START + ',' + BLUE_PTR + '=' + ELEM_SIZE + '*' + BLUE_START + ';' +\n        'j<' + BLUE_END + ';' +\n        '++j,' + BLUE_PTR + '+=' + ELEM_SIZE + '){' +\n        'var y0=' + BLUE_BOXES + '[' + AXIS + '+' + BLUE_PTR + '],' +\n            (full ? 'y1=' + BLUE_BOXES + '[' + AXIS + '+' + BLUE_PTR + '+' + DIMENSION + '],' : '') +\n            'yi=' + BLUE_INDEX + '[j];'\n\n  if(redMajor) {\n    code.push(redLoop, INNER_LABEL, ':', blueLoop)\n  } else {\n    code.push(blueLoop, INNER_LABEL, ':', redLoop)\n  }\n\n  if(full) {\n    code.push('if(y1<x0||x1<y0)continue;')\n  } else if(flip) {\n    code.push('if(y0<=x0||x1<y0)continue;')\n  } else {\n    code.push('if(y0<x0||x1<y0)continue;')\n  }\n\n  code.push('for(var k='+AXIS+'+1;k<'+DIMENSION+';++k){'+\n    'var r0='+RED_BOXES+'[k+'+RED_PTR+'],'+\n        'r1='+RED_BOXES+'[k+'+DIMENSION+'+'+RED_PTR+'],'+\n        'b0='+BLUE_BOXES+'[k+'+BLUE_PTR+'],'+\n        'b1='+BLUE_BOXES+'[k+'+DIMENSION+'+'+BLUE_PTR+'];'+\n      'if(r1<b0||b1<r0)continue ' + INNER_LABEL + ';}' +\n      'var ' + RETVAL + '=' + VISIT + '(')\n\n  if(flip) {\n    code.push('yi,xi')\n  } else {\n    code.push('xi,yi')\n  }\n\n  code.push(');if(' + RETVAL + '!==void 0)return ' + RETVAL + ';}}}')\n\n  return {\n    name: funcName, \n    code: code.join('')\n  }\n}\n\nfunction bruteForcePlanner(full) {\n  var funcName = 'bruteForce' + (full ? 'Full' : 'Partial')\n  var prefix = []\n  var fargs = ARGS.slice()\n  if(!full) {\n    fargs.splice(3, 0, FLIP)\n  }\n\n  var code = ['function ' + funcName + '(' + fargs.join() + '){']\n\n  function invoke(redMajor, flip) {\n    var res = generateBruteForce(redMajor, flip, full)\n    prefix.push(res.code)\n    code.push('return ' + res.name + '(' + ARGS.join() + ');')\n  }\n\n  code.push('if(' + RED_END + '-' + RED_START + '>' +\n                    BLUE_END + '-' + BLUE_START + '){')\n\n  if(full) {\n    invoke(true, false)\n    code.push('}else{')\n    invoke(false, false)\n  } else {\n    code.push('if(' + FLIP + '){')\n    invoke(true, true)\n    code.push('}else{')\n    invoke(true, false)\n    code.push('}}else{if(' + FLIP + '){')\n    invoke(false, true)\n    code.push('}else{')\n    invoke(false, false)\n    code.push('}')\n  }\n  code.push('}}return ' + funcName)\n\n  var codeStr = prefix.join('') + code.join('')\n  var proc = new Function(codeStr)\n  return proc()\n}\n\n\nexports.partial = bruteForcePlanner(false)\nexports.full    = bruteForcePlanner(true)","\n\n/*\n * \n *      Encapsulates (mostly) a collection of objects, \n *      exposed both as a hash and as an array\n *      _map maps hash id to list index\n * \n *      Note this is a dumb store, it doesn't check any inputs at all.\n *      It also assumes every stored data object is stored like:\n *          dataStore.add(37, {__id:37} )\n * \n*/\n\n\nmodule.exports = class DataStore {\n\n    constructor() {\n        this.list = []\n        this.hash = {}\n        this._map = {}\n        this._pendingRemovals = []\n    }\n\n\n    // add a new state object\n    add(id, stateObject) {\n        if (typeof this._map[id] === 'number') {\n            // this happens if id is removed/readded without flushing\n            var index = this._map[id]\n            this.hash[id] = stateObject\n            this.list[index] = stateObject\n        } else {\n            this._map[id] = this.list.length\n            this.hash[id] = stateObject\n            this.list.push(stateObject)\n        }\n    }\n\n\n    // remove - nulls the state object, actual removal comes later\n    remove(id) {\n        var index = this._map[id]\n        this.hash[id] = null\n        this.list[index] = null\n        this._pendingRemovals.push(id)\n    }\n\n\n    // just sever references\n    dispose() {\n        this.list = null\n        this.hash = null\n        this._map = null\n        this._pendingRemovals.length = 0\n    }\n\n\n    // deletes removed objects from data structures\n    flush() {\n        for (var i = 0; i < this._pendingRemovals.length; i++) {\n            var id = this._pendingRemovals[i]\n            // removal might have been reversed, or already handled\n            if (this.hash[id] !== null) continue\n            removeElement(this, id)\n        }\n        this._pendingRemovals.length = 0\n    }\n\n}\n\n\n/*\n * \n *      actual remove / cleanup logic, fixes up data structures after removal\n * \n * \n*/\n\n\nfunction removeElement(data, id) {\n    // current location of this element in the list\n    var index = data._map[id]\n    // for hash and map, just delete by id\n    delete data.hash[id]\n    delete data._map[id]\n    // now splice - either by popping or by swapping with final element\n    if (index === data.list.length - 1) {\n        data.list.pop()\n    } else {\n        // swap last item with the one we're removing\n        var swapped = data.list.pop()\n        data.list[index] = swapped\n        // need to fix _map for swapped item\n        if (swapped === null || swapped[0] === null) {\n            // slowest but rarest case - swapped item is ALSO pending removal\n            var prevIndex = data.list.length\n            for (var swapID in data._map) {\n                if (data._map[swapID] === prevIndex) {\n                    data._map[swapID] = index\n                    return\n                }\n            }\n        } else {\n            var swappedID = swapped.__id || swapped[0].__id\n            data._map[swappedID] = index\n        }\n    }\n}\n\n\n","module.exports = round\n\n/**\n * Math.round the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a vector to round\n * @returns {vec3} out\n */\nfunction round(out, a) {\n  out[0] = Math.round(a[0])\n  out[1] = Math.round(a[1])\n  out[2] = Math.round(a[2])\n  return out\n}\n","module.exports = floor\n\n/**\n * Math.floor the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a vector to floor\n * @returns {vec3} out\n */\nfunction floor(out, a) {\n  out[0] = Math.floor(a[0])\n  out[1] = Math.floor(a[1])\n  out[2] = Math.floor(a[2])\n  return out\n}\n","module.exports = random;\n\n/**\n * Generates a random vector with the given scale\n *\n * @param {vec3} out the receiving vector\n * @param {Number} [scale] Length of the resulting vector. If ommitted, a unit vector will be returned\n * @returns {vec3} out\n */\nfunction random(out, scale) {\n    scale = scale || 1.0\n\n    var r = Math.random() * 2.0 * Math.PI\n    var z = (Math.random() * 2.0) - 1.0\n    var zScale = Math.sqrt(1.0-z*z) * scale\n\n    out[0] = Math.cos(r) * zScale\n    out[1] = Math.sin(r) * zScale\n    out[2] = z * scale\n    return out\n}","/**\n * Bit twiddling hacks for JavaScript.\n *\n * Author: Mikola Lysenko\n *\n * Ported from Stanford bit twiddling hack library:\n *    http://graphics.stanford.edu/~seander/bithacks.html\n */\n\n\"use strict\"; \"use restrict\";\n\n//Number of bits in an integer\nvar INT_BITS = 32;\n\n//Constants\nexports.INT_BITS  = INT_BITS;\nexports.INT_MAX   =  0x7fffffff;\nexports.INT_MIN   = -1<<(INT_BITS-1);\n\n//Returns -1, 0, +1 depending on sign of x\nexports.sign = function(v) {\n  return (v > 0) - (v < 0);\n}\n\n//Computes absolute value of integer\nexports.abs = function(v) {\n  var mask = v >> (INT_BITS-1);\n  return (v ^ mask) - mask;\n}\n\n//Computes minimum of integers x and y\nexports.min = function(x, y) {\n  return y ^ ((x ^ y) & -(x < y));\n}\n\n//Computes maximum of integers x and y\nexports.max = function(x, y) {\n  return x ^ ((x ^ y) & -(x < y));\n}\n\n//Checks if a number is a power of two\nexports.isPow2 = function(v) {\n  return !(v & (v-1)) && (!!v);\n}\n\n//Computes log base 2 of v\nexports.log2 = function(v) {\n  var r, shift;\n  r =     (v > 0xFFFF) << 4; v >>>= r;\n  shift = (v > 0xFF  ) << 3; v >>>= shift; r |= shift;\n  shift = (v > 0xF   ) << 2; v >>>= shift; r |= shift;\n  shift = (v > 0x3   ) << 1; v >>>= shift; r |= shift;\n  return r | (v >> 1);\n}\n\n//Computes log base 10 of v\nexports.log10 = function(v) {\n  return  (v >= 1000000000) ? 9 : (v >= 100000000) ? 8 : (v >= 10000000) ? 7 :\n          (v >= 1000000) ? 6 : (v >= 100000) ? 5 : (v >= 10000) ? 4 :\n          (v >= 1000) ? 3 : (v >= 100) ? 2 : (v >= 10) ? 1 : 0;\n}\n\n//Counts number of bits\nexports.popCount = function(v) {\n  v = v - ((v >>> 1) & 0x55555555);\n  v = (v & 0x33333333) + ((v >>> 2) & 0x33333333);\n  return ((v + (v >>> 4) & 0xF0F0F0F) * 0x1010101) >>> 24;\n}\n\n//Counts number of trailing zeros\nfunction countTrailingZeros(v) {\n  var c = 32;\n  v &= -v;\n  if (v) c--;\n  if (v & 0x0000FFFF) c -= 16;\n  if (v & 0x00FF00FF) c -= 8;\n  if (v & 0x0F0F0F0F) c -= 4;\n  if (v & 0x33333333) c -= 2;\n  if (v & 0x55555555) c -= 1;\n  return c;\n}\nexports.countTrailingZeros = countTrailingZeros;\n\n//Rounds to next power of 2\nexports.nextPow2 = function(v) {\n  v += v === 0;\n  --v;\n  v |= v >>> 1;\n  v |= v >>> 2;\n  v |= v >>> 4;\n  v |= v >>> 8;\n  v |= v >>> 16;\n  return v + 1;\n}\n\n//Rounds down to previous power of 2\nexports.prevPow2 = function(v) {\n  v |= v >>> 1;\n  v |= v >>> 2;\n  v |= v >>> 4;\n  v |= v >>> 8;\n  v |= v >>> 16;\n  return v - (v>>>1);\n}\n\n//Computes parity of word\nexports.parity = function(v) {\n  v ^= v >>> 16;\n  v ^= v >>> 8;\n  v ^= v >>> 4;\n  v &= 0xf;\n  return (0x6996 >>> v) & 1;\n}\n\nvar REVERSE_TABLE = new Array(256);\n\n(function(tab) {\n  for(var i=0; i<256; ++i) {\n    var v = i, r = i, s = 7;\n    for (v >>>= 1; v; v >>>= 1) {\n      r <<= 1;\n      r |= v & 1;\n      --s;\n    }\n    tab[i] = (r << s) & 0xff;\n  }\n})(REVERSE_TABLE);\n\n//Reverse bits in a 32 bit word\nexports.reverse = function(v) {\n  return  (REVERSE_TABLE[ v         & 0xff] << 24) |\n          (REVERSE_TABLE[(v >>> 8)  & 0xff] << 16) |\n          (REVERSE_TABLE[(v >>> 16) & 0xff] << 8)  |\n           REVERSE_TABLE[(v >>> 24) & 0xff];\n}\n\n//Interleave bits of 2 coordinates with 16 bits.  Useful for fast quadtree codes\nexports.interleave2 = function(x, y) {\n  x &= 0xFFFF;\n  x = (x | (x << 8)) & 0x00FF00FF;\n  x = (x | (x << 4)) & 0x0F0F0F0F;\n  x = (x | (x << 2)) & 0x33333333;\n  x = (x | (x << 1)) & 0x55555555;\n\n  y &= 0xFFFF;\n  y = (y | (y << 8)) & 0x00FF00FF;\n  y = (y | (y << 4)) & 0x0F0F0F0F;\n  y = (y | (y << 2)) & 0x33333333;\n  y = (y | (y << 1)) & 0x55555555;\n\n  return x | (y << 1);\n}\n\n//Extracts the nth interleaved component\nexports.deinterleave2 = function(v, n) {\n  v = (v >>> n) & 0x55555555;\n  v = (v | (v >>> 1))  & 0x33333333;\n  v = (v | (v >>> 2))  & 0x0F0F0F0F;\n  v = (v | (v >>> 4))  & 0x00FF00FF;\n  v = (v | (v >>> 16)) & 0x000FFFF;\n  return (v << 16) >> 16;\n}\n\n\n//Interleave bits of 3 coordinates, each with 10 bits.  Useful for fast octree codes\nexports.interleave3 = function(x, y, z) {\n  x &= 0x3FF;\n  x  = (x | (x<<16)) & 4278190335;\n  x  = (x | (x<<8))  & 251719695;\n  x  = (x | (x<<4))  & 3272356035;\n  x  = (x | (x<<2))  & 1227133513;\n\n  y &= 0x3FF;\n  y  = (y | (y<<16)) & 4278190335;\n  y  = (y | (y<<8))  & 251719695;\n  y  = (y | (y<<4))  & 3272356035;\n  y  = (y | (y<<2))  & 1227133513;\n  x |= (y << 1);\n  \n  z &= 0x3FF;\n  z  = (z | (z<<16)) & 4278190335;\n  z  = (z | (z<<8))  & 251719695;\n  z  = (z | (z<<4))  & 3272356035;\n  z  = (z | (z<<2))  & 1227133513;\n  \n  return x | (z << 2);\n}\n\n//Extracts nth interleaved component of a 3-tuple\nexports.deinterleave3 = function(v, n) {\n  v = (v >>> n)       & 1227133513;\n  v = (v | (v>>>2))   & 3272356035;\n  v = (v | (v>>>4))   & 251719695;\n  v = (v | (v>>>8))   & 4278190335;\n  v = (v | (v>>>16))  & 0x3FF;\n  return (v<<22)>>22;\n}\n\n//Computes next combination in colexicographic order (this is mistakenly called nextPermutation on the bit twiddling hacks page)\nexports.nextCombination = function(v) {\n  var t = v | (v - 1);\n  return (t + 1) | (((~t & -~t) - 1) >>> (countTrailingZeros(v) + 1));\n}\n\n","module.exports = require('./multiply')\n","module.exports = length;\n\n/**\n * Calculates the length of a vec3\n *\n * @param {vec3} a vector to calculate length of\n * @returns {Number} length of a\n */\nfunction length(a) {\n    var x = a[0],\n        y = a[1],\n        z = a[2]\n    return Math.sqrt(x*x + y*y + z*z)\n}","module.exports = max;\n\n/**\n * Returns the maximum of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a the first operand\n * @param {vec3} b the second operand\n * @returns {vec3} out\n */\nfunction max(out, a, b) {\n    out[0] = Math.max(a[0], b[0])\n    out[1] = Math.max(a[1], b[1])\n    out[2] = Math.max(a[2], b[2])\n    return out\n}","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\nmodule.exports.once = once;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n\nfunction once(emitter, name) {\n  return new Promise(function (resolve, reject) {\n    function errorListener(err) {\n      emitter.removeListener(name, resolver);\n      reject(err);\n    }\n\n    function resolver() {\n      if (typeof emitter.removeListener === 'function') {\n        emitter.removeListener('error', errorListener);\n      }\n      resolve([].slice.call(arguments));\n    };\n\n    eventTargetAgnosticAddListener(emitter, name, resolver, { once: true });\n    if (name !== 'error') {\n      addErrorHandlerIfEventEmitter(emitter, errorListener, { once: true });\n    }\n  });\n}\n\nfunction addErrorHandlerIfEventEmitter(emitter, handler, flags) {\n  if (typeof emitter.on === 'function') {\n    eventTargetAgnosticAddListener(emitter, 'error', handler, flags);\n  }\n}\n\nfunction eventTargetAgnosticAddListener(emitter, name, listener, flags) {\n  if (typeof emitter.on === 'function') {\n    if (flags.once) {\n      emitter.once(name, listener);\n    } else {\n      emitter.on(name, listener);\n    }\n  } else if (typeof emitter.addEventListener === 'function') {\n    // EventTarget does not have `error` event semantics like Node\n    // EventEmitters, we do not listen for `error` events here.\n    emitter.addEventListener(name, function wrapListener(arg) {\n      // IE does not have builtin `{ once: true }` support so we\n      // have to do it manually.\n      if (flags.once) {\n        emitter.removeEventListener(name, wrapListener);\n      }\n      listener(arg);\n    });\n  } else {\n    throw new TypeError('The \"emitter\" argument must be of type EventEmitter. Received type ' + typeof emitter);\n  }\n}\n","'use strict';\n\n//This code is extracted from ndarray-sort\n//It is inlined here as a temporary workaround\n\nmodule.exports = wrapper;\n\nvar INSERT_SORT_CUTOFF = 32\n\nfunction wrapper(data, n0) {\n  if (n0 <= 4*INSERT_SORT_CUTOFF) {\n    insertionSort(0, n0 - 1, data);\n  } else {\n    quickSort(0, n0 - 1, data);\n  }\n}\n\nfunction insertionSort(left, right, data) {\n  var ptr = 2*(left+1)\n  for(var i=left+1; i<=right; ++i) {\n    var a = data[ptr++]\n    var b = data[ptr++]\n    var j = i\n    var jptr = ptr-2\n    while(j-- > left) {\n      var x = data[jptr-2]\n      var y = data[jptr-1]\n      if(x < a) {\n        break\n      } else if(x === a && y < b) {\n        break\n      }\n      data[jptr]   = x\n      data[jptr+1] = y\n      jptr -= 2\n    }\n    data[jptr]   = a\n    data[jptr+1] = b\n  }\n}\n\nfunction swap(i, j, data) {\n  i *= 2\n  j *= 2\n  var x = data[i]\n  var y = data[i+1]\n  data[i] = data[j]\n  data[i+1] = data[j+1]\n  data[j] = x\n  data[j+1] = y\n}\n\nfunction move(i, j, data) {\n  i *= 2\n  j *= 2\n  data[i] = data[j]\n  data[i+1] = data[j+1]\n}\n\nfunction rotate(i, j, k, data) {\n  i *= 2\n  j *= 2\n  k *= 2\n  var x = data[i]\n  var y = data[i+1]\n  data[i] = data[j]\n  data[i+1] = data[j+1]\n  data[j] = data[k]\n  data[j+1] = data[k+1]\n  data[k] = x\n  data[k+1] = y\n}\n\nfunction shufflePivot(i, j, px, py, data) {\n  i *= 2\n  j *= 2\n  data[i] = data[j]\n  data[j] = px\n  data[i+1] = data[j+1]\n  data[j+1] = py\n}\n\nfunction compare(i, j, data) {\n  i *= 2\n  j *= 2\n  var x = data[i],\n      y = data[j]\n  if(x < y) {\n    return false\n  } else if(x === y) {\n    return data[i+1] > data[j+1]\n  }\n  return true\n}\n\nfunction comparePivot(i, y, b, data) {\n  i *= 2\n  var x = data[i]\n  if(x < y) {\n    return true\n  } else if(x === y) {\n    return data[i+1] < b\n  }\n  return false\n}\n\nfunction quickSort(left, right, data) {\n  var sixth = (right - left + 1) / 6 | 0, \n      index1 = left + sixth, \n      index5 = right - sixth, \n      index3 = left + right >> 1, \n      index2 = index3 - sixth, \n      index4 = index3 + sixth, \n      el1 = index1, \n      el2 = index2, \n      el3 = index3, \n      el4 = index4, \n      el5 = index5, \n      less = left + 1, \n      great = right - 1, \n      tmp = 0\n  if(compare(el1, el2, data)) {\n    tmp = el1\n    el1 = el2\n    el2 = tmp\n  }\n  if(compare(el4, el5, data)) {\n    tmp = el4\n    el4 = el5\n    el5 = tmp\n  }\n  if(compare(el1, el3, data)) {\n    tmp = el1\n    el1 = el3\n    el3 = tmp\n  }\n  if(compare(el2, el3, data)) {\n    tmp = el2\n    el2 = el3\n    el3 = tmp\n  }\n  if(compare(el1, el4, data)) {\n    tmp = el1\n    el1 = el4\n    el4 = tmp\n  }\n  if(compare(el3, el4, data)) {\n    tmp = el3\n    el3 = el4\n    el4 = tmp\n  }\n  if(compare(el2, el5, data)) {\n    tmp = el2\n    el2 = el5\n    el5 = tmp\n  }\n  if(compare(el2, el3, data)) {\n    tmp = el2\n    el2 = el3\n    el3 = tmp\n  }\n  if(compare(el4, el5, data)) {\n    tmp = el4\n    el4 = el5\n    el5 = tmp\n  }\n\n  var pivot1X = data[2*el2]\n  var pivot1Y = data[2*el2+1]\n  var pivot2X = data[2*el4]\n  var pivot2Y = data[2*el4+1]\n\n  var ptr0 = 2 * el1;\n  var ptr2 = 2 * el3;\n  var ptr4 = 2 * el5;\n  var ptr5 = 2 * index1;\n  var ptr6 = 2 * index3;\n  var ptr7 = 2 * index5;\n  for (var i1 = 0; i1 < 2; ++i1) {\n    var x = data[ptr0+i1];\n    var y = data[ptr2+i1];\n    var z = data[ptr4+i1];\n    data[ptr5+i1] = x;\n    data[ptr6+i1] = y;\n    data[ptr7+i1] = z;\n  }\n\n  move(index2, left, data)\n  move(index4, right, data)\n  for (var k = less; k <= great; ++k) {\n    if (comparePivot(k, pivot1X, pivot1Y, data)) {\n      if (k !== less) {\n        swap(k, less, data)\n      }\n      ++less;\n    } else {\n      if (!comparePivot(k, pivot2X, pivot2Y, data)) {\n        while (true) {\n          if (!comparePivot(great, pivot2X, pivot2Y, data)) {\n            if (--great < k) {\n              break;\n            }\n            continue;\n          } else {\n            if (comparePivot(great, pivot1X, pivot1Y, data)) {\n              rotate(k, less, great, data)\n              ++less;\n              --great;\n            } else {\n              swap(k, great, data)\n              --great;\n            }\n            break;\n          }\n        }\n      }\n    }\n  }\n  shufflePivot(left, less-1, pivot1X, pivot1Y, data)\n  shufflePivot(right, great+1, pivot2X, pivot2Y, data)\n  if (less - 2 - left <= INSERT_SORT_CUTOFF) {\n    insertionSort(left, less - 2, data);\n  } else {\n    quickSort(left, less - 2, data);\n  }\n  if (right - (great + 2) <= INSERT_SORT_CUTOFF) {\n    insertionSort(great + 2, right, data);\n  } else {\n    quickSort(great + 2, right, data);\n  }\n  if (great - less <= INSERT_SORT_CUTOFF) {\n    insertionSort(less, great, data);\n  } else {\n    quickSort(less, great, data);\n  }\n}","module.exports = rotateX;\n\n/**\n * Rotate a 3D vector around the x-axis\n * @param {vec3} out The receiving vec3\n * @param {vec3} a The vec3 point to rotate\n * @param {vec3} b The origin of the rotation\n * @param {Number} c The angle of rotation\n * @returns {vec3} out\n */\nfunction rotateX(out, a, b, c){\n    var by = b[1]\n    var bz = b[2]\n\n    // Translate point to the origin\n    var py = a[1] - by\n    var pz = a[2] - bz\n\n    var sc = Math.sin(c)\n    var cc = Math.cos(c)\n\n    // perform rotation and translate to correct position\n    out[0] = a[0]\n    out[1] = by + py * cc - pz * sc\n    out[2] = bz + py * sc + pz * cc\n\n    return out\n}\n","'use strict'\n\nmodule.exports = boxIntersectWrapper\n\nvar pool = require('@jpweeks/typedarray-pool')\nvar sweep = require('./lib/sweep')\nvar boxIntersectIter = require('./lib/intersect')\n\nfunction boxEmpty(d, box) {\n  for(var j=0; j<d; ++j) {\n    if(!(box[j] <= box[j+d])) {\n      return true\n    }\n  }\n  return false\n}\n\n//Unpack boxes into a flat typed array, remove empty boxes\nfunction convertBoxes(boxes, d, data, ids) {\n  var ptr = 0\n  var count = 0\n  for(var i=0, n=boxes.length; i<n; ++i) {\n    var b = boxes[i]\n    if(boxEmpty(d, b)) {\n      continue\n    }\n    for(var j=0; j<2*d; ++j) {\n      data[ptr++] = b[j]\n    }\n    ids[count++] = i\n  }\n  return count\n}\n\n//Perform type conversions, check bounds\nfunction boxIntersect(red, blue, visit, full) {\n  var n = red.length\n  var m = blue.length\n\n  //If either array is empty, then we can skip this whole thing\n  if(n <= 0 || m <= 0) {\n    return\n  }\n\n  //Compute dimension, if it is 0 then we skip\n  var d = (red[0].length)>>>1\n  if(d <= 0) {\n    return\n  }\n\n  var retval\n\n  //Convert red boxes\n  var redList  = pool.mallocDouble(2*d*n)\n  var redIds   = pool.mallocInt32(n)\n  n = convertBoxes(red, d, redList, redIds)\n\n  if(n > 0) {\n    if(d === 1 && full) {\n      //Special case: 1d complete\n      sweep.init(n)\n      retval = sweep.sweepComplete(\n        d, visit, \n        0, n, redList, redIds,\n        0, n, redList, redIds)\n    } else {\n\n      //Convert blue boxes\n      var blueList = pool.mallocDouble(2*d*m)\n      var blueIds  = pool.mallocInt32(m)\n      m = convertBoxes(blue, d, blueList, blueIds)\n\n      if(m > 0) {\n        sweep.init(n+m)\n\n        if(d === 1) {\n          //Special case: 1d bipartite\n          retval = sweep.sweepBipartite(\n            d, visit, \n            0, n, redList,  redIds,\n            0, m, blueList, blueIds)\n        } else {\n          //General case:  d>1\n          retval = boxIntersectIter(\n            d, visit,    full,\n            n, redList,  redIds,\n            m, blueList, blueIds)\n        }\n\n        pool.free(blueList)\n        pool.free(blueIds)\n      }\n    }\n\n    pool.free(redList)\n    pool.free(redIds)\n  }\n\n  return retval\n}\n\n\nvar RESULT\n\nfunction appendItem(i,j) {\n  RESULT.push([i,j])\n}\n\nfunction intersectFullArray(x) {\n  RESULT = []\n  boxIntersect(x, x, appendItem, true)\n  return RESULT\n}\n\nfunction intersectBipartiteArray(x, y) {\n  RESULT = []\n  boxIntersect(x, y, appendItem, false)\n  return RESULT\n}\n\n//User-friendly wrapper, handle full input and no-visitor cases\nfunction boxIntersectWrapper(arg0, arg1, arg2) {\n  var result\n  switch(arguments.length) {\n    case 1:\n      return intersectFullArray(arg0)\n    case 2:\n      if(typeof arg1 === 'function') {\n        return boxIntersect(arg0, arg0, arg1, true)\n      } else {\n        return intersectBipartiteArray(arg0, arg1)\n      }\n    case 3:\n      return boxIntersect(arg0, arg1, arg2, false)\n    default:\n      throw new Error('box-intersect: Invalid arguments')\n  }\n}","module.exports = require('./length')\n","module.exports = ceil\n\n/**\n * Math.ceil the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {vec3} a vector to ceil\n * @returns {vec3} out\n */\nfunction ceil(out, a) {\n  out[0] = Math.ceil(a[0])\n  out[1] = Math.ceil(a[1])\n  out[2] = Math.ceil(a[2])\n  return out\n}\n","\"use strict\"\n\nfunction dupe_array(count, value, i) {\n  var c = count[i]|0\n  if(c <= 0) {\n    return []\n  }\n  var result = new Array(c), j\n  if(i === count.length-1) {\n    for(j=0; j<c; ++j) {\n      result[j] = value\n    }\n  } else {\n    for(j=0; j<c; ++j) {\n      result[j] = dupe_array(count, value, i+1)\n    }\n  }\n  return result\n}\n\nfunction dupe_number(count, value) {\n  var result, i\n  result = new Array(count)\n  for(i=0; i<count; ++i) {\n    result[i] = value\n  }\n  return result\n}\n\nfunction dupe(count, value) {\n  if(typeof value === \"undefined\") {\n    value = 0\n  }\n  switch(typeof count) {\n    case \"number\":\n      if(count > 0) {\n        return dupe_number(count|0, value)\n      }\n    break\n    case \"object\":\n      if(typeof (count.length) === \"number\") {\n        return dupe_array(count, value, 0)\n      }\n    break\n  }\n  return []\n}\n\nmodule.exports = dupe","module.exports = require('./squaredLength')\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT')\n\t\tscriptUrl = document.currentScript.src;\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) {\n\t\t\tvar i = scripts.length - 1;\n\t\t\twhile (i > -1 && (!scriptUrl || !/^http(s?):/.test(scriptUrl))) scriptUrl = scripts[i--].src;\n\t\t}\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/^blob:/, \"\").replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t792: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = (chunkId) => (installedChunks[chunkId] === 0);\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunk\"] = self[\"webpackChunk\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// startup\n// Load entry module and return exports\n// This entry module depends on other loaded chunks and execution need to be delayed\nvar __webpack_exports__ = __webpack_require__.O(undefined, [926], () => (__webpack_require__(4517)))\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n"],"names":["deferred","window","globalThis","module","exports","out","a","b","t","ax","ay","az","tempA","fromValues","tempB","normalize","cosine","dot","Math","acos","x","y","z","c","bx","bz","px","pz","sc","sin","cc","cos","AABB","vec3","pos","vec","this","pos2","create","add","base","min","clone","max","mag","length","proto","prototype","width","height","depth","x0","y0","z0","x1","y1","z1","translate","by","setPosition","copy","expand","aabb","subtract","intersects","touches","intersection","union","base_x","base_y","base_z","py","init","count","rcount","bits","nextPow2","RED_SWEEP_QUEUE","pool","free","mallocInt32","RED_SWEEP_INDEX","BLUE_SWEEP_QUEUE","BLUE_SWEEP_INDEX","COMMON_SWEEP_QUEUE","COMMON_SWEEP_INDEX","eventLength","SWEEP_EVENTS","mallocDouble","sweepBipartite","d","visit","redStart","redEnd","red","redIndex","blueStart","blueEnd","blue","blueIndex","ptr","elemSize","istart","iend","i","idx","redOffset","BLUE_FLAG","blueOffset","n","isort","redActive","blueActive","e","sqPop","j","retval","sqPush","sweepComplete","commonActive","color","id","scanBipartite","axis","flip","redShift","blueShift","isRed","blueId","bluePtr","b0","b1","red_loop","oidx","redPtr","k","redId","scanComplete","INIT_CAPACITY","queue","index","item","top","q","qx","qy","qz","qw","ix","iy","iz","iw","isBuffer","obj","constructor","readFloatLE","slice","isSlowBuffer","_isBuffer","dup","g","__TYPEDARRAY_POOL","UINT8","UINT16","UINT32","INT8","INT16","INT32","FLOAT","DOUBLE","DATA","UINT8C","BUFFER","hasUint8C","Uint8ClampedArray","POOL","freeArrayBuffer","buffer","byteLength","log_n","log2","push","mallocArrayBuffer","pop","ArrayBuffer","mallocUint8","Uint8Array","mallocUint16","Uint16Array","mallocUint32","Uint32Array","mallocInt8","Int8Array","mallocInt16","Int16Array","Int32Array","mallocFloat","Float32Array","Float64Array","mallocUint8Clamped","mallocDataView","DataView","array","Object","toString","call","freeUint8","freeUint16","freeUint32","freeInt8","freeInt16","freeInt32","freeFloat32","freeFloat","freeFloat64","freeDouble","freeUint8Clamped","freeDataView","freeBuffer","malloc","dtype","undefined","mallocFloat32","mallocFloat64","clearCache","m","w","a0","a1","a2","b2","abs","EPSILON","len","sqrt","self","components","comps","UID","storage","systems","renderSystems","deferrals","timeout","removals","multiComps","removeComponent","entID","compName","def","data","state","hash","remove","onRemove","multi","forEach","pingDeferrals","setTimeout","deferralHandler","doDeferredCleanup","list","statesArr","splice","deferredMultiCompCleanup","flush","deferredComponentCleanup","_storage","_systems","_renderSystems","createEntity","compList","Array","isArray","addComponent","deleteEntity","keys","createComponent","compDefn","Error","name","internalDef","order","isNaN","onAdd","system","renderSystem","DataStore","_pendingMultiCleanup","_multiCleanupIDs","sort","overwriteComponent","si","indexOf","ri","baseState","getStatesList","key","__id","deleteComponent","dispose","newState","assign","hasComponent","getState","getStateAccessor","getComponentAccessor","tick","dt","comp","render","removeMultiComponent","removeMultiCompElement","initFull","xSize","xBoxes","xIndex","ySize","yBoxes","yIndex","levels","maxInts","IFRAME_SIZE","BOX_ISTACK","maxDoubles","DFRAME_SIZE","BOX_DSTACK","iterInit","iterPush","Infinity","iptr","dptr","lo","hi","full","partitionStartLessThan","partitionEndLessThanEqual","redCount","blueCount","SCAN_COMPLETE_CUTOFF","sweep","BRUTE_FORCE_CUTOFF","bruteForcePartial","SCAN_CUTOFF","red0","partitionInteriorContainsInterval","bruteForceFull","blue0","findMedian","mid","blue1","partitionStartEqual","onePointFull","onePointPartial","red1","partitionContainsPoint","redX","partitionContainsPointProper","bruteForce","partial","genPartition","blueX","r0","r1","DefaultOptions","preventDefaults","stopPropagation","allowContextMenu","disabled","GameInputs","domElement","options","version","opts","element","document","filterEvents","ev","bindingName","down","EventEmitter","up","pointerState","dx","dy","scrollx","scrolly","scrollz","pressCount","releaseCount","_keyBindmap","_keyStates","_bindPressCount","_touches","lastX","lastY","currID","_pressedDuringMeta","readyState","initEvents","addEventListener","once","bind","code","bindings","includes","unbind","getBindings","res","zeroAllProperties","inputs","onKeyEvent","pointerOpts","passive","PointerEvent","onPointerEvent","onPointerMove","onWheelEvent","onContextMenu","onWindowBlur","nowDown","handleKeyEvent","isMeta","test","metaKey","note","preventDefault","workaroundMacBug","pointerId","button","movementX","mozMovementX","movementY","mozMovementY","scale","deltaMode","clientHeight","innerHeight","deltaX","deltaY","deltaZ","XOR","pressed","counter","ct","emitter","emit","handleBindingEvent","defaultPrevented","defaultOptions","defaultBindings","Inputs","noa","super","MicroGameShell","pollTime","stickyPointerLock","stickyFullscreen","tickRate","maxRenderRate","maxTickTime","pointerLock","fullscreen","onTick","onRender","framePart","tickDur","onInit","onResize","onPointerLockChanged","hasPL","onFullscreenChanged","hasFS","onPointerLockError","err","_data","Data","fn","handler","removeEventListener","domReady","shell","dat","now","nowObject","lastTickStarted","lastFrameStarted","lastRenderStarted","frameCB","requestAnimationFrame","intervalHandler","renderAccum","frameDur","renderDt","frameHandler","intervalCB","intervalID","setInterval","setupTimers","el","setPL","want","pointerLockElement","requestPointerLock","catch","exitPointerLock","setFS","fullscreenElement","requestFullscreen","webkitRequestFullscreen","exitFullscreen","defineProperty","get","set","resizeHandler","ResizeObserver","observe","setupDomElement","performance","Date","avgTickTime","lookAhead","tickUntil","cutoffTime","after","runningAverage","avg","newVal","Container","container","canvas","domEl","querySelector","createElement","tabIndex","style","position","left","right","bottom","overflow","body","appendChild","insertBefore","firstChild","fixCanvas","off","on","doCanvasBugfix","supportsPointerLock","pointerInGame","isFocused","hasFocus","hasPointerLock","_shell","rendering","resize","listener","type","detectPointerLock","onFirstMousedown","appendTo","htmlElement","setPointerLock","lock","CameraDefaults","inverseX","inverseY","sensitivityMult","sensitivityMultOutsidePointerlock","sensitivityX","sensitivityY","initialZoom","zoomSpeed","tempVectors","originVector","Camera","heading","pitch","cameraTarget","ents","eyeOffset","getPositionData","playerEntity","entity","offset","zoomDistance","currentZoom","_dirVector","_localGetTargetPosition","pdat","_renderPosition","_localGetPosition","loc","getTargetPosition","globalCamPos","localToGlobal","getPosition","getDirection","applyInputsToCamera","senseMult","badx","lastx","bady","lasty","bugFix","conv","PI","twopi","maxPitch","dir","origin","updateBeforeEntityRenderSystems","updateAfterEntityRenderSystems","maxZoom","_sweepBox","_sweepGetVoxel","world","getBlockSolidity","_sweepVec","_sweepHit","worldOriginOffset","dist","cameraObstructionDistance","PositionState","_localPosition","_extents","eid","globalToLocal","updatePositionExtents","states","hw","lpos","ext","PhysicsState","physics","addBody","setPhysicsFromPosition","hasPosition","setPositionFromPhysics","backtrackRenderPos","removeBody","tickPos","positionInCurrentTick","tickTime","backtrackAmt","timeScale","cameraSmoothed","local","physState","posState","box","smoothed","vel","velocity","intervals","cylinder","collideBits","collideMask","callback","stateA","stateB","intervalA","intervalB","rada","radb","dz","radsum","cylinderCylinderTest","cylinderBoxTest","cylindricalHitTest","idA","idB","onPairwiseEntityCollision","handleCollision","cyl","cube","rad","cx","cz","clamp","val","entities","hasPhysics","getPhysics","onCollide","impulse","cb","getCollideTerrain","cutoff","zoom","camera","checkZoom","hasMesh","mesh","getMeshData","metadata","shouldHide","setMeshVisibility","onTargetMissing","updatePosition","updateRenderPosition","other","names","followsEntity","posDat","addMeshToScene","rpos","copyFromFloats","MovementState","running","jumping","maxSpeed","moveForce","responsiveness","runningFriction","standingFriction","airMoveMult","jumpImpulse","jumpForce","jumpTime","airJumps","_jumpCount","_currjumptime","_isJumping","phys","applyMovementPhysics","tempvec","tempvec2","zeroVec","onGround","atRestY","canjump","jf","applyForce","applyImpulse","speed","pushLen","canPush","pushAmt","friction","inputState","camHeading","setMovementState","getMovement","jump","fb","forward","backward","rl","distance","shadowDist","scene","getScene","disc","radius","tessellation","rotation","mat","makeStandardMaterial","diffuseColor","ambientColor","alpha","material","freeze","size","_mesh","createInstance","setEnabled","cpos","updateShadowHeight","spos","shadowPos","physDat","camPos","localY","resting","_localPick","round","scaling","time","shadowDistance","Entities","componentArgs","compDefs","collideEntities","collideTerrain","fadeOnZoom","movement","receivesInputs","shadow","smoothCamera","bareName","compDef","compFn","getPhysicsBody","getCollideEntities","id1","id2","_localSetPosition","setEntitySize","xs","ys","zs","_updateDerivedPositionData","_rebaseOrigin","delta","locPos","nudgePosition","addComponentAgain","isTerrainBlocked","xlocal","floor","ylocal","zlocal","blockExt","extentsOverlap","getEntitiesInAABB","withComponent","entStates","testExtents","compState","hits","meshOffset","doPhysics","smoothName","onStep","dmin","dmax","extA","extB","removeUnorderedListItem","locationHasher","ChunkStorage","getChunkByIndexes","storeChunkByIndexes","chunk","removeChunkByIndexes","LocationQueue","arr","thisArg","toFront","unshift","removeByIndex","isEmpty","empty","copyFrom","sortByDistance","locToDist","reverse","distFn","sortLocationArrByDistance","ObjectMesher","rootNode","rebaseOffset","rebuildNextTick","transformObj","allBaseMeshes","managers","getManager","registry","_blockMeshLookup","prev","geometry","objectMeshFlag","InstanceManager","initChunk","_objectBlocks","setObjectBlock","blockID","oldID","removeInstance","handlers","_blockHandlerLookup","onCreate","onCustomMeshCreate","setAll","mgr","xform","addInstance","buildObjectMeshes","profile_hook","updateMatrix","disposed","disposeChunk","rebased","dirty","capacity","keyToIndex","locToKey","parent","_objectMesher","isPickable","doNotSyncBoundingInfo","alwaysSelectAsActiveMesh","thinInstanceCount","setCapacity","transform","rebaseVec","maybeExpandBuffer","computeWorldMatrix","copyMatrixData","_localMatrix","_m","matArray","tempMatrixArray","remIndex","remLoc","tailLoc","tailIndex","tailKey","thinInstanceBufferUpdated","isVisible","newBuff","thinInstanceSetBuffer","src","srcOff","dest","destOff","TerrainMatManager","_defaultMat","allMaterials","_idCounter","_blockMatIDtoTerrainID","_terrainIDtoMatObject","_texURLtoTerrainID","_renderMatToTerrainID","Map","getTerrainMatId","blockMatID","terrID","matInfo","getMaterialData","renderMat","has","texture","url","decideTerrainMatID","matName","plainMat","texURL","sampling","NEAREST_SAMPLINGMODE","tex","texHasAlpha","hasAlpha","diffuseTexture","atlasIndex","TerrainMaterialPlugin","_textureNeedsAlpha","createTerrainMat","getMaterial","terrainMatID","_enable","_atlasTextureArray","onLoadObservable","setTextureArrayData","getSize","numLayers","_readPixelsSync","format","TEXTUREFORMAT_RGBA","mode","prepareDefines","defines","getClassName","getSamplers","samplers","getAttributes","attributes","getUniforms","ubo","bindForSubMesh","uniformBuffer","engine","subMesh","setTexture","getCustomCode","shaderType","TerrainMesher","terrainMatManager","allTerrainMaterials","_defaultMaterial","greedyMesher","GreedyMesher","meshBuilder","MeshBuilder","_terrainMeshes","meshChunk","ignoreMaterials","faceDataSet","meshes","buildMesh","cullingStrategy","CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY","freezeNormals","freezeWorldMatrix","terrainMeshFlag","MeshedFaceData","terrainID","numFaces","matIDs","dirs","is","js","ks","wids","hts","packedAO","maskCache","aoMaskCache","realGetTerrainID","fakeGetTerrainID","matID","terrainIDgetter","prepareSolidityLookup","nabVoxelsT","solidityLookupInittedSize","voxelIDtoSolidity","_solidityLookup","coordToLoc","edgeCoordLookup","missingCoordLookup","centerChunk","nab","voxTypeLookup","voxLookup","cs","edgesOnly","_isEmpty","_isFull","faceDataPool","reset","u","v","nabVoxelsArr","_neighbors","map","voxels","transpose","here","prevOff","nFaces","constructMeshMask","constructGeometryFromMasks","v1","_wholeLayerVoxel","layerVoxRef","nf","fill","voxelIsSolid","voxArray","lookup","ci","cj","ck","arrA","iA","arrB","iB","wholeLayerVoxel","shape","mask","aoMask","doAO","useAO","skipRevAo","revAoVal","aoVals","opacityLookup","_opacityLookup","getBlockFaceMaterial","materialDir","indexA","jstrideA","stride","kstrideA","indexB","jstrideB","kstrideB","facesFound","dA","dB","id0","op0","op1","m0","m1","packAOMask","len1","len2","aomask","maskCompareFcn","maskCompare","maskCompare_noAO","h","maskVal","ao","OUTER","fdFromPool","faceData","hx","wx","aoVal","addPositionValues","posArr","faceNum","du","dv","addUVs","uvArr","addNormalValues","normArr","norms","addIndexValues","indArr","triDir","baseIndex","indexVals","indexLists","atlasIndexLookup","_matAtlasIndexLookup","matColorLookup","_materialColorLookup","white","usesAtlas","atlasIndexes","indices","positions","normals","colors","uvs","f","A","B","C","D","unpackAOMask","decideTriDir","addAtlasIndices","matColor","pushMeshColors","pushMeshColors_noAO","requestID","vdat","applyToMesh","setVerticesData","_refreshBoundingInfo","col","revAo","pushAOColor","baseCol","mult","isSolid","ipos","ineg","skipReverse","defaults","texturePath","Registry","_texturePath","blockSolidity","blockOpacity","blockIsFluid","blockIsObject","blockProps","blockMeshes","blockHandlers","blockIsPlain","blockMats","matAtlasIndexLookup","matDefs","registerBlock","BlockOptions","fluid","solid","opaque","blockMesh","mats","getMaterialId","fluidDensity","viscosity","hasHandler","onLoad","onUnload","onSet","onUnset","BlockCallbackHolder","isPlain","registerMaterial","MaterialOptions","textureURL","renderMaterial","getBlockOpacity","getBlockFluidity","getBlockProps","blockId","some","_fluidityLookup","_objectLookup","_blockIsPlainLookup","reg","lazyInit","isFluid","SceneOctreeManager","blockSize","_addComponent","octreeBlock","inDynamicList","inOctreeBlock","octree","NOP","_selectionOctree","blocks","octBlocksHash","rebase","recurseRebaseBlocks","addMesh","isStatic","dynamicContent","bs","mapKey","block","gloc","makeOctreeBlock","_noaMapKey","entries","removeMesh","visible","_chunkSize","child","minPoint","subtractInPlace","maxPoint","_boundingVectors","minPt","showFPS","antiAlias","clearColor","lightDiffuse","lightSpecular","lightVector","AOmultipliers","reverseAOmultiplier","preserveDrawingBuffer","octreeBlockSize","renderOnResize","Rendering","meshingCutoffTime","light","_initScene","div","zIndex","backgroundColor","font","textAlign","minWidth","margin","longest","start","last","fps_hook","nt","fps","innerHTML","setUpFPS","detachControl","performancePriority","Intermediate","autoClear","_octreeManager","_cameraHolder","minZ","_camScreen","_camScreenMat","_camLocBlock","FromArray","lightVec","diffuse","specular","skipPointerMovePicking","cam","tgtLoc","cloc","cy","getBlock","matId","matData","checkCameraEffect","updateCameraForRender","beginFrame","endFrame","postRender","_paused","highlightBlockFace","show","_highlightMesh","hlm","backFaceCulling","emissiveColor","s","lines","points","getHighlightMesh","hlpos","slop","containingChunk","addedToSceneFlag","asArray","fromArray","onDisposeObservable","specularColor","prepareChunkForRendering","disposeChunkForRendering","dvec","isWorldMatrixFrozen","debug_SceneCheck","dyns","octs","numOcts","numSubs","materials","allmats","subMaterials","isDisposed","warn","getIndices","missing","subMeshes","unusedMats","used","console","join","avgPerOct","msg","list1","list2","log","debug_MeshCount","replace","substr","RigidBody","_aabb","mass","restitution","gravMult","autoStep","gravityMultiplier","airDrag","fluidDrag","inFluid","_ratioInFluid","_forces","_impulses","_sleepFrameCount","p","sanityCheck","_markActive","atRestX","atRestZ","gravity","minBounceImpulse","testSolid","testFluid","bodies","impacts","oldResting","noGravity","equals","isResting","gmult","sleepVec","bodyAsleep","ratioInFluid","submerged","displaced","_fluidVec","applyFluidForces","applyFrictionByAxis","drag","cloneAABB","tmpBox","processCollisions","oldBox","xBlocked","zBlocked","ratio","targetPos","getVoxels","ydist","upvec","collided","leftover","tmpResting","tryAutoStepping","iterateBody","dvel","restDir","vNormal","lateralVel","vCurr","dvMax","scaler","tgt","Physics","solidLookup","fluidLookup","getBlockID","Chunk","dataArray","fillVoxelID","userData","_terrainDirty","_objectsDirty","_terrainMesher","narr","from","_neighborCount","_timesMeshed","_blockHandlerLocs","scanVoxelData","callBlockHandler","opaqueLookup","handlerLookup","objectLookup","plainLookup","objMesher","fullyOpaque","fullyAir","layerID","constantID","callAllBlockHandlers","_createVoxelArray","_updateVoxelArray","getSolidityAt","newID","hold","hnew","objOld","objNew","solidityChanged","opacityChanged","wasTerrain","nowTerrain","_queueChunkForRemesh","edge","jmin","kmin","imax","jmax","kmax","ni","nj","nk","updateMeshes","chunkSize","chunkAddDistance","chunkRemoveDistance","worldGenWhilePaused","manuallyControlChunkLoading","World","playerChunkLoaded","chunkSortingDistFn","defaultSortDistance","minNeighborsToMesh","maxChunksPendingCreation","maxChunksPendingMeshing","maxProcessingPerTick","maxProcessingPerRender","_chunkAddDistance","_chunkRemoveDistance","_addDistanceFn","_remDistanceFn","_prevWorldName","_prevPlayerChunkHash","_chunkAddSearchFrom","_prevSortingFn","_sortMeshQueueEvery","_chunksKnown","_chunksToRequest","_chunksInvalidated","_chunksToRemove","_chunksPending","_chunksToMesh","_chunksToMeshFirst","_chunksSortedLocs","setAddRemoveDistance","_coordsToChunkIndexes","chunkCoordsToIndexesGeneral","_coordsToChunkLocals","chunkCoordsToLocalsGeneral","_coordShiftBits","_coordMask","chunkCoordsToIndexesPowerOfTwo","chunkCoordsToLocalsPowerOfTwo","getBlockProperties","setBlockID","isBoxUnobstructed","setChunkData","reqID","split","parseInt","shift","worldName","possiblyQueueChunkForMeshing","updateNeighborsOfChunk","profile_queues_hook","addDist","remDist","addArr","remArr","makeDistanceTestFunction","invalidateVoxelsInAABB","Number","isFinite","invalidateChunksInBox","manuallyLoadChunk","manualErr","manuallyUnloadChunk","getPlayerChunkIndexes","tickStartTime","chunkLocHash","sortQueueByDistanceFrom","processRemoveQueue","distCheck","toRemove","numQueued","knownArr","maxIter","found","removeCheckIndex","findDistantChunksToRemove","toRequest","sortDistFn","locsArr","di","dj","dk","checkReflectedLocations","findChunksToRequest","meshCheckIndex","findChunksToMesh","t1","done1","done2","done3","processRequestQueue","processMeshingQueue","pChunk","_getChunkByCoords","checkOneLocation","pending","toMesh","dataArr","requestNewChunk","removeChunk","firstOnly","doChunkRemesh","pi","pj","pk","terrainChanged","neighbor","nabRef","xsize","ysize","asq","bsq","dxsq","_report","exist","surrounded","remeshes","padEnd","sum","reduce","acc","toFixed","report","every","title","filter","times","started","iter","total","makeProfileHook","debug","silent","silentBabylon","playerHeight","playerWidth","playerStart","playerAutoStep","playerShadowComponent","blockTestDistance","dragCameraOutsidePointerLock","skipDefaultHighlighting","originRebaseDistance","Engine","debugstr","_originRebaseDistance","_consoleLog","blockTargetIdCheck","targetedBlock","defaultBlockHighlightFunction","normal","_targetedBlockDat","adjacent","_prevTargetHash","_pickPos","_pickResult","ndarray","win","ver","dep","throwFn","deprecateStuff","checkWorldOffset","newhash","blockIdFn","result","norm","updateBlockTargets","pst","profile_hook_render","setPaused","paused","setBlock","addBlock","global","globalPrecise","coord","floored","pick","blockTestFunction","pickPos","testFn","rnorm","context","grassPaths","error","grassTexture","random","dirtID","grassID","stoneID","getVoxelID","player","scroll","arg","l","end","boxes","ids","pivot","value","PARTITION_THRESHOLD","insertionSort","pivot0","value0","pivot1","value1","pivot2","value2","aPtr","bPtr","boxPtr","tmp","tr_arr","ldi_arr","tri_arr","step_arr","tDelta_arr","tNext_arr","vec_arr","normed_arr","base_arr","max_arr","left_arr","result_arr","getVoxel","noTranslate","epsilon","tr","ldi","tri","step","tDelta","tNext","normed","cumulative_t","max_t","initSweep","stepForward","checkCollision","lead","leadEdgeToInt","trailEdgeToInt","i_axis","stepx","stepy","stepz","done","sweep_impl","angle","exactEquals","sub","multiply","mul","divide","ceil","scaleAndAdd","squaredDistance","sqrDist","squaredLength","sqrLen","negate","inverse","cross","lerp","transformMat4","transformMat3","transformQuat","rotateX","rotateY","rotateZ","webpackContext","req","webpackContextResolve","__webpack_require__","o","resolve","predicate","args","fargs","concat","reads","Function","apply","iota","hasTypedArrays","compare1st","terms","compileConstructor","dimension","className","useGetters","procedure","CACHED_CONSTRUCTORS","index_str","shapeArg","strideArg","a_vars","c_vars","tShape","tStride","ctor","sz","arrayDType","ctor_list","direction","max_d","hit_pos","hit_norm","ds","txDelta","tyDelta","tzDelta","txMax","tyMax","tzMax","steppedIndex","traceRay_impl","ARGS","bruteForcePlanner","funcName","prefix","invoke","redMajor","redLoop","blueLoop","generateBruteForce","codeStr","proc","removeElement","_map","swapped","prevIndex","swapID","swappedID","_pendingRemovals","stateObject","r","zScale","countTrailingZeros","INT_BITS","INT_MAX","INT_MIN","sign","isPow2","log10","popCount","prevPow2","parity","REVERSE_TABLE","tab","interleave2","deinterleave2","interleave3","deinterleave3","nextCombination","ReflectOwnKeys","R","Reflect","ReflectApply","target","receiver","ownKeys","getOwnPropertySymbols","getOwnPropertyNames","NumberIsNaN","Promise","reject","errorListener","removeListener","resolver","arguments","eventTargetAgnosticAddListener","addErrorHandlerIfEventEmitter","_events","_eventsCount","_maxListeners","defaultMaxListeners","checkListener","TypeError","_getMaxListeners","that","_addListener","prepend","events","existing","warning","newListener","warned","String","onceWrapper","fired","wrapFn","_onceWrap","wrapped","_listeners","unwrap","evlistener","ret","unwrapListeners","arrayClone","listenerCount","flags","wrapListener","enumerable","RangeError","getPrototypeOf","setMaxListeners","getMaxListeners","doError","er","message","listeners","addListener","prependListener","prependOnceListener","originalListener","spliceOne","removeAllListeners","rawListeners","eventNames","n0","INSERT_SORT_CUTOFF","quickSort","jptr","swap","move","rotate","shufflePivot","compare","comparePivot","sixth","index1","index5","index3","index2","index4","el1","el2","el3","el4","el5","less","great","pivot1X","pivot1Y","pivot2X","pivot2Y","ptr0","ptr2","ptr4","ptr5","ptr6","ptr7","i1","arg0","arg1","arg2","RESULT","boxIntersect","appendItem","intersectBipartiteArray","boxIntersectIter","boxEmpty","convertBoxes","redList","redIds","blueList","blueIds","dupe_array","dupe_number","__webpack_module_cache__","moduleId","cachedModule","__webpack_modules__","O","chunkIds","priority","notFulfilled","fulfilled","getter","__esModule","definition","prop","hasOwnProperty","scriptUrl","importScripts","location","currentScript","tagName","toUpperCase","scripts","getElementsByTagName","installedChunks","chunkId","webpackJsonpCallback","parentChunkLoadingFunction","moreModules","runtime","chunkLoadingGlobal","__webpack_exports__"],"sourceRoot":""}