/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var e,t={49:()=>{window&&!window.global&&(window.global=window.globalThis||{})},193:e=>{e.exports=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}},277:e=>{e.exports=function(e,t,r,n){var i=t[0],s=t[1],o=t[2];return e[0]=i+n*(r[0]-i),e[1]=s+n*(r[1]-s),e[2]=o+n*(r[2]-o),e}},371:(e,t,r)=>{"use strict";e.exports=r.p+"textures/grass_007_score0.0283.png"},380:(e,t,r)=>{"use strict";e.exports=r.p+"textures/grass_008_score0.0294.png"},461:e=>{e.exports=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}},645:(e,t,r)=>{e.exports=function(e,t){var r=n(e[0],e[1],e[2]),o=n(t[0],t[1],t[2]);i(r,r),i(o,o);var a=s(r,o);return a>1?0:Math.acos(a)};var n=r(4246),i=r(3201),s=r(4081)},664:(e,t,r)=>{e.exports=r(704)},689:(e,t,r)=>{"use strict";e.exports=r.p+"textures/grass_013_score0.0299.png"},704:e=>{e.exports=function(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return r*r+n*n+i*i}},720:e=>{e.exports=function(e,t,r,n){var i=r[0],s=r[2],o=t[0]-i,a=t[2]-s,h=Math.sin(n),u=Math.cos(n);return e[0]=i+a*h+o*u,e[1]=t[1],e[2]=s+a*u-o*h,e}},937:(e,t,r)=>{e.exports=i;var n=r(5530);function i(e,t){if(!(this instanceof i))return new i(e,t);var r=n.create();n.add(r,e,t),this.base=n.min(n.create(),e,r),this.vec=n.clone(t),this.max=n.max(n.create(),e,r),this.mag=n.length(this.vec)}var s=i.prototype;s.width=function(){return this.vec[0]},s.height=function(){return this.vec[1]},s.depth=function(){return this.vec[2]},s.x0=function(){return this.base[0]},s.y0=function(){return this.base[1]},s.z0=function(){return this.base[2]},s.x1=function(){return this.max[0]},s.y1=function(){return this.max[1]},s.z1=function(){return this.max[2]},s.translate=function(e){return n.add(this.max,this.max,e),n.add(this.base,this.base,e),this},s.setPosition=function(e){return n.add(this.max,e,this.vec),n.copy(this.base,e),this},s.expand=function(e){var t=n.create(),r=n.create();return n.max(t,e.max,this.max),n.min(r,e.base,this.base),n.subtract(t,t,r),new i(r,t)},s.intersects=function(e){return!(e.base[0]>this.max[0]||e.base[1]>this.max[1]||e.base[2]>this.max[2]||e.max[0]<this.base[0]||e.max[1]<this.base[1]||e.max[2]<this.base[2])},s.touches=function(e){var t=this.union(e);return null!==t&&(0==t.width()||0==t.height()||0==t.depth())},s.union=function(e){if(!this.intersects(e))return null;var t=Math.max(e.base[0],this.base[0]),r=Math.max(e.base[1],this.base[1]),n=Math.max(e.base[2],this.base[2]);return new i([t,r,n],[Math.min(e.max[0],this.max[0])-t,Math.min(e.max[1],this.max[1])-r,Math.min(e.max[2],this.max[2])-n])}},1095:(e,t,r)=>{"use strict";e.exports=r.p+"textures/grass_014_score0.0294.png"},1227:e=>{e.exports=function(e){var t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n}},1365:e=>{e.exports=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}},1609:e=>{e.exports=function(e,t,r,n){var i=r[0],s=r[1],o=t[0]-i,a=t[1]-s,h=Math.sin(n),u=Math.cos(n);return e[0]=i+o*u-a*h,e[1]=s+o*h+a*u,e[2]=t[2],e}},1659:(e,t,r)=>{"use strict";e.exports=r.p+"textures/grass_003_score0.0261.png"},1749:(e,t,r)=>{"use strict";e.exports=r.p+"textures/grass_004_score0.0268.png"},1932:(e,t,r)=>{e.exports=r(5764)},1959:(e,t,r)=>{"use strict";e.exports=r.p+"textures/grass_015_score0.0295.png"},2050:(e,t,r)=>{"use strict";e.exports={init:function(e){var t=i.nextPow2(e);h.length<t&&(n.free(h),h=n.mallocInt32(t)),u.length<t&&(n.free(u),u=n.mallocInt32(t)),c.length<t&&(n.free(c),c=n.mallocInt32(t)),l.length<t&&(n.free(l),l=n.mallocInt32(t)),d.length<t&&(n.free(d),d=n.mallocInt32(t)),f.length<t&&(n.free(f),f=n.mallocInt32(t));var r=8*t;p.length<r&&(n.free(p),p=n.mallocDouble(r))},sweepBipartite:function(e,t,r,n,i,a,d,f,g,y){for(var _=0,b=2*e,k=e-1,w=b-1,x=r;x<n;++x){var M=a[x],C=b*x;p[_++]=i[C+k],p[_++]=-(M+1),p[_++]=i[C+w],p[_++]=M}for(x=d;x<f;++x){M=y[x]+o;var P=b*x;p[_++]=g[P+k],p[_++]=-M,p[_++]=g[P+w],p[_++]=M}var T=_>>>1;s(p,T);var I=0,D=0;for(x=0;x<T;++x){var A=0|p[2*x+1];if(A>=o)v(c,l,D--,A=A-o|0);else if(A>=0)v(h,u,I--,A);else if(A<=-o){A=-A-o|0;for(var E=0;E<I;++E)if(void 0!==(S=t(h[E],A)))return S;m(c,l,D++,A)}else{for(A=-A-1|0,E=0;E<D;++E){var S;if(void 0!==(S=t(A,c[E])))return S}m(h,u,I++,A)}}},sweepComplete:function(e,t,r,n,i,o,a,g,y,_){for(var b=0,k=2*e,w=e-1,x=k-1,M=r;M<n;++M){var C=o[M]+1<<1,P=k*M;p[b++]=i[P+w],p[b++]=-C,p[b++]=i[P+x],p[b++]=C}for(M=a;M<g;++M){C=_[M]+1<<1;var T=k*M;p[b++]=y[T+w],p[b++]=1|-C,p[b++]=y[T+x],p[b++]=1|C}var I=b>>>1;s(p,I);var D=0,A=0,E=0;for(M=0;M<I;++M){var S=0|p[2*M+1],L=1&S;if(M<I-1&&S>>1==p[2*M+3]>>1&&(L=2,M+=1),S<0){for(var F=-(S>>1)-1,R=0;R<E;++R)if(void 0!==(B=t(d[R],F)))return B;if(0!==L)for(R=0;R<D;++R)if(void 0!==(B=t(h[R],F)))return B;if(1!==L)for(R=0;R<A;++R){var B;if(void 0!==(B=t(c[R],F)))return B}0===L?m(h,u,D++,F):1===L?m(c,l,A++,F):2===L&&m(d,f,E++,F)}else F=(S>>1)-1,0===L?v(h,u,D--,F):1===L?v(c,l,A--,F):2===L&&v(d,f,E--,F)}},scanBipartite:function(e,t,r,n,i,a,c,l,d,f,g,y){var _=0,b=2*e,k=t,w=t+e,x=1,M=1;n?M=o:x=o;for(var C=i;C<a;++C){var P=C+x,T=b*C;p[_++]=c[T+k],p[_++]=-P,p[_++]=c[T+w],p[_++]=P}for(C=d;C<f;++C){P=C+M;var I=b*C;p[_++]=g[I+k],p[_++]=-P}var D=_>>>1;s(p,D);var A=0;for(C=0;C<D;++C){var E=0|p[2*C+1];if(E<0){var S=!1;if((P=-E)>=o?(S=!n,P-=o):(S=!!n,P-=1),S)m(h,u,A++,P);else{var L=y[P],F=b*P,R=g[F+t+1],B=g[F+t+1+e];e:for(var j=0;j<A;++j){var O=h[j],z=b*O;if(!(B<c[z+t+1]||c[z+t+1+e]<R)){for(var U=t+2;U<e;++U)if(g[F+U+e]<c[z+U]||c[z+U+e]<g[F+U])continue e;var N,V=l[O];if(void 0!==(N=n?r(L,V):r(V,L)))return N}}}}else v(h,u,A--,E-x)}},scanComplete:function(e,t,r,n,i,a,u,c,l,d,f){for(var v=0,m=2*e,g=t,y=t+e,_=n;_<i;++_){var b=_+o,k=m*_;p[v++]=a[k+g],p[v++]=-b,p[v++]=a[k+y],p[v++]=b}for(_=c;_<l;++_){b=_+1;var w=m*_;p[v++]=d[w+g],p[v++]=-b}var x=v>>>1;s(p,x);var M=0;for(_=0;_<x;++_){var C=0|p[2*_+1];if(C<0)if((b=-C)>=o)h[M++]=b-o;else{var P=f[b-=1],T=m*b,I=d[T+t+1],D=d[T+t+1+e];e:for(var A=0;A<M;++A){var E=h[A],S=u[E];if(S===P)break;var L=m*E;if(!(D<a[L+t+1]||a[L+t+1+e]<I)){for(var F=t+2;F<e;++F)if(d[T+F+e]<a[L+F]||a[L+F+e]<d[T+F])continue e;var R=r(S,P);if(void 0!==R)return R}}}else{for(b=C-o,A=M-1;A>=0;--A)if(h[A]===b){for(F=A+1;F<M;++F)h[F-1]=h[F];break}--M}}}};var n=r(2461),i=r(7317),s=r(8116),o=1<<28,a=1024,h=n.mallocInt32(a),u=n.mallocInt32(a),c=n.mallocInt32(a),l=n.mallocInt32(a),d=n.mallocInt32(a),f=n.mallocInt32(a),p=n.mallocDouble(8192);function v(e,t,r,n){var i=t[n],s=e[r-1];e[i]=s,t[s]=i}function m(e,t,r,n){e[r]=n,t[n]=r}},2070:e=>{e.exports=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}},2081:e=>{e.exports=function(e,t,r){var n=t[0],i=t[1],s=t[2],o=r[0],a=r[1],h=r[2],u=r[3],c=u*n+a*s-h*i,l=u*i+h*n-o*s,d=u*s+o*i-a*n,f=-o*n-a*i-h*s;return e[0]=c*u+f*-o+l*-h-d*-a,e[1]=l*u+f*-a+d*-o-c*-h,e[2]=d*u+f*-h+c*-a-l*-o,e}},2149:e=>{function t(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(t(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&t(e.slice(0,0))}(e)||!!e._isBuffer)}},2461:(e,t,r)=>{"use strict";var n=r(7317),i=r(9463),s=r(5262);r.g.__TYPEDARRAY_POOL||(r.g.__TYPEDARRAY_POOL={UINT8:i([32,0]),UINT16:i([32,0]),UINT32:i([32,0]),INT8:i([32,0]),INT16:i([32,0]),INT32:i([32,0]),FLOAT:i([32,0]),DOUBLE:i([32,0]),DATA:i([32,0]),UINT8C:i([32,0]),BUFFER:i([32,0])});var o="undefined"!=typeof Uint8ClampedArray,a=r.g.__TYPEDARRAY_POOL;a.UINT8C||(a.UINT8C=i([32,0])),a.BUFFER||(a.BUFFER=i([32,0]));var h=a.DATA,u=a.BUFFER;function c(e){if(e){var t=e.length||e.byteLength,r=n.log2(t);h[r].push(e)}}function l(e){e=n.nextPow2(e);var t=n.log2(e),r=h[t];return r.length>0?r.pop():new ArrayBuffer(e)}function d(e){return new Uint8Array(l(e),0,e)}function f(e){return new Uint16Array(l(2*e),0,e)}function p(e){return new Uint32Array(l(4*e),0,e)}function v(e){return new Int8Array(l(e),0,e)}function m(e){return new Int16Array(l(2*e),0,e)}function g(e){return new Int32Array(l(4*e),0,e)}function y(e){return new Float32Array(l(4*e),0,e)}function _(e){return new Float64Array(l(8*e),0,e)}function b(e){return o?new Uint8ClampedArray(l(e),0,e):d(e)}function k(e){return new DataView(l(e),0,e)}t.free=function(e){if(s(e))u[n.log2(e.length)].push(e);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(e)&&(e=e.buffer),!e)return;var t=e.length||e.byteLength,r=0|n.log2(t);h[r].push(e)}},t.freeUint8=t.freeUint16=t.freeUint32=t.freeInt8=t.freeInt16=t.freeInt32=t.freeFloat32=t.freeFloat=t.freeFloat64=t.freeDouble=t.freeUint8Clamped=t.freeDataView=function(e){c(e.buffer)},t.freeArrayBuffer=c,t.freeBuffer=function(e){u[n.log2(e.length)].push(e)},t.malloc=function(e,t){if(void 0===t||"arraybuffer"===t)return l(e);switch(t){case"uint8":return d(e);case"uint16":return f(e);case"uint32":return p(e);case"int8":return v(e);case"int16":return m(e);case"int32":return g(e);case"float":case"float32":return y(e);case"double":case"float64":return _(e);case"uint8_clamped":return b(e);case"buffer":throw"Buffer not supported";case"data":case"dataview":return k(e);default:return null}return null},t.mallocArrayBuffer=l,t.mallocUint8=d,t.mallocUint16=f,t.mallocUint32=p,t.mallocInt8=v,t.mallocInt16=m,t.mallocInt32=g,t.mallocFloat32=t.mallocFloat=y,t.mallocFloat64=t.mallocDouble=_,t.mallocUint8Clamped=b,t.mallocDataView=k,t.clearCache=function(){for(var e=0;e<32;++e)a.UINT8[e].length=0,a.UINT16[e].length=0,a.UINT32[e].length=0,a.INT8[e].length=0,a.INT16[e].length=0,a.INT32[e].length=0,a.FLOAT[e].length=0,a.DOUBLE[e].length=0,a.UINT8C[e].length=0,h[e].length=0,u[e].length=0}},2608:e=>{e.exports=function(e,t,r){var n=t[0],i=t[1],s=t[2],o=r[3]*n+r[7]*i+r[11]*s+r[15];return o=o||1,e[0]=(r[0]*n+r[4]*i+r[8]*s+r[12])/o,e[1]=(r[1]*n+r[5]*i+r[9]*s+r[13])/o,e[2]=(r[2]*n+r[6]*i+r[10]*s+r[14])/o,e}},2761:(e,t,r)=>{e.exports=function(e,t){var r=e[0],i=e[1],s=e[2],o=t[0],a=t[1],h=t[2];return Math.abs(r-o)<=n*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=n*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(s-h)<=n*Math.max(1,Math.abs(s),Math.abs(h))};var n=r(6328)},2864:e=>{e.exports=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}},2919:e=>{e.exports=function(e){var t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}},3109:e=>{e.exports=function(e,t,r){var n=t[0],i=t[1],s=t[2];return e[0]=n*r[0]+i*r[3]+s*r[6],e[1]=n*r[1]+i*r[4]+s*r[7],e[2]=n*r[2]+i*r[5]+s*r[8],e}},3201:e=>{e.exports=function(e,t){var r=t[0],n=t[1],i=t[2],s=r*r+n*n+i*i;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s),e}},3274:(e,t,r)=>{e.exports=function(){var e=this;this.components={},this.comps=this.components;var t=this.components,r=1,i={},s=[],o=[],a={timeout:!1,removals:[],multiComps:[]};function h(e,r){var n=t[r],s=i[r],o=s.hash[e];o&&(s.remove(e),n.onRemove&&(n.multi?(o.forEach(t=>{t&&n.onRemove(e,t)}),o.length=0):n.onRemove(e,o)),a.removals.push(s),u())}function u(){a.timeout||(a.timeout=!0,setTimeout(c,1))}function c(){a.timeout=!1,l()}function l(){a.multiComps.length&&function(e){for(var t=0;t<e.length;t++){var{entID:r,data:n}=e[t],i=n.hash[r];if(i){for(var s=0;s<i.length;s++)i[s]||(i.splice(s,1),s--);0===i.length&&(n.remove(r),a.removals.push(n))}}e.length=0}(a.multiComps),a.removals.length&&function(e){for(var t=0;t<e.length;t++)e[t].flush();e.length=0}(a.removals)}this._storage=i,this._systems=s,this._renderSystems=o,this.createEntity=function(t){var n=r++;return Array.isArray(t)&&t.forEach(t=>e.addComponent(n,t)),n},this.deleteEntity=function(t){return Object.keys(i).forEach(e=>{i[e].hash[t]&&h(t,e)}),e},this.createComponent=function(e){if(!e)throw new Error("Missing component definition");var r=e.name;if(!r)throw new Error("Component definition must have a name property.");if("string"!=typeof r)throw new Error("Component name must be a string.");if(""===r)throw new Error("Component name must be a non-empty string.");if(i[r])throw new Error(`Component ${r} already exists.`);var a={};return a.name=r,a.multi=!!e.multi,a.order=isNaN(e.order)?99:e.order,a.state=e.state||{},a.onAdd=e.onAdd||null,a.onRemove=e.onRemove||null,a.system=e.system||null,a.renderSystem=e.renderSystem||null,t[r]=a,i[r]=new n,i[r]._pendingMultiCleanup=!1,i[r]._multiCleanupIDs=a.multi?[]:null,a.system&&(s.push(r),s.sort((e,r)=>t[e].order-t[r].order)),a.renderSystem&&(o.push(r),o.sort((e,r)=>t[e].order-t[r].order)),r},this.overwriteComponent=function(e,r){var n=t[e];if(!n)throw new Error(`Unknown component: ${e}`);if(!r)throw new Error("Missing component definition");if(n.name!==r.name)throw new Error("Overwriting component must use the same name property.");var a={};a.name=e,a.multi=!!r.multi,a.order=isNaN(r.order)?99:r.order,a.state=r.state||{},a.onAdd=r.onAdd||null,a.onRemove=r.onRemove||null,a.system=r.system||null,a.renderSystem=r.renderSystem||null,t[e]=a,i[e]._pendingMultiCleanup=!1,i[e]._multiCleanupIDs=a.multi?[]:null;var h=s.indexOf(e);a.system&&h<0&&s.push(e),!a.system&&h>=0&&s.splice(h,1),s.sort((e,r)=>t[e].order-t[r].order);var u=o.indexOf(e);a.renderSystem&&u<0&&o.push(e),!a.renderSystem&&u>=0&&o.splice(u,1),o.sort((e,r)=>t[e].order-t[r].order);var c=a.state;return this.getStatesList(e).forEach(e=>{for(var t in c)t in e||(e[t]=c[t]);a.onAdd&&a.onAdd(e.__id,e)}),e},this.deleteComponent=function(r){var n=i[r];if(!n)throw new Error(`Unknown component: ${r}`);n.flush(),n.list.forEach(e=>{e&&h(e.__id||e[0].__id,r)});var a=s.indexOf(r),u=o.indexOf(r);return a>-1&&s.splice(a,1),u>-1&&o.splice(u,1),i[r].dispose(),delete i[r],delete t[r],e},this.addComponent=function(e,r,n){var s=t[r],o=i[r];if(!o)throw new Error(`Unknown component: ${r}.`);if(o.hash[e]&&!s.multi)throw new Error(`Entity ${e} already has component: ${r}.`);var a=Object.assign({},{__id:e},s.state,n);if(a.__id=e,s.multi){var h=o.hash[e];h||(h=[],o.add(e,h)),h.push(a)}else o.add(e,a);return s.onAdd&&s.onAdd(e,a),this},this.hasComponent=function(e,t){var r=i[t];if(!r)throw new Error(`Unknown component: ${t}.`);return!!r.hash[e]},this.removeComponent=function(t,r){if(!i[r])throw new Error(`Unknown component: ${r}.`);return h(t,r),e},this.getState=function(e,t){var r=i[t];if(!r)throw new Error(`Unknown component: ${t}.`);return r.hash[e]},this.getStatesList=function(e){var t=i[e];if(!t)throw new Error(`Unknown component: ${e}.`);return l(),t.list},this.getStateAccessor=function(e){if(!i[e])throw new Error(`Unknown component: ${e}.`);var t=i[e].hash;return e=>t[e]},this.getComponentAccessor=function(e){if(!i[e])throw new Error(`Unknown component: ${e}.`);var t=i[e].hash;return e=>!!t[e]},this.tick=function(r){l();for(var n=0;n<s.length;n++){var o=s[n],a=t[o],h=i[o];a.system(r,h.list),l()}return e},this.render=function(r){l();for(var n=0;n<o.length;n++){var s=o[n],a=t[s],h=i[s];a.renderSystem(r,h.list),l()}return e},this.removeMultiComponent=function(r,n,s){var o=t[n],h=i[n];if(!h)throw new Error(`Unknown component: ${n}.`);if(!o.multi)throw new Error("removeMultiComponent called on non-multi component");return function(e,t,r,n){var i=r.hash[e];if(i){var s=i[n];s&&(i[n]=null,t.onRemove&&t.onRemove(e,s),a.multiComps.push({entID:e,data:r}),u())}}(r,o,h,s),e}};var n=r(6534)},3515:e=>{e.exports=function(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(r*r+n*n+i*i)}},3526:(e,t,r)=>{"use strict";e.exports=r.p+"textures/grass_012_score0.0288.png"},3592:e=>{e.exports=function(){var e=new Float32Array(3);return e[0]=0,e[1]=0,e[2]=0,e}},3795:(e,t,r)=>{"use strict";e.exports=r.p+"textures/grass_010_score0.0294.png"},3824:e=>{e.exports=function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}},4081:e=>{e.exports=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}},4118:e=>{e.exports=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}},4123:(e,t,r)=>{"use strict";e.exports=function(e,t,r,s,c,T,I,D,A){!function(e,t){var r=8*i.log2(t+1)*(e+1)|0,s=i.nextPow2(b*r);w.length<s&&(n.free(w),w=n.mallocInt32(s));var o=i.nextPow2(k*r);x.length<o&&(n.free(x),x=n.mallocDouble(o))}(e,s+I);var E,S=0,L=2*e;for(M(S++,0,0,s,0,I,r?16:0,-1/0,1/0),r||M(S++,0,0,I,0,s,1,-1/0,1/0);S>0;){var F=(S-=1)*b,R=w[F],B=w[F+1],j=w[F+2],O=w[F+3],z=w[F+4],U=w[F+5],N=S*k,V=x[N],q=x[N+1],H=1&U,G=!!(16&U),K=c,$=T,Y=D,Z=A;if(H&&(K=D,$=A,Y=c,Z=T),!(2&U&&B>=(j=m(e,R,B,j,K,$,q))||4&U&&(B=g(e,R,B,j,K,$,V))>=j)){var W=j-B,X=z-O;if(G){if(e*W*(W+X)<f){if(void 0!==(E=h.scanComplete(e,R,t,B,j,K,$,O,z,Y,Z)))return E;continue}}else{if(e*Math.min(W,X)<l){if(void 0!==(E=o(e,R,t,H,B,j,K,$,O,z,Y,Z)))return E;continue}if(e*W*X<d){if(void 0!==(E=h.scanBipartite(e,R,t,H,B,j,K,$,O,z,Y,Z)))return E;continue}}var Q=p(e,R,B,j,K,$,V,q);if(B<Q)if(e*(Q-B)<l){if(void 0!==(E=a(e,R+1,t,B,Q,K,$,O,z,Y,Z)))return E}else if(R===e-2){if(void 0!==(E=H?h.sweepBipartite(e,t,O,z,Y,Z,B,Q,K,$):h.sweepBipartite(e,t,B,Q,K,$,O,z,Y,Z)))return E}else M(S++,R+1,B,Q,O,z,H,-1/0,1/0),M(S++,R+1,O,z,B,Q,1^H,-1/0,1/0);if(Q<j){var J=u(e,R,O,z,Y,Z),ee=Y[L*J+R],te=v(e,R,J,z,Y,Z,ee);if(te<z&&M(S++,R,Q,j,te,z,(4|H)+(G?16:0),ee,q),O<J&&M(S++,R,Q,j,O,J,(2|H)+(G?16:0),V,ee),J+1===te){if(void 0!==(E=G?P(e,R,t,Q,j,K,$,J,Y,Z[J]):C(e,R,t,H,Q,j,K,$,J,Y,Z[J])))return E}else if(J<te){var re;if(G){if(Q<(re=y(e,R,Q,j,K,$,ee))){var ne=v(e,R,Q,re,K,$,ee);if(R===e-2){if(Q<ne&&void 0!==(E=h.sweepComplete(e,t,Q,ne,K,$,J,te,Y,Z)))return E;if(ne<re&&void 0!==(E=h.sweepBipartite(e,t,ne,re,K,$,J,te,Y,Z)))return E}else Q<ne&&M(S++,R+1,Q,ne,J,te,16,-1/0,1/0),ne<re&&(M(S++,R+1,ne,re,J,te,0,-1/0,1/0),M(S++,R+1,J,te,ne,re,1,-1/0,1/0))}}else Q<(re=H?_(e,R,Q,j,K,$,ee):y(e,R,Q,j,K,$,ee))&&(R===e-2?E=H?h.sweepBipartite(e,t,J,te,Y,Z,Q,re,K,$):h.sweepBipartite(e,t,Q,re,K,$,J,te,Y,Z):(M(S++,R+1,Q,re,J,te,H,-1/0,1/0),M(S++,R+1,J,te,Q,re,1^H,-1/0,1/0)))}}}}};var n=r(2461),i=r(7317),s=r(6426),o=s.partial,a=s.full,h=r(2050),u=r(4846),c=r(5640),l=128,d=1<<22,f=1<<22,p=c("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),v=c("lo===p0",["p0"]),m=c("lo<p0",["p0"]),g=c("hi<=p0",["p0"]),y=c("lo<=p0&&p0<=hi",["p0"]),_=c("lo<p0&&p0<=hi",["p0"]),b=6,k=2,w=n.mallocInt32(1024),x=n.mallocDouble(1024);function M(e,t,r,n,i,s,o,a,h){var u=b*e;w[u]=t,w[u+1]=r,w[u+2]=n,w[u+3]=i,w[u+4]=s,w[u+5]=o;var c=k*e;x[c]=a,x[c+1]=h}function C(e,t,r,n,i,s,o,a,h,u,c){var l=2*e,d=h*l,f=u[d+t];e:for(var p=i,v=i*l;p<s;++p,v+=l){var m=o[v+t],g=o[v+t+e];if(!(f<m||g<f||n&&f===m)){for(var y,_=a[p],b=t+1;b<e;++b){m=o[v+b],g=o[v+b+e];var k=u[d+b],w=u[d+b+e];if(g<k||w<m)continue e}if(void 0!==(y=n?r(c,_):r(_,c)))return y}}}function P(e,t,r,n,i,s,o,a,h,u){var c=2*e,l=a*c,d=h[l+t];e:for(var f=n,p=n*c;f<i;++f,p+=c){var v=o[f];if(v!==u){var m=s[p+t],g=s[p+t+e];if(!(d<m||g<d)){for(var y=t+1;y<e;++y){m=s[p+y],g=s[p+y+e];var _=h[l+y],b=h[l+y+e];if(g<_||b<m)continue e}var k=r(v,u);if(void 0!==k)return k}}}}},4144:(e,t,r)=>{e.exports=r(3515)},4217:(e,t,r)=>{"use strict";e.exports=r.p+"textures/grass_009_score0.0298.png"},4246:e=>{e.exports=function(e,t,r){var n=new Float32Array(3);return n[0]=e,n[1]=t,n[2]=r,n}},4290:e=>{e.exports=function(e,t,r){var n=t[0],i=t[1],s=t[2],o=r[0],a=r[1],h=r[2];return e[0]=i*h-s*a,e[1]=s*o-n*h,e[2]=n*a-i*o,e}},4517:(e,t,r)=>{"use strict";r(49);var n=r(7975),i=r.n(n),s=r(5530),o=r.n(s),a=r(5991),h=r.n(a),u=r(6084),c=r.n(u);function l(){this.preventDefaults=!1,this.stopPropagation=!1,this.allowContextMenu=!1,this.disabled=!1}class d{constructor(e,t){this.version="0.8.0";var r=Object.assign({},new l,t||{});this.element=e||document,this.preventDefaults=!!r.preventDefaults,this.stopPropagation=!!r.stopPropagation,this.allowContextMenu=!!r.allowContextMenu,this.disabled=!!r.disabled,this.filterEvents=(e,t)=>!0,this.down=new n.EventEmitter,this.up=new n.EventEmitter,this.state={},this.pointerState={dx:0,dy:0,scrollx:0,scrolly:0,scrollz:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},this._pressedDuringMeta={},"loading"!==document.readyState?p(this):document.addEventListener("DOMContentLoaded",e=>{p(this)},{once:!0})}bind(e,...t){t.forEach(t=>{var r=this._keyBindmap[t]||[];r.includes(e)||(r.push(e),this._keyBindmap[t]=r)}),this.state[e]=!!this.state[e],this.pressCount[e]=this.pressCount[e]||0,this.releaseCount[e]=this.releaseCount[e]||0}unbind(e){for(var t in this._keyBindmap){var r=this._keyBindmap[t],n=r.indexOf(e);n>-1&&r.splice(n,1)}}getBindings(){var e={};for(var t in this._keyBindmap)this._keyBindmap[t].forEach(r=>{e[r]=e[r]||[],e[r].push(t)});return e}tick(){f(this.pointerState),f(this.pressCount),f(this.releaseCount)}}function f(e){for(var t in e)e[t]=0}function p(e){window.addEventListener("keydown",v.bind(null,e,!0),!1),window.addEventListener("keyup",v.bind(null,e,!1),!1);var t={passive:!0};window.PointerEvent?(e.element.addEventListener("pointerdown",m.bind(null,e,!0),t),window.document.addEventListener("pointerup",m.bind(null,e,!1),t),e.element.addEventListener("pointermove",g.bind(null,e),t)):(e.element.addEventListener("mousedown",m.bind(null,e,!0),t),window.document.addEventListener("mouseup",m.bind(null,e,!1),t),e.element.addEventListener("mousemove",g.bind(null,e),t)),e.element.addEventListener("wheel",y.bind(null,e),t),e.element.addEventListener("contextmenu",_.bind(null,e),!1),window.addEventListener("blur",b.bind(null,e),!1)}function v(e,t,r){k(r.code,t,e,r),function(e,t,r){var n=/^Meta/.test(r.code);if(r.metaKey&&!n&&e)t._pressedDuringMeta[r.code]=!0;else if(n&&!e){for(var i in t._pressedDuringMeta)t._keyStates[i]&&(/^Mouse\d/.test(i)||k(i,!1,t,{code:i,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}));t._pressedDuringMeta={}}}(t,e,r)}function m(e,t,r){if("pointerId"in r)if(t){if(null!==e._touches.currID)return;e._touches.currID=r.pointerId}else{if(e._touches.currID!==r.pointerId)return;e._touches.currID=null}return k("Mouse"+("button"in r?r.button+1:1),t,e,r),!1}function g(e,t){if(!("pointerId"in t)||null===e._touches.currID||e._touches.currID===t.pointerId){var r=t.movementX||t.mozMovementX||0,n=t.movementY||t.mozMovementY||0;e.pointerState.dx+=r,e.pointerState.dy+=n}}function y(e,t){var r=1;switch(t.deltaMode){case 0:r=1;break;case 1:r=12;break;case 2:r=e.element.clientHeight||window.innerHeight}e.pointerState.scrollx+=(t.deltaX||0)*r,e.pointerState.scrolly+=(t.deltaY||0)*r,e.pointerState.scrollz+=(t.deltaZ||0)*r}function _(e,t){if(!e.allowContextMenu)return t.preventDefault(),!1}function b(e){for(var t in e._keyStates)e._keyStates[t]&&(/^Mouse\d/.test(t)||k(t,!1,e,{code:t,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function k(e,t,r,n){var i=r._keyBindmap[e];i&&(w(r._keyStates[e],t)&&(r._keyStates[e]=t,i.forEach(e=>{(!r.filterEvents||r.filterEvents(n,e))&&function(e,t,r,n){var i=t?r.pressCount:r.releaseCount;i[e]=(i[e]||0)+1;var s=r._bindPressCount[e]||0;if((s+=t?1:-1)<0&&(s=0),r._bindPressCount[e]=s,w(r.state[e],s)){r.state[e]=s>0;var o=t?r.down:r.up;r.disabled||o.emit(e,n)}}(e,t,r,n)})),"button"in n||(r.preventDefaults&&!n.defaultPrevented&&n.preventDefault(),r.stopPropagation&&n.stopPropagation()))}function w(e,t){return e?!t:t}var x={preventDefaults:!1,stopPropagation:!1,allowContextMenu:!1},M={forward:["KeyW","ArrowUp"],backward:["KeyS","ArrowDown"],left:["KeyA","ArrowLeft"],right:["KeyD","ArrowRight"],fire:"Mouse1","mid-fire":["Mouse2","KeyQ"],"alt-fire":["Mouse3","KeyE"],jump:"Space"};class C extends d{constructor(e,t,r){super(r,t=Object.assign({},x,t));var n=t.bindings||M;for(var i in n){var s=Array.isArray(n[i])?n[i]:[n[i]];this.bind(i,...s)}}}class P{constructor(e=null,t=10){this.stickyPointerLock=!1,this.stickyFullscreen=!1,this.tickRate=30,this.maxRenderRate=0,this.maxTickTime=100,this.pointerLock=!1,this.fullscreen=!1,this.onTick=function(e){},this.onRender=function(e,t,r){},this.onInit=function(){},this.onResize=function(){},this.onPointerLockChanged=function(e=!1){},this.onFullscreenChanged=function(e=!1){},this.onPointerLockError=function(e){},this._data=new T(t),function(e){if("loading"===document.readyState){var t=()=>{document.removeEventListener("readystatechange",t),e()};document.addEventListener("readystatechange",t)}else setTimeout(e,0)}(()=>{!function(e){var t=e._data,r=t.nowObject.now();t.lastTickStarted=r,t.lastFrameStarted=r,t.lastRenderStarted=r,t.frameCB=()=>function(e){var t=e._data;requestAnimationFrame(t.frameCB),I(e);var r=t.nowObject.now(),n=r-t.lastFrameStarted;if(t.lastFrameStarted=r,e.maxRenderRate>0){t.renderAccum+=n;var i=1e3/e.maxRenderRate;if(t.renderAccum<i)return;t.renderAccum-=i,t.renderAccum>i&&(t.renderAccum=i)}var s=r-t.lastRenderStarted;t.lastRenderStarted=r;var o=1e3/e.tickRate,a=(r-t.lastTickStarted)/o;a<0&&(a=0),e.onRender(s,a,o),setTimeout(I,0,e,!0)}(e),t.intervalCB=()=>I(e),requestAnimationFrame(t.frameCB),t.pollTime>0&&(t.intervalID=setInterval(t.intervalCB,t.pollTime))}(this),function(e,t){if(t){var r=!1,n=!1,i=e=>{if(!!e!=(r=t===document.pointerLockElement))if(e){var n=t.requestPointerLock();n&&n.catch&&n.catch(e=>{})}else document.exitPointerLock()},s=e=>{!!e!=(n=t===document.fullscreenElement)&&(e?t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen():document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen())};document.addEventListener("pointerlockchange",n=>{r=t===document.pointerLockElement,e.onPointerLockChanged(r)}),document.addEventListener("fullscreenchange",r=>{n=t===document.fullscreenElement,e.onFullscreenChanged(n)}),document.addEventListener("pointerlockerror",n=>{r=t===document.pointerLockElement,e.onPointerLockError(n)}),Object.defineProperty(e,"pointerLock",{get:()=>r,set:i}),Object.defineProperty(e,"fullscreen",{get:()=>n,set:s}),t.addEventListener("click",t=>{e.stickyPointerLock&&i(!0),e.stickyFullscreen&&s(!0)});var o=()=>e.onResize();window.ResizeObserver?new ResizeObserver(o).observe(t):window.addEventListener("resize",o)}}(this,e),this.onInit()})}}function T(e=10){this.nowObject=performance||Date,this.pollTime=e,this.renderAccum=0,this.lastTickStarted=0,this.lastFrameStarted=0,this.lastRenderStarted=0,this.avgTickTime=2,this.frameCB=null,this.intervalCB=null,this.intervalID=-1}function I(e,t=!1){var r=e._data,n=r.nowObject.now(),i=n;t&&(i+=r.avgTickTime);var s=n+e.maxTickTime;s>n||(s=n+1);for(var o=1e3/e.tickRate;r.lastTickStarted+o<i;){e.onTick(o),r.lastTickStarted+=o;var a=r.nowObject.now();if(r.avgTickTime=D(r.avgTickTime,a-n),(n=a)>s)return void(r.lastTickStarted=n)}}function D(e,t){return t>4*e&&(t=4*e),t<.25*e&&(t=.25*e),.9*e+.1*t}class A extends n.EventEmitter{constructor(e,t){super(),t=t||{},this.noa=e;var r,n,i,s=t.domElement||null;"string"==typeof s&&(s=document.querySelector(s)),this.element=s||((r=document.createElement("div")).tabIndex=1,r.style.position="fixed",r.style.left="0px",r.style.right="0px",r.style.top="0px",r.style.bottom="0px",r.style.height="100%",r.style.overflow="hidden",document.body.appendChild(r),document.body.style.overflow="hidden",document.body.style.height="100%",r.id="noa-container",r),this.canvas=(n=this.element,(i=n.querySelector("canvas"))||((i=document.createElement("canvas")).style.position="absolute",i.style.left="0px",i.style.top="0px",i.style.height="100%",i.style.width="100%",i.id="noa-canvas",n.insertBefore(i,n.firstChild)),i),function(e,t){var r=0,n=()=>{var i=t.width;t.width=i+1,t.width=i,r++>10&&e.off("beforeRender",n)};e.on("beforeRender",n)}(e,this.canvas),this.supportsPointerLock=!1,this.pointerInGame=!1,this.isFocused=!!document.hasFocus(),this.hasPointerLock=!1,this._shell=new P(this.element,10),this._shell.tickRate=t.tickRate,this._shell.maxRenderRate=t.maxRenderRate,this._shell.stickyPointerLock=t.stickyPointerLock,this._shell.stickyFullscreen=t.stickyFullscreen,this._shell.maxTickTime=50,this._shell.onTick=e.tick.bind(e),this._shell.onRender=e.render.bind(e),this._shell.onPointerLockChanged=e=>{this.hasPointerLock=e,this.emit(e?"gainedPointerLock":"lostPointerLock"),e&&(this.pointerInGame=!0)},this._shell.onInit=()=>{this._shell.onResize=e.rendering.resize.bind(e.rendering),function(e){if("pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document){e.supportsPointerLock=!0;var t=function(r){e.supportsPointerLock=!1,document.removeEventListener(r.type,t)};document.addEventListener("touchmove",t)}}(this),this.element.addEventListener("mouseenter",()=>{this.pointerInGame=!0}),this.element.addEventListener("mouseleave",()=>{this.pointerInGame=!1}),window.addEventListener("focus",()=>{this.isFocused=!0}),window.addEventListener("blur",()=>{this.isFocused=!1});var t=()=>{this.pointerInGame=!0,this.isFocused=!0,this.element.removeEventListener("mousedown",t)};this.element.addEventListener("mousedown",t),this.emit("DOMready"),this._shell.onInit=null}}appendTo(e){this.element.appendChild(e)}setPointerLock(e=!1){this._shell.pointerLock=!!e}}var E=r(937),S=r.n(E),L=r(4881),F=r.n(L);function R(){this.inverseX=!1,this.inverseY=!1,this.sensitivityMult=1,this.sensitivityMultOutsidePointerlock=0,this.sensitivityX=10,this.sensitivityY=10,this.initialZoom=0,this.zoomSpeed=.2}var B=[o().create(),o().create(),o().create()],j=o().create();class O{constructor(e,t){t=Object.assign({},new R,t),this.noa=e,this.sensitivityX=+t.sensitivityX,this.sensitivityY=+t.sensitivityY,this.inverseX=!!t.inverseX,this.inverseY=!!t.inverseY,this.sensitivityMult=t.sensitivityMult,this.sensitivityMultOutsidePointerlock=t.sensitivityMultOutsidePointerlock,this.heading=0,this.pitch=0,this.cameraTarget=this.noa.ents.createEntity(["position"]);var r=.9*e.ents.getPositionData(e.playerEntity).height;e.ents.addComponent(this.cameraTarget,"followsEntity",{entity:e.playerEntity,offset:[0,r,0]}),this.zoomDistance=t.initialZoom,this.zoomSpeed=t.zoomSpeed,this.currentZoom=t.initialZoom,this._dirVector=o().fromValues(0,0,1)}_localGetTargetPosition(){var e=this.noa.ents.getPositionData(this.cameraTarget),t=B[0];return o().copy(t,e._renderPosition)}_localGetPosition(){var e=this._localGetTargetPosition();return 0===this.currentZoom?e:o().scaleAndAdd(e,e,this._dirVector,-this.currentZoom)}getTargetPosition(){var e=this._localGetTargetPosition(),t=B[1];return this.noa.localToGlobal(e,t)}getPosition(){var e=this._localGetPosition(),t=B[2];return this.noa.localToGlobal(e,t)}getDirection(){return this._dirVector}applyInputsToCamera(){var e=this.sensitivityMult;if(this.noa.container.supportsPointerLock&&(this.noa.container.hasPointerLock||(e*=this.sensitivityMultOutsidePointerlock)),0!==e){var t=this.noa.inputs.pointerState;!function(e){var t=e.dx,r=e.dy,n=Math.abs(t)>400&&Math.abs(t/z)>4,i=Math.abs(r)>400&&Math.abs(r/U)>4;n||i?(e.dx=z,e.dy=U,z=(z+t)/2,U=(U+r)/2):(z=t||1,U=r||1)}(t);var r=.0066*Math.PI/180,n=t.dx*this.sensitivityX*e*r,i=t.dy*this.sensitivityY*e*r;this.inverseX&&(n=-n),this.inverseY&&(i=-i);var s=2*Math.PI;this.heading+=n<0?n+s:n,this.heading>s&&(this.heading-=s);var a=Math.PI/2-.001;this.pitch=Math.max(-a,Math.min(a,this.pitch+i)),o().set(this._dirVector,0,0,1);var h=this._dirVector,u=j;o().rotateX(h,h,u,this.pitch),o().rotateY(h,h,u,this.heading)}}updateBeforeEntityRenderSystems(){this.currentZoom+=(this.zoomDistance-this.currentZoom)*this.zoomSpeed}updateAfterEntityRenderSystems(){var e=function(e){e._sweepBox||(e._sweepBox=new(S())([0,0,0],[.2,.2,.2]),e._sweepGetVoxel=e.noa.world.getBlockSolidity.bind(e.noa.world),e._sweepVec=o().create(),e._sweepHit=()=>!0);var t=o().copy(e._sweepVec,e._localGetTargetPosition());o().add(t,t,e.noa.worldOriginOffset);for(var r=0;r<3;r++)t[r]-=.1;e._sweepBox.setPosition(t);var n=Math.max(e.zoomDistance,e.currentZoom)+.1;return o().scale(e._sweepVec,e.getDirection(),-n),F()(e._sweepGetVoxel,e._sweepBox,e._sweepVec,e._sweepHit,!0)}(this);this.currentZoom>e&&(this.currentZoom=e)}}var z=0,U=0,N=r(3274),V=r.n(N);class q{constructor(){this.position=null,this.width=.8,this.height=.8,this._localPosition=null,this._renderPosition=null,this._extents=null}}function H(e){return{name:"position",order:60,state:new q,onAdd:function(t,r){var n=[0,0,0];r.position&&o().copy(n,r.position),r.position=n,r._localPosition=o().create(),r._renderPosition=o().create(),r._extents=new Float32Array(6),e.globalToLocal(r.position,null,r._localPosition),o().copy(r._renderPosition,r._localPosition),G(r)},onRemove:null,system:function(t,r){for(var n=e.worldOriginOffset,i=0;i<r.length;i++){var s=r[i];o().add(s.position,s._localPosition,n),G(s)}}}}function G(e){var t=e.width/2,r=e._localPosition,n=e._extents;n[0]=r[0]-t,n[1]=r[1],n[2]=r[2]-t,n[3]=r[0]+t,n[4]=r[1]+e.height,n[5]=r[2]+t}class K{constructor(){this.body=null}}function $(e){return{name:"physics",order:40,state:new K,onAdd:function(t,r){r.body=e.physics.addBody(),Z(r,e.ents.getPositionData(r.__id))},onRemove:function(t,r){if(e.ents.hasPosition(r.__id)){var n=e.ents.getPositionData(r.__id);W(r,n),X(r,n,0,!1)}e.physics.removeBody(r.body)},system:function(t,r){for(var n=0;n<r.length;n++){var i=r[n];W(i,e.ents.getPositionData(i.__id))}},renderSystem:function(t,r){for(var n=e.positionInCurrentTick,i=1e3/e.container._shell.tickRate,s=(n*(i*=e.timeScale)-i)/1e3,o=0;o<r.length;o++){var a=r[o],h=a.__id;X(a,e.ents.getPositionData(h),s,e.ents.cameraSmoothed(h))}}}}var Y=o().create();function Z(e,t){var r=e.body.aabb,n=t._extents;o().copy(r.base,n),o().set(r.vec,t.width,t.height,t.width),o().add(r.max,r.base,r.vec)}function W(e,t){var r=e.body.aabb.base,n=t.width/2;o().set(t._localPosition,r[0]+n,r[1],r[2]+n)}function X(e,t,r,n){var i=e.body.velocity;o().scaleAndAdd(Y,t._localPosition,i,r),n&&o().lerp(Y,t._renderPosition,Y,.3),o().copy(t._renderPosition,Y)}var Q=r(8770),J=r.n(Q);function ee(e){var t=[];return{name:"collideEntities",order:70,state:{cylinder:!1,collideBits:1,collideMask:1,callback:null},onAdd:null,onRemove:null,system:function(n,i){for(var s=e.ents,o=0;o<i.length;o++){var a=i[o].__id,h=s.getPositionData(a);t[o]=h._extents}t.length=i.length,J()(t,function(n,s){var o=i[n],a=i[s];o&&a&&function(e,t,n,i){return e.cylinder?t.cylinder?function(e,t){var r=(e[3]-e[0])/2,n=(t[3]-t[0])/2,i=e[0]+r-(t[0]+n),s=e[2]+r-(t[2]+n),o=r+n;return i*i+s*s<=o*o}(n,i):r(n,i):!t.cylinder||r(i,n)}(o,a,t[n],t[s])&&function(e,t,r){var n=t.__id,i=r.__id;t.collideMask&r.collideBits&&t.callback&&t.callback(i),r.collideMask&t.collideBits&&r.callback&&r.callback(n),e.ents.onPairwiseEntityCollision(n,i)}(e,o,a)})}};function r(e,t){var r=(e[3]-e[0])/2,i=e[0]+r,s=e[2]+r,o=n(i,t[0],t[3])-i,a=n(s,t[2],t[5])-s;return o*o+a*a<=r*r}function n(e,t,r){return e<t?t:e>r?r:e}}function te(e){return{name:"collideTerrain",order:0,state:{callback:null},onAdd:function(t,r){var n=e.entities;n.hasPhysics(t)&&(n.getPhysics(t).body.onCollide=function(r){var n=e.ents.getCollideTerrain(t).callback;n&&n(r,t)})},onRemove:function(t,r){var n=e.entities;n.hasPhysics(t)&&(n.getPhysics(t).body.onCollide=null)}}}function re(e){return{name:"fadeOnZoom",order:99,state:{cutoff:1.5},onAdd:null,onRemove:null,system:function(t,r){for(var n=e.camera.currentZoom,i=0;i<r.length;i++)ne(r[i],n,e)}}}function ne(e,t,r){if(r.ents.hasMesh(e.__id)){var n=r.ents.getMeshData(e.__id).mesh;if(n.metadata){var i=t<e.cutoff;r.rendering.setMeshVisibility(n,!i)}}}function ie(e){return{name:"followsEntity",order:50,state:{entity:0,offset:null,onTargetMissing:null},onAdd:function(e,n){var i=o().create();n.offset=n.offset?o().copy(i,n.offset):i,t(n),r(n)},onRemove:null,system:function(e,r){for(var n=0;n<r.length;n++)t(r[n])},renderSystem:function(e,t){for(var n=0;n<t.length;n++)r(t[n])}};function t(t){var r=t.__id,n=e.ents.getPositionData(r),i=e.ents.getPositionData(t.entity);i?o().add(n._localPosition,i._localPosition,t.offset):(t.onTargetMissing&&t.onTargetMissing(r),e.ents.removeComponent(r,e.ents.names.followsEntity))}function r(t){var r=t.__id,n=e.ents.getPositionData(r),i=e.ents.getPositionData(t.entity);i&&o().add(n._renderPosition,i._renderPosition,t.offset)}}function se(e){return{name:"mesh",order:100,state:{mesh:null,offset:null},onAdd:function(t,r){var n=e.ents.getPositionData(t);if(!r.mesh)throw new Error("Mesh component added without a mesh - probably a bug!");e.rendering.addMeshToScene(r.mesh,!1,n.position),r.offset||(r.offset=o().create());var i=n._renderPosition;r.mesh.position.copyFromFloats(i[0]+r.offset[0],i[1]+r.offset[1],i[2]+r.offset[2])},onRemove:function(e,t){t.mesh.dispose()},renderSystem:function(t,r){for(var n=0;n<r.length;n++){var i=r[n],s=i.__id,o=e.ents.getPositionData(s)._renderPosition;i.mesh.position.copyFromFloats(o[0]+i.offset[0],o[1]+i.offset[1],o[2]+i.offset[2])}}}}function oe(){this.heading=0,this.running=!1,this.jumping=!1,this.maxSpeed=10,this.moveForce=30,this.responsiveness=15,this.runningFriction=0,this.standingFriction=2,this.airMoveMult=.5,this.jumpImpulse=10,this.jumpForce=12,this.jumpTime=500,this.airJumps=1,this._jumpCount=0,this._currjumptime=0,this._isJumping=!1}function ae(e){return{name:"movement",order:30,state:new oe,onAdd:null,onRemove:null,system:function(t,r){for(var n=e.entities,i=0;i<r.length;i++){var s=r[i],o=n.getPhysics(s.__id);o&&le(t,s,o.body)}}}}var he=o().create(),ue=o().create(),ce=o().create();function le(e,t,r){var n=r.atRestY()<0,i=n||t._jumpCount<t.airJumps;if(n&&(t._isJumping=!1,t._jumpCount=0),t.jumping)if(t._isJumping){if(t._currjumptime>0){var s=t.jumpForce;t._currjumptime<e&&(s*=t._currjumptime/e),r.applyForce([0,s,0]),t._currjumptime-=e}}else i&&(t._isJumping=!0,n||t._jumpCount++,t._currjumptime=t.jumpTime,r.applyImpulse([0,t.jumpImpulse,0]),!n&&r.velocity[1]<0&&(r.velocity[1]=0));else t._isJumping=!1;var a=he,h=ue;if(t.running){var u=t.maxSpeed;o().set(a,0,0,u),o().rotateY(a,a,ce,t.heading),o().subtract(h,a,r.velocity),h[1]=0;var c=o().length(h);if(o().normalize(h,h),c>0){var l=t.moveForce;n||(l*=t.airMoveMult);var d=t.responsiveness*c;l>d&&(l=d),o().scale(h,h,l),r.applyForce(h)}r.friction=t.runningFriction}else r.friction=t.standingFriction}function de(e){return{name:"receivesInputs",order:20,state:{},onAdd:null,onRemove:null,system:function(t,r){for(var n=e.entities,i=e.inputs.state,s=e.camera.heading,o=0;o<r.length;o++){var a=r[o];fe(n.getMovement(a.__id),i,s)}}}}function fe(e,t,r){e.jumping=!!t.jump;var n=t.forward?t.backward?0:1:t.backward?-1:0,i=t.right?t.left?0:1:t.left?-1:0;0===(n|i)?e.running=!1:(e.running=!0,n?(-1==n&&(r+=Math.PI),i&&(r+=Math.PI/4*n*i)):r+=i*Math.PI/2,e.heading=r)}var pe=r(4471),ve=r(731);function me(e,t=10){var r=t,n=e.rendering.getScene(),i=(0,ve.WA)("shadow",{radius:.75,tessellation:30},n);i.rotation.x=Math.PI/2;var s=e.rendering.makeStandardMaterial("shadow_component_mat");return s.diffuseColor.set(0,0,0),s.ambientColor.set(0,0,0),s.alpha=.5,i.material=s,s.freeze(),e.rendering.setMeshVisibility(i,!1),{name:"shadow",order:80,state:{size:.5,_mesh:null},onAdd:function(t,r){var n=i.createInstance("shadow_instance");e.rendering.addMeshToScene(n),n.setEnabled(!1),r._mesh=n},onRemove:function(e,t){t._mesh.dispose(),t._mesh=null},system:function(t,n){for(var i=e.camera._localGetPosition(),s=r,o=0;o<n.length;o++){var a=n[o],h=e.ents.getPositionData(a.__id),u=e.ents.getPhysics(a.__id);_e(e,h,u,a._mesh,a.size,s,i)}},renderSystem:function(t,r){for(var n=0;n<r.length;n++){var i=r[n],s=e.ents.getPositionData(i.__id)._renderPosition,o=i._mesh.position;o.x=s[0],o.z=s[2]}}}}r(1274);var ge=o().fromValues(0,0,0),ye=o().fromValues(0,-1,0);function _e(e,t,r,n,i,s,a){var h;if(r&&r.body.resting[1]<0)h=t._localPosition[1];else{var u=e._localPick(t._localPosition,ye,s);if(!u)return void n.setEnabled(!1);h=u.position[1]-e.worldOriginOffset[1]}h=Math.round(h),o().copy(ge,t._localPosition),ge[1]=h;var c=.01+o().squaredDistance(a,ge)/1600*.1;c>.1&&(c=.1),n.position.y=h+c;var l=.7*i*(1-(t._localPosition[1]-h)/s);n.scaling.copyFromFloats(l,l,l),n.setEnabled(!0)}function be(e){var t="smoothCamera";return{name:t,order:99,state:{time:100.1},onAdd:null,onRemove:null,system:function(r,n){for(var i=0;i<n.length;i++){var s=n[i];s.time-=r,s.time<0&&e.ents.removeComponent(s.__id,t)}}}}var ke={shadowDistance:10};class we extends(V()){constructor(e,t){super();var r={shadow:(t=Object.assign({},ke,t)).shadowDistance};this.noa=e,this.names={};var n={collideEntities:ee,collideTerrain:te,fadeOnZoom:re,followsEntity:ie,mesh:se,movement:ae,physics:$,position:H,receivesInputs:de,shadow:me,smoothCamera:be};Object.keys(n).forEach(t=>{var i=(0,n[t])(e,r[t]||void 0);this.names[t]=this.createComponent(i)}),this.cameraSmoothed=this.getComponentAccessor(this.names.smoothCamera),this.hasPhysics=this.getComponentAccessor(this.names.physics),this.hasPosition=this.getComponentAccessor(this.names.position),this.getPositionData=this.getStateAccessor(this.names.position),this.getPosition=e=>{var t=this.getPositionData(e);return t?t.position:null},this.getPhysics=this.getStateAccessor(this.names.physics),this.getPhysicsBody=e=>{var t=this.getPhysics(e);return t?t.body:null},this.hasMesh=this.getComponentAccessor(this.names.mesh),this.getMeshData=this.getStateAccessor(this.names.mesh),this.getMovement=this.getStateAccessor(this.names.movement),this.getCollideTerrain=this.getStateAccessor(this.names.collideTerrain),this.getCollideEntities=this.getStateAccessor(this.names.collideEntities),this.onPairwiseEntityCollision=function(e,t){}}setPosition(e,t,r=0,n=0){"number"==typeof t&&(t=[t,r,n]);var i=this.noa.globalToLocal(t,null,[]);this._localSetPosition(e,i)}setEntitySize(e,t,r,n){var i=this.getPositionData(e);i.width=(t+n)/2,i.height=r,this._updateDerivedPositionData(e,i)}_rebaseOrigin(e){for(var t of this.getStatesList(this.names.position)){var r=t._localPosition,n=t.width/2;xe(r,0,-n,n,t.__id),xe(r,1,0,t.height,t.__id),xe(r,2,-n,n,t.__id),o().subtract(r,r,e),this._updateDerivedPositionData(t.__id,t)}}_localGetPosition(e){return this.getPositionData(e)._localPosition}_localSetPosition(e,t){var r=this.getPositionData(e);o().copy(r._localPosition,t),this._updateDerivedPositionData(e,r)}_updateDerivedPositionData(e,t){o().copy(t._renderPosition,t._localPosition);var r=this.noa.worldOriginOffset;o().add(t.position,t._localPosition,r),G(t);var n=this.getPhysics(e);n&&Z(n,t)}addComponentAgain(e,t,r){this.hasComponent(e,t)&&this.removeComponent(e,t),this.addComponent(e,t,r)}isTerrainBlocked(e,t,r){for(var n=this.noa.worldOriginOffset,i=Math.floor(e-n[0]),s=Math.floor(t-n[1]),o=Math.floor(r-n[2]),a=[i+.001,s+.001,o+.001,i+.999,s+.999,o+.999],h=this.getStatesList(this.names.collideTerrain),u=0;u<h.length;u++){var c=h[u].__id;if(Me(a,this.getPositionData(c)._extents))return!0}return!1}getEntitiesInAABB(e,t){var r,n=this.noa.worldOriginOffset,i=[e.base[0]-n[0],e.base[1]-n[1],e.base[2]-n[2],e.max[0]-n[0],e.max[1]-n[1],e.max[2]-n[2]];if(t)for(var s of(r=[],this.getStatesList(t))){var o=this.getPositionData(s.__id);o&&r.push(o)}else r=this.getStatesList(this.names.position);for(var a=[],h=0;h<r.length;h++){var u=r[h];Me(i,u._extents)&&a.push(u.__id)}return a}add(e=null,t=1,r=1,n=null,i=null,s=!1,a=!1){var h=this,u=this.createEntity();if(this.addComponent(u,this.names.position,{position:e||o().create(),width:t,height:r}),s){this.addComponent(u,this.names.physics);var c=this.getPhysics(u).body,l=this.names.smoothCamera;c.onStep=function(){h.addComponentAgain(u,l)}}return n&&(i||(i=o().create()),this.addComponent(u,this.names.mesh,{mesh:n,offset:i})),a&&this.addComponent(u,this.names.shadow,{size:t}),u}}function xe(e,t,r,n,i){var s=e[t]+r,o=e[t]+n;Math.abs(s-Math.round(s))<.002&&(e[t]+=.002),Math.abs(o-Math.round(o))<.001&&(e[t]-=.001)}function Me(e,t){return!(e[0]>t[3]||e[1]>t[4]||e[2]>t[5]||e[3]<t[0]||e[4]<t[1]||e[5]<t[2])}var Ce=r(3822);function Pe(e,t){var r=e.indexOf(t);r<0||(r===e.length-1?e.pop():e[r]=e.pop())}function Te(e,t,r){return 1023&e|(1023&t)<<10|(1023&r)<<20}class Ie{constructor(){this.hash={}}getChunkByIndexes(e=0,t=0,r=0){return this.hash[Te(e,t,r)]||null}storeChunkByIndexes(e=0,t=0,r=0,n){this.hash[Te(e,t,r)]=n}removeChunkByIndexes(e=0,t=0,r=0){delete this.hash[Te(e,t,r)]}}class De{constructor(){this.arr=[],this.hash={}}forEach(e,t){this.arr.forEach(e,t)}includes(e,t,r){var n=Te(e,t,r);return!!this.hash[n]}add(e,t,r,n=!1){var i=Te(e,t,r);this.hash[i]||(n?this.arr.unshift([e,t,r,i]):this.arr.push([e,t,r,i]),this.hash[i]=!0)}removeByIndex(e){var t=this.arr[e];delete this.hash[t[3]],this.arr.splice(e,1)}remove(e,t,r){var n=Te(e,t,r);if(this.hash[n]){delete this.hash[n];for(var i=0;i<this.arr.length;i++)if(n===this.arr[i][3])return void this.arr.splice(i,1);throw"internal bug with location queue - hash value overlapped"}}count(){return this.arr.length}isEmpty(){return 0===this.arr.length}empty(){this.arr=[],this.hash={}}pop(){var e=this.arr.pop();return delete this.hash[e[3]],e}copyFrom(e){for(var t in this.arr=e.arr.slice(),this.hash={},e.hash)this.hash[t]=!0}sortByDistance(e,t=!1){!function(e,t,r){var n={};for(var i of e)n[i[3]]=t(i[0],i[1],i[2]);r?e.sort((e,t)=>n[e[3]]-n[t[3]]):e.sort((e,t)=>n[t[3]]-n[e[3]]),n=null}(this.arr,e,t)}}function Ae(e){this.rootNode=new Ce.V("objectMeshRoot",e.rendering.scene);var t=[0,0,0],r=!1,n=new Ce.V("");this.allBaseMeshes=[];var i={},s=t=>{if(i[t])return i[t];var r=e.registry._blockMeshLookup[t];for(var n in i){var s=i[n].mesh;if(s===r||s.geometry===r.geometry)return i[t]=i[n]}return this.allBaseMeshes.push(r),r.metadata||(r.metadata={}),r.metadata[o]=!0,i[t]=new Ee(e,r)},o="noa_object_base_mesh";this.initChunk=function(e){e._objectBlocks={}},this.setObjectBlock=function(r,i,o,a,h){var u=r.x+o,c=r.y+a,l=r.z+h,d=`${u}:${c}:${l}`,f=r._objectBlocks[d]||0;if(f!==i){if(f>0&&s(f).removeInstance(r,d),i>0){var p=e.registry._blockHandlerLookup[i],v=p&&p.onCustomMeshCreate;v&&(n.position.copyFromFloats(.5,0,.5),n.scaling.setAll(1),n.rotation.setAll(0),v(n,u,c,l));var m=s(i),g=v?n:null;m.addInstance(r,d,o,a,h,g,t)}f>0&&!i&&delete r._objectBlocks[d],i>0&&(r._objectBlocks[d]=i)}},this.buildObjectMeshes=function(){for(var e in Fe("start"),i){var t=i[e];t.updateMatrix(),0===t.count&&t.dispose(),t.disposed&&delete i[e]}Fe("rebuilt"),Fe("end")},this.disposeChunk=function(e){for(var t in e._objectBlocks){var n=e._objectBlocks[t];n>0&&s(n).removeInstance(e,t)}e._objectBlocks=null,r=!0},this.tick=function(){r&&(this.buildObjectMeshes(),r=!1)},this._rebaseOrigin=function(e){for(var n in t[0]+=e[0],t[1]+=e[1],t[2]+=e[2],i)i[n].rebased=!1;for(var s in i){var o=i[s];if(!o.rebased){for(var a=0;a<o.count;a++){var h=a<<4;o.buffer[h+12]-=e[0],o.buffer[h+13]-=e[1],o.buffer[h+14]-=e[2]}o.rebased=!0,o.dirty=!0}}r=!0}}function Ee(e,t){this.noa=e,this.mesh=t,this.buffer=null,this.capacity=0,this.count=0,this.dirty=!1,this.rebased=!0,this.disposed=!1,this.keyToIndex={},this.locToKey=[],this.mesh.position.setAll(0),this.mesh.parent=e._objectMesher.rootNode,this.noa.rendering.addMeshToScene(this.mesh,!1),this.noa.emit("addingTerrainMesh",this.mesh),this.mesh.isPickable=!1,this.mesh.doNotSyncBoundingInfo=!0,this.mesh.alwaysSelectAsActiveMesh=!0}r(9709),Ee.prototype.dispose=function(){this.disposed||(this.mesh.thinInstanceCount=0,this.setCapacity(0),this.noa.emit("removingTerrainMesh",this.mesh),this.noa.rendering.setMeshVisibility(this.mesh,!1),this.mesh=null,this.keyToIndex=null,this.locToKey=null,this.disposed=!0)},Ee.prototype.addInstance=function(e,t,r,n,i,s,o){!function(e){if(!(e.count<e.capacity)){var t=Math.max(8,2*e.capacity);e.setCapacity(t)}}(this);var a=this.count<<4;if(this.locToKey[this.count]=t,this.keyToIndex[t]=a,s)s.position.x+=e.x-o[0]+r,s.position.y+=e.y-o[1]+n,s.position.z+=e.z-o[2]+i,s.computeWorldMatrix(!0),Le(s._localMatrix._m,0,this.buffer,a);else{var h=Se;h[12]=e.x-o[0]+r+.5,h[13]=e.y-o[1]+n,h[14]=e.z-o[2]+i+.5,Le(h,0,this.buffer,a)}this.count++,this.dirty=!0},Ee.prototype.removeInstance=function(e,t){var r=this.keyToIndex[t];if(!(r>=0))throw"tried to remove object instance not in storage";delete this.keyToIndex[t];var n,i=r>>4,s=this.count-1;if(i!==s){var o=s<<4;Le(this.buffer,o,this.buffer,r);var a=this.locToKey[s];this.keyToIndex[a]=r,this.locToKey[i]=a}this.count--,this.dirty=!0,(n=this).count>.4*n.capacity||n.capacity<100||(n.setCapacity(Math.round(n.capacity/2)),n.locToKey.length=Math.min(n.locToKey.length,n.capacity))},Ee.prototype.updateMatrix=function(){this.dirty&&(this.mesh.thinInstanceCount=this.count,this.mesh.thinInstanceBufferUpdated("matrix"),this.mesh.isVisible=this.count>0,this.dirty=!1)},Ee.prototype.setCapacity=function(e=4){if(this.capacity=e,0===e)this.buffer=null;else{var t=new Float32Array(16*this.capacity);if(this.buffer)for(var r=Math.min(this.buffer.length,t.length),n=0;n<r;n++)t[n]=this.buffer[n];this.buffer=t}this.mesh.thinInstanceSetBuffer("matrix",this.buffer),this.updateMatrix()};var Se=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function Le(e,t,r,n){for(var i=0;i<16;i++)r[n+i]=e[t+i]}var Fe=()=>{},Re=r(9554),Be=r(4129),je=r(2136),Oe=r(7055),ze=r(903),Ue=r(171);class Ne{constructor(e){this._defaultMat=e.rendering.makeStandardMaterial("base-terrain"),this._defaultMat.freeze(),this.allMaterials=[this._defaultMat],this.noa=e,this._idCounter=1e3,this._blockMatIDtoTerrainID={},this._terrainIDtoMatObject={},this._texURLtoTerrainID={},this._renderMatToTerrainID=new Map}getTerrainMatId(e){if(e in this._blockMatIDtoTerrainID)return this._blockMatIDtoTerrainID[e];var t=function(e,t=0){var r=e.noa.registry.getMaterialData(t);if(r.renderMat){var n=r.renderMat;return e._renderMatToTerrainID.has(n)||e._renderMatToTerrainID.set(n,e._idCounter++),e._renderMatToTerrainID.get(n)}if(r.texture){var i=r.texture;return i in e._texURLtoTerrainID||(e._texURLtoTerrainID[i]=e._idCounter++),e._texURLtoTerrainID[i]}var s=r.alpha;return s>0&&s<1?10+Math.round(100*s):1}(this,e);if(!(t in this._terrainIDtoMatObject)){var r=function(e,t=0){var r=e.noa.registry.getMaterialData(t);if(r.renderMat)return r.renderMat;if(!r.texture){if(!(r.alpha>0&&r.alpha<1))return e._defaultMat;var n="terrain-alpha-"+t,i=e.noa.rendering.makeStandardMaterial(n);return i.alpha=r.alpha,i.freeze(),i}var s=e.noa.rendering.getScene(),o=e.noa.rendering.makeStandardMaterial("terrain-textured-"+t),a=r.texture,h=Oe.g.NEAREST_SAMPLINGMODE,u=new Oe.g(a,s,!0,!1,h);return r.texHasAlpha&&(u.hasAlpha=!0),o.diffuseTexture=u,r.atlasIndex>=0&&(new Ve(o,u),e.noa.registry._textureNeedsAlpha(r.texture)&&(u.hasAlpha=!0)),o.freeze(),o}(this,e);this.allMaterials.push(r),this._terrainIDtoMatObject[t]=r}return this._blockMatIDtoTerrainID[e]=t,t}getMaterial(e=1){return this._terrainIDtoMatObject[e]}}class Ve extends ze.y{constructor(e,t){super(e,"TestPlugin",200,{NOA_TWOD_ARRAY_TEXTURE:!1}),this._enable(!0),this._atlasTextureArray=null,t.onLoadObservable.add(e=>{this.setTextureArrayData(e)})}setTextureArrayData(e){var{width:t,height:r}=e.getSize(),n=Math.round(r/t);r=t;var i=e._readPixelsSync(),s=je.N.TEXTUREFORMAT_RGBA,o=Oe.g.NEAREST_SAMPLINGMODE,a=e.getScene();this._atlasTextureArray=new Ue.L(i,t,r,n,s,a,!0,!1,o)}prepareDefines(e,t,r){e.NOA_TWOD_ARRAY_TEXTURE=!0}getClassName(){return"TerrainMaterialPluginName"}getSamplers(e){e.push("atlasTexture")}getAttributes(e){e.push("texAtlasIndices")}getUniforms(){return{ubo:[]}}bindForSubMesh(e,t,r,n){this._atlasTextureArray&&e.setTexture("atlasTexture",this._atlasTextureArray)}getCustomCode(e){return"vertex"===e?{CUSTOM_VERTEX_MAIN_BEGIN:"\n                texAtlasIndex = texAtlasIndices;\n            ",CUSTOM_VERTEX_DEFINITIONS:"\n                uniform highp sampler2DArray atlasTexture;\n                attribute float texAtlasIndices;\n                varying float texAtlasIndex;\n            "}:"fragment"===e?{"!baseColor\\=texture2D\\(diffuseSampler,vDiffuseUV\\+uvOffset\\);":"baseColor = texture(atlasTexture, vec3(vDiffuseUV, texAtlasIndex));",CUSTOM_FRAGMENT_DEFINITIONS:"\n                uniform highp sampler2DArray atlasTexture;\n                varying float texAtlasIndex;\n            "}:null}}function qe(e){var t=new Ne(e);this.allTerrainMaterials=t.allMaterials,this._defaultMaterial=t._defaultMat;var r=new Ge(e,t),n=new Ze(e,t);this.initChunk=function(e){e._terrainMeshes.length=0},this.disposeChunk=function(t){t._terrainMeshes.forEach(t=>{e.emit("removingTerrainMesh",t),t.dispose()}),t._terrainMeshes.length=0},this.meshChunk=function(t,s=!1){Qe("start"),this.disposeChunk(t),Qe("cleanup");var o=r.mesh(t,s);Qe("geom");var a=n.buildMesh(t,o,s);Qe("build"),Qe("end"),a.forEach(r=>{r.cullingStrategy=Re.e.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,e.rendering.addMeshToScene(r,!0,t.pos,this),e.emit("addingTerrainMesh",r),r.freezeNormals(),r.freezeWorldMatrix(),t._terrainMeshes.push(r),r.metadata||(r.metadata={}),r.metadata[i]=!0})};var i="noa_chunk_terrain_mesh"}function He(){this.terrainID=0,this.numFaces=0,this.matIDs=[],this.dirs=[],this.is=[],this.js=[],this.ks=[],this.wids=[],this.hts=[],this.packedAO=[]}function Ge(e,t){var r=new Int16Array(16),n=new Int16Array(16),i=t.getTerrainMatId.bind(t),s=e=>1,o=i;function a(t,r){if(u!==r){u=r,c=e.registry._solidityLookup;for(var n=-1;n<r+1;n++){var i=n<0?0:n<r?1:2;f[n+1]=[0,1,2][i],p[n+1]=[r-1,n,0][i],v[n+1]=[0,n,r-1][i]}}for(var s=t.get(0,0,0),o=0;o<3;o++)for(var a=0;a<3;a++)for(var h=0;h<3;h++){var m=9*o+3*a+h,g=t.get(o-1,a-1,h-1),y=0;g||(y=1),g===s&&(y=2),d[m]=y,l[m]=g||s}}this.mesh=function(e,t){var u=e.size;o=t?s:i;var c=e._isEmpty||e._isFull,l={};Ye.reset();for(var d=0;d<3;++d){var f=2===d?0:2,p=1===d?0:1,v=e._neighbors.data.map(e=>e&&e.voxels?e.voxels.transpose(d,f,p):null),m=h()(v,[3,3,3]).lo(1,1,1).transpose(d,f,p);r.length<u*u&&(r=new Int16Array(u*u),n=new Int16Array(u*u)),a(m,u);var _=m.get(-1,0,0),b=m.get(0,0,0);if(_){var k=_.lo(u,0,0),w=g(d,k,-1,b,0);w>0&&y(0,d,f,p,u,u,w,l)}if(!c)for(var x=0;x<u-1;x++){if(1===d){var M=e._wholeLayerVoxel[x];if(M>=0&&M===e._wholeLayerVoxel[x+1])continue}var C=1===d?null:e._wholeLayerVoxel,P=g(d,b,x,b,x+1,C);P>0&&y(x+1,d,f,p,u,u,P,l)}}return l};var u=-1,c=[!1,!0],l=Array(27).fill(null),d=Array(27).fill(0),f=[0,1,1,1,1,1,2],p=[3,0,1,2,3,0],v=[0,0,1,2,3,3];function m(e,t,r){var n=9*f[e+1]+3*f[t+1]+f[r+1],i=l[n],s=d[n];if(2===s)return c[i.get(e,t,r)];var o=[p,v][s],a=o[e+1],h=o[t+1],u=o[r+1];return c[i.get(a,h,u)]}function g(t,i,s,o,a,h=null){for(var u=i.shape[1],c=r,l=n,d=e.rendering.useAO,f=e.rendering.revAoVal===e.rendering.aoVals[0],p=e.registry._opacityLookup,v=e.registry.getBlockFaceMaterial,g=2*t,y=0,_=i.index(s,0,0),b=i.stride[1],k=i.stride[2],w=o.index(a,0,0),x=o.stride[1],M=o.stride[2],C=0,P=0;P<u;++P){var T=_,I=w;if(_+=k,w+=M,h&&h[P]>=0)y+=u;else for(var D=0;D<u;D++,y++,T+=b,I+=x){var A=i.data[T],E=o.data[I];if(A!==E){var S=p[A],L=p[E];if(!S||!L){var F=v(A,g),R=v(E,g+1);F!==R&&(S||0===R?(c[y]=F,d&&(l[y]=We(m,a,s,D,P,f)),C++):(L||0===F)&&(c[y]=-R,d&&(l[y]=We(m,s,a,D,P,f)),C++))}}}}return C}function y(t,i,s,a,h,u,c,l){var d=e.rendering.useAO,f=r,p=n,v=0,m=2*i,g=[0,0,0];g[i]=t;for(var y=d?_:b,k=0;k<u;++k)for(var w=1,x=1,M=0;M<h;M+=w,v+=w){var C=0|f[v];if(C){var P=0|p[v];for(w=1;w<h-M&&y(v+w,f,C,p,P);++w);e:for(x=1;x<u-k;++x)for(var T=0;T<w;++T)if(!y(v+T+x*h,f,C,p,P))break e;var I=Math.abs(C),D=o(I);if(!(D in l)){var A=Ye.get();A.numFaces=0,A.terrainID=D,l[D]=A}var E=l[D],S=E.numFaces;E.numFaces++,E.matIDs[S]=I,g[s]=M,g[a]=k,E.is[S]=g[0],E.js[S]=g[1],E.ks[S]=g[2],E.wids[S]=w,E.hts[S]=x,E.packedAO[S]=P,E.dirs[S]=C>0?m:m+1;for(var L=0;L<x;++L)for(var F=0;F<w;++F)f[v+F+L*h]=0;if(0===(c-=w*x))return}else w=1}}function _(e,t,r,n,i){return r===t[e]&&i===n[e]}function b(e,t,r,n,i){return r===t[e]}}var Ke,$e,Ye=(Ke=[],$e=0,{get:()=>($e>=Ke.length&&Ke.push(new He),$e++,Ke[$e-1]),reset:()=>{$e=0}});function Ze(e,t){function r(e,t,r,n,i,s,o,a){var h=12*t,u=[r,n,i],c=[0,0,0],l=[0,0,0];c[2===s?0:2]=o,l[1===s?0:1]=a;for(var d=0;d<3;d++)e[h+d]=u[d],e[h+3+d]=u[d]+c[d],e[h+6+d]=u[d]+c[d]+l[d],e[h+9+d]=u[d]+l[d]}function n(e,t,r,n,i,s){for(var o=8*t,a=0;a<8;a++)e[o+a]=0;0===r?(e[o+1]=e[o+3]=i-0,e[o+2]=e[o+4]=s*n):1===r?(e[o+1]=e[o+7]=n-0,e[o+4]=e[o+6]=s*i):(e[o+1]=e[o+3]=i-0,e[o+2]=e[o+4]=-s*n)}function i(e,t,r){for(var n=12*t,i=0;i<12;i++)e[n+i]=r[i%3]}function s(e,t,r,n,i){var s=6*t,a=4*t;0===r&&(n=-n);var h=n<0?0:1;i||(h+=2);for(var u=o[h],c=0;c<6;c++)e[s+c]=a+u[c]}this.buildMesh=function(o,l,d){var f=e.rendering.getScene(),p=e.rendering.useAO,v=e.rendering.aoVals,m=e.rendering.revAoVal,g=e.registry._matAtlasIndexLookup,y=e.registry._materialColorLookup,_=[1,1,1],b=[];for(var k in l){var w=l[k],x=w.terrainID,M=!1;d||(M=g[w.matIDs[0]]>=0);var C,P=w.numFaces,T=new Uint16Array(6*P),I=new Float32Array(12*P),D=new Float32Array(12*P),A=new Float32Array(16*P),E=new Float32Array(8*P);M&&(C=new Float32Array(4*P));for(var S=0;S<w.numFaces;S++){var L=w.matIDs[S],F=w.dirs[S],R=w.is[S],B=w.js[S],j=w.ks[S],O=w.wids[S],z=w.hts[S],U=F/2|0,N=F%2?-1:1;r(I,S,R,B,j,U,O,z),n(E,S,U,O,z,N);var V=[0,0,0];V[U]=N,i(D,S,V);var q=w.packedAO[S],[H,G,K,$]=Xe(q);s(T,S,U,N,h(H,G,K,$)),M&&a(C,S,g[L]);var Y=y[L]||_;p?c(A,S,Y,v,m,H,G,K,$):u(A,S,Y)}var Z=`chunk_${o.requestID}_${x}`,W=new Re.e(Z,f),X=new Be.P;X.positions=I,X.indices=T,X.normals=D,X.colors=A,X.uvs=E,X.applyToMesh(W),M&&W.setVerticesData("texAtlasIndices",C,!1,1),W.isPickable=!1,W.doNotSyncBoundingInfo=!0,W._refreshBoundingInfo=()=>W,d||(W.material=t.getMaterial(x)),b.push(W)}return b};var o=[[0,1,2,0,2,3],[0,2,1,0,3,2],[1,2,3,1,3,0],[1,3,2,1,0,3]];function a(e,t,r){for(var n=4*t,i=0;i<4;i++)e[n+i]=r}function h(e,t,r,n){return e===r?n!==t||2===n:n!==t&&e+r>n+t}function u(e,t,r){for(var n=16*t,i=0;i<16;i+=4)e[n+i]=r[0],e[n+i+1]=r[1],e[n+i+2]=r[2],e[n+i+3]=1}function c(e,t,r,n,i,s,o,a,h){var u=16*t;l(e,u,r,s,n,i),l(e,u+4,r,h,n,i),l(e,u+8,r,a,n,i),l(e,u+12,r,o,n,i)}function l(e,t,r,n,i,s){var o=0===n?s:i[n-1];e[t]=r[0]*o,e[t+1]=r[1]*o,e[t+2]=r[2]*o,e[t+3]=1}}function We(e,t,r,n,i,s=!1){var o=1,a=1,h=1,u=1;return e(t,n+1,i)&&(++h,++u),e(t,n-1,i)&&(++o,++a),e(t,n,i+1)&&(++a,++u),e(t,n,i-1)&&(++o,++h),e(t,n,i)?(u=3===u||e(t,n+1,i+1)?3:2,a=3===a||e(t,n-1,i+1)?3:2,u<<6|(h=3===h||e(t,n+1,i-1)?3:2)<<4|a<<2|(o=3===o||e(t,n-1,i-1)?3:2)):s?(1===u&&e(t,n+1,i+1)&&(u=2),1===a&&e(t,n-1,i+1)&&(a=2),1===h&&e(t,n+1,i-1)&&(h=2),1===o&&e(t,n-1,i-1)&&(o=2),u<<6|h<<4|a<<2|o):(1===u&&(e(t,n+1,i+1)?u=2:e(r,n,i+1)&&e(r,n+1,i)&&e(r,n+1,i+1)||(u=0)),1===h&&(e(t,n+1,i-1)?h=2:e(r,n,i-1)&&e(r,n+1,i)&&e(r,n+1,i-1)||(h=0)),1===a&&(e(t,n-1,i+1)?a=2:e(r,n,i+1)&&e(r,n-1,i)&&e(r,n-1,i+1)||(a=0)),1===o&&(e(t,n-1,i-1)?o=2:e(r,n,i-1)&&e(r,n-1,i)&&e(r,n-1,i-1)||(o=0)),u<<6|h<<4|a<<2|o)}function Xe(e){return[3&e,e>>2&3,e>>6&3,e>>4&3]}var Qe=()=>{},Je={texturePath:""};class et{constructor(e,t){t=Object.assign({},Je,t),this.noa=e,this._texturePath=t.texturePath;var r={},n=[!1],i=[!1],s=[!1],o=[!1],a=[null],h=[null],u=[null],c=[!1],l=[0,0,0,0,0,0],d=[null],f=[-1],p=[];this.registerBlock=function(e=1,t=null){var d=new nt(t&&t.fluid),f=Object.assign({},d,t||{});if(e<1||e>65535)throw"Block id out of range: "+e;for(;e>n.length;)this.registerBlock(n.length,{});n[e]=!!f.solid,i[e]=!!f.opaque,s[e]=!!f.fluid,o[e]=!!f.blockMesh,h[e]=f.blockMesh||null;var p,v=f.material||null;if(v)if("string"==typeof v)p=[v,v,v,v,v,v];else if(v.length&&2==v.length)p=[v[1],v[1],v[0],v[0],v[1],v[1]];else if(v.length&&3==v.length)p=[v[2],v[2],v[0],v[1],v[2],v[2]];else{if(!v.length||6!=v.length)throw"Invalid material parameter: "+v;p=v}else p=[null,null,null,null,null,null];for(var m=0;m<6;++m)l[6*e+m]=tt(this,r,p[m],!0);a[e]={},s[e]&&(a[e].fluidDensity=f.fluidDensity,a[e].viscosity=f.viscosity);var g=f.onLoad||f.onUnload||f.onSet||f.onUnset||f.onCustomMeshCreate;u[e]=g?new rt(f):null;var y=n[e]&&i[e]&&!g&&!s[e]&&!o[e];return c[e]=y,e},this.registerMaterial=function(e="?",t=null){if(Array.isArray(t))throw'This API changed signatures in v0.33, please use: `noa.registry.registerMaterial("name", optionsObj)`';var n=Object.assign(new it,t||{}),i=r[e]||p.length;r[e]=i;var s=n.textureURL?this._texturePath+n.textureURL:"",o=1,a=n.color||[1,1,1];return 4===a.length&&(o=a.pop()),s&&(a=null),d[i]=a,f[i]=n.atlasIndex,p[i]={color:a,alpha:o,texture:s,texHasAlpha:!!n.texHasAlpha,atlasIndex:n.atlasIndex,renderMat:n.renderMaterial},i},this.getBlockSolidity=function(e){return n[e]},this.getBlockOpacity=function(e){return i[e]},this.getBlockFluidity=function(e){return s[e]},this.getBlockProps=function(e){return a[e]},this.getBlockFaceMaterial=function(e,t){return l[6*e+t]},this.getMaterialData=function(e){return p[e]},this._textureNeedsAlpha=function(e=""){return p.some(t=>t.texture===e&&t.texHasAlpha)},this._solidityLookup=n,this._opacityLookup=i,this._fluidityLookup=s,this._objectLookup=o,this._blockMeshLookup=h,this._blockHandlerLookup=u,this._blockIsPlainLookup=c,this._materialColorLookup=d,this._matAtlasIndexLookup=f,this.registerMaterial("dirt",{color:[.4,.3,0]}),this.registerBlock(1,{material:"dirt"})}}function tt(e,t,r,n){if(!r)return 0;var i=t[r];return void 0===i&&n&&(i=e.registerMaterial(r)),i}function rt(e){this.onLoad=e.onLoad||null,this.onUnload=e.onUnload||null,this.onSet=e.onSet||null,this.onUnset=e.onUnset||null,this.onCustomMeshCreate=e.onCustomMeshCreate||null}function nt(e=!1){this.solid=!e,this.opaque=!e,this.fluid=!1,this.material=null,this.blockMesh=null,this.fluidDensity=1,this.viscosity=.5,this.onLoad=null,this.onUnload=null,this.onSet=null,this.onUnset=null,this.onCustomMeshCreate=null}function it(){this.color=null,this.textureURL=null,this.texHasAlpha=!1,this.atlasIndex=-1,this.renderMaterial=null}var st=r(9861),ot=r(2047),at=r(738),ht=r(901);class ut{constructor(e,t){var r=e.scene;r._addComponent(new ht.y(r));var n="noa_octree_block",i="noa_in_dynamic_list",s="noa_in_octree_block",o=new ot.x(h);r._selectionOctree=o,o.blocks=[];var a={};this.rebase=e=>{c(o,e)},this.addMesh=(t,r,h,c)=>{if(t.metadata||(t.metadata={}),!r){if(t.metadata[i])return;return o.dynamicContent.push(t),void(t.metadata[i]=!0)}var d=Math.floor(h[0]/u),f=Math.floor(h[1]/u),p=Math.floor(h[2]/u),v=Te(d,f,p),m=a[v];if(!m){var g=[d*u,f*u,p*u],y=[0,0,0];e.noa.globalToLocal(g,null,y),m=l(y,u),o.blocks.push(m),a[v]=m,m._noaMapKey=v}m.entries.push(t),t.metadata[n]=m,t.metadata[s]=!0,t.alwaysSelectAsActiveMesh=!0},this.removeMesh=e=>{if(e.metadata&&(e.metadata[i]&&(Pe(o.dynamicContent,e),e.metadata[i]=!1),e.metadata[s])){var t=e.metadata[n];t&&t.entries&&(Pe(t.entries,e),0===t.entries.length&&(delete a[t._noaMapKey],Pe(o.blocks,t))),e.metadata[n]=null,e.metadata[s]=!1}},this.setMeshVisibility=(e,t=!1)=>{if(e.metadata[n]){if(e.metadata[s]===t)return;var r=e.metadata[n];r&&r.entries&&(t?r.entries.push(e):Pe(r.entries,e)),e.metadata[s]=t}else{if(e.metadata[i]===t)return;t?o.dynamicContent.push(e):Pe(o.dynamicContent,e),e.metadata[i]=t}};var h=()=>{},u=t*e.noa.world._chunkSize,c=(e,t)=>{e.blocks.forEach(e=>{e.minPoint.subtractInPlace(t),e.maxPoint.subtractInPlace(t),e._boundingVectors.forEach(e=>e.subtractInPlace(t)),e.blocks&&c(e,t)})},l=(e,t)=>{var r=new st.Pq(e[0],e[1],e[2]),n=new st.Pq(e[0]+t,e[1]+t,e[2]+t);return new at.I(r,n,void 0,void 0,void 0,h)}}}var ct=r(8494),lt=r(8561),dt=r(2604),ft=r(4432),pt=r(4891),vt=r(3482),mt={showFPS:!1,antiAlias:!0,clearColor:[.8,.9,1],ambientColor:[.5,.5,.5],lightDiffuse:[1,1,1],lightSpecular:[1,1,1],lightVector:[1,-1,.5],useAO:!0,AOmultipliers:[.93,.8,.5],reverseAOmultiplier:1,preserveDrawingBuffer:!0,octreeBlockSize:2,renderOnResize:!0};class gt{constructor(e,t,r){t=Object.assign({},mt,t),this.noa=e,this.renderOnResize=!!t.renderOnResize,this.useAO=!!t.useAO,this.aoVals=t.AOmultipliers,this.revAoVal=t.reverseAOmultiplier,this.meshingCutoffTime=6,this.engine=null,this.scene=null,this.light=null,this.camera=null,this._initScene(r,t),t.showFPS&&function(){var e=document.createElement("div");e.id="noa_fps",e.style.position="absolute",e.style.top="0",e.style.right="0",e.style.zIndex="0",e.style.color="white",e.style.backgroundColor="rgba(0,0,0,0.5)",e.style.font="14px monospace",e.style.textAlign="center",e.style.minWidth="2em",e.style.margin="4px",document.body.appendChild(e);var t=0,r=0,n=performance.now(),i=n;kt=function(){t++;var s=performance.now();if(s-i>r&&(r=s-i),i=s,!(s-n<1e3)){var o=Math.round(t/(s-n)*1e3),a=Math.round(1/r*1e3);e.innerHTML=o+"<br>"+a,t=0,r=0,n=s}}}()}_initScene(e,t){this.engine=new je.N(e,t.antiAlias,{preserveDrawingBuffer:t.preserveDrawingBuffer});var r=new ct.Z(this.engine);this.scene=r,r.detachControl(),r.performancePriority=ct.F.Intermediate,r.autoClear=!0;var n=Math.round(t.octreeBlockSize);this._octreeManager=new ut(this,n),this._cameraHolder=new Ce.V("camHolder",r),this.camera=new lt.S("camera",new st.Pq(0,0,0),r),this.camera.parent=this._cameraHolder,this.camera.minZ=.01,this._camScreen=(0,vt.x)("camScreen",{size:10},r),this.addMeshToScene(this._camScreen),this._camScreen.position.z=.1,this._camScreen.parent=this.camera,this._camScreenMat=this.makeStandardMaterial("camera_screen_mat"),this._camScreen.material=this._camScreenMat,this._camScreen.setEnabled(!1),this._camScreenMat.freeze(),this._camLocBlock=0,r.clearColor=pe.ov.FromArray(t.clearColor),r.ambientColor=pe.v9.FromArray(t.ambientColor);var i=st.Pq.FromArray(t.lightVector);this.light=new dt.Z("light",i,r),this.light.diffuse=pe.v9.FromArray(t.lightDiffuse),this.light.specular=pe.v9.FromArray(t.lightSpecular),r.skipPointerMovePicking=!0}}gt.prototype.getScene=function(){return this.scene},gt.prototype.tick=function(e){},gt.prototype.render=function(){bt("start"),function(e){var t=e.noa.camera,r=t._localGetTargetPosition();e._cameraHolder.position.copyFromFloats(r[0],r[1],r[2]),e._cameraHolder.rotation.x=t.pitch,e._cameraHolder.rotation.y=t.heading,e.camera.position.z=-t.currentZoom;var n=t._localGetPosition(),i=e.noa.worldOriginOffset,s=Math.floor(n[0]+i[0]),o=Math.floor(n[1]+i[1]),a=Math.floor(n[2]+i[2]),h=e.noa.getBlock(s,o,a);!function(e,t){if(t!==e._camLocBlock){if(0===t)e._camScreen.setEnabled(!1);else{var r=e.noa.registry.getBlockFaceMaterial(t,0);if(r){var n=e.noa.registry.getMaterialData(r),i=n.color,s=n.alpha;i&&s&&s<1&&(e._camScreenMat.diffuseColor.set(0,0,0),e._camScreenMat.ambientColor.set(i[0],i[1],i[2]),e._camScreenMat.alpha=s,e._camScreen.setEnabled(!0))}}e._camLocBlock=t}}(e,h)}(this),bt("updateCamera"),this.engine.beginFrame(),bt("beginFrame"),this.scene.render(),bt("render"),kt(),this.engine.endFrame(),bt("endFrame"),bt("end")},gt.prototype.postRender=function(){},gt.prototype.resize=function(){this.engine.resize(),this.noa._paused&&this.renderOnResize&&this.scene.render()},gt.prototype.highlightBlockFace=function(e,t,r){var n=function(e){var t=e._highlightMesh;if(!t){t=(0,vt.x)("highlight",{size:1},e.scene);var r=e.makeStandardMaterial("block_highlight_mat");r.backFaceCulling=!1,r.emissiveColor=new pe.v9(1,1,1),r.alpha=.2,r.freeze(),t.material=r;var n=.5,i=(0,pt.sh)("hightlightLines",{points:[new st.Pq(n,n,0),new st.Pq(n,-n,0),new st.Pq(-n,-n,0),new st.Pq(-n,n,0),new st.Pq(n,n,0)]},e.scene);i.color=new pe.v9(1,1,1),i.parent=t,e.addMeshToScene(t),e.addMeshToScene(i),e._highlightMesh=t}return t}(this);if(e){this.noa.globalToLocal(t,null,yt);for(var i=.001+.001*o().dist(this.noa.camera._localGetPosition(),yt),s=0;s<3;s++)0===r[s]?yt[s]+=.5:yt[s]+=r[s]>0?1+i:-i;n.position.copyFromFloats(yt[0],yt[1],yt[2]),n.rotation.x=r[1]?Math.PI/2:0,n.rotation.y=r[0]?Math.PI/2:0}n.setEnabled(e)};var yt=[];gt.prototype.addMeshToScene=function(e,t=!1,r=null,n=null){if(e.metadata||(e.metadata={}),e.metadata[_t])this._octreeManager.setMeshVisibility(e,!0);else{if(e.metadata[_t]=!0,!e.parent){r||(r=e.position.asArray());var i=this.noa.globalToLocal(r,null,[]);e.position.fromArray(i)}this._octreeManager.addMesh(e,t,r,n),e.onDisposeObservable.add(()=>{this._octreeManager.removeMesh(e),e.metadata[_t]=!1})}};var _t="noa_added_to_scene";gt.prototype.setMeshVisibility=function(e,t=!1){e.metadata||(e.metadata={}),e.metadata[_t]?this._octreeManager.setMeshVisibility(e,t):t&&this.addMeshToScene(e)},gt.prototype.makeStandardMaterial=function(e){var t=new ft.F(e,this.scene);return t.specularColor.copyFromFloats(0,0,0),t.ambientColor.copyFromFloats(1,1,1),t.diffuseColor.copyFromFloats(1,1,1),t},gt.prototype.prepareChunkForRendering=function(e){},gt.prototype.disposeChunkForRendering=function(e){},gt.prototype._rebaseOrigin=function(e){var t=new st.Pq(e[0],e[1],e[2]);this.scene.meshes.forEach(e=>{e.parent||(e.position.subtractInPlace(t),e.isWorldMatrixFrozen&&e.freezeWorldMatrix())}),this._octreeManager.rebase(t)},gt.prototype.debug_SceneCheck=function(){var e=this.scene.meshes,t=this.scene._selectionOctree,r=t.dynamicContent,n=[],i=0,s=0,o=this.scene.materials,a=[];o.forEach(e=>{e.subMaterials?e.subMaterials.forEach(e=>a.push(e)):a.push(e)}),t.blocks.forEach(function(e){i++,e.entries.forEach(e=>n.push(e))}),e.forEach(function(e){if(e.isDisposed()&&c(e,"disposed mesh in scene"),!function(e){return 0===e.getIndices().length}(e))if(l(e,r,n)&&c(e,"non-empty mesh missing from octree"),e.material){s+=e.subMeshes?e.subMeshes.length:1;var t=e.material.subMaterials||[e.material];t.forEach(function(e){l(e,t)&&c(e,"mesh material not in scene")})}else c(e,"non-empty scene mesh with no material")});var h=[];a.forEach(t=>{var r=!1;e.forEach(e=>{e.material===t&&(r=!0),e.material&&(e.material.subMaterials||[e.material]).includes(t)&&(r=!0)}),r||h.push(t.name)}),h.length&&console.warn("Materials unused by any mesh: ",h.join(", ")),r.forEach(function(t){l(t,e)&&c(t,"octree/dynamic mesh not in scene")}),n.forEach(function(t){l(t,e)&&c(t,"octree block mesh not in scene")});var u=Math.round(10*n.length/i)/10;function c(e,t){console.warn(e.name+" --- "+t)}function l(e,t,r){return!(!e||t.includes(e)||r&&r.includes(e))}return console.log("meshes - octree:",n.length,"  dynamic:",r.length,"   subMeshes:",s,"   avg meshes/octreeBlock:",u),"done."},gt.prototype.debug_MeshCount=function(){var e={};for(var t in this.scene.meshes.forEach(t=>{var r=t.name||"";r=(r=(r=(r=r.replace(/-\d+.*/,"#")).replace(/\d+.*/,"#")).replace(/(rotHolder|camHolder|camScreen)/,"rendering use")).replace(/atlas sprite .*/,"atlas sprites"),e[r]=e[r]||0,e[r]++}),e)console.log("   "+(e[t]+"       ").substr(0,7)+t)};var bt=()=>{},kt=function(){};class wt{constructor(e,t,r,n,i,s,a){this.aabb=new(S())(e.base,e.vec),this.mass=t,this.friction=r,this.restitution=n,this.gravityMultiplier=i,this.onCollide=s,this.autoStep=!!a,this.airDrag=-1,this.fluidDrag=-1,this.onStep=null,this.velocity=o().create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=o().create(),this._impulses=o().create(),this._sleepFrameCount=10}setPosition(e){xt(e),o().subtract(e,e,this.aabb.base),this.aabb.translate(e),this._markActive()}getPosition(){return o().clone(this.aabb.base)}applyForce(e){xt(e),o().add(this._forces,this._forces,e),this._markActive()}applyImpulse(e){xt(e),o().add(this._impulses,this._impulses,e),this._markActive()}_markActive(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var xt=e=>{};function Mt(){this.airDrag=.1,this.fluidDrag=.4,this.fluidDensity=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function Ct(e,t,r){e=Object.assign(new Mt,e),this.gravity=e.gravity||[0,-10,0],this.airDrag=e.airDrag||.1,this.fluidDensity=e.fluidDensity||2,this.fluidDrag=e.fluidDrag||.4,this.minBounceImpulse=e.minBounceImpulse,this.bodies=[],this.testSolid=t,this.testFluid=r}Ct.prototype.addBody=function(e,t,r,n,i,s){e=e||new(S())([0,0,0],[1,1,1]),void 0===t&&(t=1),void 0===r&&(r=1),void 0===n&&(n=0),void 0===i&&(i=1);var o=new wt(e,t,r,n,i,s);return this.bodies.push(o),o},Ct.prototype.removeBody=function(e){var t=this.bodies.indexOf(e);t<0||(this.bodies.splice(t,1),e.aabb=e.onCollide=null)};var Pt=o().create(),Tt=o().create(),It=o().create(),Dt=o().create(),At=o().create();Ct.prototype.tick=function(e){e/=1e3;var t=Nt(0,o().squaredLength(this.gravity));this.bodies.forEach(r=>function(e,t,r,n){if(o().copy(At,t.resting),t.mass<=0)return o().set(t.velocity,0,0,0),o().set(t._forces,0,0,0),void o().set(t._impulses,0,0,0);if(!function(e,t,r,n){if(t._sleepFrameCount>0)return!1;if(n)return!0;var i=!1,s=.5*r*r*t.gravityMultiplier;return o().scale(Ut,e.gravity,s),F()(e.testSolid,t.aabb,Ut,function(){return i=!0,!0},!0),i}(e,t,r,n||0===t.gravityMultiplier)){t._sleepFrameCount--,function(e,t){var r=t.aabb,n=Math.floor(r.base[0]),i=Math.floor(r.base[2]),s=Math.floor(r.base[1]),a=Math.floor(r.max[1]);if(!e.testFluid(n,s,i))return t.inFluid=!1,void(t.ratioInFluid=0);for(var h=1,u=s+1;u<=a&&e.testFluid(n,u,i);)h++,u++;var c=(s+h-r.base[1])/r.vec[1];c>1&&(c=1);var l=r.vec[0]*r.vec[1]*r.vec[2]*c,d=Et;o().scale(d,e.gravity,-e.fluidDensity*l),t.applyForce(d),t.inFluid=!0,t.ratioInFluid=c}(e,t),qt(t._forces),qt(t._impulses),qt(t.velocity),qt(t.resting),o().scale(Pt,t._forces,1/t.mass),o().scaleAndAdd(Pt,Pt,e.gravity,t.gravityMultiplier),o().scale(Tt,t._impulses,1/t.mass),o().scaleAndAdd(Tt,Tt,Pt,r),o().add(t.velocity,t.velocity,Tt),t.friction&&(St(0,t,Tt),St(1,t,Tt),St(2,t,Tt));var i=t.airDrag>=0?t.airDrag:e.airDrag;t.inFluid&&(i=t.fluidDrag>=0?t.fluidDrag:e.fluidDrag,i*=1-(1-t.ratioInFluid)**2);var s=Math.max(1-i*r/t.mass,0);o().scale(t.velocity,t.velocity,s),o().scale(It,t.velocity,r),o().set(t._forces,0,0,0),o().set(t._impulses,0,0,0),t.autoStep&&Vt(Rt,t.aabb),Ft(e,t.aabb,It,t.resting),t.autoStep&&function(e,t,r,n){if(!(t.resting[1]>=0)||t.inFluid){var i=0!==t.resting[0],s=0!==t.resting[2];if(i||s){var a=Math.abs(n[0]/n[2]);if((i||!(a>4))&&(s||!(a<1/4))){o().add(jt,r.base,n);var h=e.testSolid;F()(h,r,n,function(e,t,r,n){if(1!==t)return!0;n[t]=0});var u=t.aabb.base[1],c=Math.floor(u+1.001)-u;o().set(Ot,0,c,0);var l=!1;F()(h,r,Ot,function(e,t,r,n){return l=!0,!0}),l||(o().subtract(zt,jt,r.base),zt[1]=0,Ft(e,r,zt,Bt),(!i||Nt(r.base[0],jt[0]))&&(s&&!Nt(r.base[2],jt[2])||(Vt(t.aabb,r),t.resting[0]=Bt[0],t.resting[2]=Bt[2],t.onStep&&t.onStep())))}}}}(e,t,Rt,It);for(var a=0;a<3;++a)Dt[a]=0,t.resting[a]&&(At[a]||(Dt[a]=-t.velocity[a]),t.velocity[a]=0);var h=o().length(Dt);h>.001&&(o().scale(Dt,Dt,t.mass),t.onCollide&&t.onCollide(Dt),t.restitution>0&&h>e.minBounceImpulse&&(o().scale(Dt,Dt,t.restitution),t.applyImpulse(Dt))),o().squaredLength(t.velocity)>1e-5&&t._markActive()}}(this,r,e,t))};var Et=o().create();function St(e,t,r){var n=t.resting[e],i=r[e];if(0!==n&&!(n*i<=0)){o().copy(Lt,t.velocity),Lt[e]=0;var s=o().length(Lt);if(!Nt(s,0)){var a=Math.abs(t.friction*i),h=s>a?(s-a)/s:0;t.velocity[(e+1)%3]*=h,t.velocity[(e+2)%3]*=h}}}var Lt=o().create();function Ft(e,t,r,n){return o().set(n,0,0,0),F()(e.testSolid,t,r,function(e,t,r,i){n[t]=r,i[t]=0})}var Rt=new(S())([],[]),Bt=o().create(),jt=o().create(),Ot=o().create(),zt=o().create(),Ut=o().create();function Nt(e,t){return Math.abs(e-t)<1e-5}function Vt(e,t){for(var r=0;r<3;r++)e.base[r]=t.base[r],e.max[r]=t.max[r],e.vec[r]=t.vec[r]}var qt=function(e){},Ht={gravity:[0,-10,0],airDrag:.1};class Gt extends Ct{constructor(e,t){t=Object.assign({},Ht,t);var r=e.world,n=e.registry._solidityLookup,i=e.registry._fluidityLookup,s=e.worldOriginOffset;super(t,(e,t,i)=>{var o=r.getBlockID(e+s[0],t+s[1],i+s[2]);return n[o]},(e,t,n)=>{var o=r.getBlockID(e+s[0],t+s[1],n+s[2]);return i[o]})}}function Kt(e,t,r,n,i,s,o,a=-1){this.noa=e,this.isDisposed=!1,this.userData=null,this.requestID=t,this.voxels=o,this.i=r,this.j=n,this.k=i,this.size=s,this.x=r*s,this.y=n*s,this.z=i*s,this.pos=[this.x,this.y,this.z],this._terrainDirty=!1,this._objectsDirty=!1,this._terrainMeshes=[],e._terrainMesher.initChunk(this),e._objectMesher.initChunk(this),this._isFull=!1,this._isEmpty=!1,this._wholeLayerVoxel=Array(s).fill(-1),a>=0&&(this.voxels.data.fill(a,0,this.voxels.size),this._wholeLayerVoxel.fill(a));var u=Array.from(Array(27),()=>null);this._neighbors=h()(u,[3,3,3]).lo(1,1,1),this._neighbors.set(0,0,0,this),this._neighborCount=0,this._timesMeshed=0,this._blockHandlerLocs=new De,Yt(this)}function $t(e,t,r,n,i,s){var o=t[r];o&&o(e.x+n,e.y+i,e.z+s)}function Yt(e){for(var t=e.voxels,r=t.data,n=t.shape[0],i=e.noa.registry._opacityLookup,s=e.noa.registry._blockHandlerLookup,o=e.noa.registry._objectLookup,a=e.noa.registry._blockIsPlainLookup,h=e.noa._objectMesher,u=!0,c=!0,l=0;l<n;++l){var d=e._wholeLayerVoxel[l];if(d>=0&&!h[d]&&!s[d])i[d]||(u=!1),0!==d&&(c=!1);else{for(var f=t.get(0,l,0),p=0;p<n;++p)for(var v=t.index(p,l,0),m=0;m<n;++m,++v){var g=r[v];if(f>=0&&g!==f&&(f=-1),0!==g)if(a[g])c=!1;else{u=u&&i[g],c=!1,o[g]&&(h.setObjectBlock(e,g,p,l,m),e._objectsDirty=!0);var y=s[g];y&&(e._blockHandlerLocs.add(p,l,m),$t(e,y,"onLoad",p,l,m))}else u=!1}f>=0&&(e._wholeLayerVoxel[l]=f)}}e._isFull=u,e._isEmpty=c,e._terrainDirty=!e._isEmpty}function Zt(e,t){var r=e.voxels,n=e.noa.registry._blockHandlerLookup;e._blockHandlerLocs.arr.forEach(([i,s,o])=>{var a=r.get(i,s,o);$t(e,n[a],t,i,s,o)})}Kt._createVoxelArray=function(e){var t=new Uint16Array(e*e*e);return h()(t,[e,e,e])},Kt.prototype._updateVoxelArray=function(e,t=-1){Zt(this,"onUnload"),this.noa._objectMesher.disposeChunk(this),this.noa._terrainMesher.disposeChunk(this),this.voxels=e,this._terrainDirty=!1,this._objectsDirty=!1,this._blockHandlerLocs.empty(),this.noa._objectMesher.initChunk(this),this.noa._terrainMesher.initChunk(this),t>=0?this._wholeLayerVoxel.fill(t):this._wholeLayerVoxel.fill(-1),Yt(this)},Kt.prototype.get=function(e,t,r){return this.voxels.get(e,t,r)},Kt.prototype.getSolidityAt=function(e,t,r){return this.noa.registry._solidityLookup[this.voxels.get(e,t,r)]},Kt.prototype.set=function(e,t,r,n){var i=this.voxels.get(e,t,r);if(n!==i){this.voxels.set(e,t,r,n);var s=this.noa.registry._solidityLookup,o=this.noa.registry._objectLookup,a=this.noa.registry._opacityLookup,h=this.noa.registry._blockHandlerLookup;a[n]||(this._isFull=!1),0!==n&&(this._isEmpty=!1),this._wholeLayerVoxel[t]!==n&&(this._wholeLayerVoxel[t]=-1);var u=h[i],c=h[n];u&&$t(this,u,"onUnset",e,t,r),c?($t(this,c,"onSet",e,t,r),this._blockHandlerLocs.add(e,t,r)):this._blockHandlerLocs.remove(e,t,r);var l=this.noa._objectMesher,d=o[i],f=o[n];d&&l.setObjectBlock(this,0,e,t,r),f&&l.setObjectBlock(this,n,e,t,r);var p=s[i]!==s[n],v=a[i]!==a[n],m=!d&&0!==i,g=!f&&0!==n;if((d||f)&&(this._objectsDirty=!0),(p||v||m||g)&&(this._terrainDirty=!0),(this._terrainDirty||this._objectsDirty)&&this.noa.world._queueChunkForRemesh(this),p||v)for(var y=this.size-1,_=0===t?-1:0,b=0===r?-1:0,k=e===y?1:0,w=t===y?1:0,x=r===y?1:0,M=0===e?-1:0;M<=k;M++)for(var C=_;C<=w;C++)for(var P=b;P<=x;P++)if(0!==(M|C|P)){var T=this._neighbors.get(M,C,P);T&&(T._terrainDirty=!0,this.noa.world._queueChunkForRemesh(T))}}},Kt.prototype.updateMeshes=function(){this._terrainDirty&&(this.noa._terrainMesher.meshChunk(this),this._timesMeshed++,this._terrainDirty=!1),this._objectsDirty&&(this.noa._objectMesher.buildObjectMeshes(),this._objectsDirty=!1)},Kt.prototype.dispose=function(){Zt(this,"onUnload"),this._blockHandlerLocs.empty(),this.noa._objectMesher.disposeChunk(this),this.noa._terrainMesher.disposeChunk(this),this.voxels.data=null,this.voxels=null,this._neighbors.data=null,this._neighbors=null,this.isDisposed=!0};var Wt={chunkSize:24,chunkAddDistance:[2,2],chunkRemoveDistance:[3,3],worldGenWhilePaused:!1,manuallyControlChunkLoading:!1};class Xt extends(i()){constructor(e,t){super(),t=Object.assign({},Wt,t),this.noa=e,this.playerChunkLoaded=!1,this.Chunk=Kt,this.manuallyControlChunkLoading=!!t.manuallyControlChunkLoading,this.chunkSortingDistFn=fr,this.minNeighborsToMesh=6,this.worldGenWhilePaused=!!t.worldGenWhilePaused,this.maxChunksPendingCreation=50,this.maxChunksPendingMeshing=50,this.maxProcessingPerTick=5,this.maxProcessingPerRender=3,this._chunkSize=t.chunkSize,this._chunkAddDistance=[2,2],this._chunkRemoveDistance=[3,3],this._addDistanceFn=null,this._remDistanceFn=null,this._prevWorldName="",this._prevPlayerChunkHash=0,this._chunkAddSearchFrom=0,this._prevSortingFn=null,this._sortMeshQueueEvery=0,this._chunksKnown=new De,this._chunksToRequest=new De,this._chunksInvalidated=new De,this._chunksToRemove=new De,this._chunksPending=new De,this._chunksToMesh=new De,this._chunksToMeshFirst=new De,this._chunksSortedLocs=new De,this.setAddRemoveDistance(t.chunkAddDistance,t.chunkRemoveDistance),this._storage=new Ie;var r=this._chunkSize;this._coordsToChunkIndexes=hr,this._coordsToChunkLocals=ur,!(r&r-1)&&(this._coordShiftBits=0|Math.log2(r),this._coordMask=r-1|0,this._coordsToChunkIndexes=cr,this._coordsToChunkLocals=lr)}}Xt.prototype.getBlockID=function(e=0,t=0,r=0){var[n,i,s]=this._coordsToChunkIndexes(e,t,r),o=this._storage.getChunkByIndexes(n,i,s);if(!o)return 0;var[a,h,u]=this._coordsToChunkLocals(e,t,r);return o.voxels.get(a,h,u)},Xt.prototype.getBlockSolidity=function(e=0,t=0,r=0){var[n,i,s]=this._coordsToChunkIndexes(e,t,r),o=this._storage.getChunkByIndexes(n,i,s);if(!o)return!1;var[a,h,u]=this._coordsToChunkLocals(e,t,r);return!!o.getSolidityAt(a,h,u)},Xt.prototype.getBlockOpacity=function(e=0,t=0,r=0){var n=this.getBlockID(e,t,r);return this.noa.registry.getBlockOpacity(n)},Xt.prototype.getBlockFluidity=function(e=0,t=0,r=0){var n=this.getBlockID(e,t,r);return this.noa.registry.getBlockFluidity(n)},Xt.prototype.getBlockProperties=function(e=0,t=0,r=0){var n=this.getBlockID(e,t,r);return this.noa.registry.getBlockProps(n)},Xt.prototype.setBlockID=function(e=0,t=0,r=0,n=0){var[i,s,o]=this._coordsToChunkIndexes(t,r,n),a=this._storage.getChunkByIndexes(i,s,o);if(a){var[h,u,c]=this._coordsToChunkLocals(t,r,n);return a.set(h,u,c,e)}},Xt.prototype.isBoxUnobstructed=function(e){for(var t=e.base,r=e.max,n=Math.floor(t[0]);n<r[0]+1;n++)for(var i=Math.floor(t[1]);i<r[1]+1;i++)for(var s=Math.floor(t[2]);s<r[2]+1;s++)if(this.getBlockSolidity(n,i,s))return!1;return!0},Xt.prototype.setChunkData=function(e,t,r=null,n=-1){!function(e,t,r,n,i){var s=t.split("|"),o=parseInt(s.shift()),a=parseInt(s.shift()),h=parseInt(s.shift()),u=s.join("|");if(e._chunksPending.remove(o,a,h),u===e.noa.worldName&&e._chunksKnown.includes(o,a,h)&&!e._chunksToRemove.includes(o,a,h)){var c=e._storage.getChunkByIndexes(o,a,h);if(c)c._updateVoxelArray(r,i);else{var l=e._chunkSize;c=new Kt(e.noa,t,o,a,h,l,r,i),e._storage.storeChunkByIndexes(o,a,h,c),c.userData=n,e.noa.rendering.prepareChunkForRendering(c),e.emit("chunkAdded",c)}ar(e,c),pr(e,o,a,h,c),yr("receive")}}(this,e,t,r,n)},Xt.prototype.setAddRemoveDistance=function(e=2,t=3){var r=Array.isArray(e)?e:[e,e],n=Array.isArray(t)?t:[t,t];n[0]<r[0]+1&&(n[0]=r[0]+1),n[1]<r[1]+1&&(n[1]=r[1]+1),this._chunkAddDistance=r,this._chunkRemoveDistance=n,this._addDistanceFn=vr(r[0],r[1]),this._remDistanceFn=vr(n[0],n[1]),this._chunksSortedLocs.empty();for(var i=0;i<=r[0];i++)for(var s=0;s<=i;s++)for(var o=0;o<=r[1];o++)this._addDistanceFn(i,o,s)&&this._chunksSortedLocs.add(i,o,s);this._prevSortingFn=null,this._chunkAddSearchFrom=0},Xt.prototype.invalidateVoxelsInAABB=function(e){!function(e,t){for(var r=e._coordsToChunkIndexes(t.base[0],t.base[1],t.base[2]),n=e._coordsToChunkIndexes(t.max[0],t.max[1],t.max[2]),i=0;i<3;i++)Number.isFinite(t.base[i])||(r[i]=t.base[i]),Number.isFinite(t.max[i])||(n[i]=t.max[i]);e._chunksKnown.forEach(t=>{var[i,s,o]=t;i<r[0]||i>=n[0]||s<r[1]||s>=n[1]||o<r[2]||o>=n[2]||(e._chunksInvalidated.add(i,s,o),e._chunksToRemove.remove(i,s,o),e._chunksToRequest.remove(i,s,o),e._chunksToMesh.remove(i,s,o),e._chunksToMeshFirst.remove(i,s,o))})}(this,e)},Xt.prototype.manuallyLoadChunk=function(e=0,t=0,r=0){if(!this.manuallyControlChunkLoading)throw Qt;var[n,i,s]=this._coordsToChunkIndexes(e,t,r);this._chunksKnown.add(n,i,s),this._chunksToRequest.add(n,i,s)},Xt.prototype.manuallyUnloadChunk=function(e=0,t=0,r=0){if(!this.manuallyControlChunkLoading)throw Qt;var[n,i,s]=this._coordsToChunkIndexes(e,t,r);this._chunksToRemove.add(n,i,s),this._chunksToMesh.remove(n,i,s),this._chunksToRequest.remove(n,i,s),this._chunksToMeshFirst.remove(n,i,s)};var Qt="Set `noa.world.manuallyControlChunkLoading` if you need this API";function Jt(e){var[t,r,n]=e.noa.entities.getPosition(e.noa.playerEntity);return e._coordsToChunkIndexes(t,r,n)}Xt.prototype.tick=function(){var e,t=performance.now(),[r,n,i]=Jt(this),s=Te(r,n,i);s!==this._prevPlayerChunkHash&&(this.emit("playerEnteredChunk",r,n,i),this._prevPlayerChunkHash=s,this._chunkAddSearchFrom=0),this._prevWorldName!==this.noa.worldName&&(this.manuallyControlChunkLoading||((e=this)._chunksInvalidated.copyFrom(e._chunksKnown),e._chunksToRemove.empty(),e._chunksToRequest.empty(),e._chunksToMesh.empty(),e._chunksToMeshFirst.empty(),dr(e,e._chunksInvalidated),this._chunkAddSearchFrom=0,sr(this)),this._prevWorldName=this.noa.worldName),gr("start"),yr("start"),this.manuallyControlChunkLoading||(function(e,t,r,n){var i=e._remDistanceFn,s=e._chunksToRemove,o=s.count()+e._chunksInvalidated.count();if(!(o>=50)){var a=e._chunksKnown.arr;if(0!==a.length){for(var h=Math.min(100,a.length/10),u=!1,c=0;c<h;c++){var[l,d,f]=a[rr++%a.length];if(!s.includes(l,d,f)&&!i(l-t,d-r,f-n)&&(e._chunksToRemove.add(l,d,f),e._chunksToRequest.remove(l,d,f),e._chunksToMesh.remove(l,d,f),e._chunksToMeshFirst.remove(l,d,f),u=!0,++o>50))break}rr%=a.length,u&&dr(e,s,t,r,n)}}}(this,r,n,i),gr("remQueue"),function(e,t,r,n){var i=e._chunksToRequest;if(!(i.count()>=50)){var s=e.chunkSortingDistFn||fr;s!==e._prevSortingFn&&(dr(e,e._chunksSortedLocs,0,0,0,!0),e._prevSortingFn=s);for(var o=e._chunksSortedLocs.arr,a=e._chunkAddSearchFrom,h=Math.min(20,o.length/10),u=0;u<h;u++){var[c,l,d]=o[a++%o.length];if(er(e,t,r,n,c,l,d),i.count()>=50)break}e._chunksInvalidated.isEmpty()&&(e._chunkAddSearchFrom=a%o.length),dr(e,i,t,r,n,!1)}}(this,r,n,i),gr("addQueue")),function(e){var t=e._chunksToMesh.count()+e._chunksToMeshFirst.count();if(!(t>10)){for(var r=e._chunksKnown.arr,n=Math.min(50,r.length/10),i=0;i<n;i++){var[s,o,a]=r[nr++%r.length],h=e._storage.getChunkByIndexes(s,o,a);if(h&&(ar(e,h)&&t++,t>10))break}nr%=r.length}}(this);var o=performance.now(),a=t+(this.maxProcessingPerTick||0);o<a&&(a=o+1);for(var h=!1,u=!1,c=!1;o<a&&(h||(h=sr(this)||sr(this),gr("removes")),u||(u=ir(this),gr("requests")),c||(c=or(this,!1),gr("meshes")),!(h&&u&&c));)o=performance.now();var l=this._storage.getChunkByIndexes(r,n,i);this.playerChunkLoaded=!!l,yr("end",this),gr("end")},Xt.prototype.render=function(){for(var e=performance.now(),t=e+this.maxProcessingPerRender;e<t&&!or(this,!0);)e=performance.now()},Xt.prototype._getChunkByCoords=function(e=0,t=0,r=0){var[n,i,s]=this._coordsToChunkIndexes(e,t,r);return this._storage.getChunkByIndexes(n,i,s)},Xt.prototype._queueChunkForRemesh=function(e){ar(this,e)};var er=(e,t,r,n,i,s,o)=>{tr(e,t+i,r+s,n+o),i!==o&&tr(e,t+o,r+s,n+i),i>0&&er(e,t,r,n,-i,s,o),s>0&&er(e,t,r,n,i,-s,o),o>0&&er(e,t,r,n,i,s,-o)},tr=(e,t,r,n)=>{e._chunksKnown.includes(t,r,n)||(e._chunksKnown.add(t,r,n),e._chunksToRequest.add(t,r,n,!0))},rr=0,nr=0;function ir(e){var t=e._chunksToRequest;if(t.isEmpty())return!0;var r=e._chunksPending.count(),n=e._chunksToMesh.count();if(r>=e.maxChunksPendingCreation)return!0;if(n>=e.maxChunksPendingMeshing)return!0;var[i,s,o]=t.pop();return function(e,t,r,n){var i=e._chunkSize,s=Kt._createVoxelArray(e._chunkSize),o=e.noa.worldName,a=[t,r,n,o].join("|"),h=t*i,u=r*i,c=n*i;e._chunksPending.add(t,r,n),e.emit("worldDataNeeded",a,s,h,u,c,o),yr("request")}(e,i,s,o),t.isEmpty()}function sr(e){var t=e._chunksInvalidated;if(t.isEmpty()&&(t=e._chunksToRemove),t.isEmpty())return!0;var[r,n,i]=t.pop();return function(e,t,r,n){var i=e._storage.getChunkByIndexes(t,r,n);i&&(e.emit("chunkBeingRemoved",i.requestID,i.voxels,i.userData),e.noa.rendering.disposeChunkForRendering(i),i.dispose(),yr("dispose"),pr(e,t,r,n,null)),e._storage.removeChunkByIndexes(t,r,n),e._chunksKnown.remove(t,r,n),e._chunksToMesh.remove(t,r,n),e._chunksToRemove.remove(t,r,n),e._chunksToMeshFirst.remove(t,r,n)}(e,r,n,i),t.isEmpty()}function or(e,t){var r=e._chunksToMeshFirst;if(r.isEmpty()&&!t&&(r=e._chunksToMesh),r.isEmpty())return!0;var[n,i,s]=r.pop();if(!e._chunksToRemove.includes(n,i,s)){var o=e._storage.getChunkByIndexes(n,i,s);o&&function(e,t){e._chunksToMesh.remove(t.i,t.j,t.k),e._chunksToMeshFirst.remove(t.i,t.j,t.k),t.updateMeshes(),yr("mesh")}(e,o)}}function ar(e,t){if(!t._terrainDirty&&!t._objectsDirty)return!1;if(t._neighborCount<t.minNeighborsToMesh)return!1;if(e._chunksToMesh.includes(t.i,t.j,t.k))return!1;if(e._chunksToMeshFirst.includes(t.i,t.j,t.k))return!1;var r=26===t._neighborCount?e._chunksToMeshFirst:e._chunksToMesh;return r.add(t.i,t.j,t.k),e._sortMeshQueueEvery++,e._sortMeshQueueEvery>20&&(dr(e,r),e._sortMeshQueueEvery=0),!0}function hr(e,t,r){var n=this._chunkSize;return[0|Math.floor(e/n),0|Math.floor(t/n),0|Math.floor(r/n)]}function ur(e,t,r){var n=this._chunkSize,i=e%n|0;i<0&&(i+=n);var s=t%n|0;s<0&&(s+=n);var o=r%n|0;return o<0&&(o+=n),[i,s,o]}function cr(e,t,r){var n=this._coordShiftBits;return[e>>n|0,t>>n|0,r>>n|0]}function lr(e,t,r){var n=this._coordMask;return[e&n|0,t&n|0,r&n|0]}function dr(e,t,r,n,i,s=!1){var o=e.chunkSortingDistFn||fr;void 0===r&&([r,n,i]=Jt(e)),t.sortByDistance((e,t,s)=>o(r-e,n-t,i-s),s)}var fr=(e,t,r)=>e*e+t*t+r*r;function pr(e,t,r,n,i){for(var s=!i||i&&!i.isEmpty,o=-1;o<=1;o++)for(var a=-1;a<=1;a++)for(var h=-1;h<=1;h++)if(0!==(o|a|h)){var u=e._storage.getChunkByIndexes(t+o,r+a,n+h);if(u){s&&(u._terrainDirty=!0),i&&!i._neighbors.get(o,a,h)&&(i._neighborCount++,i._neighbors.set(o,a,h,u));var c=u._neighbors.get(-o,-a,-h);i&&!c&&(u._neighborCount++,u._neighbors.set(-o,-a,-h,i),26===u._neighborCount&&ar(e,u)),!i&&c&&(u._neighborCount--,u._neighbors.set(-o,-a,-h,null))}}}function vr(e,t){var r=e*e,n=t*t;return e===t?(e,t,n)=>e*e+t*t+n*n<=r:e>t?(e,n,i)=>!(Math.abs(n)>t)&&e*e+n*n+i*i<=r:(e,t,i)=>{var s=e*e+i*i;return!(s>r)&&s+t*t<=n}}function mr(e,t,r,n){var i=0,s=0,o=0,a=0,h=[];r.forEach(t=>{var r=e._storage.getChunkByIndexes(t[0],t[1],t[2]);r&&(o++,h.push(r._timesMeshed),r._isFull&&i++,r._isEmpty&&s++,26===r._neighborCount&&a++)});var u=r.length.toString().padEnd(8);if(u+=("exist: "+o).padEnd(12),u+=("full: "+i).padEnd(12),u+=("empty: "+s).padEnd(12),u+=("surr: "+a).padEnd(12),n){var c=h.reduce((e,t)=>e+t,0),l=h.reduce((e,t)=>Math.max(e,t),0),d=h.reduce((e,t)=>Math.min(e,t),0);u+="times meshed: avg "+(c/o).toFixed(2),u+="  max "+l,u+="  min "+d}console.log(t,u)}Xt.prototype.report=function(){console.log("World report - playerChunkLoaded: ",this.playerChunkLoaded),mr(this,"  known:     ",this._chunksKnown.arr,!0),mr(this,"  to request:",this._chunksToRequest.arr,0),mr(this,"  to remove: ",this._chunksToRemove.arr,0),mr(this,"  invalid:   ",this._chunksInvalidated.arr,0),mr(this,"  creating:  ",this._chunksPending.arr,0),mr(this,"  to mesh:   ",this._chunksToMesh.arr,0),mr(this,"  mesh 1st:  ",this._chunksToMeshFirst.arr,0)};var gr=function(e,t="",r){if(!(e>0))return()=>{};var n={},i=0,s=0,o=0,a=0;return h=>{var u,c;"start"===h?(i=s=performance.now(),o++):"end"===h?(()=>{if(a+=performance.now()-i,!(o<e)){var s=`${t}: ${(a/e).toFixed(2)}ms  --  `;s+=Object.keys(n).map(e=>r&&n[e]/a<.05?"":`${e}: ${(n[e]/o).toFixed(2)}ms`).join("  "),console.log(s+`    (avg over ${e} runs)`),n={},o=a=0}})():(u=h,c=performance.now(),n[u]=(n[u]||0)+(c-s),s=c)}}(0,"world ticks:",1),yr=()=>{},_r={debug:!1,silent:!1,silentBabylon:!1,playerHeight:1.8,playerWidth:.6,playerStart:[0,10,0],playerAutoStep:!1,playerShadowComponent:!0,tickRate:30,maxRenderRate:0,blockTestDistance:10,stickyPointerLock:!0,dragCameraOutsidePointerLock:!0,stickyFullscreen:!1,skipDefaultHighlighting:!1,originRebaseDistance:25};class br extends n.EventEmitter{constructor(e={}){if(super(),e=Object.assign({},_r,e),this.version="0.33.0",!e.silent){var t=e.debug?" (debug)":"";console.log(`noa-engine v${this.version}${t}`)}this._paused=!1,this._originRebaseDistance=e.originRebaseDistance,this.worldOriginOffset=[0,0,0],this.positionInCurrentTick=0,this.worldName="default",this.timeScale=1,this.container=new A(this,e),this.tickRate=this.container._shell.tickRate,Object.defineProperty(this,"tickRate",{get:()=>this.container._shell.tickRate}),this.maxRenderRate=this.container._shell.maxRenderRate,Object.defineProperty(this,"maxRenderRate",{get:()=>this.container._shell.maxRenderRate,set:e=>{this.container._shell.maxRenderRate=e||0}}),this.inputs=new C(this,e,this.container.element),this.registry=new et(this,e),this.world=new Xt(this,e);var r=console.log;e.silentBabylon&&(console.log=()=>{}),this.rendering=new gt(this,e,this.container.canvas),e.silentBabylon&&(console.log=r),this.physics=new Gt(this,e),this.entities=new we(this,e),this.ents=this.entities;var n=this.entities;this.playerEntity=n.add(e.playerStart,e.playerWidth,e.playerHeight,null,null,!0,e.playerShadowComponent),n.addComponent(this.playerEntity,n.names.collideTerrain),n.addComponent(this.playerEntity,n.names.collideEntities);var i=n.getPhysics(this.playerEntity).body;if(i.gravityMultiplier=2,i.autoStep=e.playerAutoStep,n.addComponent(this.playerEntity,n.names.receivesInputs),n.addComponent(this.playerEntity,n.names.fadeOnZoom),n.addComponent(this.playerEntity,n.names.movement,{airJumps:1}),this.camera=new O(this,e),this.blockTestDistance=e.blockTestDistance,this.blockTargetIdCheck=this.registry.getBlockSolidity,this.targetedBlock=null,e.skipDefaultHighlighting||(this.defaultBlockHighlightFunction=e=>{e?this.rendering.highlightBlockFace(!0,e.position,e.normal):this.rendering.highlightBlockFace(!1)},this.on("targetBlockChanged",this.defaultBlockHighlightFunction)),this._terrainMesher=new qe(this),this._objectMesher=new Ae(this),this._targetedBlockDat={blockID:0,position:o().create(),normal:o().create(),adjacent:o().create()},this._prevTargetHash=0,this._pickPos=o().create(),this._pickResult={_localPosition:o().create(),position:[0,0,0],normal:[0,0,0]},e.debug){this.vec3=o(),this.ndarray=h(),n.getMovement(1).airJumps=999;var s=window;s.noa=this,s.vec3=o(),s.ndarray=h(),s.scene=this.rendering.scene}!function(e){var t="0.27",r=(e,r,n)=>{var i=()=>{throw`This property changed in ${t} - ${n}`};Object.defineProperty(e,r,{get:i,set:i})};r(e,"getPlayerEyePosition","to get the camera/player offset see API docs for `noa.camera.cameraTarget`"),r(e,"setPlayerEyePosition","to set the camera/player offset see API docs for `noa.camera.cameraTarget`"),r(e,"getPlayerPosition","use `noa.ents.getPosition(noa.playerEntity)` or similar"),r(e,"getCameraVector","use `noa.camera.getDirection`"),r(e,"getPlayerMesh","use `noa.ents.getMeshData(noa.playerEntity).mesh` or similar"),r(e,"playerBody","use `noa.ents.getPhysicsBody(noa.playerEntity)`"),r(e.rendering,"zoomDistance","use `noa.camera.zoomDistance`"),r(e.rendering,"_currentZoom","use `noa.camera.currentZoom`"),r(e.rendering,"_cameraZoomSpeed","use `noa.camera.zoomSpeed`"),r(e.rendering,"getCameraVector","use `noa.camera.getDirection`"),r(e.rendering,"getCameraPosition","use `noa.camera.getLocalPosition`"),r(e.rendering,"getCameraRotation","use `noa.camera.heading` and `noa.camera.pitch`"),r(e.rendering,"setCameraRotation","to customize camera behavior see API docs for `noa.camera`"),t="0.28",r(e.rendering,"makeMeshInstance","removed, use Babylon's `mesh.createInstance`"),r(e.world,"_maxChunksPendingCreation",'use `maxChunksPendingCreation` (no "_")'),r(e.world,"_maxChunksPendingMeshing",'use `maxChunksPendingMeshing` (no "_")'),r(e.world,"_maxProcessingPerTick",'use `maxProcessingPerTick` (no "_")'),r(e.world,"_maxProcessingPerRender",'use `maxProcessingPerRender` (no "_")'),t="0.29",r(e,"_constants","removed, voxel IDs are no longer packed with bit flags"),t="0.30",r(e,"_tickRate","tickRate is now at `noa.tickRate`"),r(e.container,"_tickRate","tickRate is now at `noa.tickRate`"),t="0.31",r(e.world,"chunkSize","effectively an internal, so changed to `_chunkSize`"),r(e.world,"chunkAddDistance","set this with `noa.world.setAddRemoveDistance`"),r(e.world,"chunkRemoveDistance","set this with `noa.world.setAddRemoveDistance`"),t="0.33",r(e.rendering,"postMaterialCreationHook","Removed - use mesh post-creation hook instead`")}(this)}tick(e){if(e*=this.timeScale||1,this._paused)this.world.worldGenWhilePaused&&this.world.tick();else if(kr("start"),function(e){var t=e.ents.getPositionData(e.playerEntity)._localPosition,r=e._originRebaseDistance;if(!(o().sqrLen(t)<r*r)){for(var n=[],i=0;i<3;i++)n[i]=Math.floor(t[i]),e.worldOriginOffset[i]+=n[i];e.rendering._rebaseOrigin(n),e.entities._rebaseOrigin(n),e._objectMesher._rebaseOrigin(n)}}(this),this.world.tick(),kr("world"),this.world.playerChunkLoaded){this.physics.tick(e),kr("physics"),this._objectMesher.tick(),this.rendering.tick(e),kr("rendering"),function(e){var t=0,r=e.blockTargetIdCheck||e.registry.getBlockSolidity,n=e._localPick(null,null,null,r);if(n){var i=e._targetedBlockDat;o().floor(i.adjacent,n.position),o().copy(i.normal,n.normal),o().subtract(i.position,i.adjacent,i.normal),i.blockID=e.world.getBlockID(i.position[0],i.position[1],i.position[2]),e.targetedBlock=i;var s=i.position,a=i.normal,h=Te(s[0]+i.blockID,s[1],s[2]);t=h^=Te(a[0],a[1]+i.blockID,a[2])}else e.targetedBlock=null;t!=e._prevTargetHash&&(e.emit("targetBlockChanged",e.targetedBlock),e._prevTargetHash=t)}(this),kr("targets"),this.entities.tick(e),kr("entities"),this.emit("tick",e),kr("tick event"),kr("end");var t=this.inputs.pointerState;t.scrollx=t.scrolly=t.scrollz=0}else this.rendering.tick(e)}render(e,t){e*=this.timeScale||1,this.positionInCurrentTick=t,this._paused?this.world.worldGenWhilePaused&&this.world.render():(wr("start"),this.camera.applyInputsToCamera(),wr("init"),this.world.render(),wr("meshing"),this.camera.updateBeforeEntityRenderSystems(),this.entities.render(e),this.camera.updateAfterEntityRenderSystems(),wr("entities"),this.emit("beforeRender",e),wr("before render"),this.rendering.render(),this.rendering.postRender(),wr("render"),this.emit("afterRender",e),wr("after render"),wr("end"),this.inputs.pointerState.dx=this.inputs.pointerState.dy=0)}setPaused(e=!1){this._paused=!!e,e||(this.inputs.pointerState.dx=this.inputs.pointerState.dy=0)}getBlock(e,t=0,r=0){return e.length?this.world.getBlockID(e[0],e[1],e[2]):this.world.getBlockID(e,t,r)}setBlock(e,t,r=0,n=0){return t.length?this.world.setBlockID(e,t[0],t[1],t[2]):this.world.setBlockID(e,t,r,n)}addBlock(e,t,r=0,n=0){if(t.length){if(this.entities.isTerrainBlocked(t[0],t[1],t[2]))return;return this.world.setBlockID(e,t[0],t[1],t[2]),e}if(!this.entities.isTerrainBlocked(t,r,n))return this.world.setBlockID(e,t,r,n),e}globalToLocal(e,t,r){var n=this.worldOriginOffset;if(t){for(var i=0;i<3;i++){var s=e[i]-n[i];s+=t[i],r[i]=s}return r}return o().subtract(r,e,n)}localToGlobal(e,t,r=null){var n=this.worldOriginOffset;if(r){for(var i=0;i<3;i++){var s=Math.floor(e[i]);t[i]=s+n[i],r[i]=e[i]-s}return t}return o().add(t,e,n)}pick(e=null,t=null,r=-1,n=null){if(0===r)return null;var i=this._pickPos;return e&&(this.globalToLocal(e,null,i),e=i),this._localPick(e,t,r,n)}_localPick(e=null,t=null,r=-1,n=null){if(0===r)return null;var i=n||this.registry.getBlockSolidity,s=this.world,a=this.worldOriginOffset;e||(e=this.camera._localGetTargetPosition()),t=t||this.camera.getDirection(),(r=r||-1)<0&&(r=this.blockTestDistance);var h=this._pickResult,u=h._localPosition,l=h.normal;return c()(function(e,t,r){var n=s.getBlockID(e+a[0],t+a[1],r+a[2]);return i(n)},e,t,r,u,l)?(o().scaleAndAdd(u,u,l,.01),this.localToGlobal(u,h.position),h):null}}var kr=()=>{},wr=()=>{},xr=r(367);const Mr=new br({debug:!0,showFPS:!0,chunkSize:32,chunkAddDistance:2.5,chunkRemoveDistance:3.5}),Cr=r(5625),Pr=Cr.keys().map(Cr);0===Pr.length?console.error("   PNG-  ../textures/grass/"):console.log("   :",Pr);const Tr=Pr[Math.floor(Math.random()*Pr.length)];console.log("   :",Tr),Mr.registry.registerMaterial("dirt",{color:[.45,.36,.22]}),Mr.registry.registerMaterial("grass",{textureURL:Tr}),Mr.registry.registerMaterial("stone",{textureURL:"./textures/stone1.png"});const Ir=Mr.registry.registerBlock(1,{material:"dirt"}),Dr=Mr.registry.registerBlock(2,{material:"grass"}),Ar=Mr.registry.registerBlock(3,{material:"stone"});function Er(e,t,r){return t<-3?Ar:t<0?Ir:t<2*Math.sin(e/10)+3*Math.cos(r/20)?Dr:0}Mr.world.on("worldDataNeeded",(e,t,r,n,i)=>{for(let e=0;e<t.shape[0];e++)for(let s=0;s<t.shape[1];s++)for(let o=0;o<t.shape[2];o++)t.set(e,s,o,Er(r+e,n+s,i+o));Mr.world.setChunkData(e,t)});const Sr=Mr.playerEntity,Lr=Mr.entities.getPositionData(Sr),Fr=(0,xr.an)("player-mesh",{},Mr.rendering.getScene());Fr.scaling.x=Lr.width,Fr.scaling.y=Lr.height,Fr.scaling.z=Lr.width,Fr.material=Mr.rendering.makeStandardMaterial(),Mr.entities.addComponent(Sr,Mr.entities.names.mesh,{mesh:Fr,offset:[0,Lr.height/2,0]}),Mr.inputs.down.on("fire",()=>{if(Mr.targetedBlock){const e=Mr.targetedBlock.position;Mr.setBlock(0,e[0],e[1],e[2])}}),Mr.inputs.down.on("alt-fire",()=>{if(Mr.targetedBlock){const e=Mr.targetedBlock.adjacent;Mr.setBlock(Dr,e[0],e[1],e[2])}}),Mr.inputs.bind("alt-fire","KeyE"),Mr.on("tick",()=>{const e=Mr.inputs.pointerState.scrolly;0!==e&&(Mr.camera.zoomDistance+=e>0?1:-1,Mr.camera.zoomDistance<0&&(Mr.camera.zoomDistance=0),Mr.camera.zoomDistance>10&&(Mr.camera.zoomDistance=10))})},4628:e=>{e.exports=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e}},4648:(e,t,r)=>{e.exports=function(e,t,r,i,s,o){var a,h;for(t||(t=3),r||(r=0),h=i?Math.min(i*t+r,e.length):e.length,a=r;a<h;a+=t)n[0]=e[a],n[1]=e[a+1],n[2]=e[a+2],s(n,n,o),e[a]=n[0],e[a+1]=n[1],e[a+2]=n[2];return e};var n=r(3592)()},4846:(e,t,r)=>{"use strict";e.exports=function(e,t,r,o,a,h){if(o<=r+1)return r;for(var u=r,c=o,l=o+r>>>1,d=2*e,f=l,p=a[d*l+t];u<c;){if(c-u<i){s(e,t,u,c,a,h),p=a[d*l+t];break}var v=c-u,m=Math.random()*v+u|0,g=a[d*m+t],y=Math.random()*v+u|0,_=a[d*y+t],b=Math.random()*v+u|0,k=a[d*b+t];g<=_?k>=_?(f=y,p=_):g>=k?(f=m,p=g):(f=b,p=k):_>=k?(f=y,p=_):k>=g?(f=m,p=g):(f=b,p=k);for(var w=d*(c-1),x=d*f,M=0;M<d;++M,++w,++x){var C=a[w];a[w]=a[x],a[x]=C}var P=h[c-1];for(h[c-1]=h[f],h[f]=P,w=d*(c-1),x=d*(f=n(e,t,u,c-1,a,h,p)),M=0;M<d;++M,++w,++x)C=a[w],a[w]=a[x],a[x]=C;if(P=h[c-1],h[c-1]=h[f],h[f]=P,l<f){for(c=f-1;u<c&&a[d*(c-1)+t]===p;)c-=1;c+=1}else{if(!(f<l))break;for(u=f+1;u<c&&a[d*u+t]===p;)u+=1}}return n(e,t,r,l,a,h,a[d*l+t])};var n=r(5640)("lo<p0",["p0"]),i=8;function s(e,t,r,n,i,s){for(var o=2*e,a=o*(r+1)+t,h=r+1;h<n;++h,a+=o)for(var u=i[a],c=h,l=o*(h-1);c>r&&i[l+t]>u;--c,l-=o){for(var d=l,f=l+o,p=0;p<o;++p,++d,++f){var v=i[d];i[d]=i[f],i[f]=v}var m=s[c];s[c]=s[c-1],s[c-1]=m}}},4881:e=>{"use strict";var t=[],r=[],n=[],i=[],s=[],o=[],a=[],h=[],u=[],c=[],l=[],d=[];e.exports=function(e,f,p,v,m,g){for(var y=a,_=u,b=c,k=d,w=0;w<3;w++)y[w]=+p[w],b[w]=+f.max[w],_[w]=+f.base[w];g||(g=1e-10);var x=function(e,a,u,c,d,f){var p=t,v=r,m=n,g=i,y=s,_=o,b=h,k=Math.floor,w=0,x=0,M=0,C=0,P=0;if(T(),0===M)return 0;for(C=A();x<=M;){if(I(C)&&D())return w;C=A()}for(w+=M,P=0;P<3;P++)c[P]+=u[P],d[P]+=u[P];return w;function T(){if(x=0,0!==(M=Math.sqrt(u[0]*u[0]+u[1]*u[1]+u[2]*u[2])))for(var e=0;e<3;e++){var t=u[e]>=0;g[e]=t?1:-1;var r=t?d[e]:c[e];p[e]=t?c[e]:d[e],v[e]=E(r,g[e]),m[e]=S(p[e],g[e]),b[e]=u[e]/M,y[e]=Math.abs(1/b[e]);var n=t?v[e]+1-r:r-v[e];_[e]=y[e]<1/0?y[e]*n:1/0}}function I(t){for(var r=g[0],n=0===t?v[0]:m[0],i=v[0]+r,s=g[1],o=1===t?v[1]:m[1],a=v[1]+s,h=g[2],u=2===t?v[2]:m[2],c=v[2]+h,l=n;l!=i;l+=r)for(var d=o;d!=a;d+=s)for(var f=u;f!=c;f+=h)if(e(l,d,f))return!0;return!1}function D(){w+=x;var e=g[C],t=x/M,r=l;for(P=0;P<3;P++){var n=u[P]*t;c[P]+=n,d[P]+=n,r[P]=u[P]-n}if(e>0?d[C]=Math.round(d[C]):c[C]=Math.round(c[C]),a(w,C,e,r))return!0;for(P=0;P<3;P++)u[P]=r[P];return T(),0===M}function A(){var e=_[0]<_[1]?_[0]<_[2]?0:2:_[1]<_[2]?1:2,t=_[e]-x;for(x=_[e],v[e]+=g[e],_[e]+=y[e],P=0;P<3;P++)p[P]+=t*b[P],m[P]=S(p[P],g[P]);return e}function E(e,t){return k(e-t*f)}function S(e,t){return k(e+t*f)}}(e,v,y,_,b,g);if(!m){for(w=0;w<3;w++)k[w]=p[w]>0?b[w]-f.max[w]:_[w]-f.base[w];f.translate(k)}return x}},5010:e=>{e.exports=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}},5189:(e,t,r)=>{"use strict";e.exports=r.p+"textures/grass_005_score0.0290.png"},5234:(e,t,r)=>{"use strict";e.exports=r.p+"textures/grass_016_score0.0288.png"},5262:e=>{e.exports=function(e){return null!=e&&null!=e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}},5530:(e,t,r)=>{e.exports={EPSILON:r(6328),create:r(3592),clone:r(2919),angle:r(645),fromValues:r(4246),copy:r(461),set:r(5898),equals:r(2761),exactEquals:r(6236),add:r(193),subtract:r(5764),sub:r(1932),multiply:r(3824),mul:r(7424),divide:r(1365),div:r(6033),min:r(2070),max:r(7768),floor:r(7212),ceil:r(9013),round:r(6610),scale:r(2864),scaleAndAdd:r(4628),distance:r(3515),dist:r(4144),squaredDistance:r(704),sqrDist:r(664),length:r(7760),len:r(8957),squaredLength:r(1227),sqrLen:r(9909),negate:r(5010),inverse:r(4118),normalize:r(3201),dot:r(4081),cross:r(4290),lerp:r(277),random:r(7219),transformMat4:r(2608),transformMat3:r(3109),transformQuat:r(2081),rotateX:r(8119),rotateY:r(720),rotateZ:r(1609),forEach:r(4648)}},5625:(e,t,r)=>{var n={"./grass_001_score0.0277.png":9236,"./grass_002_score0.0286.png":5775,"./grass_003_score0.0261.png":1659,"./grass_004_score0.0268.png":1749,"./grass_005_score0.0290.png":5189,"./grass_006_score0.0297.png":9397,"./grass_007_score0.0283.png":371,"./grass_008_score0.0294.png":380,"./grass_009_score0.0298.png":4217,"./grass_010_score0.0294.png":3795,"./grass_011_score0.0267.png":9460,"./grass_012_score0.0288.png":3526,"./grass_013_score0.0299.png":689,"./grass_014_score0.0294.png":1095,"./grass_015_score0.0295.png":1959,"./grass_016_score0.0288.png":5234,"./grass_017_score0.0289.png":9958,"./grass_018_score0.0281.png":8445,"./grass_019_score0.0276.png":9918};function i(e){var t=s(e);return r(t)}function s(e){if(!r.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}i.keys=function(){return Object.keys(n)},i.resolve=s,e.exports=i,i.id=5625},5640:e=>{"use strict";e.exports=function(e,r){var n="abcdef".split("").concat(r),i=[];return e.indexOf("lo")>=0&&i.push("lo=e[k+n]"),e.indexOf("hi")>=0&&i.push("hi=e[k+o]"),n.push(t.replace("_",i.join()).replace("$",e)),Function.apply(void 0,n)};var t="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},5764:e=>{e.exports=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}},5775:(e,t,r)=>{"use strict";e.exports=r.p+"textures/grass_002_score0.0286.png"},5898:e=>{e.exports=function(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e}},5955:e=>{"use strict";e.exports=function(e){for(var t=new Array(e),r=0;r<e;++r)t[r]=r;return t}},5991:(e,t,r)=>{var n=r(5955),i=r(2149),s="undefined"!=typeof Float64Array;function o(e,t){return e[0]-t[0]}function a(){var e,t=this.stride,r=new Array(t.length);for(e=0;e<r.length;++e)r[e]=[Math.abs(t[e]),e];r.sort(o);var n=new Array(r.length);for(e=0;e<n.length;++e)n[e]=r[e][1];return n}function h(e,t){var r=["View",t,"d",e].join("");t<0&&(r="View_Nil"+e);var i="generic"===e;if(-1===t){var s="function "+r+"(a){this.data=a;};var proto="+r+".prototype;proto.dtype='"+e+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+r+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+r+"(a){return new "+r+"(a);}";return new Function(s)()}if(0===t)return s="function "+r+"(a,d) {this.data = a;this.offset = d};var proto="+r+".prototype;proto.dtype='"+e+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+r+"_copy() {return new "+r+"(this.data,this.offset)};proto.pick=function "+r+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+r+"_get(){return "+(i?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+r+"_set(v){return "+(i?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+r+"(a,b,c,d){return new "+r+"(a,d)}",new Function("TrivialArray",s)(u[e][0]);s=["'use strict'"];var o=n(t),h=o.map(function(e){return"i"+e}),c="this.offset+"+o.map(function(e){return"this.stride["+e+"]*i"+e}).join("+"),l=o.map(function(e){return"b"+e}).join(","),d=o.map(function(e){return"c"+e}).join(",");s.push("function "+r+"(a,"+l+","+d+",d){this.data=a","this.shape=["+l+"]","this.stride=["+d+"]","this.offset=d|0}","var proto="+r+".prototype","proto.dtype='"+e+"'","proto.dimension="+t),s.push("Object.defineProperty(proto,'size',{get:function "+r+"_size(){return "+o.map(function(e){return"this.shape["+e+"]"}).join("*"),"}})"),1===t?s.push("proto.order=[0]"):(s.push("Object.defineProperty(proto,'order',{get:"),t<4?(s.push("function "+r+"_order(){"),2===t?s.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===t&&s.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):s.push("ORDER})")),s.push("proto.set=function "+r+"_set("+h.join(",")+",v){"),i?s.push("return this.data.set("+c+",v)}"):s.push("return this.data["+c+"]=v}"),s.push("proto.get=function "+r+"_get("+h.join(",")+"){"),i?s.push("return this.data.get("+c+")}"):s.push("return this.data["+c+"]}"),s.push("proto.index=function "+r+"_index(",h.join(),"){return "+c+"}"),s.push("proto.hi=function "+r+"_hi("+h.join(",")+"){return new "+r+"(this.data,"+o.map(function(e){return["(typeof i",e,"!=='number'||i",e,"<0)?this.shape[",e,"]:i",e,"|0"].join("")}).join(",")+","+o.map(function(e){return"this.stride["+e+"]"}).join(",")+",this.offset)}");var f=o.map(function(e){return"a"+e+"=this.shape["+e+"]"}),p=o.map(function(e){return"c"+e+"=this.stride["+e+"]"});s.push("proto.lo=function "+r+"_lo("+h.join(",")+"){var b=this.offset,d=0,"+f.join(",")+","+p.join(","));for(var v=0;v<t;++v)s.push("if(typeof i"+v+"==='number'&&i"+v+">=0){d=i"+v+"|0;b+=c"+v+"*d;a"+v+"-=d}");for(s.push("return new "+r+"(this.data,"+o.map(function(e){return"a"+e}).join(",")+","+o.map(function(e){return"c"+e}).join(",")+",b)}"),s.push("proto.step=function "+r+"_step("+h.join(",")+"){var "+o.map(function(e){return"a"+e+"=this.shape["+e+"]"}).join(",")+","+o.map(function(e){return"b"+e+"=this.stride["+e+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil"),v=0;v<t;++v)s.push("if(typeof i"+v+"==='number'){d=i"+v+"|0;if(d<0){c+=b"+v+"*(a"+v+"-1);a"+v+"=ceil(-a"+v+"/d)}else{a"+v+"=ceil(a"+v+"/d)}b"+v+"*=d}");s.push("return new "+r+"(this.data,"+o.map(function(e){return"a"+e}).join(",")+","+o.map(function(e){return"b"+e}).join(",")+",c)}");var m=new Array(t),g=new Array(t);for(v=0;v<t;++v)m[v]="a[i"+v+"]",g[v]="b[i"+v+"]";for(s.push("proto.transpose=function "+r+"_transpose("+h+"){"+h.map(function(e,t){return e+"=("+e+"===undefined?"+t+":"+e+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+r+"(this.data,"+m.join(",")+","+g.join(",")+",this.offset)}"),s.push("proto.pick=function "+r+"_pick("+h+"){var a=[],b=[],c=this.offset"),v=0;v<t;++v)s.push("if(typeof i"+v+"==='number'&&i"+v+">=0){c=(c+this.stride["+v+"]*i"+v+")|0}else{a.push(this.shape["+v+"]);b.push(this.stride["+v+"])}");return s.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),s.push("return function construct_"+r+"(data,shape,stride,offset){return new "+r+"(data,"+o.map(function(e){return"shape["+e+"]"}).join(",")+","+o.map(function(e){return"stride["+e+"]"}).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",s.join("\n"))(u[e],a)}var u={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};e.exports=function(e,t,r,n){if(void 0===e)return(0,u.array[0])([]);"number"==typeof e&&(e=[e]),void 0===t&&(t=[e.length]);var o=t.length;if(void 0===r){r=new Array(o);for(var a=o-1,c=1;a>=0;--a)r[a]=c,c*=t[a]}if(void 0===n)for(n=0,a=0;a<o;++a)r[a]<0&&(n-=(t[a]-1)*r[a]);for(var l=function(e){if(i(e))return"buffer";if(s)switch(Object.prototype.toString.call(e)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(e)?"array":"generic"}(e),d=u[l];d.length<=o+1;)d.push(h(l,d.length-1));return(0,d[o+1])(e,t,r,n)}},6033:(e,t,r)=>{e.exports=r(1365)},6084:e=>{"use strict";e.exports=function(e,t,r,n,i,s){var o=+t[0],a=+t[1],h=+t[2],u=+r[0],c=+r[1],l=+r[2],d=Math.sqrt(u*u+c*c+l*l);if(0===d)throw new Error("Can't raycast along a zero vector");return function(e,t,r,n,i,s,o,a,h,u){for(var c=0,l=Math.floor,d=0|l(t),f=0|l(r),p=0|l(n),v=i>0?1:-1,m=s>0?1:-1,g=o>0?1:-1,y=Math.abs(1/i),_=Math.abs(1/s),b=Math.abs(1/o),k=y<1/0?y*(v>0?d+1-t:t-d):1/0,w=_<1/0?_*(m>0?f+1-r:r-f):1/0,x=b<1/0?b*(g>0?p+1-n:n-p):1/0,M=-1;c<=a;){var C=e(d,f,p);if(C)return h&&(h[0]=t+c*i,h[1]=r+c*s,h[2]=n+c*o),u&&(u[0]=u[1]=u[2]=0,0===M&&(u[0]=-v),1===M&&(u[1]=-m),2===M&&(u[2]=-g)),C;k<w?k<x?(d+=v,c=k,k+=y,M=0):(p+=g,c=x,x+=b,M=2):w<x?(f+=m,c=w,w+=_,M=1):(p+=g,c=x,x+=b,M=2)}return h&&(h[0]=t+c*i,h[1]=r+c*s,h[2]=n+c*o),u&&(u[0]=u[1]=u[2]=0),0}(e,o,a,h,u/=d,c/=d,l/=d,n=void 0===n?64:+n,i,s)}},6236:e=>{e.exports=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}},6328:e=>{e.exports=1e-6},6426:(e,t)=>{"use strict";var r=["d","ax","vv","rs","re","rb","ri","bs","be","bb","bi"];function n(e){var t="bruteForce"+(e?"Full":"Partial"),n=[],i=r.slice();e||i.splice(3,0,"fp");var s=["function "+t+"("+i.join()+"){"];function o(t,i){var o=function(e,t,n){var i="bruteForce"+(e?"Red":"Blue")+(t?"Flip":"")+(n?"Full":""),s=["function ",i,"(",r.join(),"){","var ","es","=2*","d",";"],o="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",a="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(n?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return e?s.push(o,"Q",":",a):s.push(a,"Q",":",o),n?s.push("if(y1<x0||x1<y0)continue;"):t?s.push("if(y0<=x0||x1<y0)continue;"):s.push("if(y0<x0||x1<y0)continue;"),s.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),t?s.push("yi,xi"):s.push("xi,yi"),s.push(");if(rv!==void 0)return rv;}}}"),{name:i,code:s.join("")}}(t,i,e);n.push(o.code),s.push("return "+o.name+"("+r.join()+");")}s.push("if(re-rs>be-bs){"),e?(o(!0,!1),s.push("}else{"),o(!1,!1)):(s.push("if(fp){"),o(!0,!0),s.push("}else{"),o(!0,!1),s.push("}}else{if(fp){"),o(!1,!0),s.push("}else{"),o(!1,!1),s.push("}")),s.push("}}return "+t);var a=n.join("")+s.join("");return new Function(a)()}t.partial=n(!1),t.full=n(!0)},6534:e=>{function t(e,t){var r=e._map[t];if(delete e.hash[t],delete e._map[t],r===e.list.length-1)e.list.pop();else{var n=e.list.pop();if(e.list[r]=n,null===n||null===n[0]){var i=e.list.length;for(var s in e._map)if(e._map[s]===i)return void(e._map[s]=r)}else{var o=n.__id||n[0].__id;e._map[o]=r}}}e.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(e,t){if("number"==typeof this._map[e]){var r=this._map[e];this.hash[e]=t,this.list[r]=t}else this._map[e]=this.list.length,this.hash[e]=t,this.list.push(t)}remove(e){var t=this._map[e];this.hash[e]=null,this.list[t]=null,this._pendingRemovals.push(e)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var e=0;e<this._pendingRemovals.length;e++){var r=this._pendingRemovals[e];null===this.hash[r]&&t(this,r)}this._pendingRemovals.length=0}}},6610:e=>{e.exports=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}},7212:e=>{e.exports=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}},7219:e=>{e.exports=function(e,t){t=t||1;var r=2*Math.random()*Math.PI,n=2*Math.random()-1,i=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(r)*i,e[1]=Math.sin(r)*i,e[2]=n*t,e}},7317:(e,t)=>{"use strict";function r(e){var t=32;return(e&=-e)&&t--,65535&e&&(t-=16),16711935&e&&(t-=8),252645135&e&&(t-=4),858993459&e&&(t-=2),1431655765&e&&(t-=1),t}t.INT_BITS=32,t.INT_MAX=2147483647,t.INT_MIN=-1<<31,t.sign=function(e){return(e>0)-(e<0)},t.abs=function(e){var t=e>>31;return(e^t)-t},t.min=function(e,t){return t^(e^t)&-(e<t)},t.max=function(e,t){return e^(e^t)&-(e<t)},t.isPow2=function(e){return!(e&e-1||!e)},t.log2=function(e){var t,r;return t=(e>65535)<<4,t|=r=((e>>>=t)>255)<<3,t|=r=((e>>>=r)>15)<<2,(t|=r=((e>>>=r)>3)<<1)|(e>>>=r)>>1},t.log10=function(e){return e>=1e9?9:e>=1e8?8:e>=1e7?7:e>=1e6?6:e>=1e5?5:e>=1e4?4:e>=1e3?3:e>=100?2:e>=10?1:0},t.popCount=function(e){return 16843009*((e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)>>>24},t.countTrailingZeros=r,t.nextPow2=function(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,1+(e|=e>>>16)},t.prevPow2=function(e){return e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)-(e>>>1)},t.parity=function(e){return e^=e>>>16,e^=e>>>8,e^=e>>>4,27030>>>(e&=15)&1};var n=new Array(256);!function(e){for(var t=0;t<256;++t){var r=t,n=t,i=7;for(r>>>=1;r;r>>>=1)n<<=1,n|=1&r,--i;e[t]=n<<i&255}}(n),t.reverse=function(e){return n[255&e]<<24|n[e>>>8&255]<<16|n[e>>>16&255]<<8|n[e>>>24&255]},t.interleave2=function(e,t){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))<<1},t.deinterleave2=function(e,t){return(e=65535&((e=16711935&((e=252645135&((e=858993459&((e=e>>>t&1431655765)|e>>>1))|e>>>2))|e>>>4))|e>>>16))<<16>>16},t.interleave3=function(e,t,r){return e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2),(e|=(t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2))<<1)|(r=1227133513&((r=3272356035&((r=251719695&((r=4278190335&((r&=1023)|r<<16))|r<<8))|r<<4))|r<<2))<<2},t.deinterleave3=function(e,t){return(e=1023&((e=4278190335&((e=251719695&((e=3272356035&((e=e>>>t&1227133513)|e>>>2))|e>>>4))|e>>>8))|e>>>16))<<22>>22},t.nextCombination=function(e){var t=e|e-1;return t+1|(~t&-~t)-1>>>r(e)+1}},7424:(e,t,r)=>{e.exports=r(3824)},7760:e=>{e.exports=function(e){var t=e[0],r=e[1],n=e[2];return Math.sqrt(t*t+r*r+n*n)}},7768:e=>{e.exports=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}},7975:e=>{"use strict";var t,r="object"==typeof Reflect?Reflect:null,n=r&&"function"==typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise(function(r,n){function i(r){e.removeListener(t,s),n(r)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",i),r([].slice.call(arguments))}v(e,t,s,{once:!0}),"error"!==t&&function(e,t){"function"==typeof e.on&&v(e,"error",t,{once:!0})}(e,i)})},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function h(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function u(e,t,r,n){var i,s,o,u;if(a(r),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),o=s[t]),void 0===o)o=s[t]=r,++e._eventsCount;else if("function"==typeof o?o=s[t]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),(i=h(e))>0&&o.length>i&&!o.warned){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=o.length,u=c,console&&console.warn&&console.warn(u)}return e}function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=c.bind(n);return i.listener=r,n.wrapFn=i,i}function d(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):p(i,i.length)}function f(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function p(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function v(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,function i(s){n.once&&e.removeEventListener(t,i),r(s)})}}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return h(this)},s.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i="error"===e,s=this._events;if(void 0!==s)i=i&&void 0===s.error;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var h=s[e];if(void 0===h)return!1;if("function"==typeof h)n(h,this,t);else{var u=h.length,c=p(h,u);for(r=0;r<u;++r)n(c[r],this,t)}return!0},s.prototype.addListener=function(e,t){return u(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return u(this,e,t,!0)},s.prototype.once=function(e,t){return a(t),this.on(e,l(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,l(this,e,t)),this},s.prototype.removeListener=function(e,t){var r,n,i,s,o;if(a(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,s=r.length-1;s>=0;s--)if(r[s]===t||r[s].listener===t){o=r[s].listener,i=s;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,o||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,s=Object.keys(r);for(n=0;n<s.length;++n)"removeListener"!==(i=s[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},s.prototype.listeners=function(e){return d(this,e,!0)},s.prototype.rawListeners=function(e){return d(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):f.call(e,t)},s.prototype.listenerCount=f,s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},8116:e=>{"use strict";e.exports=function(e,n){n<=4*t?r(0,n-1,e):u(0,n-1,e)};var t=32;function r(e,t,r){for(var n=2*(e+1),i=e+1;i<=t;++i){for(var s=r[n++],o=r[n++],a=i,h=n-2;a-- >e;){var u=r[h-2],c=r[h-1];if(u<s)break;if(u===s&&c<o)break;r[h]=u,r[h+1]=c,h-=2}r[h]=s,r[h+1]=o}}function n(e,t,r){t*=2;var n=r[e*=2],i=r[e+1];r[e]=r[t],r[e+1]=r[t+1],r[t]=n,r[t+1]=i}function i(e,t,r){t*=2,r[e*=2]=r[t],r[e+1]=r[t+1]}function s(e,t,r,n){t*=2,r*=2;var i=n[e*=2],s=n[e+1];n[e]=n[t],n[e+1]=n[t+1],n[t]=n[r],n[t+1]=n[r+1],n[r]=i,n[r+1]=s}function o(e,t,r,n,i){t*=2,i[e*=2]=i[t],i[t]=r,i[e+1]=i[t+1],i[t+1]=n}function a(e,t,r){t*=2;var n=r[e*=2],i=r[t];return!(n<i)&&(n!==i||r[e+1]>r[t+1])}function h(e,t,r,n){var i=n[e*=2];return i<t||i===t&&n[e+1]<r}function u(e,c,l){var d=(c-e+1)/6|0,f=e+d,p=c-d,v=e+c>>1,m=v-d,g=v+d,y=f,_=m,b=v,k=g,w=p,x=e+1,M=c-1,C=0;a(y,_,l)&&(C=y,y=_,_=C),a(k,w,l)&&(C=k,k=w,w=C),a(y,b,l)&&(C=y,y=b,b=C),a(_,b,l)&&(C=_,_=b,b=C),a(y,k,l)&&(C=y,y=k,k=C),a(b,k,l)&&(C=b,b=k,k=C),a(_,w,l)&&(C=_,_=w,w=C),a(_,b,l)&&(C=_,_=b,b=C),a(k,w,l)&&(C=k,k=w,w=C);for(var P=l[2*_],T=l[2*_+1],I=l[2*k],D=l[2*k+1],A=2*y,E=2*b,S=2*w,L=2*f,F=2*v,R=2*p,B=0;B<2;++B){var j=l[A+B],O=l[E+B],z=l[S+B];l[L+B]=j,l[F+B]=O,l[R+B]=z}i(m,e,l),i(g,c,l);for(var U=x;U<=M;++U)if(h(U,P,T,l))U!==x&&n(U,x,l),++x;else if(!h(U,I,D,l))for(;;){if(h(M,I,D,l)){h(M,P,T,l)?(s(U,x,M,l),++x,--M):(n(U,M,l),--M);break}if(--M<U)break}o(e,x-1,P,T,l),o(c,M+1,I,D,l),x-2-e<=t?r(e,x-2,l):u(e,x-2,l),c-(M+2)<=t?r(M+2,c,l):u(M+2,c,l),M-x<=t?r(x,M,l):u(x,M,l)}},8119:e=>{e.exports=function(e,t,r,n){var i=r[1],s=r[2],o=t[1]-i,a=t[2]-s,h=Math.sin(n),u=Math.cos(n);return e[0]=t[0],e[1]=i+o*u-a*h,e[2]=s+o*h+a*u,e}},8445:(e,t,r)=>{"use strict";e.exports=r.p+"textures/grass_018_score0.0281.png"},8770:(e,t,r)=>{"use strict";e.exports=function(e,t,r){switch(arguments.length){case 1:return n=[],u(i=e,i,c,!0),n;case 2:return"function"==typeof t?u(e,e,t,!0):function(e,t){return n=[],u(e,t,c,!1),n}(e,t);case 3:return u(e,t,r,!1);default:throw new Error("box-intersect: Invalid arguments")}var i};var n,i=r(2461),s=r(2050),o=r(4123);function a(e,t){for(var r=0;r<e;++r)if(!(t[r]<=t[r+e]))return!0;return!1}function h(e,t,r,n){for(var i=0,s=0,o=0,h=e.length;o<h;++o){var u=e[o];if(!a(t,u)){for(var c=0;c<2*t;++c)r[i++]=u[c];n[s++]=o}}return s}function u(e,t,r,n){var a=e.length,u=t.length;if(!(a<=0||u<=0)){var c=e[0].length>>>1;if(!(c<=0)){var l,d=i.mallocDouble(2*c*a),f=i.mallocInt32(a);if((a=h(e,c,d,f))>0){if(1===c&&n)s.init(a),l=s.sweepComplete(c,r,0,a,d,f,0,a,d,f);else{var p=i.mallocDouble(2*c*u),v=i.mallocInt32(u);(u=h(t,c,p,v))>0&&(s.init(a+u),l=1===c?s.sweepBipartite(c,r,0,a,d,f,0,u,p,v):o(c,r,n,a,d,f,u,p,v),i.free(p),i.free(v))}i.free(d),i.free(f)}return l}}}function c(e,t){n.push([e,t])}},8957:(e,t,r)=>{e.exports=r(7760)},9013:e=>{e.exports=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}},9236:(e,t,r)=>{"use strict";e.exports=r.p+"textures/grass_001_score0.0277.png"},9397:(e,t,r)=>{"use strict";e.exports=r.p+"textures/grass_006_score0.0297.png"},9460:(e,t,r)=>{"use strict";e.exports=r.p+"textures/grass_011_score0.0267.png"},9463:e=>{"use strict";function t(e,r,n){var i=0|e[n];if(i<=0)return[];var s,o=new Array(i);if(n===e.length-1)for(s=0;s<i;++s)o[s]=r;else for(s=0;s<i;++s)o[s]=t(e,r,n+1);return o}e.exports=function(e,r){switch(void 0===r&&(r=0),typeof e){case"number":if(e>0)return function(e,t){var r,n;for(r=new Array(e),n=0;n<e;++n)r[n]=t;return r}(0|e,r);break;case"object":if("number"==typeof e.length)return t(e,r,0)}return[]}},9909:(e,t,r)=>{e.exports=r(1227)},9918:(e,t,r)=>{"use strict";e.exports=r.p+"textures/grass_019_score0.0276.png"},9958:(e,t,r)=>{"use strict";e.exports=r.p+"textures/grass_017_score0.0289.png"}},r={};function n(e){var i=r[e];if(void 0!==i)return i.exports;var s=r[e]={exports:{}};return t[e](s,s.exports,n),s.exports}n.m=t,e=[],n.O=(t,r,i,s)=>{if(!r){var o=1/0;for(c=0;c<e.length;c++){for(var[r,i,s]=e[c],a=!0,h=0;h<r.length;h++)(!1&s||o>=s)&&Object.keys(n.O).every(e=>n.O[e](r[h]))?r.splice(h--,1):(a=!1,s<o&&(o=s));if(a){e.splice(c--,1);var u=i();void 0!==u&&(t=u)}}return t}s=s||0;for(var c=e.length;c>0&&e[c-1][2]>s;c--)e[c]=e[c-1];e[c]=[r,i,s]},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var i=r.length-1;i>-1&&(!e||!/^http(s?):/.test(e));)e=r[i--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),(()=>{var e={792:0};n.O.j=t=>0===e[t];var t=(t,r)=>{var i,s,[o,a,h]=r,u=0;if(o.some(t=>0!==e[t])){for(i in a)n.o(a,i)&&(n.m[i]=a[i]);if(h)var c=h(n)}for(t&&t(r);u<o.length;u++)s=o[u],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return n.O(c)},r=self.webpackChunk=self.webpackChunk||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var i=n.O(void 0,[926],()=>n(4517));i=n.O(i)})();
//# sourceMappingURL=bundle.js.map