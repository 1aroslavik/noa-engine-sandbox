import { createNoise2D } from "simplex-noise"

// —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π seed
let seed = Math.floor(Math.random() * 1e9)
function rnd() {
    seed = (seed * 16807) % 2147483647
    return (seed - 1) / 2147483646
}

// –±–∏–æ–º–Ω—ã–µ —à—É–º—ã
const _temp = createNoise2D(rnd)
const _moist = createNoise2D(rnd)
const _height = createNoise2D(rnd)

// –î–û–ë–ê–í–õ–Ø–ï–ú –ù–û–í–´–ï –®–£–ú–´ –î–õ–Ø –í–û–î–´
const _lake  = createNoise2D(rnd)
const _river = createNoise2D(rnd)
const _water = createNoise2D(rnd)

// ===== –≠–ö–°–ü–û–†–¢–´ =====
export function noiseTemp(x, z) {
    return _temp(x * 0.001, z * 0.001)
}

export function noiseMoist(x, z) {
    return _moist(x * 0.001, z * 0.001)
}

export function noiseHeight(x, z) {
    return _height(x * 0.0008, z * 0.0008)
}

// –≠–¢–û–ì–û –ù–ï –•–í–ê–¢–ê–õ–û
export function noiseLake(x, z) {
    return _lake(x, z)
}

export function noiseRiver(x, z) {
    return _river(x, z)
}

export function noiseWater(x, z) {
    return _water(x, z)
}

// ========= –ù–û–í–´–ï –ë–ò–û–ú–´ =========
export function getBiome(x, z) {
    const t = noiseTemp(x, z)    // —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞
    const m = noiseMoist(x, z)   // –≤–ª–∞–∂–Ω–æ—Å—Ç—å
    const h = noiseHeight(x, z)  // –ù–ï –∞–±—Å–æ–ª—é—Ç–Ω–∞—è –≤—ã—Å–æ—Ç–∞, –∞ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —à—É–º

    // ---- –≤—ã—á–∏—Å–ª—è–µ–º —Ä–µ–∞–ª—å–Ω—É—é –≤—ã—Å–æ—Ç—É –≤ –º–∏—Ä–µ ----
    const realH = 38 + (h * 32)  // –∫–∞–∫ –≤ —Ç–≤–æ—ë–º getHeightAt()

    // =====================================================
    // ‚ùÑ –í–´–°–û–ö–û–ì–û–†–ù–´–ô –°–ù–ï–ì ‚Äî –í–°–ï–ì–î–ê –°–ù–ï–ì –ù–ê –í–ï–†–®–ò–ù–ê–• –ì–û–†
    // =====================================================
    if (realH > 80) return "snow";

    // =====================================================
    // ‚ùÑ –°–ò–õ–¨–ù–û –•–û–õ–û–î–ù–´–ï –ë–ò–û–ú–´
    // =====================================================
    if (t < -0.55 && m < 0) return "ice";    // –ª–µ–¥—è–Ω—ã–µ —Ä–∞–≤–Ω–∏–Ω—ã
    if (t < -0.40 && h > 0.35) return "snow";
    if (t < -0.35) return "tundra";

    // =====================================================
    // ‚õ∞ –ì–û–†–´ (–ù–ï –≤—ã—Å–æ–∫–∏–µ)
    // =====================================================
    if (h > 0.55) return "mountain";

    // =====================================================
    // üèú –ü–£–°–¢–´–ù–ò
    // =====================================================
    if (t > 0.35 && m < -0.25) return "red_desert";
    if (t > 0.25 && m < -0.10) return "desert";

    // =====================================================
    // üåæ –°–£–•–ò–ï –õ–£–ì–ê
    // =====================================================
    if (t > 0.15 && m < 0.05) return "dry";

    // =====================================================
    // üå≤ –õ–ï–°–ê
    // =====================================================
    if (m > 0.25) return "forest";

    // =====================================================
    // üå± –†–ê–í–ù–ò–ù–´ ‚Äì –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    // =====================================================
    return "plains";
}
